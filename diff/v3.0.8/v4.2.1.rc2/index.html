<!DOCTYPE html>
<html>
  <head>
    <title>Rails v3.0.8 - v4.2.1.rc2 diff - RailsDiff</title>
    <link href='/assets/pygment_trac.css' rel='stylesheet'>
    <link href='/assets/app.css' rel='stylesheet'>
  </head>
  <body>
    <header>
      <h1>
        <a href='/'>RailsDiff</a>
      </h1>
      <form>
        <label>
          Source
          <select name='source'></select>
        </label>
        <a class='switch' href='#'><img src='/assets/arrow_refresh.png'></a>
        <label>
          Target
          <select name='target'></select>
        </label>
        <input type='submit' value='View Diff'>
      </form>
    </header>
    <div class='content'>
      <div class='diff'>
        <h2>
          <a href='full/#-gitignore'>.gitignore</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -1,4 +1,17 @@</span>
        <span class="gd">-.bundle</span>
        <span class="gd">-db/*.sqlite3</span>
        <span class="gd">-log/*.log</span>
        <span class="gd">-tmp/</span>
        <span class="gi">+# See https://help.github.com/articles/ignoring-files for more about ignoring files.</span>
        <span class="gi">+#</span>
        <span class="gi">+# If you find yourself ignoring temporary files generated by your text editor</span>
        <span class="gi">+# or operating system, you probably want to add a global ignore instead:</span>
        <span class="gi">+#   git config --global core.excludesfile &#39;~/.gitignore_global&#39;</span>
        <span class="gi">+</span>
        <span class="gi">+# Ignore bundler config.</span>
        <span class="gi">+/.bundle</span>
        <span class="gi">+</span>
        <span class="gi">+# Ignore the default SQLite database.</span>
        <span class="gi">+/db/*.sqlite3</span>
        <span class="gi">+/db/*.sqlite3-journal</span>
        <span class="gi">+</span>
        <span class="gi">+# Ignore all logfiles and tempfiles.</span>
        <span class="gi">+/log/*</span>
        <span class="gi">+!/log/.keep</span>
        <span class="gi">+/tmp</span>
        </pre></div>
        <h2>
          <a href='full/#Gemfile'>Gemfile</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -1,31 +1,45 @@</span>
        <span class="gd">-source &#39;http://rubygems.org&#39;</span>
        <span class="gi">+source &#39;https://rubygems.org&#39;</span>
         
        <span class="gd">-gem &#39;rails&#39;, &#39;3.0.8&#39;</span>
        <span class="gd">-</span>
        <span class="gd">-# Bundle edge Rails instead:</span>
        <span class="gd">-# gem &#39;rails&#39;, :git =&gt; &#39;git://github.com/rails/rails.git&#39;</span>
         
        <span class="gi">+# Bundle edge Rails instead: gem &#39;rails&#39;, github: &#39;rails/rails&#39;</span>
        <span class="gi">+gem &#39;rails&#39;, &#39;4.2.1.rc2&#39;</span>
        <span class="gi">+# Use sqlite3 as the database for Active Record</span>
         gem &#39;sqlite3&#39;
        <span class="gi">+# Use SCSS for stylesheets</span>
        <span class="gi">+gem &#39;sass-rails&#39;, &#39;~&gt; 5.0&#39;</span>
        <span class="gi">+# Use Uglifier as compressor for JavaScript assets</span>
        <span class="gi">+gem &#39;uglifier&#39;, &#39;&gt;= 1.3.0&#39;</span>
        <span class="gi">+# Use CoffeeScript for .coffee assets and views</span>
        <span class="gi">+gem &#39;coffee-rails&#39;, &#39;~&gt; 4.1.0&#39;</span>
        <span class="gi">+# See https://github.com/sstephenson/execjs#readme for more supported runtimes</span>
        <span class="gi">+# gem &#39;therubyracer&#39;, platforms: :ruby</span>
        <span class="gi">+</span>
        <span class="gi">+# Use jquery as the JavaScript library</span>
        <span class="gi">+gem &#39;jquery-rails&#39;</span>
        <span class="gi">+# Turbolinks makes following links in your web application faster. Read more: https://github.com/rails/turbolinks</span>
        <span class="gi">+gem &#39;turbolinks&#39;</span>
        <span class="gi">+# Build JSON APIs with ease. Read more: https://github.com/rails/jbuilder</span>
        <span class="gi">+gem &#39;jbuilder&#39;, &#39;~&gt; 2.0&#39;</span>
        <span class="gi">+# bundle exec rake doc:rails generates the API under doc/api.</span>
        <span class="gi">+gem &#39;sdoc&#39;, &#39;~&gt; 0.4.0&#39;, group: :doc</span>
        <span class="gi">+</span>
        <span class="gi">+# Use ActiveModel has_secure_password</span>
        <span class="gi">+# gem &#39;bcrypt&#39;, &#39;~&gt; 3.1.7&#39;</span>
         
        <span class="gd">-# Use unicorn as the web server</span>
        <span class="gi">+# Use Unicorn as the app server</span>
         # gem &#39;unicorn&#39;
         
        <span class="gd">-# Deploy with Capistrano</span>
        <span class="gd">-# gem &#39;capistrano&#39;</span>
        <span class="gi">+# Use Capistrano for deployment</span>
        <span class="gi">+# gem &#39;capistrano-rails&#39;, group: :development</span>
        <span class="gi">+</span>
        <span class="gi">+group :development, :test do</span>
        <span class="gi">+  # Call &#39;byebug&#39; anywhere in the code to stop execution and get a debugger console</span>
        <span class="gi">+  gem &#39;byebug&#39;</span>
        <span class="gi">+</span>
        <span class="gi">+  # Access an IRB console on exception pages or by using &lt;%= console %&gt; in views</span>
        <span class="gi">+  gem &#39;web-console&#39;, &#39;~&gt; 2.0&#39;</span>
        <span class="gi">+</span>
        <span class="gi">+  # Spring speeds up development by keeping your application running in the background. Read more: https://github.com/rails/spring</span>
        <span class="gi">+  gem &#39;spring&#39;</span>
        <span class="gi">+end</span>
         
        <span class="gd">-# To use debugger (ruby-debug for Ruby 1.8.7+, ruby-debug19 for Ruby 1.9.2+)</span>
        <span class="gd">-# gem &#39;ruby-debug&#39;</span>
        <span class="gd">-# gem &#39;ruby-debug19&#39;, :require =&gt; &#39;ruby-debug&#39;</span>
        <span class="gd">-</span>
        <span class="gd">-# Bundle the extra gems:</span>
        <span class="gd">-# gem &#39;bj&#39;</span>
        <span class="gd">-# gem &#39;nokogiri&#39;</span>
        <span class="gd">-# gem &#39;sqlite3-ruby&#39;, :require =&gt; &#39;sqlite3&#39;</span>
        <span class="gd">-# gem &#39;aws-s3&#39;, :require =&gt; &#39;aws/s3&#39;</span>
        <span class="gd">-</span>
        <span class="gd">-# Bundle gems for the local environment. Make sure to</span>
        <span class="gd">-# put test-only gems in this group so their generators</span>
        <span class="gd">-# and rake tasks are available in development mode:</span>
        <span class="gd">-# group :development, :test do</span>
        <span class="gd">-#   gem &#39;webrat&#39;</span>
        <span class="gd">-# end</span>
        </pre></div>
        <h2>
          <a href='full/#README'>README</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -1,256 +0,0 @@</span>
        <span class="gd">-== Welcome to Rails</span>
        <span class="gd">-</span>
        <span class="gd">-Rails is a web-application framework that includes everything needed to create</span>
        <span class="gd">-database-backed web applications according to the Model-View-Control pattern.</span>
        <span class="gd">-</span>
        <span class="gd">-This pattern splits the view (also called the presentation) into &quot;dumb&quot;</span>
        <span class="gd">-templates that are primarily responsible for inserting pre-built data in between</span>
        <span class="gd">-HTML tags. The model contains the &quot;smart&quot; domain objects (such as Account,</span>
        <span class="gd">-Product, Person, Post) that holds all the business logic and knows how to</span>
        <span class="gd">-persist themselves to a database. The controller handles the incoming requests</span>
        <span class="gd">-(such as Save New Account, Update Product, Show Post) by manipulating the model</span>
        <span class="gd">-and directing data to the view.</span>
        <span class="gd">-</span>
        <span class="gd">-In Rails, the model is handled by what&#39;s called an object-relational mapping</span>
        <span class="gd">-layer entitled Active Record. This layer allows you to present the data from</span>
        <span class="gd">-database rows as objects and embellish these data objects with business logic</span>
        <span class="gd">-methods. You can read more about Active Record in</span>
        <span class="gd">-link:files/vendor/rails/activerecord/README.html.</span>
        <span class="gd">-</span>
        <span class="gd">-The controller and view are handled by the Action Pack, which handles both</span>
        <span class="gd">-layers by its two parts: Action View and Action Controller. These two layers</span>
        <span class="gd">-are bundled in a single package due to their heavy interdependence. This is</span>
        <span class="gd">-unlike the relationship between the Active Record and Action Pack that is much</span>
        <span class="gd">-more separate. Each of these packages can be used independently outside of</span>
        <span class="gd">-Rails. You can read more about Action Pack in</span>
        <span class="gd">-link:files/vendor/rails/actionpack/README.html.</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-== Getting Started</span>
        <span class="gd">-</span>
        <span class="gd">-1. At the command prompt, create a new Rails application:</span>
        <span class="gd">-       &lt;tt&gt;rails new myapp&lt;/tt&gt; (where &lt;tt&gt;myapp&lt;/tt&gt; is the application name)</span>
        <span class="gd">-</span>
        <span class="gd">-2. Change directory to &lt;tt&gt;myapp&lt;/tt&gt; and start the web server:</span>
        <span class="gd">-       &lt;tt&gt;cd myapp; rails server&lt;/tt&gt; (run with --help for options)</span>
        <span class="gd">-</span>
        <span class="gd">-3. Go to http://localhost:3000/ and you&#39;ll see:</span>
        <span class="gd">-       &quot;Welcome aboard: You&#39;re riding Ruby on Rails!&quot;</span>
        <span class="gd">-</span>
        <span class="gd">-4. Follow the guidelines to start developing your application. You can find</span>
        <span class="gd">-the following resources handy:</span>
        <span class="gd">-</span>
        <span class="gd">-* The Getting Started Guide: http://guides.rubyonrails.org/getting_started.html</span>
        <span class="gd">-* Ruby on Rails Tutorial Book: http://www.railstutorial.org/</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-== Debugging Rails</span>
        <span class="gd">-</span>
        <span class="gd">-Sometimes your application goes wrong. Fortunately there are a lot of tools that</span>
        <span class="gd">-will help you debug it and get it back on the rails.</span>
        <span class="gd">-</span>
        <span class="gd">-First area to check is the application log files. Have &quot;tail -f&quot; commands</span>
        <span class="gd">-running on the server.log and development.log. Rails will automatically display</span>
        <span class="gd">-debugging and runtime information to these files. Debugging info will also be</span>
        <span class="gd">-shown in the browser on requests from 127.0.0.1.</span>
        <span class="gd">-</span>
        <span class="gd">-You can also log your own messages directly into the log file from your code</span>
        <span class="gd">-using the Ruby logger class from inside your controllers. Example:</span>
        <span class="gd">-</span>
        <span class="gd">-  class WeblogController &lt; ActionController::Base</span>
        <span class="gd">-    def destroy</span>
        <span class="gd">-      @weblog = Weblog.find(params[:id])</span>
        <span class="gd">-      @weblog.destroy</span>
        <span class="gd">-      logger.info(&quot;#{Time.now} Destroyed Weblog ID ##{@weblog.id}!&quot;)</span>
        <span class="gd">-    end</span>
        <span class="gd">-  end</span>
        <span class="gd">-</span>
        <span class="gd">-The result will be a message in your log file along the lines of:</span>
        <span class="gd">-</span>
        <span class="gd">-  Mon Oct 08 14:22:29 +1000 2007 Destroyed Weblog ID #1!</span>
        <span class="gd">-</span>
        <span class="gd">-More information on how to use the logger is at http://www.ruby-doc.org/core/</span>
        <span class="gd">-</span>
        <span class="gd">-Also, Ruby documentation can be found at http://www.ruby-lang.org/. There are</span>
        <span class="gd">-several books available online as well:</span>
        <span class="gd">-</span>
        <span class="gd">-* Programming Ruby: http://www.ruby-doc.org/docs/ProgrammingRuby/ (Pickaxe)</span>
        <span class="gd">-* Learn to Program: http://pine.fm/LearnToProgram/ (a beginners guide)</span>
        <span class="gd">-</span>
        <span class="gd">-These two books will bring you up to speed on the Ruby language and also on</span>
        <span class="gd">-programming in general.</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-== Debugger</span>
        <span class="gd">-</span>
        <span class="gd">-Debugger support is available through the debugger command when you start your</span>
        <span class="gd">-Mongrel or WEBrick server with --debugger. This means that you can break out of</span>
        <span class="gd">-execution at any point in the code, investigate and change the model, and then,</span>
        <span class="gd">-resume execution! You need to install ruby-debug to run the server in debugging</span>
        <span class="gd">-mode. With gems, use &lt;tt&gt;sudo gem install ruby-debug&lt;/tt&gt;. Example:</span>
        <span class="gd">-</span>
        <span class="gd">-  class WeblogController &lt; ActionController::Base</span>
        <span class="gd">-    def index</span>
        <span class="gd">-      @posts = Post.find(:all)</span>
        <span class="gd">-      debugger</span>
        <span class="gd">-    end</span>
        <span class="gd">-  end</span>
        <span class="gd">-</span>
        <span class="gd">-So the controller will accept the action, run the first line, then present you</span>
        <span class="gd">-with a IRB prompt in the server window. Here you can do things like:</span>
        <span class="gd">-</span>
        <span class="gd">-  &gt;&gt; @posts.inspect</span>
        <span class="gd">-  =&gt; &quot;[#&lt;Post:0x14a6be8</span>
        <span class="gd">-          @attributes={&quot;title&quot;=&gt;nil, &quot;body&quot;=&gt;nil, &quot;id&quot;=&gt;&quot;1&quot;}&gt;,</span>
        <span class="gd">-       #&lt;Post:0x14a6620</span>
        <span class="gd">-          @attributes={&quot;title&quot;=&gt;&quot;Rails&quot;, &quot;body&quot;=&gt;&quot;Only ten..&quot;, &quot;id&quot;=&gt;&quot;2&quot;}&gt;]&quot;</span>
        <span class="gd">-  &gt;&gt; @posts.first.title = &quot;hello from a debugger&quot;</span>
        <span class="gd">-  =&gt; &quot;hello from a debugger&quot;</span>
        <span class="gd">-</span>
        <span class="gd">-...and even better, you can examine how your runtime objects actually work:</span>
        <span class="gd">-</span>
        <span class="gd">-  &gt;&gt; f = @posts.first</span>
        <span class="gd">-  =&gt; #&lt;Post:0x13630c4 @attributes={&quot;title&quot;=&gt;nil, &quot;body&quot;=&gt;nil, &quot;id&quot;=&gt;&quot;1&quot;}&gt;</span>
        <span class="gd">-  &gt;&gt; f.</span>
        <span class="gd">-  Display all 152 possibilities? (y or n)</span>
        <span class="gd">-</span>
        <span class="gd">-Finally, when you&#39;re ready to resume execution, you can enter &quot;cont&quot;.</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-== Console</span>
        <span class="gd">-</span>
        <span class="gd">-The console is a Ruby shell, which allows you to interact with your</span>
        <span class="gd">-application&#39;s domain model. Here you&#39;ll have all parts of the application</span>
        <span class="gd">-configured, just like it is when the application is running. You can inspect</span>
        <span class="gd">-domain models, change values, and save to the database. Starting the script</span>
        <span class="gd">-without arguments will launch it in the development environment.</span>
        <span class="gd">-</span>
        <span class="gd">-To start the console, run &lt;tt&gt;rails console&lt;/tt&gt; from the application</span>
        <span class="gd">-directory.</span>
        <span class="gd">-</span>
        <span class="gd">-Options:</span>
        <span class="gd">-</span>
        <span class="gd">-* Passing the &lt;tt&gt;-s, --sandbox&lt;/tt&gt; argument will rollback any modifications</span>
        <span class="gd">-  made to the database.</span>
        <span class="gd">-* Passing an environment name as an argument will load the corresponding</span>
        <span class="gd">-  environment. Example: &lt;tt&gt;rails console production&lt;/tt&gt;.</span>
        <span class="gd">-</span>
        <span class="gd">-To reload your controllers and models after launching the console run</span>
        <span class="gd">-&lt;tt&gt;reload!&lt;/tt&gt;</span>
        <span class="gd">-</span>
        <span class="gd">-More information about irb can be found at:</span>
        <span class="gd">-link:http://www.rubycentral.com/pickaxe/irb.html</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-== dbconsole</span>
        <span class="gd">-</span>
        <span class="gd">-You can go to the command line of your database directly through &lt;tt&gt;rails</span>
        <span class="gd">-dbconsole&lt;/tt&gt;. You would be connected to the database with the credentials</span>
        <span class="gd">-defined in database.yml. Starting the script without arguments will connect you</span>
        <span class="gd">-to the development database. Passing an argument will connect you to a different</span>
        <span class="gd">-database, like &lt;tt&gt;rails dbconsole production&lt;/tt&gt;. Currently works for MySQL,</span>
        <span class="gd">-PostgreSQL and SQLite 3.</span>
        <span class="gd">-</span>
        <span class="gd">-== Description of Contents</span>
        <span class="gd">-</span>
        <span class="gd">-The default directory structure of a generated Ruby on Rails application:</span>
        <span class="gd">-</span>
        <span class="gd">-  |-- app</span>
        <span class="gd">-  |   |-- controllers</span>
        <span class="gd">-  |   |-- helpers</span>
        <span class="gd">-  |   |-- mailers</span>
        <span class="gd">-  |   |-- models</span>
        <span class="gd">-  |   `-- views</span>
        <span class="gd">-  |       `-- layouts</span>
        <span class="gd">-  |-- config</span>
        <span class="gd">-  |   |-- environments</span>
        <span class="gd">-  |   |-- initializers</span>
        <span class="gd">-  |   `-- locales</span>
        <span class="gd">-  |-- db</span>
        <span class="gd">-  |-- doc</span>
        <span class="gd">-  |-- lib</span>
        <span class="gd">-  |   `-- tasks</span>
        <span class="gd">-  |-- log</span>
        <span class="gd">-  |-- public</span>
        <span class="gd">-  |   |-- images</span>
        <span class="gd">-  |   |-- javascripts</span>
        <span class="gd">-  |   `-- stylesheets</span>
        <span class="gd">-  |-- script</span>
        <span class="gd">-  |-- test</span>
        <span class="gd">-  |   |-- fixtures</span>
        <span class="gd">-  |   |-- functional</span>
        <span class="gd">-  |   |-- integration</span>
        <span class="gd">-  |   |-- performance</span>
        <span class="gd">-  |   `-- unit</span>
        <span class="gd">-  |-- tmp</span>
        <span class="gd">-  |   |-- cache</span>
        <span class="gd">-  |   |-- pids</span>
        <span class="gd">-  |   |-- sessions</span>
        <span class="gd">-  |   `-- sockets</span>
        <span class="gd">-  `-- vendor</span>
        <span class="gd">-      `-- plugins</span>
        <span class="gd">-</span>
        <span class="gd">-app</span>
        <span class="gd">-  Holds all the code that&#39;s specific to this particular application.</span>
        <span class="gd">-</span>
        <span class="gd">-app/controllers</span>
        <span class="gd">-  Holds controllers that should be named like weblogs_controller.rb for</span>
        <span class="gd">-  automated URL mapping. All controllers should descend from</span>
        <span class="gd">-  ApplicationController which itself descends from ActionController::Base.</span>
        <span class="gd">-</span>
        <span class="gd">-app/models</span>
        <span class="gd">-  Holds models that should be named like post.rb. Models descend from</span>
        <span class="gd">-  ActiveRecord::Base by default.</span>
        <span class="gd">-</span>
        <span class="gd">-app/views</span>
        <span class="gd">-  Holds the template files for the view that should be named like</span>
        <span class="gd">-  weblogs/index.html.erb for the WeblogsController#index action. All views use</span>
        <span class="gd">-  eRuby syntax by default.</span>
        <span class="gd">-</span>
        <span class="gd">-app/views/layouts</span>
        <span class="gd">-  Holds the template files for layouts to be used with views. This models the</span>
        <span class="gd">-  common header/footer method of wrapping views. In your views, define a layout</span>
        <span class="gd">-  using the &lt;tt&gt;layout :default&lt;/tt&gt; and create a file named default.html.erb.</span>
        <span class="gd">-  Inside default.html.erb, call &lt;% yield %&gt; to render the view using this</span>
        <span class="gd">-  layout.</span>
        <span class="gd">-</span>
        <span class="gd">-app/helpers</span>
        <span class="gd">-  Holds view helpers that should be named like weblogs_helper.rb. These are</span>
        <span class="gd">-  generated for you automatically when using generators for controllers.</span>
        <span class="gd">-  Helpers can be used to wrap functionality for your views into methods.</span>
        <span class="gd">-</span>
        <span class="gd">-config</span>
        <span class="gd">-  Configuration files for the Rails environment, the routing map, the database,</span>
        <span class="gd">-  and other dependencies.</span>
        <span class="gd">-</span>
        <span class="gd">-db</span>
        <span class="gd">-  Contains the database schema in schema.rb. db/migrate contains all the</span>
        <span class="gd">-  sequence of Migrations for your schema.</span>
        <span class="gd">-</span>
        <span class="gd">-doc</span>
        <span class="gd">-  This directory is where your application documentation will be stored when</span>
        <span class="gd">-  generated using &lt;tt&gt;rake doc:app&lt;/tt&gt;</span>
        <span class="gd">-</span>
        <span class="gd">-lib</span>
        <span class="gd">-  Application specific libraries. Basically, any kind of custom code that</span>
        <span class="gd">-  doesn&#39;t belong under controllers, models, or helpers. This directory is in</span>
        <span class="gd">-  the load path.</span>
        <span class="gd">-</span>
        <span class="gd">-public</span>
        <span class="gd">-  The directory available for the web server. Contains subdirectories for</span>
        <span class="gd">-  images, stylesheets, and javascripts. Also contains the dispatchers and the</span>
        <span class="gd">-  default HTML files. This should be set as the DOCUMENT_ROOT of your web</span>
        <span class="gd">-  server.</span>
        <span class="gd">-</span>
        <span class="gd">-script</span>
        <span class="gd">-  Helper scripts for automation and generation.</span>
        <span class="gd">-</span>
        <span class="gd">-test</span>
        <span class="gd">-  Unit and functional tests along with fixtures. When using the rails generate</span>
        <span class="gd">-  command, template test files will be generated for you and placed in this</span>
        <span class="gd">-  directory.</span>
        <span class="gd">-</span>
        <span class="gd">-vendor</span>
        <span class="gd">-  External libraries that the application depends on. Also includes the plugins</span>
        <span class="gd">-  subdirectory. If the app has frozen rails, those gems also go here, under</span>
        <span class="gd">-  vendor/rails/. This directory is in the load path.</span>
        </pre></div>
        <h2>
          <a href='full/#README-rdoc'>README.rdoc</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -0,0 +1,28 @@</span>
        <span class="gi">+== README</span>
        <span class="gi">+</span>
        <span class="gi">+This README would normally document whatever steps are necessary to get the</span>
        <span class="gi">+application up and running.</span>
        <span class="gi">+</span>
        <span class="gi">+Things you may want to cover:</span>
        <span class="gi">+</span>
        <span class="gi">+* Ruby version</span>
        <span class="gi">+</span>
        <span class="gi">+* System dependencies</span>
        <span class="gi">+</span>
        <span class="gi">+* Configuration</span>
        <span class="gi">+</span>
        <span class="gi">+* Database creation</span>
        <span class="gi">+</span>
        <span class="gi">+* Database initialization</span>
        <span class="gi">+</span>
        <span class="gi">+* How to run the test suite</span>
        <span class="gi">+</span>
        <span class="gi">+* Services (job queues, cache servers, search engines, etc.)</span>
        <span class="gi">+</span>
        <span class="gi">+* Deployment instructions</span>
        <span class="gi">+</span>
        <span class="gi">+* ...</span>
        <span class="gi">+</span>
        <span class="gi">+</span>
        <span class="gi">+Please feel free to use a different markup language if you do not plan to run</span>
        <span class="gi">+&lt;tt&gt;rake doc:app&lt;/tt&gt;.</span>
        </pre></div>
        <h2>
          <a href='full/#Rakefile'>Rakefile</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -2,6 +2,5 @@</span>
         # for example lib/tasks/capistrano.rake, and they will automatically be available to Rake.
         
         require File.expand_path(&#39;../config/application&#39;, __FILE__)
        <span class="gd">-require &#39;rake&#39;</span>
         
        <span class="gd">-Railsdiff::Application.load_tasks</span>
        <span class="gi">+Rails.application.load_tasks</span>
        </pre></div>
        <h2>
          <a href='full/#app-assets-javascripts-application-js'>app/assets/javascripts/application.js</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -0,0 +1,16 @@</span>
        <span class="gi">+// This is a manifest file that&#39;ll be compiled into application.js, which will include all the files</span>
        <span class="gi">+// listed below.</span>
        <span class="gi">+//</span>
        <span class="gi">+// Any JavaScript/Coffee file within this directory, lib/assets/javascripts, vendor/assets/javascripts,</span>
        <span class="gi">+// or any plugin&#39;s vendor/assets/javascripts directory can be referenced here using a relative path.</span>
        <span class="gi">+//</span>
        <span class="gi">+// It&#39;s not advisable to add code directly here, but if you do, it&#39;ll appear at the bottom of the</span>
        <span class="gi">+// compiled file.</span>
        <span class="gi">+//</span>
        <span class="gi">+// Read Sprockets README (https://github.com/sstephenson/sprockets#sprockets-directives) for details</span>
        <span class="gi">+// about supported directives.</span>
        <span class="gi">+//</span>
        <span class="gi">+//= require jquery</span>
        <span class="gi">+//= require jquery_ujs</span>
        <span class="gi">+//= require turbolinks</span>
        <span class="gi">+//= require_tree .</span>
        </pre></div>
        <h2>
          <a href='full/#app-assets-stylesheets-application-css'>app/assets/stylesheets/application.css</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -0,0 +1,15 @@</span>
        <span class="gi">+/*</span>
        <span class="gi">+ * This is a manifest file that&#39;ll be compiled into application.css, which will include all the files</span>
        <span class="gi">+ * listed below.</span>
        <span class="gi">+ *</span>
        <span class="gi">+ * Any CSS and SCSS file within this directory, lib/assets/stylesheets, vendor/assets/stylesheets,</span>
        <span class="gi">+ * or any plugin&#39;s vendor/assets/stylesheets directory can be referenced here using a relative path.</span>
        <span class="gi">+ *</span>
        <span class="gi">+ * You&#39;re free to add application-wide styles to this file and they&#39;ll appear at the bottom of the</span>
        <span class="gi">+ * compiled file so the styles you add here take precedence over styles defined in any styles</span>
        <span class="gi">+ * defined in the other CSS/SCSS files in this directory. It is generally better to create a new</span>
        <span class="gi">+ * file per style scope.</span>
        <span class="gi">+ *</span>
        <span class="gi">+ *= require_tree .</span>
        <span class="gi">+ *= require_self</span>
        <span class="gi">+ */</span>
        </pre></div>
        <h2>
          <a href='full/#app-controllers-application_controller-rb'>app/controllers/application_controller.rb</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -1,3 +1,5 @@</span>
         class ApplicationController &lt; ActionController::Base
        <span class="gd">-  protect_from_forgery</span>
        <span class="gi">+  # Prevent CSRF attacks by raising an exception.</span>
        <span class="gi">+  # For APIs, you may want to use :null_session instead.</span>
        <span class="gi">+  protect_from_forgery with: :exception</span>
         end
        </pre></div>
        <h2>
          <a href='full/#app-views-layouts-application-html-erb'>app/views/layouts/application.html.erb</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -2,9 +2,9 @@</span>
         &lt;html&gt;
         &lt;head&gt;
           &lt;title&gt;Railsdiff&lt;/title&gt;
        <span class="gd">-  &lt;%= stylesheet_link_tag :all %&gt;</span>
        <span class="gd">-  &lt;%= javascript_include_tag :defaults %&gt;</span>
        <span class="gd">-  &lt;%= csrf_meta_tag %&gt;</span>
        <span class="gi">+  &lt;%= stylesheet_link_tag    &#39;application&#39;, media: &#39;all&#39;, &#39;data-turbolinks-track&#39; =&gt; true %&gt;</span>
        <span class="gi">+  &lt;%= javascript_include_tag &#39;application&#39;, &#39;data-turbolinks-track&#39; =&gt; true %&gt;</span>
        <span class="gi">+  &lt;%= csrf_meta_tags %&gt;</span>
         &lt;/head&gt;
         &lt;body&gt;
         
        </pre></div>
        <h2>
          <a href='full/#bin-bundle'>bin/bundle</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -0,0 +1,3 @@</span>
        <span class="gi">+#!/usr/bin/env ruby</span>
        <span class="gi">+ENV[&#39;BUNDLE_GEMFILE&#39;] ||= File.expand_path(&#39;../../Gemfile&#39;, __FILE__)</span>
        <span class="gi">+load Gem.bin_path(&#39;bundler&#39;, &#39;bundle&#39;)</span>
        </pre></div>
        <h2>
          <a href='full/#bin-rails'>bin/rails</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -0,0 +1,4 @@</span>
        <span class="gi">+#!/usr/bin/env ruby</span>
        <span class="gi">+APP_PATH = File.expand_path(&#39;../../config/application&#39;, __FILE__)</span>
        <span class="gi">+require_relative &#39;../config/boot&#39;</span>
        <span class="gi">+require &#39;rails/commands&#39;</span>
        </pre></div>
        <h2>
          <a href='full/#bin-rake'>bin/rake</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -0,0 +1,4 @@</span>
        <span class="gi">+#!/usr/bin/env ruby</span>
        <span class="gi">+require_relative &#39;../config/boot&#39;</span>
        <span class="gi">+require &#39;rake&#39;</span>
        <span class="gi">+Rake.application.run</span>
        </pre></div>
        <h2>
          <a href='full/#bin-setup'>bin/setup</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -0,0 +1,29 @@</span>
        <span class="gi">+#!/usr/bin/env ruby</span>
        <span class="gi">+require &#39;pathname&#39;</span>
        <span class="gi">+</span>
        <span class="gi">+# path to your application root.</span>
        <span class="gi">+APP_ROOT = Pathname.new File.expand_path(&#39;../../&#39;,  __FILE__)</span>
        <span class="gi">+</span>
        <span class="gi">+Dir.chdir APP_ROOT do</span>
        <span class="gi">+  # This script is a starting point to setup your application.</span>
        <span class="gi">+  # Add necessary setup steps to this file:</span>
        <span class="gi">+</span>
        <span class="gi">+  puts &quot;== Installing dependencies ==&quot;</span>
        <span class="gi">+  system &quot;gem install bundler --conservative&quot;</span>
        <span class="gi">+  system &quot;bundle check || bundle install&quot;</span>
        <span class="gi">+</span>
        <span class="gi">+  # puts &quot;\n== Copying sample files ==&quot;</span>
        <span class="gi">+  # unless File.exist?(&quot;config/database.yml&quot;)</span>
        <span class="gi">+  #   system &quot;cp config/database.yml.sample config/database.yml&quot;</span>
        <span class="gi">+  # end</span>
        <span class="gi">+</span>
        <span class="gi">+  puts &quot;\n== Preparing database ==&quot;</span>
        <span class="gi">+  system &quot;bin/rake db:setup&quot;</span>
        <span class="gi">+</span>
        <span class="gi">+  puts &quot;\n== Removing old logs and tempfiles ==&quot;</span>
        <span class="gi">+  system &quot;rm -f log/*&quot;</span>
        <span class="gi">+  system &quot;rm -rf tmp/cache&quot;</span>
        <span class="gi">+</span>
        <span class="gi">+  puts &quot;\n== Restarting application server ==&quot;</span>
        <span class="gi">+  system &quot;touch tmp/restart.txt&quot;</span>
        <span class="gi">+end</span>
        </pre></div>
        <h2>
          <a href='full/#config-application-rb'>config/application.rb</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -2,9 +2,9 @@</span>
         
         require &#39;rails/all&#39;
         
        <span class="gd">-# If you have a Gemfile, require the gems listed there, including any gems</span>
        <span class="gi">+# Require the gems listed in Gemfile, including any gems</span>
         # you&#39;ve limited to :test, :development, or :production.
        <span class="gd">-Bundler.require(:default, Rails.env) if defined?(Bundler)</span>
        <span class="gi">+Bundler.require(*Rails.groups)</span>
         
         module Railsdiff
           class Application &lt; Rails::Application
        <span class="gu">@@ -12,16 +12,6 @@</span>
             # Application configuration should go into files in config/initializers
             # -- all .rb files in that directory are automatically loaded.
         
        <span class="gd">-    # Custom directories with classes and modules you want to be autoloadable.</span>
        <span class="gd">-    # config.autoload_paths += %W(#{config.root}/extras)</span>
        <span class="gd">-</span>
        <span class="gd">-    # Only load the plugins named here, in the order given (default is alphabetical).</span>
        <span class="gd">-    # :all can be used as a placeholder for all plugins not explicitly named.</span>
        <span class="gd">-    # config.plugins = [ :exception_notification, :ssl_requirement, :all ]</span>
        <span class="gd">-</span>
        <span class="gd">-    # Activate observers that should always be running.</span>
        <span class="gd">-    # config.active_record.observers = :cacher, :garbage_collector, :forum_observer</span>
        <span class="gd">-</span>
             # Set Time.zone default to the specified zone and make Active Record auto-convert to this zone.
             # Run &quot;rake -D time&quot; for a list of tasks for finding time zone names. Default is UTC.
             # config.time_zone = &#39;Central Time (US &amp; Canada)&#39;
        <span class="gu">@@ -30,13 +20,7 @@</span>
             # config.i18n.load_path += Dir[Rails.root.join(&#39;my&#39;, &#39;locales&#39;, &#39;*.{rb,yml}&#39;).to_s]
             # config.i18n.default_locale = :de
         
        <span class="gd">-    # JavaScript files you want as :defaults (application.js is always included).</span>
        <span class="gd">-    # config.action_view.javascript_expansions[:defaults] = %w(jquery rails)</span>
        <span class="gd">-</span>
        <span class="gd">-    # Configure the default encoding used in templates for Ruby 1.9.</span>
        <span class="gd">-    config.encoding = &quot;utf-8&quot;</span>
        <span class="gd">-</span>
        <span class="gd">-    # Configure sensitive parameters which will be filtered from the log file.</span>
        <span class="gd">-    config.filter_parameters += [:password]</span>
        <span class="gi">+    # Do not swallow errors in after_commit/after_rollback callbacks.</span>
        <span class="gi">+    config.active_record.raise_in_transactional_callbacks = true</span>
           end
         end
        </pre></div>
        <h2>
          <a href='full/#config-boot-rb'>config/boot.rb</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -1,6 +1,3 @@</span>
        <span class="gd">-require &#39;rubygems&#39;</span>
        <span class="gd">-</span>
        <span class="gd">-# Set up gems listed in the Gemfile.</span>
         ENV[&#39;BUNDLE_GEMFILE&#39;] ||= File.expand_path(&#39;../../Gemfile&#39;, __FILE__)
         
        <span class="gd">-require &#39;bundler/setup&#39; if File.exists?(ENV[&#39;BUNDLE_GEMFILE&#39;])</span>
        <span class="gi">+require &#39;bundler/setup&#39; # Set up gems listed in the Gemfile.</span>
        </pre></div>
        <h2>
          <a href='full/#config-database-yml'>config/database.yml</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -1,22 +1,25 @@</span>
         # SQLite version 3.x
         #   gem install sqlite3
        <span class="gd">-development:</span>
        <span class="gi">+#</span>
        <span class="gi">+#   Ensure the SQLite 3 gem is defined in your Gemfile</span>
        <span class="gi">+#   gem &#39;sqlite3&#39;</span>
        <span class="gi">+#</span>
        <span class="gi">+default: &amp;default</span>
           adapter: sqlite3
        <span class="gd">-  database: db/development.sqlite3</span>
           pool: 5
           timeout: 5000
         
        <span class="gi">+development:</span>
        <span class="gi">+  &lt;&lt;: *default</span>
        <span class="gi">+  database: db/development.sqlite3</span>
        <span class="gi">+</span>
         # Warning: The database defined as &quot;test&quot; will be erased and
         # re-generated from your development database when you run &quot;rake&quot;.
         # Do not set this db to the same as development or production.
         test:
        <span class="gd">-  adapter: sqlite3</span>
        <span class="gi">+  &lt;&lt;: *default</span>
           database: db/test.sqlite3
        <span class="gd">-  pool: 5</span>
        <span class="gd">-  timeout: 5000</span>
         
         production:
        <span class="gd">-  adapter: sqlite3</span>
        <span class="gi">+  &lt;&lt;: *default</span>
           database: db/production.sqlite3
        <span class="gd">-  pool: 5</span>
        <span class="gd">-  timeout: 5000</span>
        </pre></div>
        <h2>
          <a href='full/#config-environment-rb'>config/environment.rb</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -1,5 +1,5 @@</span>
        <span class="gd">-# Load the rails application</span>
        <span class="gi">+# Load the Rails application.</span>
         require File.expand_path(&#39;../application&#39;, __FILE__)
         
        <span class="gd">-# Initialize the rails application</span>
        <span class="gd">-Railsdiff::Application.initialize!</span>
        <span class="gi">+# Initialize the Rails application.</span>
        <span class="gi">+Rails.application.initialize!</span>
        </pre></div>
        <h2>
          <a href='full/#config-environments-development-rb'>config/environments/development.rb</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -1,26 +1,41 @@</span>
        <span class="gd">-Railsdiff::Application.configure do</span>
        <span class="gd">-  # Settings specified here will take precedence over those in config/application.rb</span>
        <span class="gi">+Rails.application.configure do</span>
        <span class="gi">+  # Settings specified here will take precedence over those in config/application.rb.</span>
         
           # In the development environment your application&#39;s code is reloaded on
        <span class="gd">-  # every request.  This slows down response time but is perfect for development</span>
        <span class="gd">-  # since you don&#39;t have to restart the webserver when you make code changes.</span>
        <span class="gi">+  # every request. This slows down response time but is perfect for development</span>
        <span class="gi">+  # since you don&#39;t have to restart the web server when you make code changes.</span>
           config.cache_classes = false
         
        <span class="gd">-  # Log error messages when you accidentally call methods on nil.</span>
        <span class="gd">-  config.whiny_nils = true</span>
        <span class="gi">+  # Do not eager load code on boot.</span>
        <span class="gi">+  config.eager_load = false</span>
         
        <span class="gd">-  # Show full error reports and disable caching</span>
        <span class="gi">+  # Show full error reports and disable caching.</span>
           config.consider_all_requests_local       = true
        <span class="gd">-  config.action_view.debug_rjs             = true</span>
           config.action_controller.perform_caching = false
         
        <span class="gd">-  # Don&#39;t care if the mailer can&#39;t send</span>
        <span class="gi">+  # Don&#39;t care if the mailer can&#39;t send.</span>
           config.action_mailer.raise_delivery_errors = false
         
        <span class="gd">-  # Print deprecation notices to the Rails logger</span>
        <span class="gi">+  # Print deprecation notices to the Rails logger.</span>
           config.active_support.deprecation = :log
         
        <span class="gd">-  # Only use best-standards-support built into browsers</span>
        <span class="gd">-  config.action_dispatch.best_standards_support = :builtin</span>
        <span class="gd">-end</span>
        <span class="gi">+  # Raise an error on page load if there are pending migrations.</span>
        <span class="gi">+  config.active_record.migration_error = :page_load</span>
        <span class="gi">+</span>
        <span class="gi">+  # Debug mode disables concatenation and preprocessing of assets.</span>
        <span class="gi">+  # This option may cause significant delays in view rendering with a large</span>
        <span class="gi">+  # number of complex assets.</span>
        <span class="gi">+  config.assets.debug = true</span>
        <span class="gi">+</span>
        <span class="gi">+  # Asset digests allow you to set far-future HTTP expiration dates on all assets,</span>
        <span class="gi">+  # yet still be able to expire them through the digest params.</span>
        <span class="gi">+  config.assets.digest = true</span>
        <span class="gi">+</span>
        <span class="gi">+  # Adds additional error checking when serving assets at runtime.</span>
        <span class="gi">+  # Checks for improperly declared sprockets dependencies.</span>
        <span class="gi">+  # Raises helpful error messages.</span>
        <span class="gi">+  config.assets.raise_runtime_errors = true</span>
         
        <span class="gi">+  # Raises error for missing translations</span>
        <span class="gi">+  # config.action_view.raise_on_missing_translations = true</span>
        <span class="gi">+end</span>
        </pre></div>
        <h2>
          <a href='full/#config-environments-production-rb'>config/environments/production.rb</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -1,49 +1,79 @@</span>
        <span class="gd">-Railsdiff::Application.configure do</span>
        <span class="gd">-  # Settings specified here will take precedence over those in config/application.rb</span>
        <span class="gi">+Rails.application.configure do</span>
        <span class="gi">+  # Settings specified here will take precedence over those in config/application.rb.</span>
         
        <span class="gd">-  # The production environment is meant for finished, &quot;live&quot; apps.</span>
        <span class="gd">-  # Code is not reloaded between requests</span>
        <span class="gi">+  # Code is not reloaded between requests.</span>
           config.cache_classes = true
         
        <span class="gd">-  # Full error reports are disabled and caching is turned on</span>
        <span class="gi">+  # Eager load code on boot. This eager loads most of Rails and</span>
        <span class="gi">+  # your application in memory, allowing both threaded web servers</span>
        <span class="gi">+  # and those relying on copy on write to perform better.</span>
        <span class="gi">+  # Rake tasks automatically ignore this option for performance.</span>
        <span class="gi">+  config.eager_load = true</span>
        <span class="gi">+</span>
        <span class="gi">+  # Full error reports are disabled and caching is turned on.</span>
           config.consider_all_requests_local       = false
           config.action_controller.perform_caching = true
         
        <span class="gd">-  # Specifies the header that your server uses for sending files</span>
        <span class="gd">-  config.action_dispatch.x_sendfile_header = &quot;X-Sendfile&quot;</span>
        <span class="gi">+  # Enable Rack::Cache to put a simple HTTP cache in front of your application</span>
        <span class="gi">+  # Add `rack-cache` to your Gemfile before enabling this.</span>
        <span class="gi">+  # For large-scale production use, consider using a caching reverse proxy like</span>
        <span class="gi">+  # NGINX, varnish or squid.</span>
        <span class="gi">+  # config.action_dispatch.rack_cache = true</span>
         
        <span class="gd">-  # For nginx:</span>
        <span class="gd">-  # config.action_dispatch.x_sendfile_header = &#39;X-Accel-Redirect&#39;</span>
        <span class="gi">+  # Disable serving static files from the `/public` folder by default since</span>
        <span class="gi">+  # Apache or NGINX already handles this.</span>
        <span class="gi">+  config.serve_static_files = ENV[&#39;RAILS_SERVE_STATIC_FILES&#39;].present?</span>
         
        <span class="gd">-  # If you have no front-end server that supports something like X-Sendfile,</span>
        <span class="gd">-  # just comment this out and Rails will serve the files</span>
        <span class="gi">+  # Compress JavaScripts and CSS.</span>
        <span class="gi">+  config.assets.js_compressor = :uglifier</span>
        <span class="gi">+  # config.assets.css_compressor = :sass</span>
         
        <span class="gd">-  # See everything in the log (default is :info)</span>
        <span class="gd">-  # config.log_level = :debug</span>
        <span class="gi">+  # Do not fallback to assets pipeline if a precompiled asset is missed.</span>
        <span class="gi">+  config.assets.compile = false</span>
         
        <span class="gd">-  # Use a different logger for distributed setups</span>
        <span class="gd">-  # config.logger = SyslogLogger.new</span>
        <span class="gi">+  # Asset digests allow you to set far-future HTTP expiration dates on all assets,</span>
        <span class="gi">+  # yet still be able to expire them through the digest params.</span>
        <span class="gi">+  config.assets.digest = true</span>
         
        <span class="gd">-  # Use a different cache store in production</span>
        <span class="gd">-  # config.cache_store = :mem_cache_store</span>
        <span class="gi">+  # `config.assets.precompile` and `config.assets.version` have moved to config/initializers/assets.rb</span>
         
        <span class="gd">-  # Disable Rails&#39;s static asset server</span>
        <span class="gd">-  # In production, Apache or nginx will already do this</span>
        <span class="gd">-  config.serve_static_assets = false</span>
        <span class="gi">+  # Specifies the header that your server uses for sending files.</span>
        <span class="gi">+  # config.action_dispatch.x_sendfile_header = &#39;X-Sendfile&#39; # for Apache</span>
        <span class="gi">+  # config.action_dispatch.x_sendfile_header = &#39;X-Accel-Redirect&#39; # for NGINX</span>
         
        <span class="gd">-  # Enable serving of images, stylesheets, and javascripts from an asset server</span>
        <span class="gd">-  # config.action_controller.asset_host = &quot;http://assets.example.com&quot;</span>
        <span class="gi">+  # Force all access to the app over SSL, use Strict-Transport-Security, and use secure cookies.</span>
        <span class="gi">+  # config.force_ssl = true</span>
         
        <span class="gd">-  # Disable delivery errors, bad email addresses will be ignored</span>
        <span class="gd">-  # config.action_mailer.raise_delivery_errors = false</span>
        <span class="gi">+  # Use the lowest log level to ensure availability of diagnostic information</span>
        <span class="gi">+  # when problems arise.</span>
        <span class="gi">+  config.log_level = :debug</span>
         
        <span class="gd">-  # Enable threaded mode</span>
        <span class="gd">-  # config.threadsafe!</span>
        <span class="gi">+  # Prepend all log lines with the following tags.</span>
        <span class="gi">+  # config.log_tags = [ :subdomain, :uuid ]</span>
        <span class="gi">+</span>
        <span class="gi">+  # Use a different logger for distributed setups.</span>
        <span class="gi">+  # config.logger = ActiveSupport::TaggedLogging.new(SyslogLogger.new)</span>
        <span class="gi">+</span>
        <span class="gi">+  # Use a different cache store in production.</span>
        <span class="gi">+  # config.cache_store = :mem_cache_store</span>
        <span class="gi">+</span>
        <span class="gi">+  # Enable serving of images, stylesheets, and JavaScripts from an asset server.</span>
        <span class="gi">+  # config.action_controller.asset_host = &#39;http://assets.example.com&#39;</span>
        <span class="gi">+</span>
        <span class="gi">+  # Ignore bad email addresses and do not raise email delivery errors.</span>
        <span class="gi">+  # Set this to true and configure the email server for immediate delivery to raise delivery errors.</span>
        <span class="gi">+  # config.action_mailer.raise_delivery_errors = false</span>
         
           # Enable locale fallbacks for I18n (makes lookups for any locale fall back to
        <span class="gd">-  # the I18n.default_locale when a translation can not be found)</span>
        <span class="gi">+  # the I18n.default_locale when a translation cannot be found).</span>
           config.i18n.fallbacks = true
         
        <span class="gd">-  # Send deprecation notices to registered listeners</span>
        <span class="gi">+  # Send deprecation notices to registered listeners.</span>
           config.active_support.deprecation = :notify
        <span class="gi">+</span>
        <span class="gi">+  # Use default logging formatter so that PID and timestamp are not suppressed.</span>
        <span class="gi">+  config.log_formatter = ::Logger::Formatter.new</span>
        <span class="gi">+</span>
        <span class="gi">+  # Do not dump schema after migrations.</span>
        <span class="gi">+  config.active_record.dump_schema_after_migration = false</span>
         end
        </pre></div>
        <h2>
          <a href='full/#config-environments-test-rb'>config/environments/test.rb</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -1,35 +1,42 @@</span>
        <span class="gd">-Railsdiff::Application.configure do</span>
        <span class="gd">-  # Settings specified here will take precedence over those in config/application.rb</span>
        <span class="gi">+Rails.application.configure do</span>
        <span class="gi">+  # Settings specified here will take precedence over those in config/application.rb.</span>
         
           # The test environment is used exclusively to run your application&#39;s
        <span class="gd">-  # test suite.  You never need to work with it otherwise.  Remember that</span>
        <span class="gi">+  # test suite. You never need to work with it otherwise. Remember that</span>
           # your test database is &quot;scratch space&quot; for the test suite and is wiped
        <span class="gd">-  # and recreated between test runs.  Don&#39;t rely on the data there!</span>
        <span class="gi">+  # and recreated between test runs. Don&#39;t rely on the data there!</span>
           config.cache_classes = true
         
        <span class="gd">-  # Log error messages when you accidentally call methods on nil.</span>
        <span class="gd">-  config.whiny_nils = true</span>
        <span class="gi">+  # Do not eager load code on boot. This avoids loading your whole application</span>
        <span class="gi">+  # just for the purpose of running a single test. If you are using a tool that</span>
        <span class="gi">+  # preloads Rails for running tests, you may have to set it to true.</span>
        <span class="gi">+  config.eager_load = false</span>
        <span class="gi">+</span>
        <span class="gi">+  # Configure static file server for tests with Cache-Control for performance.</span>
        <span class="gi">+  config.serve_static_files   = true</span>
        <span class="gi">+  config.static_cache_control = &#39;public, max-age=3600&#39;</span>
         
        <span class="gd">-  # Show full error reports and disable caching</span>
        <span class="gi">+  # Show full error reports and disable caching.</span>
           config.consider_all_requests_local       = true
           config.action_controller.perform_caching = false
         
        <span class="gd">-  # Raise exceptions instead of rendering exception templates</span>
        <span class="gi">+  # Raise exceptions instead of rendering exception templates.</span>
           config.action_dispatch.show_exceptions = false
         
        <span class="gd">-  # Disable request forgery protection in test environment</span>
        <span class="gd">-  config.action_controller.allow_forgery_protection    = false</span>
        <span class="gi">+  # Disable request forgery protection in test environment.</span>
        <span class="gi">+  config.action_controller.allow_forgery_protection = false</span>
         
           # Tell Action Mailer not to deliver emails to the real world.
           # The :test delivery method accumulates sent emails in the
           # ActionMailer::Base.deliveries array.
           config.action_mailer.delivery_method = :test
         
        <span class="gd">-  # Use SQL instead of Active Record&#39;s schema dumper when creating the test database.</span>
        <span class="gd">-  # This is necessary if your schema can&#39;t be completely dumped by the schema dumper,</span>
        <span class="gd">-  # like if you have constraints or database-specific column types</span>
        <span class="gd">-  # config.active_record.schema_format = :sql</span>
        <span class="gi">+  # Randomize the order test cases are executed.</span>
        <span class="gi">+  config.active_support.test_order = :random</span>
         
        <span class="gd">-  # Print deprecation notices to the stderr</span>
        <span class="gi">+  # Print deprecation notices to the stderr.</span>
           config.active_support.deprecation = :stderr
        <span class="gi">+</span>
        <span class="gi">+  # Raises error for missing translations</span>
        <span class="gi">+  # config.action_view.raise_on_missing_translations = true</span>
         end
        </pre></div>
        <h2>
          <a href='full/#config-initializers-assets-rb'>config/initializers/assets.rb</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -0,0 +1,11 @@</span>
        <span class="gi">+# Be sure to restart your server when you modify this file.</span>
        <span class="gi">+</span>
        <span class="gi">+# Version of your assets, change this if you want to expire all your assets.</span>
        <span class="gi">+Rails.application.config.assets.version = &#39;1.0&#39;</span>
        <span class="gi">+</span>
        <span class="gi">+# Add additional assets to the asset load path</span>
        <span class="gi">+# Rails.application.config.assets.paths &lt;&lt; Emoji.images_path</span>
        <span class="gi">+</span>
        <span class="gi">+# Precompile additional assets.</span>
        <span class="gi">+# application.js, application.css, and all non-JS/CSS in app/assets folder are already added.</span>
        <span class="gi">+# Rails.application.config.assets.precompile += %w( search.js )</span>
        </pre></div>
        <h2>
          <a href='full/#config-initializers-cookies_serializer-rb'>config/initializers/cookies_serializer.rb</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -0,0 +1,3 @@</span>
        <span class="gi">+# Be sure to restart your server when you modify this file.</span>
        <span class="gi">+</span>
        <span class="gi">+Rails.application.config.action_dispatch.cookies_serializer = :json</span>
        </pre></div>
        <h2>
          <a href='full/#config-initializers-filter_parameter_logging-rb'>config/initializers/filter_parameter_logging.rb</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -0,0 +1,4 @@</span>
        <span class="gi">+# Be sure to restart your server when you modify this file.</span>
        <span class="gi">+</span>
        <span class="gi">+# Configure sensitive parameters which will be filtered from the log file.</span>
        <span class="gi">+Rails.application.config.filter_parameters += [:password]</span>
        </pre></div>
        <h2>
          <a href='full/#config-initializers-inflections-rb'>config/initializers/inflections.rb</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -1,10 +1,16 @@</span>
         # Be sure to restart your server when you modify this file.
         
        <span class="gd">-# Add new inflection rules using the following format</span>
        <span class="gd">-# (all these examples are active by default):</span>
        <span class="gd">-# ActiveSupport::Inflector.inflections do |inflect|</span>
        <span class="gi">+# Add new inflection rules using the following format. Inflections</span>
        <span class="gi">+# are locale specific, and you may define rules for as many different</span>
        <span class="gi">+# locales as you wish. All of these examples are active by default:</span>
        <span class="gi">+# ActiveSupport::Inflector.inflections(:en) do |inflect|</span>
         #   inflect.plural /^(ox)$/i, &#39;\1en&#39;
         #   inflect.singular /^(ox)en/i, &#39;\1&#39;
         #   inflect.irregular &#39;person&#39;, &#39;people&#39;
         #   inflect.uncountable %w( fish sheep )
         # end
        <span class="gi">+</span>
        <span class="gi">+# These inflection rules are supported but not enabled by default:</span>
        <span class="gi">+# ActiveSupport::Inflector.inflections(:en) do |inflect|</span>
        <span class="gi">+#   inflect.acronym &#39;RESTful&#39;</span>
        <span class="gi">+# end</span>
        </pre></div>
        <h2>
          <a href='full/#config-initializers-mime_types-rb'>config/initializers/mime_types.rb</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -2,4 +2,3 @@</span>
         
         # Add new mime types for use in respond_to blocks:
         # Mime::Type.register &quot;text/richtext&quot;, :rtf
        <span class="gd">-# Mime::Type.register_alias &quot;text/html&quot;, :iphone</span>
        </pre></div>
        <h2>
          <a href='full/#config-initializers-secret_token-rb'>config/initializers/secret_token.rb</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -1,7 +0,0 @@</span>
        <span class="gd">-# Be sure to restart your server when you modify this file.</span>
        <span class="gd">-</span>
        <span class="gd">-# Your secret key for verifying the integrity of signed cookies.</span>
        <span class="gd">-# If you change this key, all old signed cookies will become invalid!</span>
        <span class="gd">-# Make sure the secret is at least 30 characters and all random,</span>
        <span class="gd">-# no regular words or you&#39;ll be exposed to dictionary attacks.</span>
        <span class="gd">-Railsdiff::Application.config.secret_token = &#39;your-secret-token&#39;</span>
        </pre></div>
        <h2>
          <a href='full/#config-initializers-session_store-rb'>config/initializers/session_store.rb</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -1,8 +1,3 @@</span>
         # Be sure to restart your server when you modify this file.
         
        <span class="gd">-Railsdiff::Application.config.session_store :cookie_store, :key =&gt; &#39;_railsdiff_session&#39;</span>
        <span class="gd">-</span>
        <span class="gd">-# Use the database for sessions instead of the cookie-based default,</span>
        <span class="gd">-# which shouldn&#39;t be used to store highly confidential information</span>
        <span class="gd">-# (create the session table with &quot;rails generate session_migration&quot;)</span>
        <span class="gd">-# Railsdiff::Application.config.session_store :active_record_store</span>
        <span class="gi">+Rails.application.config.session_store :cookie_store, key: &#39;_railsdiff_session&#39;</span>
        </pre></div>
        <h2>
          <a href='full/#config-initializers-wrap_parameters-rb'>config/initializers/wrap_parameters.rb</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -0,0 +1,14 @@</span>
        <span class="gi">+# Be sure to restart your server when you modify this file.</span>
        <span class="gi">+</span>
        <span class="gi">+# This file contains settings for ActionController::ParamsWrapper which</span>
        <span class="gi">+# is enabled by default.</span>
        <span class="gi">+</span>
        <span class="gi">+# Enable parameter wrapping for JSON. You can disable this by setting :format to an empty array.</span>
        <span class="gi">+ActiveSupport.on_load(:action_controller) do</span>
        <span class="gi">+  wrap_parameters format: [:json] if respond_to?(:wrap_parameters)</span>
        <span class="gi">+end</span>
        <span class="gi">+</span>
        <span class="gi">+# To enable root element in JSON for ActiveRecord objects.</span>
        <span class="gi">+# ActiveSupport.on_load(:active_record) do</span>
        <span class="gi">+#  self.include_root_in_json = true</span>
        <span class="gi">+# end</span>
        </pre></div>
        <h2>
          <a href='full/#config-locales-en-yml'>config/locales/en.yml</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -1,5 +1,23 @@</span>
        <span class="gd">-# Sample localization file for English. Add more files in this directory for other locales.</span>
        <span class="gd">-# See http://github.com/svenfuchs/rails-i18n/tree/master/rails%2Flocale for starting points.</span>
        <span class="gi">+# Files in the config/locales directory are used for internationalization</span>
        <span class="gi">+# and are automatically loaded by Rails. If you want to use locales other</span>
        <span class="gi">+# than English, add the necessary files in this directory.</span>
        <span class="gi">+#</span>
        <span class="gi">+# To use the locales, use `I18n.t`:</span>
        <span class="gi">+#</span>
        <span class="gi">+#     I18n.t &#39;hello&#39;</span>
        <span class="gi">+#</span>
        <span class="gi">+# In views, this is aliased to just `t`:</span>
        <span class="gi">+#</span>
        <span class="gi">+#     &lt;%= t(&#39;hello&#39;) %&gt;</span>
        <span class="gi">+#</span>
        <span class="gi">+# To use a different locale, set it with `I18n.locale`:</span>
        <span class="gi">+#</span>
        <span class="gi">+#     I18n.locale = :es</span>
        <span class="gi">+#</span>
        <span class="gi">+# This would use the information in config/locales/es.yml.</span>
        <span class="gi">+#</span>
        <span class="gi">+# To learn more, please read the Rails Internationalization guide</span>
        <span class="gi">+# available at http://guides.rubyonrails.org/i18n.html.</span>
         
         en:
           hello: &quot;Hello world&quot;
        </pre></div>
        <h2>
          <a href='full/#config-routes-rb'>config/routes.rb</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -1,19 +1,20 @@</span>
        <span class="gd">-Railsdiff::Application.routes.draw do</span>
        <span class="gd">-  # The priority is based upon order of creation:</span>
        <span class="gd">-  # first created -&gt; highest priority.</span>
        <span class="gd">-</span>
        <span class="gd">-  # Sample of regular route:</span>
        <span class="gd">-  #   match &#39;products/:id&#39; =&gt; &#39;catalog#view&#39;</span>
        <span class="gd">-  # Keep in mind you can assign values other than :controller and :action</span>
        <span class="gd">-</span>
        <span class="gd">-  # Sample of named route:</span>
        <span class="gd">-  #   match &#39;products/:id/purchase&#39; =&gt; &#39;catalog#purchase&#39;, :as =&gt; :purchase</span>
        <span class="gd">-  # This route can be invoked with purchase_url(:id =&gt; product.id)</span>
        <span class="gi">+Rails.application.routes.draw do</span>
        <span class="gi">+  # The priority is based upon order of creation: first created -&gt; highest priority.</span>
        <span class="gi">+  # See how all your routes lay out with &quot;rake routes&quot;.</span>
         
        <span class="gd">-  # Sample resource route (maps HTTP verbs to controller actions automatically):</span>
        <span class="gi">+  # You can have the root of your site routed with &quot;root&quot;</span>
        <span class="gi">+  # root &#39;welcome#index&#39;</span>
        <span class="gi">+</span>
        <span class="gi">+  # Example of regular route:</span>
        <span class="gi">+  #   get &#39;products/:id&#39; =&gt; &#39;catalog#view&#39;</span>
        <span class="gi">+</span>
        <span class="gi">+  # Example of named route that can be invoked with purchase_url(id: product.id)</span>
        <span class="gi">+  #   get &#39;products/:id/purchase&#39; =&gt; &#39;catalog#purchase&#39;, as: :purchase</span>
        <span class="gi">+</span>
        <span class="gi">+  # Example resource route (maps HTTP verbs to controller actions automatically):</span>
           #   resources :products
         
        <span class="gd">-  # Sample resource route with options:</span>
        <span class="gi">+  # Example resource route with options:</span>
           #   resources :products do
           #     member do
           #       get &#39;short&#39;
        <span class="gu">@@ -25,34 +26,31 @@</span>
           #     end
           #   end
         
        <span class="gd">-  # Sample resource route with sub-resources:</span>
        <span class="gi">+  # Example resource route with sub-resources:</span>
           #   resources :products do
           #     resources :comments, :sales
           #     resource :seller
           #   end
         
        <span class="gd">-  # Sample resource route with more complex sub-resources</span>
        <span class="gi">+  # Example resource route with more complex sub-resources:</span>
           #   resources :products do
           #     resources :comments
           #     resources :sales do
        <span class="gd">-  #       get &#39;recent&#39;, :on =&gt; :collection</span>
        <span class="gi">+  #       get &#39;recent&#39;, on: :collection</span>
           #     end
           #   end
         
        <span class="gd">-  # Sample resource route within a namespace:</span>
        <span class="gi">+  # Example resource route with concerns:</span>
        <span class="gi">+  #   concern :toggleable do</span>
        <span class="gi">+  #     post &#39;toggle&#39;</span>
        <span class="gi">+  #   end</span>
        <span class="gi">+  #   resources :posts, concerns: :toggleable</span>
        <span class="gi">+  #   resources :photos, concerns: :toggleable</span>
        <span class="gi">+</span>
        <span class="gi">+  # Example resource route within a namespace:</span>
           #   namespace :admin do
           #     # Directs /admin/products/* to Admin::ProductsController
           #     # (app/controllers/admin/products_controller.rb)
           #     resources :products
           #   end
        <span class="gd">-</span>
        <span class="gd">-  # You can have the root of your site routed with &quot;root&quot;</span>
        <span class="gd">-  # just remember to delete public/index.html.</span>
        <span class="gd">-  # root :to =&gt; &quot;welcome#index&quot;</span>
        <span class="gd">-</span>
        <span class="gd">-  # See how all your routes lay out with &quot;rake routes&quot;</span>
        <span class="gd">-</span>
        <span class="gd">-  # This is a legacy wild controller route that&#39;s not recommended for RESTful applications.</span>
        <span class="gd">-  # Note: This route will make all actions in every controller accessible via GET requests.</span>
        <span class="gd">-  # match &#39;:controller(/:action(/:id(.:format)))&#39;</span>
         end
        </pre></div>
        <h2>
          <a href='full/#config-secrets-yml'>config/secrets.yml</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -0,0 +1,22 @@</span>
        <span class="gi">+# Be sure to restart your server when you modify this file.</span>
        <span class="gi">+</span>
        <span class="gi">+# Your secret key is used for verifying the integrity of signed cookies.</span>
        <span class="gi">+# If you change this key, all old signed cookies will become invalid!</span>
        <span class="gi">+</span>
        <span class="gi">+# Make sure the secret is at least 30 characters and all random,</span>
        <span class="gi">+# no regular words or you&#39;ll be exposed to dictionary attacks.</span>
        <span class="gi">+# You can use `rake secret` to generate a secure secret key.</span>
        <span class="gi">+</span>
        <span class="gi">+# Make sure the secrets in this file are kept private</span>
        <span class="gi">+# if you&#39;re sharing your code publicly.</span>
        <span class="gi">+</span>
        <span class="gi">+development:</span>
        <span class="gi">+  secret_key_base: your-secret-token</span>
        <span class="gi">+</span>
        <span class="gi">+test:</span>
        <span class="gi">+  secret_key_base: your-secret-token</span>
        <span class="gi">+</span>
        <span class="gi">+# Do not keep production secrets in the repository,</span>
        <span class="gi">+# instead read values from the environment.</span>
        <span class="gi">+production:</span>
        <span class="gi">+  secret_key_base: &lt;%= ENV[&quot;SECRET_KEY_BASE&quot;] %&gt;</span>
        </pre></div>
        <h2>
          <a href='full/#config-ru'>config.ru</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -1,4 +1,4 @@</span>
         # This file is used by Rack-based servers to start the application.
         
        <span class="gd">-require ::File.expand_path(&#39;../config/environment&#39;,  __FILE__)</span>
        <span class="gd">-run Railsdiff::Application</span>
        <span class="gi">+require ::File.expand_path(&#39;../config/environment&#39;, __FILE__)</span>
        <span class="gi">+run Rails.application</span>
        </pre></div>
        <h2>
          <a href='full/#db-seeds-rb'>db/seeds.rb</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -3,5 +3,5 @@</span>
         #
         # Examples:
         #
        <span class="gd">-#   cities = City.create([{ :name =&gt; &#39;Chicago&#39; }, { :name =&gt; &#39;Copenhagen&#39; }])</span>
        <span class="gd">-#   Mayor.create(:name =&gt; &#39;Daley&#39;, :city =&gt; cities.first)</span>
        <span class="gi">+#   cities = City.create([{ name: &#39;Chicago&#39; }, { name: &#39;Copenhagen&#39; }])</span>
        <span class="gi">+#   Mayor.create(name: &#39;Emanuel&#39;, city: cities.first)</span>
        </pre></div>
        <h2>
          <a href='full/#doc-README_FOR_APP'>doc/README_FOR_APP</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -1,2 +0,0 @@</span>
        <span class="gd">-Use this README file to introduce your application and point to useful places in the API for learning more.</span>
        <span class="gd">-Run &quot;rake doc:app&quot; to generate API documentation for your models, controllers, helpers, and libraries.</span>
        </pre></div>
        <h2>
          <a href='full/#public-404-html'>public/404.html</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -2,25 +2,66 @@</span>
         &lt;html&gt;
         &lt;head&gt;
           &lt;title&gt;The page you were looking for doesn&#39;t exist (404)&lt;/title&gt;
        <span class="gd">-  &lt;style type=&quot;text/css&quot;&gt;</span>
        <span class="gd">-    body { background-color: #fff; color: #666; text-align: center; font-family: arial, sans-serif; }</span>
        <span class="gd">-    div.dialog {</span>
        <span class="gd">-      width: 25em;</span>
        <span class="gd">-      padding: 0 4em;</span>
        <span class="gd">-      margin: 4em auto 0 auto;</span>
        <span class="gd">-      border: 1px solid #ccc;</span>
        <span class="gd">-      border-right-color: #999;</span>
        <span class="gd">-      border-bottom-color: #999;</span>
        <span class="gd">-    }</span>
        <span class="gd">-    h1 { font-size: 100%; color: #f00; line-height: 1.5em; }</span>
        <span class="gi">+  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1&quot;&gt;</span>
        <span class="gi">+  &lt;style&gt;</span>
        <span class="gi">+  body {</span>
        <span class="gi">+    background-color: #EFEFEF;</span>
        <span class="gi">+    color: #2E2F30;</span>
        <span class="gi">+    text-align: center;</span>
        <span class="gi">+    font-family: arial, sans-serif;</span>
        <span class="gi">+    margin: 0;</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  div.dialog {</span>
        <span class="gi">+    width: 95%;</span>
        <span class="gi">+    max-width: 33em;</span>
        <span class="gi">+    margin: 4em auto 0;</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  div.dialog &gt; div {</span>
        <span class="gi">+    border: 1px solid #CCC;</span>
        <span class="gi">+    border-right-color: #999;</span>
        <span class="gi">+    border-left-color: #999;</span>
        <span class="gi">+    border-bottom-color: #BBB;</span>
        <span class="gi">+    border-top: #B00100 solid 4px;</span>
        <span class="gi">+    border-top-left-radius: 9px;</span>
        <span class="gi">+    border-top-right-radius: 9px;</span>
        <span class="gi">+    background-color: white;</span>
        <span class="gi">+    padding: 7px 12% 0;</span>
        <span class="gi">+    box-shadow: 0 3px 8px rgba(50, 50, 50, 0.17);</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  h1 {</span>
        <span class="gi">+    font-size: 100%;</span>
        <span class="gi">+    color: #730E15;</span>
        <span class="gi">+    line-height: 1.5em;</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  div.dialog &gt; p {</span>
        <span class="gi">+    margin: 0 0 1em;</span>
        <span class="gi">+    padding: 1em;</span>
        <span class="gi">+    background-color: #F7F7F7;</span>
        <span class="gi">+    border: 1px solid #CCC;</span>
        <span class="gi">+    border-right-color: #999;</span>
        <span class="gi">+    border-left-color: #999;</span>
        <span class="gi">+    border-bottom-color: #999;</span>
        <span class="gi">+    border-bottom-left-radius: 4px;</span>
        <span class="gi">+    border-bottom-right-radius: 4px;</span>
        <span class="gi">+    border-top-color: #DADADA;</span>
        <span class="gi">+    color: #666;</span>
        <span class="gi">+    box-shadow: 0 3px 8px rgba(50, 50, 50, 0.17);</span>
        <span class="gi">+  }</span>
           &lt;/style&gt;
         &lt;/head&gt;
         
         &lt;body&gt;
           &lt;!-- This file lives in public/404.html --&gt;
           &lt;div class=&quot;dialog&quot;&gt;
        <span class="gd">-    &lt;h1&gt;The page you were looking for doesn&#39;t exist.&lt;/h1&gt;</span>
        <span class="gd">-    &lt;p&gt;You may have mistyped the address or the page may have moved.&lt;/p&gt;</span>
        <span class="gi">+    &lt;div&gt;</span>
        <span class="gi">+      &lt;h1&gt;The page you were looking for doesn&#39;t exist.&lt;/h1&gt;</span>
        <span class="gi">+      &lt;p&gt;You may have mistyped the address or the page may have moved.&lt;/p&gt;</span>
        <span class="gi">+    &lt;/div&gt;</span>
        <span class="gi">+    &lt;p&gt;If you are the application owner check the logs for more information.&lt;/p&gt;</span>
           &lt;/div&gt;
         &lt;/body&gt;
         &lt;/html&gt;
        </pre></div>
        <h2>
          <a href='full/#public-422-html'>public/422.html</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -2,25 +2,66 @@</span>
         &lt;html&gt;
         &lt;head&gt;
           &lt;title&gt;The change you wanted was rejected (422)&lt;/title&gt;
        <span class="gd">-  &lt;style type=&quot;text/css&quot;&gt;</span>
        <span class="gd">-    body { background-color: #fff; color: #666; text-align: center; font-family: arial, sans-serif; }</span>
        <span class="gd">-    div.dialog {</span>
        <span class="gd">-      width: 25em;</span>
        <span class="gd">-      padding: 0 4em;</span>
        <span class="gd">-      margin: 4em auto 0 auto;</span>
        <span class="gd">-      border: 1px solid #ccc;</span>
        <span class="gd">-      border-right-color: #999;</span>
        <span class="gd">-      border-bottom-color: #999;</span>
        <span class="gd">-    }</span>
        <span class="gd">-    h1 { font-size: 100%; color: #f00; line-height: 1.5em; }</span>
        <span class="gi">+  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1&quot;&gt;</span>
        <span class="gi">+  &lt;style&gt;</span>
        <span class="gi">+  body {</span>
        <span class="gi">+    background-color: #EFEFEF;</span>
        <span class="gi">+    color: #2E2F30;</span>
        <span class="gi">+    text-align: center;</span>
        <span class="gi">+    font-family: arial, sans-serif;</span>
        <span class="gi">+    margin: 0;</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  div.dialog {</span>
        <span class="gi">+    width: 95%;</span>
        <span class="gi">+    max-width: 33em;</span>
        <span class="gi">+    margin: 4em auto 0;</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  div.dialog &gt; div {</span>
        <span class="gi">+    border: 1px solid #CCC;</span>
        <span class="gi">+    border-right-color: #999;</span>
        <span class="gi">+    border-left-color: #999;</span>
        <span class="gi">+    border-bottom-color: #BBB;</span>
        <span class="gi">+    border-top: #B00100 solid 4px;</span>
        <span class="gi">+    border-top-left-radius: 9px;</span>
        <span class="gi">+    border-top-right-radius: 9px;</span>
        <span class="gi">+    background-color: white;</span>
        <span class="gi">+    padding: 7px 12% 0;</span>
        <span class="gi">+    box-shadow: 0 3px 8px rgba(50, 50, 50, 0.17);</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  h1 {</span>
        <span class="gi">+    font-size: 100%;</span>
        <span class="gi">+    color: #730E15;</span>
        <span class="gi">+    line-height: 1.5em;</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  div.dialog &gt; p {</span>
        <span class="gi">+    margin: 0 0 1em;</span>
        <span class="gi">+    padding: 1em;</span>
        <span class="gi">+    background-color: #F7F7F7;</span>
        <span class="gi">+    border: 1px solid #CCC;</span>
        <span class="gi">+    border-right-color: #999;</span>
        <span class="gi">+    border-left-color: #999;</span>
        <span class="gi">+    border-bottom-color: #999;</span>
        <span class="gi">+    border-bottom-left-radius: 4px;</span>
        <span class="gi">+    border-bottom-right-radius: 4px;</span>
        <span class="gi">+    border-top-color: #DADADA;</span>
        <span class="gi">+    color: #666;</span>
        <span class="gi">+    box-shadow: 0 3px 8px rgba(50, 50, 50, 0.17);</span>
        <span class="gi">+  }</span>
           &lt;/style&gt;
         &lt;/head&gt;
         
         &lt;body&gt;
           &lt;!-- This file lives in public/422.html --&gt;
           &lt;div class=&quot;dialog&quot;&gt;
        <span class="gd">-    &lt;h1&gt;The change you wanted was rejected.&lt;/h1&gt;</span>
        <span class="gd">-    &lt;p&gt;Maybe you tried to change something you didn&#39;t have access to.&lt;/p&gt;</span>
        <span class="gi">+    &lt;div&gt;</span>
        <span class="gi">+      &lt;h1&gt;The change you wanted was rejected.&lt;/h1&gt;</span>
        <span class="gi">+      &lt;p&gt;Maybe you tried to change something you didn&#39;t have access to.&lt;/p&gt;</span>
        <span class="gi">+    &lt;/div&gt;</span>
        <span class="gi">+    &lt;p&gt;If you are the application owner check the logs for more information.&lt;/p&gt;</span>
           &lt;/div&gt;
         &lt;/body&gt;
         &lt;/html&gt;
        </pre></div>
        <h2>
          <a href='full/#public-500-html'>public/500.html</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -2,25 +2,65 @@</span>
         &lt;html&gt;
         &lt;head&gt;
           &lt;title&gt;We&#39;re sorry, but something went wrong (500)&lt;/title&gt;
        <span class="gd">-  &lt;style type=&quot;text/css&quot;&gt;</span>
        <span class="gd">-    body { background-color: #fff; color: #666; text-align: center; font-family: arial, sans-serif; }</span>
        <span class="gd">-    div.dialog {</span>
        <span class="gd">-      width: 25em;</span>
        <span class="gd">-      padding: 0 4em;</span>
        <span class="gd">-      margin: 4em auto 0 auto;</span>
        <span class="gd">-      border: 1px solid #ccc;</span>
        <span class="gd">-      border-right-color: #999;</span>
        <span class="gd">-      border-bottom-color: #999;</span>
        <span class="gd">-    }</span>
        <span class="gd">-    h1 { font-size: 100%; color: #f00; line-height: 1.5em; }</span>
        <span class="gi">+  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1&quot;&gt;</span>
        <span class="gi">+  &lt;style&gt;</span>
        <span class="gi">+  body {</span>
        <span class="gi">+    background-color: #EFEFEF;</span>
        <span class="gi">+    color: #2E2F30;</span>
        <span class="gi">+    text-align: center;</span>
        <span class="gi">+    font-family: arial, sans-serif;</span>
        <span class="gi">+    margin: 0;</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  div.dialog {</span>
        <span class="gi">+    width: 95%;</span>
        <span class="gi">+    max-width: 33em;</span>
        <span class="gi">+    margin: 4em auto 0;</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  div.dialog &gt; div {</span>
        <span class="gi">+    border: 1px solid #CCC;</span>
        <span class="gi">+    border-right-color: #999;</span>
        <span class="gi">+    border-left-color: #999;</span>
        <span class="gi">+    border-bottom-color: #BBB;</span>
        <span class="gi">+    border-top: #B00100 solid 4px;</span>
        <span class="gi">+    border-top-left-radius: 9px;</span>
        <span class="gi">+    border-top-right-radius: 9px;</span>
        <span class="gi">+    background-color: white;</span>
        <span class="gi">+    padding: 7px 12% 0;</span>
        <span class="gi">+    box-shadow: 0 3px 8px rgba(50, 50, 50, 0.17);</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  h1 {</span>
        <span class="gi">+    font-size: 100%;</span>
        <span class="gi">+    color: #730E15;</span>
        <span class="gi">+    line-height: 1.5em;</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  div.dialog &gt; p {</span>
        <span class="gi">+    margin: 0 0 1em;</span>
        <span class="gi">+    padding: 1em;</span>
        <span class="gi">+    background-color: #F7F7F7;</span>
        <span class="gi">+    border: 1px solid #CCC;</span>
        <span class="gi">+    border-right-color: #999;</span>
        <span class="gi">+    border-left-color: #999;</span>
        <span class="gi">+    border-bottom-color: #999;</span>
        <span class="gi">+    border-bottom-left-radius: 4px;</span>
        <span class="gi">+    border-bottom-right-radius: 4px;</span>
        <span class="gi">+    border-top-color: #DADADA;</span>
        <span class="gi">+    color: #666;</span>
        <span class="gi">+    box-shadow: 0 3px 8px rgba(50, 50, 50, 0.17);</span>
        <span class="gi">+  }</span>
           &lt;/style&gt;
         &lt;/head&gt;
         
         &lt;body&gt;
           &lt;!-- This file lives in public/500.html --&gt;
           &lt;div class=&quot;dialog&quot;&gt;
        <span class="gd">-    &lt;h1&gt;We&#39;re sorry, but something went wrong.&lt;/h1&gt;</span>
        <span class="gd">-    &lt;p&gt;We&#39;ve been notified about this issue and we&#39;ll take a look at it shortly.&lt;/p&gt;</span>
        <span class="gi">+    &lt;div&gt;</span>
        <span class="gi">+      &lt;h1&gt;We&#39;re sorry, but something went wrong.&lt;/h1&gt;</span>
        <span class="gi">+    &lt;/div&gt;</span>
        <span class="gi">+    &lt;p&gt;If you are the application owner check the logs for more information.&lt;/p&gt;</span>
           &lt;/div&gt;
         &lt;/body&gt;
         &lt;/html&gt;
        </pre></div>
        <h2>
          <a href='full/#public-index-html'>public/index.html</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -1,239 +0,0 @@</span>
        <span class="gd">-&lt;!DOCTYPE html&gt;</span>
        <span class="gd">-&lt;html&gt;</span>
        <span class="gd">-  &lt;head&gt;</span>
        <span class="gd">-    &lt;title&gt;Ruby on Rails: Welcome aboard&lt;/title&gt;</span>
        <span class="gd">-    &lt;style type=&quot;text/css&quot; media=&quot;screen&quot;&gt;</span>
        <span class="gd">-      body {</span>
        <span class="gd">-        margin: 0;</span>
        <span class="gd">-        margin-bottom: 25px;</span>
        <span class="gd">-        padding: 0;</span>
        <span class="gd">-        background-color: #f0f0f0;</span>
        <span class="gd">-        font-family: &quot;Lucida Grande&quot;, &quot;Bitstream Vera Sans&quot;, &quot;Verdana&quot;;</span>
        <span class="gd">-        font-size: 13px;</span>
        <span class="gd">-        color: #333;</span>
        <span class="gd">-      }</span>
        <span class="gd">-</span>
        <span class="gd">-      h1 {</span>
        <span class="gd">-        font-size: 28px;</span>
        <span class="gd">-        color: #000;</span>
        <span class="gd">-      }</span>
        <span class="gd">-</span>
        <span class="gd">-      a  {color: #03c}</span>
        <span class="gd">-      a:hover {</span>
        <span class="gd">-        background-color: #03c;</span>
        <span class="gd">-        color: white;</span>
        <span class="gd">-        text-decoration: none;</span>
        <span class="gd">-      }</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-      #page {</span>
        <span class="gd">-        background-color: #f0f0f0;</span>
        <span class="gd">-        width: 750px;</span>
        <span class="gd">-        margin: 0;</span>
        <span class="gd">-        margin-left: auto;</span>
        <span class="gd">-        margin-right: auto;</span>
        <span class="gd">-      }</span>
        <span class="gd">-</span>
        <span class="gd">-      #content {</span>
        <span class="gd">-        float: left;</span>
        <span class="gd">-        background-color: white;</span>
        <span class="gd">-        border: 3px solid #aaa;</span>
        <span class="gd">-        border-top: none;</span>
        <span class="gd">-        padding: 25px;</span>
        <span class="gd">-        width: 500px;</span>
        <span class="gd">-      }</span>
        <span class="gd">-</span>
        <span class="gd">-      #sidebar {</span>
        <span class="gd">-        float: right;</span>
        <span class="gd">-        width: 175px;</span>
        <span class="gd">-      }</span>
        <span class="gd">-</span>
        <span class="gd">-      #footer {</span>
        <span class="gd">-        clear: both;</span>
        <span class="gd">-      }</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-      #header, #about, #getting-started {</span>
        <span class="gd">-        padding-left: 75px;</span>
        <span class="gd">-        padding-right: 30px;</span>
        <span class="gd">-      }</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-      #header {</span>
        <span class="gd">-        background-image: url(&quot;images/rails.png&quot;);</span>
        <span class="gd">-        background-repeat: no-repeat;</span>
        <span class="gd">-        background-position: top left;</span>
        <span class="gd">-        height: 64px;</span>
        <span class="gd">-      }</span>
        <span class="gd">-      #header h1, #header h2 {margin: 0}</span>
        <span class="gd">-      #header h2 {</span>
        <span class="gd">-        color: #888;</span>
        <span class="gd">-        font-weight: normal;</span>
        <span class="gd">-        font-size: 16px;</span>
        <span class="gd">-      }</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-      #about h3 {</span>
        <span class="gd">-        margin: 0;</span>
        <span class="gd">-        margin-bottom: 10px;</span>
        <span class="gd">-        font-size: 14px;</span>
        <span class="gd">-      }</span>
        <span class="gd">-</span>
        <span class="gd">-      #about-content {</span>
        <span class="gd">-        background-color: #ffd;</span>
        <span class="gd">-        border: 1px solid #fc0;</span>
        <span class="gd">-        margin-left: -55px;</span>
        <span class="gd">-        margin-right: -10px;</span>
        <span class="gd">-      }</span>
        <span class="gd">-      #about-content table {</span>
        <span class="gd">-        margin-top: 10px;</span>
        <span class="gd">-        margin-bottom: 10px;</span>
        <span class="gd">-        font-size: 11px;</span>
        <span class="gd">-        border-collapse: collapse;</span>
        <span class="gd">-      }</span>
        <span class="gd">-      #about-content td {</span>
        <span class="gd">-        padding: 10px;</span>
        <span class="gd">-        padding-top: 3px;</span>
        <span class="gd">-        padding-bottom: 3px;</span>
        <span class="gd">-      }</span>
        <span class="gd">-      #about-content td.name  {color: #555}</span>
        <span class="gd">-      #about-content td.value {color: #000}</span>
        <span class="gd">-</span>
        <span class="gd">-      #about-content ul {</span>
        <span class="gd">-        padding: 0;</span>
        <span class="gd">-        list-style-type: none;</span>
        <span class="gd">-      }</span>
        <span class="gd">-</span>
        <span class="gd">-      #about-content.failure {</span>
        <span class="gd">-        background-color: #fcc;</span>
        <span class="gd">-        border: 1px solid #f00;</span>
        <span class="gd">-      }</span>
        <span class="gd">-      #about-content.failure p {</span>
        <span class="gd">-        margin: 0;</span>
        <span class="gd">-        padding: 10px;</span>
        <span class="gd">-      }</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-      #getting-started {</span>
        <span class="gd">-        border-top: 1px solid #ccc;</span>
        <span class="gd">-        margin-top: 25px;</span>
        <span class="gd">-        padding-top: 15px;</span>
        <span class="gd">-      }</span>
        <span class="gd">-      #getting-started h1 {</span>
        <span class="gd">-        margin: 0;</span>
        <span class="gd">-        font-size: 20px;</span>
        <span class="gd">-      }</span>
        <span class="gd">-      #getting-started h2 {</span>
        <span class="gd">-        margin: 0;</span>
        <span class="gd">-        font-size: 14px;</span>
        <span class="gd">-        font-weight: normal;</span>
        <span class="gd">-        color: #333;</span>
        <span class="gd">-        margin-bottom: 25px;</span>
        <span class="gd">-      }</span>
        <span class="gd">-      #getting-started ol {</span>
        <span class="gd">-        margin-left: 0;</span>
        <span class="gd">-        padding-left: 0;</span>
        <span class="gd">-      }</span>
        <span class="gd">-      #getting-started li {</span>
        <span class="gd">-        font-size: 18px;</span>
        <span class="gd">-        color: #888;</span>
        <span class="gd">-        margin-bottom: 25px;</span>
        <span class="gd">-      }</span>
        <span class="gd">-      #getting-started li h2 {</span>
        <span class="gd">-        margin: 0;</span>
        <span class="gd">-        font-weight: normal;</span>
        <span class="gd">-        font-size: 18px;</span>
        <span class="gd">-        color: #333;</span>
        <span class="gd">-      }</span>
        <span class="gd">-      #getting-started li p {</span>
        <span class="gd">-        color: #555;</span>
        <span class="gd">-        font-size: 13px;</span>
        <span class="gd">-      }</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-      #sidebar ul {</span>
        <span class="gd">-        margin-left: 0;</span>
        <span class="gd">-        padding-left: 0;</span>
        <span class="gd">-      }</span>
        <span class="gd">-      #sidebar ul h3 {</span>
        <span class="gd">-        margin-top: 25px;</span>
        <span class="gd">-        font-size: 16px;</span>
        <span class="gd">-        padding-bottom: 10px;</span>
        <span class="gd">-        border-bottom: 1px solid #ccc;</span>
        <span class="gd">-      }</span>
        <span class="gd">-      #sidebar li {</span>
        <span class="gd">-        list-style-type: none;</span>
        <span class="gd">-      }</span>
        <span class="gd">-      #sidebar ul.links li {</span>
        <span class="gd">-        margin-bottom: 5px;</span>
        <span class="gd">-      }</span>
        <span class="gd">-</span>
        <span class="gd">-    &lt;/style&gt;</span>
        <span class="gd">-    &lt;script type=&quot;text/javascript&quot;&gt;</span>
        <span class="gd">-      function about() {</span>
        <span class="gd">-        info = document.getElementById(&#39;about-content&#39;);</span>
        <span class="gd">-        if (window.XMLHttpRequest)</span>
        <span class="gd">-          { xhr = new XMLHttpRequest(); }</span>
        <span class="gd">-        else</span>
        <span class="gd">-          { xhr = new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;); }</span>
        <span class="gd">-        xhr.open(&quot;GET&quot;,&quot;rails/info/properties&quot;,false);</span>
        <span class="gd">-        xhr.send(&quot;&quot;);</span>
        <span class="gd">-        info.innerHTML = xhr.responseText;</span>
        <span class="gd">-        info.style.display = &#39;block&#39;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    &lt;/script&gt;</span>
        <span class="gd">-  &lt;/head&gt;</span>
        <span class="gd">-  &lt;body&gt;</span>
        <span class="gd">-    &lt;div id=&quot;page&quot;&gt;</span>
        <span class="gd">-      &lt;div id=&quot;sidebar&quot;&gt;</span>
        <span class="gd">-        &lt;ul id=&quot;sidebar-items&quot;&gt;</span>
        <span class="gd">-          &lt;li&gt;</span>
        <span class="gd">-            &lt;h3&gt;Browse the documentation&lt;/h3&gt;</span>
        <span class="gd">-            &lt;ul class=&quot;links&quot;&gt;</span>
        <span class="gd">-              &lt;li&gt;&lt;a href=&quot;http://api.rubyonrails.org/&quot;&gt;Rails API&lt;/a&gt;&lt;/li&gt;</span>
        <span class="gd">-              &lt;li&gt;&lt;a href=&quot;http://stdlib.rubyonrails.org/&quot;&gt;Ruby standard library&lt;/a&gt;&lt;/li&gt;</span>
        <span class="gd">-              &lt;li&gt;&lt;a href=&quot;http://corelib.rubyonrails.org/&quot;&gt;Ruby core&lt;/a&gt;&lt;/li&gt;</span>
        <span class="gd">-              &lt;li&gt;&lt;a href=&quot;http://guides.rubyonrails.org/&quot;&gt;Rails Guides&lt;/a&gt;&lt;/li&gt;</span>
        <span class="gd">-            &lt;/ul&gt;</span>
        <span class="gd">-          &lt;/li&gt;</span>
        <span class="gd">-        &lt;/ul&gt;</span>
        <span class="gd">-      &lt;/div&gt;</span>
        <span class="gd">-</span>
        <span class="gd">-      &lt;div id=&quot;content&quot;&gt;</span>
        <span class="gd">-        &lt;div id=&quot;header&quot;&gt;</span>
        <span class="gd">-          &lt;h1&gt;Welcome aboard&lt;/h1&gt;</span>
        <span class="gd">-          &lt;h2&gt;You&amp;rsquo;re riding Ruby on Rails!&lt;/h2&gt;</span>
        <span class="gd">-        &lt;/div&gt;</span>
        <span class="gd">-</span>
        <span class="gd">-        &lt;div id=&quot;about&quot;&gt;</span>
        <span class="gd">-          &lt;h3&gt;&lt;a href=&quot;rails/info/properties&quot; onclick=&quot;about(); return false&quot;&gt;About your application&amp;rsquo;s environment&lt;/a&gt;&lt;/h3&gt;</span>
        <span class="gd">-          &lt;div id=&quot;about-content&quot; style=&quot;display: none&quot;&gt;&lt;/div&gt;</span>
        <span class="gd">-        &lt;/div&gt;</span>
        <span class="gd">-</span>
        <span class="gd">-        &lt;div id=&quot;getting-started&quot;&gt;</span>
        <span class="gd">-          &lt;h1&gt;Getting started&lt;/h1&gt;</span>
        <span class="gd">-          &lt;h2&gt;Here&amp;rsquo;s how to get rolling:&lt;/h2&gt;</span>
        <span class="gd">-</span>
        <span class="gd">-          &lt;ol&gt;</span>
        <span class="gd">-            &lt;li&gt;</span>
        <span class="gd">-              &lt;h2&gt;Use &lt;code&gt;rails generate&lt;/code&gt; to create your models and controllers&lt;/h2&gt;</span>
        <span class="gd">-              &lt;p&gt;To see all available options, run it without parameters.&lt;/p&gt;</span>
        <span class="gd">-            &lt;/li&gt;</span>
        <span class="gd">-</span>
        <span class="gd">-            &lt;li&gt;</span>
        <span class="gd">-              &lt;h2&gt;Set up a default route and remove or rename this file&lt;/h2&gt;</span>
        <span class="gd">-              &lt;p&gt;Routes are set up in config/routes.rb.&lt;/p&gt;</span>
        <span class="gd">-            &lt;/li&gt;</span>
        <span class="gd">-</span>
        <span class="gd">-            &lt;li&gt;</span>
        <span class="gd">-              &lt;h2&gt;Create your database&lt;/h2&gt;</span>
        <span class="gd">-              &lt;p&gt;Run &lt;code&gt;rake db:migrate&lt;/code&gt; to create your database. If you&#39;re not using SQLite (the default), edit &lt;code&gt;config/database.yml&lt;/code&gt; with your username and password.&lt;/p&gt;</span>
        <span class="gd">-            &lt;/li&gt;</span>
        <span class="gd">-          &lt;/ol&gt;</span>
        <span class="gd">-        &lt;/div&gt;</span>
        <span class="gd">-      &lt;/div&gt;</span>
        <span class="gd">-</span>
        <span class="gd">-      &lt;div id=&quot;footer&quot;&gt;&amp;nbsp;&lt;/div&gt;</span>
        <span class="gd">-    &lt;/div&gt;</span>
        <span class="gd">-  &lt;/body&gt;</span>
        <span class="gd">-&lt;/html&gt;</span>
        </pre></div>
        <h2>
          <a href='full/#public-javascripts-application-js'>public/javascripts/application.js</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -1,2 +0,0 @@</span>
        <span class="gd">-// Place your application-specific JavaScript functions and classes here</span>
        <span class="gd">-// This file is automatically included by javascript_include_tag :defaults</span>
        </pre></div>
        <h2>
          <a href='full/#public-javascripts-controls-js'>public/javascripts/controls.js</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -1,965 +0,0 @@</span>
        <span class="gd">-// script.aculo.us controls.js v1.8.3, Thu Oct 08 11:23:33 +0200 2009</span>
        <span class="gd">-</span>
        <span class="gd">-// Copyright (c) 2005-2009 Thomas Fuchs (http://script.aculo.us, http://mir.aculo.us)</span>
        <span class="gd">-//           (c) 2005-2009 Ivan Krstic (http://blogs.law.harvard.edu/ivan)</span>
        <span class="gd">-//           (c) 2005-2009 Jon Tirsen (http://www.tirsen.com)</span>
        <span class="gd">-// Contributors:</span>
        <span class="gd">-//  Richard Livsey</span>
        <span class="gd">-//  Rahul Bhargava</span>
        <span class="gd">-//  Rob Wills</span>
        <span class="gd">-//</span>
        <span class="gd">-// script.aculo.us is freely distributable under the terms of an MIT-style license.</span>
        <span class="gd">-// For details, see the script.aculo.us web site: http://script.aculo.us/</span>
        <span class="gd">-</span>
        <span class="gd">-// Autocompleter.Base handles all the autocompletion functionality</span>
        <span class="gd">-// that&#39;s independent of the data source for autocompletion. This</span>
        <span class="gd">-// includes drawing the autocompletion menu, observing keyboard</span>
        <span class="gd">-// and mouse events, and similar.</span>
        <span class="gd">-//</span>
        <span class="gd">-// Specific autocompleters need to provide, at the very least,</span>
        <span class="gd">-// a getUpdatedChoices function that will be invoked every time</span>
        <span class="gd">-// the text inside the monitored textbox changes. This method</span>
        <span class="gd">-// should get the text for which to provide autocompletion by</span>
        <span class="gd">-// invoking this.getToken(), NOT by directly accessing</span>
        <span class="gd">-// this.element.value. This is to allow incremental tokenized</span>
        <span class="gd">-// autocompletion. Specific auto-completion logic (AJAX, etc)</span>
        <span class="gd">-// belongs in getUpdatedChoices.</span>
        <span class="gd">-//</span>
        <span class="gd">-// Tokenized incremental autocompletion is enabled automatically</span>
        <span class="gd">-// when an autocompleter is instantiated with the &#39;tokens&#39; option</span>
        <span class="gd">-// in the options parameter, e.g.:</span>
        <span class="gd">-// new Ajax.Autocompleter(&#39;id&#39;,&#39;upd&#39;, &#39;/url/&#39;, { tokens: &#39;,&#39; });</span>
        <span class="gd">-// will incrementally autocomplete with a comma as the token.</span>
        <span class="gd">-// Additionally, &#39;,&#39; in the above example can be replaced with</span>
        <span class="gd">-// a token array, e.g. { tokens: [&#39;,&#39;, &#39;\n&#39;] } which</span>
        <span class="gd">-// enables autocompletion on multiple tokens. This is most</span>
        <span class="gd">-// useful when one of the tokens is \n (a newline), as it</span>
        <span class="gd">-// allows smart autocompletion after linebreaks.</span>
        <span class="gd">-</span>
        <span class="gd">-if(typeof Effect == &#39;undefined&#39;)</span>
        <span class="gd">-  throw(&quot;controls.js requires including script.aculo.us&#39; effects.js library&quot;);</span>
        <span class="gd">-</span>
        <span class="gd">-var Autocompleter = { };</span>
        <span class="gd">-Autocompleter.Base = Class.create({</span>
        <span class="gd">-  baseInitialize: function(element, update, options) {</span>
        <span class="gd">-    element          = $(element);</span>
        <span class="gd">-    this.element     = element;</span>
        <span class="gd">-    this.update      = $(update);</span>
        <span class="gd">-    this.hasFocus    = false;</span>
        <span class="gd">-    this.changed     = false;</span>
        <span class="gd">-    this.active      = false;</span>
        <span class="gd">-    this.index       = 0;</span>
        <span class="gd">-    this.entryCount  = 0;</span>
        <span class="gd">-    this.oldElementValue = this.element.value;</span>
        <span class="gd">-</span>
        <span class="gd">-    if(this.setOptions)</span>
        <span class="gd">-      this.setOptions(options);</span>
        <span class="gd">-    else</span>
        <span class="gd">-      this.options = options || { };</span>
        <span class="gd">-</span>
        <span class="gd">-    this.options.paramName    = this.options.paramName || this.element.name;</span>
        <span class="gd">-    this.options.tokens       = this.options.tokens || [];</span>
        <span class="gd">-    this.options.frequency    = this.options.frequency || 0.4;</span>
        <span class="gd">-    this.options.minChars     = this.options.minChars || 1;</span>
        <span class="gd">-    this.options.onShow       = this.options.onShow ||</span>
        <span class="gd">-      function(element, update){</span>
        <span class="gd">-        if(!update.style.position || update.style.position==&#39;absolute&#39;) {</span>
        <span class="gd">-          update.style.position = &#39;absolute&#39;;</span>
        <span class="gd">-          Position.clone(element, update, {</span>
        <span class="gd">-            setHeight: false,</span>
        <span class="gd">-            offsetTop: element.offsetHeight</span>
        <span class="gd">-          });</span>
        <span class="gd">-        }</span>
        <span class="gd">-        Effect.Appear(update,{duration:0.15});</span>
        <span class="gd">-      };</span>
        <span class="gd">-    this.options.onHide = this.options.onHide ||</span>
        <span class="gd">-      function(element, update){ new Effect.Fade(update,{duration:0.15}) };</span>
        <span class="gd">-</span>
        <span class="gd">-    if(typeof(this.options.tokens) == &#39;string&#39;)</span>
        <span class="gd">-      this.options.tokens = new Array(this.options.tokens);</span>
        <span class="gd">-    // Force carriage returns as token delimiters anyway</span>
        <span class="gd">-    if (!this.options.tokens.include(&#39;\n&#39;))</span>
        <span class="gd">-      this.options.tokens.push(&#39;\n&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-    this.observer = null;</span>
        <span class="gd">-</span>
        <span class="gd">-    this.element.setAttribute(&#39;autocomplete&#39;,&#39;off&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-    Element.hide(this.update);</span>
        <span class="gd">-</span>
        <span class="gd">-    Event.observe(this.element, &#39;blur&#39;, this.onBlur.bindAsEventListener(this));</span>
        <span class="gd">-    Event.observe(this.element, &#39;keydown&#39;, this.onKeyPress.bindAsEventListener(this));</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  show: function() {</span>
        <span class="gd">-    if(Element.getStyle(this.update, &#39;display&#39;)==&#39;none&#39;) this.options.onShow(this.element, this.update);</span>
        <span class="gd">-    if(!this.iefix &amp;&amp;</span>
        <span class="gd">-      (Prototype.Browser.IE) &amp;&amp;</span>
        <span class="gd">-      (Element.getStyle(this.update, &#39;position&#39;)==&#39;absolute&#39;)) {</span>
        <span class="gd">-      new Insertion.After(this.update,</span>
        <span class="gd">-       &#39;&lt;iframe id=&quot;&#39; + this.update.id + &#39;_iefix&quot; &#39;+</span>
        <span class="gd">-       &#39;style=&quot;display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);&quot; &#39; +</span>
        <span class="gd">-       &#39;src=&quot;javascript:false;&quot; frameborder=&quot;0&quot; scrolling=&quot;no&quot;&gt;&lt;/iframe&gt;&#39;);</span>
        <span class="gd">-      this.iefix = $(this.update.id+&#39;_iefix&#39;);</span>
        <span class="gd">-    }</span>
        <span class="gd">-    if(this.iefix) setTimeout(this.fixIEOverlapping.bind(this), 50);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  fixIEOverlapping: function() {</span>
        <span class="gd">-    Position.clone(this.update, this.iefix, {setTop:(!this.update.style.height)});</span>
        <span class="gd">-    this.iefix.style.zIndex = 1;</span>
        <span class="gd">-    this.update.style.zIndex = 2;</span>
        <span class="gd">-    Element.show(this.iefix);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  hide: function() {</span>
        <span class="gd">-    this.stopIndicator();</span>
        <span class="gd">-    if(Element.getStyle(this.update, &#39;display&#39;)!=&#39;none&#39;) this.options.onHide(this.element, this.update);</span>
        <span class="gd">-    if(this.iefix) Element.hide(this.iefix);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  startIndicator: function() {</span>
        <span class="gd">-    if(this.options.indicator) Element.show(this.options.indicator);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  stopIndicator: function() {</span>
        <span class="gd">-    if(this.options.indicator) Element.hide(this.options.indicator);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  onKeyPress: function(event) {</span>
        <span class="gd">-    if(this.active)</span>
        <span class="gd">-      switch(event.keyCode) {</span>
        <span class="gd">-       case Event.KEY_TAB:</span>
        <span class="gd">-       case Event.KEY_RETURN:</span>
        <span class="gd">-         this.selectEntry();</span>
        <span class="gd">-         Event.stop(event);</span>
        <span class="gd">-       case Event.KEY_ESC:</span>
        <span class="gd">-         this.hide();</span>
        <span class="gd">-         this.active = false;</span>
        <span class="gd">-         Event.stop(event);</span>
        <span class="gd">-         return;</span>
        <span class="gd">-       case Event.KEY_LEFT:</span>
        <span class="gd">-       case Event.KEY_RIGHT:</span>
        <span class="gd">-         return;</span>
        <span class="gd">-       case Event.KEY_UP:</span>
        <span class="gd">-         this.markPrevious();</span>
        <span class="gd">-         this.render();</span>
        <span class="gd">-         Event.stop(event);</span>
        <span class="gd">-         return;</span>
        <span class="gd">-       case Event.KEY_DOWN:</span>
        <span class="gd">-         this.markNext();</span>
        <span class="gd">-         this.render();</span>
        <span class="gd">-         Event.stop(event);</span>
        <span class="gd">-         return;</span>
        <span class="gd">-      }</span>
        <span class="gd">-     else</span>
        <span class="gd">-       if(event.keyCode==Event.KEY_TAB || event.keyCode==Event.KEY_RETURN ||</span>
        <span class="gd">-         (Prototype.Browser.WebKit &gt; 0 &amp;&amp; event.keyCode == 0)) return;</span>
        <span class="gd">-</span>
        <span class="gd">-    this.changed = true;</span>
        <span class="gd">-    this.hasFocus = true;</span>
        <span class="gd">-</span>
        <span class="gd">-    if(this.observer) clearTimeout(this.observer);</span>
        <span class="gd">-      this.observer =</span>
        <span class="gd">-        setTimeout(this.onObserverEvent.bind(this), this.options.frequency*1000);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  activate: function() {</span>
        <span class="gd">-    this.changed = false;</span>
        <span class="gd">-    this.hasFocus = true;</span>
        <span class="gd">-    this.getUpdatedChoices();</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  onHover: function(event) {</span>
        <span class="gd">-    var element = Event.findElement(event, &#39;LI&#39;);</span>
        <span class="gd">-    if(this.index != element.autocompleteIndex)</span>
        <span class="gd">-    {</span>
        <span class="gd">-        this.index = element.autocompleteIndex;</span>
        <span class="gd">-        this.render();</span>
        <span class="gd">-    }</span>
        <span class="gd">-    Event.stop(event);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  onClick: function(event) {</span>
        <span class="gd">-    var element = Event.findElement(event, &#39;LI&#39;);</span>
        <span class="gd">-    this.index = element.autocompleteIndex;</span>
        <span class="gd">-    this.selectEntry();</span>
        <span class="gd">-    this.hide();</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  onBlur: function(event) {</span>
        <span class="gd">-    // needed to make click events working</span>
        <span class="gd">-    setTimeout(this.hide.bind(this), 250);</span>
        <span class="gd">-    this.hasFocus = false;</span>
        <span class="gd">-    this.active = false;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  render: function() {</span>
        <span class="gd">-    if(this.entryCount &gt; 0) {</span>
        <span class="gd">-      for (var i = 0; i &lt; this.entryCount; i++)</span>
        <span class="gd">-        this.index==i ?</span>
        <span class="gd">-          Element.addClassName(this.getEntry(i),&quot;selected&quot;) :</span>
        <span class="gd">-          Element.removeClassName(this.getEntry(i),&quot;selected&quot;);</span>
        <span class="gd">-      if(this.hasFocus) {</span>
        <span class="gd">-        this.show();</span>
        <span class="gd">-        this.active = true;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    } else {</span>
        <span class="gd">-      this.active = false;</span>
        <span class="gd">-      this.hide();</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  markPrevious: function() {</span>
        <span class="gd">-    if(this.index &gt; 0) this.index--;</span>
        <span class="gd">-      else this.index = this.entryCount-1;</span>
        <span class="gd">-    this.getEntry(this.index).scrollIntoView(true);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  markNext: function() {</span>
        <span class="gd">-    if(this.index &lt; this.entryCount-1) this.index++;</span>
        <span class="gd">-      else this.index = 0;</span>
        <span class="gd">-    this.getEntry(this.index).scrollIntoView(false);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  getEntry: function(index) {</span>
        <span class="gd">-    return this.update.firstChild.childNodes[index];</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  getCurrentEntry: function() {</span>
        <span class="gd">-    return this.getEntry(this.index);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  selectEntry: function() {</span>
        <span class="gd">-    this.active = false;</span>
        <span class="gd">-    this.updateElement(this.getCurrentEntry());</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  updateElement: function(selectedElement) {</span>
        <span class="gd">-    if (this.options.updateElement) {</span>
        <span class="gd">-      this.options.updateElement(selectedElement);</span>
        <span class="gd">-      return;</span>
        <span class="gd">-    }</span>
        <span class="gd">-    var value = &#39;&#39;;</span>
        <span class="gd">-    if (this.options.select) {</span>
        <span class="gd">-      var nodes = $(selectedElement).select(&#39;.&#39; + this.options.select) || [];</span>
        <span class="gd">-      if(nodes.length&gt;0) value = Element.collectTextNodes(nodes[0], this.options.select);</span>
        <span class="gd">-    } else</span>
        <span class="gd">-      value = Element.collectTextNodesIgnoreClass(selectedElement, &#39;informal&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-    var bounds = this.getTokenBounds();</span>
        <span class="gd">-    if (bounds[0] != -1) {</span>
        <span class="gd">-      var newValue = this.element.value.substr(0, bounds[0]);</span>
        <span class="gd">-      var whitespace = this.element.value.substr(bounds[0]).match(/^\s+/);</span>
        <span class="gd">-      if (whitespace)</span>
        <span class="gd">-        newValue += whitespace[0];</span>
        <span class="gd">-      this.element.value = newValue + value + this.element.value.substr(bounds[1]);</span>
        <span class="gd">-    } else {</span>
        <span class="gd">-      this.element.value = value;</span>
        <span class="gd">-    }</span>
        <span class="gd">-    this.oldElementValue = this.element.value;</span>
        <span class="gd">-    this.element.focus();</span>
        <span class="gd">-</span>
        <span class="gd">-    if (this.options.afterUpdateElement)</span>
        <span class="gd">-      this.options.afterUpdateElement(this.element, selectedElement);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  updateChoices: function(choices) {</span>
        <span class="gd">-    if(!this.changed &amp;&amp; this.hasFocus) {</span>
        <span class="gd">-      this.update.innerHTML = choices;</span>
        <span class="gd">-      Element.cleanWhitespace(this.update);</span>
        <span class="gd">-      Element.cleanWhitespace(this.update.down());</span>
        <span class="gd">-</span>
        <span class="gd">-      if(this.update.firstChild &amp;&amp; this.update.down().childNodes) {</span>
        <span class="gd">-        this.entryCount =</span>
        <span class="gd">-          this.update.down().childNodes.length;</span>
        <span class="gd">-        for (var i = 0; i &lt; this.entryCount; i++) {</span>
        <span class="gd">-          var entry = this.getEntry(i);</span>
        <span class="gd">-          entry.autocompleteIndex = i;</span>
        <span class="gd">-          this.addObservers(entry);</span>
        <span class="gd">-        }</span>
        <span class="gd">-      } else {</span>
        <span class="gd">-        this.entryCount = 0;</span>
        <span class="gd">-      }</span>
        <span class="gd">-</span>
        <span class="gd">-      this.stopIndicator();</span>
        <span class="gd">-      this.index = 0;</span>
        <span class="gd">-</span>
        <span class="gd">-      if(this.entryCount==1 &amp;&amp; this.options.autoSelect) {</span>
        <span class="gd">-        this.selectEntry();</span>
        <span class="gd">-        this.hide();</span>
        <span class="gd">-      } else {</span>
        <span class="gd">-        this.render();</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  addObservers: function(element) {</span>
        <span class="gd">-    Event.observe(element, &quot;mouseover&quot;, this.onHover.bindAsEventListener(this));</span>
        <span class="gd">-    Event.observe(element, &quot;click&quot;, this.onClick.bindAsEventListener(this));</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  onObserverEvent: function() {</span>
        <span class="gd">-    this.changed = false;</span>
        <span class="gd">-    this.tokenBounds = null;</span>
        <span class="gd">-    if(this.getToken().length&gt;=this.options.minChars) {</span>
        <span class="gd">-      this.getUpdatedChoices();</span>
        <span class="gd">-    } else {</span>
        <span class="gd">-      this.active = false;</span>
        <span class="gd">-      this.hide();</span>
        <span class="gd">-    }</span>
        <span class="gd">-    this.oldElementValue = this.element.value;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  getToken: function() {</span>
        <span class="gd">-    var bounds = this.getTokenBounds();</span>
        <span class="gd">-    return this.element.value.substring(bounds[0], bounds[1]).strip();</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  getTokenBounds: function() {</span>
        <span class="gd">-    if (null != this.tokenBounds) return this.tokenBounds;</span>
        <span class="gd">-    var value = this.element.value;</span>
        <span class="gd">-    if (value.strip().empty()) return [-1, 0];</span>
        <span class="gd">-    var diff = arguments.callee.getFirstDifferencePos(value, this.oldElementValue);</span>
        <span class="gd">-    var offset = (diff == this.oldElementValue.length ? 1 : 0);</span>
        <span class="gd">-    var prevTokenPos = -1, nextTokenPos = value.length;</span>
        <span class="gd">-    var tp;</span>
        <span class="gd">-    for (var index = 0, l = this.options.tokens.length; index &lt; l; ++index) {</span>
        <span class="gd">-      tp = value.lastIndexOf(this.options.tokens[index], diff + offset - 1);</span>
        <span class="gd">-      if (tp &gt; prevTokenPos) prevTokenPos = tp;</span>
        <span class="gd">-      tp = value.indexOf(this.options.tokens[index], diff + offset);</span>
        <span class="gd">-      if (-1 != tp &amp;&amp; tp &lt; nextTokenPos) nextTokenPos = tp;</span>
        <span class="gd">-    }</span>
        <span class="gd">-    return (this.tokenBounds = [prevTokenPos + 1, nextTokenPos]);</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-Autocompleter.Base.prototype.getTokenBounds.getFirstDifferencePos = function(newS, oldS) {</span>
        <span class="gd">-  var boundary = Math.min(newS.length, oldS.length);</span>
        <span class="gd">-  for (var index = 0; index &lt; boundary; ++index)</span>
        <span class="gd">-    if (newS[index] != oldS[index])</span>
        <span class="gd">-      return index;</span>
        <span class="gd">-  return boundary;</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Ajax.Autocompleter = Class.create(Autocompleter.Base, {</span>
        <span class="gd">-  initialize: function(element, update, url, options) {</span>
        <span class="gd">-    this.baseInitialize(element, update, options);</span>
        <span class="gd">-    this.options.asynchronous  = true;</span>
        <span class="gd">-    this.options.onComplete    = this.onComplete.bind(this);</span>
        <span class="gd">-    this.options.defaultParams = this.options.parameters || null;</span>
        <span class="gd">-    this.url                   = url;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  getUpdatedChoices: function() {</span>
        <span class="gd">-    this.startIndicator();</span>
        <span class="gd">-</span>
        <span class="gd">-    var entry = encodeURIComponent(this.options.paramName) + &#39;=&#39; +</span>
        <span class="gd">-      encodeURIComponent(this.getToken());</span>
        <span class="gd">-</span>
        <span class="gd">-    this.options.parameters = this.options.callback ?</span>
        <span class="gd">-      this.options.callback(this.element, entry) : entry;</span>
        <span class="gd">-</span>
        <span class="gd">-    if(this.options.defaultParams)</span>
        <span class="gd">-      this.options.parameters += &#39;&amp;&#39; + this.options.defaultParams;</span>
        <span class="gd">-</span>
        <span class="gd">-    new Ajax.Request(this.url, this.options);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  onComplete: function(request) {</span>
        <span class="gd">-    this.updateChoices(request.responseText);</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-// The local array autocompleter. Used when you&#39;d prefer to</span>
        <span class="gd">-// inject an array of autocompletion options into the page, rather</span>
        <span class="gd">-// than sending out Ajax queries, which can be quite slow sometimes.</span>
        <span class="gd">-//</span>
        <span class="gd">-// The constructor takes four parameters. The first two are, as usual,</span>
        <span class="gd">-// the id of the monitored textbox, and id of the autocompletion menu.</span>
        <span class="gd">-// The third is the array you want to autocomplete from, and the fourth</span>
        <span class="gd">-// is the options block.</span>
        <span class="gd">-//</span>
        <span class="gd">-// Extra local autocompletion options:</span>
        <span class="gd">-// - choices - How many autocompletion choices to offer</span>
        <span class="gd">-//</span>
        <span class="gd">-// - partialSearch - If false, the autocompleter will match entered</span>
        <span class="gd">-//                    text only at the beginning of strings in the</span>
        <span class="gd">-//                    autocomplete array. Defaults to true, which will</span>
        <span class="gd">-//                    match text at the beginning of any *word* in the</span>
        <span class="gd">-//                    strings in the autocomplete array. If you want to</span>
        <span class="gd">-//                    search anywhere in the string, additionally set</span>
        <span class="gd">-//                    the option fullSearch to true (default: off).</span>
        <span class="gd">-//</span>
        <span class="gd">-// - fullSsearch - Search anywhere in autocomplete array strings.</span>
        <span class="gd">-//</span>
        <span class="gd">-// - partialChars - How many characters to enter before triggering</span>
        <span class="gd">-//                   a partial match (unlike minChars, which defines</span>
        <span class="gd">-//                   how many characters are required to do any match</span>
        <span class="gd">-//                   at all). Defaults to 2.</span>
        <span class="gd">-//</span>
        <span class="gd">-// - ignoreCase - Whether to ignore case when autocompleting.</span>
        <span class="gd">-//                 Defaults to true.</span>
        <span class="gd">-//</span>
        <span class="gd">-// It&#39;s possible to pass in a custom function as the &#39;selector&#39;</span>
        <span class="gd">-// option, if you prefer to write your own autocompletion logic.</span>
        <span class="gd">-// In that case, the other options above will not apply unless</span>
        <span class="gd">-// you support them.</span>
        <span class="gd">-</span>
        <span class="gd">-Autocompleter.Local = Class.create(Autocompleter.Base, {</span>
        <span class="gd">-  initialize: function(element, update, array, options) {</span>
        <span class="gd">-    this.baseInitialize(element, update, options);</span>
        <span class="gd">-    this.options.array = array;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  getUpdatedChoices: function() {</span>
        <span class="gd">-    this.updateChoices(this.options.selector(this));</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  setOptions: function(options) {</span>
        <span class="gd">-    this.options = Object.extend({</span>
        <span class="gd">-      choices: 10,</span>
        <span class="gd">-      partialSearch: true,</span>
        <span class="gd">-      partialChars: 2,</span>
        <span class="gd">-      ignoreCase: true,</span>
        <span class="gd">-      fullSearch: false,</span>
        <span class="gd">-      selector: function(instance) {</span>
        <span class="gd">-        var ret       = []; // Beginning matches</span>
        <span class="gd">-        var partial   = []; // Inside matches</span>
        <span class="gd">-        var entry     = instance.getToken();</span>
        <span class="gd">-        var count     = 0;</span>
        <span class="gd">-</span>
        <span class="gd">-        for (var i = 0; i &lt; instance.options.array.length &amp;&amp;</span>
        <span class="gd">-          ret.length &lt; instance.options.choices ; i++) {</span>
        <span class="gd">-</span>
        <span class="gd">-          var elem = instance.options.array[i];</span>
        <span class="gd">-          var foundPos = instance.options.ignoreCase ?</span>
        <span class="gd">-            elem.toLowerCase().indexOf(entry.toLowerCase()) :</span>
        <span class="gd">-            elem.indexOf(entry);</span>
        <span class="gd">-</span>
        <span class="gd">-          while (foundPos != -1) {</span>
        <span class="gd">-            if (foundPos == 0 &amp;&amp; elem.length != entry.length) {</span>
        <span class="gd">-              ret.push(&quot;&lt;li&gt;&lt;strong&gt;&quot; + elem.substr(0, entry.length) + &quot;&lt;/strong&gt;&quot; +</span>
        <span class="gd">-                elem.substr(entry.length) + &quot;&lt;/li&gt;&quot;);</span>
        <span class="gd">-              break;</span>
        <span class="gd">-            } else if (entry.length &gt;= instance.options.partialChars &amp;&amp;</span>
        <span class="gd">-              instance.options.partialSearch &amp;&amp; foundPos != -1) {</span>
        <span class="gd">-              if (instance.options.fullSearch || /\s/.test(elem.substr(foundPos-1,1))) {</span>
        <span class="gd">-                partial.push(&quot;&lt;li&gt;&quot; + elem.substr(0, foundPos) + &quot;&lt;strong&gt;&quot; +</span>
        <span class="gd">-                  elem.substr(foundPos, entry.length) + &quot;&lt;/strong&gt;&quot; + elem.substr(</span>
        <span class="gd">-                  foundPos + entry.length) + &quot;&lt;/li&gt;&quot;);</span>
        <span class="gd">-                break;</span>
        <span class="gd">-              }</span>
        <span class="gd">-            }</span>
        <span class="gd">-</span>
        <span class="gd">-            foundPos = instance.options.ignoreCase ?</span>
        <span class="gd">-              elem.toLowerCase().indexOf(entry.toLowerCase(), foundPos + 1) :</span>
        <span class="gd">-              elem.indexOf(entry, foundPos + 1);</span>
        <span class="gd">-</span>
        <span class="gd">-          }</span>
        <span class="gd">-        }</span>
        <span class="gd">-        if (partial.length)</span>
        <span class="gd">-          ret = ret.concat(partial.slice(0, instance.options.choices - ret.length));</span>
        <span class="gd">-        return &quot;&lt;ul&gt;&quot; + ret.join(&#39;&#39;) + &quot;&lt;/ul&gt;&quot;;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }, options || { });</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-// AJAX in-place editor and collection editor</span>
        <span class="gd">-// Full rewrite by Christophe Porteneuve &lt;tdd@tddsworld.com&gt; (April 2007).</span>
        <span class="gd">-</span>
        <span class="gd">-// Use this if you notice weird scrolling problems on some browsers,</span>
        <span class="gd">-// the DOM might be a bit confused when this gets called so do this</span>
        <span class="gd">-// waits 1 ms (with setTimeout) until it does the activation</span>
        <span class="gd">-Field.scrollFreeActivate = function(field) {</span>
        <span class="gd">-  setTimeout(function() {</span>
        <span class="gd">-    Field.activate(field);</span>
        <span class="gd">-  }, 1);</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Ajax.InPlaceEditor = Class.create({</span>
        <span class="gd">-  initialize: function(element, url, options) {</span>
        <span class="gd">-    this.url = url;</span>
        <span class="gd">-    this.element = element = $(element);</span>
        <span class="gd">-    this.prepareOptions();</span>
        <span class="gd">-    this._controls = { };</span>
        <span class="gd">-    arguments.callee.dealWithDeprecatedOptions(options); // DEPRECATION LAYER!!!</span>
        <span class="gd">-    Object.extend(this.options, options || { });</span>
        <span class="gd">-    if (!this.options.formId &amp;&amp; this.element.id) {</span>
        <span class="gd">-      this.options.formId = this.element.id + &#39;-inplaceeditor&#39;;</span>
        <span class="gd">-      if ($(this.options.formId))</span>
        <span class="gd">-        this.options.formId = &#39;&#39;;</span>
        <span class="gd">-    }</span>
        <span class="gd">-    if (this.options.externalControl)</span>
        <span class="gd">-      this.options.externalControl = $(this.options.externalControl);</span>
        <span class="gd">-    if (!this.options.externalControl)</span>
        <span class="gd">-      this.options.externalControlOnly = false;</span>
        <span class="gd">-    this._originalBackground = this.element.getStyle(&#39;background-color&#39;) || &#39;transparent&#39;;</span>
        <span class="gd">-    this.element.title = this.options.clickToEditText;</span>
        <span class="gd">-    this._boundCancelHandler = this.handleFormCancellation.bind(this);</span>
        <span class="gd">-    this._boundComplete = (this.options.onComplete || Prototype.emptyFunction).bind(this);</span>
        <span class="gd">-    this._boundFailureHandler = this.handleAJAXFailure.bind(this);</span>
        <span class="gd">-    this._boundSubmitHandler = this.handleFormSubmission.bind(this);</span>
        <span class="gd">-    this._boundWrapperHandler = this.wrapUp.bind(this);</span>
        <span class="gd">-    this.registerListeners();</span>
        <span class="gd">-  },</span>
        <span class="gd">-  checkForEscapeOrReturn: function(e) {</span>
        <span class="gd">-    if (!this._editing || e.ctrlKey || e.altKey || e.shiftKey) return;</span>
        <span class="gd">-    if (Event.KEY_ESC == e.keyCode)</span>
        <span class="gd">-      this.handleFormCancellation(e);</span>
        <span class="gd">-    else if (Event.KEY_RETURN == e.keyCode)</span>
        <span class="gd">-      this.handleFormSubmission(e);</span>
        <span class="gd">-  },</span>
        <span class="gd">-  createControl: function(mode, handler, extraClasses) {</span>
        <span class="gd">-    var control = this.options[mode + &#39;Control&#39;];</span>
        <span class="gd">-    var text = this.options[mode + &#39;Text&#39;];</span>
        <span class="gd">-    if (&#39;button&#39; == control) {</span>
        <span class="gd">-      var btn = document.createElement(&#39;input&#39;);</span>
        <span class="gd">-      btn.type = &#39;submit&#39;;</span>
        <span class="gd">-      btn.value = text;</span>
        <span class="gd">-      btn.className = &#39;editor_&#39; + mode + &#39;_button&#39;;</span>
        <span class="gd">-      if (&#39;cancel&#39; == mode)</span>
        <span class="gd">-        btn.onclick = this._boundCancelHandler;</span>
        <span class="gd">-      this._form.appendChild(btn);</span>
        <span class="gd">-      this._controls[mode] = btn;</span>
        <span class="gd">-    } else if (&#39;link&#39; == control) {</span>
        <span class="gd">-      var link = document.createElement(&#39;a&#39;);</span>
        <span class="gd">-      link.href = &#39;#&#39;;</span>
        <span class="gd">-      link.appendChild(document.createTextNode(text));</span>
        <span class="gd">-      link.onclick = &#39;cancel&#39; == mode ? this._boundCancelHandler : this._boundSubmitHandler;</span>
        <span class="gd">-      link.className = &#39;editor_&#39; + mode + &#39;_link&#39;;</span>
        <span class="gd">-      if (extraClasses)</span>
        <span class="gd">-        link.className += &#39; &#39; + extraClasses;</span>
        <span class="gd">-      this._form.appendChild(link);</span>
        <span class="gd">-      this._controls[mode] = link;</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gd">-  createEditField: function() {</span>
        <span class="gd">-    var text = (this.options.loadTextURL ? this.options.loadingText : this.getText());</span>
        <span class="gd">-    var fld;</span>
        <span class="gd">-    if (1 &gt;= this.options.rows &amp;&amp; !/\r|\n/.test(this.getText())) {</span>
        <span class="gd">-      fld = document.createElement(&#39;input&#39;);</span>
        <span class="gd">-      fld.type = &#39;text&#39;;</span>
        <span class="gd">-      var size = this.options.size || this.options.cols || 0;</span>
        <span class="gd">-      if (0 &lt; size) fld.size = size;</span>
        <span class="gd">-    } else {</span>
        <span class="gd">-      fld = document.createElement(&#39;textarea&#39;);</span>
        <span class="gd">-      fld.rows = (1 &gt;= this.options.rows ? this.options.autoRows : this.options.rows);</span>
        <span class="gd">-      fld.cols = this.options.cols || 40;</span>
        <span class="gd">-    }</span>
        <span class="gd">-    fld.name = this.options.paramName;</span>
        <span class="gd">-    fld.value = text; // No HTML breaks conversion anymore</span>
        <span class="gd">-    fld.className = &#39;editor_field&#39;;</span>
        <span class="gd">-    if (this.options.submitOnBlur)</span>
        <span class="gd">-      fld.onblur = this._boundSubmitHandler;</span>
        <span class="gd">-    this._controls.editor = fld;</span>
        <span class="gd">-    if (this.options.loadTextURL)</span>
        <span class="gd">-      this.loadExternalText();</span>
        <span class="gd">-    this._form.appendChild(this._controls.editor);</span>
        <span class="gd">-  },</span>
        <span class="gd">-  createForm: function() {</span>
        <span class="gd">-    var ipe = this;</span>
        <span class="gd">-    function addText(mode, condition) {</span>
        <span class="gd">-      var text = ipe.options[&#39;text&#39; + mode + &#39;Controls&#39;];</span>
        <span class="gd">-      if (!text || condition === false) return;</span>
        <span class="gd">-      ipe._form.appendChild(document.createTextNode(text));</span>
        <span class="gd">-    };</span>
        <span class="gd">-    this._form = $(document.createElement(&#39;form&#39;));</span>
        <span class="gd">-    this._form.id = this.options.formId;</span>
        <span class="gd">-    this._form.addClassName(this.options.formClassName);</span>
        <span class="gd">-    this._form.onsubmit = this._boundSubmitHandler;</span>
        <span class="gd">-    this.createEditField();</span>
        <span class="gd">-    if (&#39;textarea&#39; == this._controls.editor.tagName.toLowerCase())</span>
        <span class="gd">-      this._form.appendChild(document.createElement(&#39;br&#39;));</span>
        <span class="gd">-    if (this.options.onFormCustomization)</span>
        <span class="gd">-      this.options.onFormCustomization(this, this._form);</span>
        <span class="gd">-    addText(&#39;Before&#39;, this.options.okControl || this.options.cancelControl);</span>
        <span class="gd">-    this.createControl(&#39;ok&#39;, this._boundSubmitHandler);</span>
        <span class="gd">-    addText(&#39;Between&#39;, this.options.okControl &amp;&amp; this.options.cancelControl);</span>
        <span class="gd">-    this.createControl(&#39;cancel&#39;, this._boundCancelHandler, &#39;editor_cancel&#39;);</span>
        <span class="gd">-    addText(&#39;After&#39;, this.options.okControl || this.options.cancelControl);</span>
        <span class="gd">-  },</span>
        <span class="gd">-  destroy: function() {</span>
        <span class="gd">-    if (this._oldInnerHTML)</span>
        <span class="gd">-      this.element.innerHTML = this._oldInnerHTML;</span>
        <span class="gd">-    this.leaveEditMode();</span>
        <span class="gd">-    this.unregisterListeners();</span>
        <span class="gd">-  },</span>
        <span class="gd">-  enterEditMode: function(e) {</span>
        <span class="gd">-    if (this._saving || this._editing) return;</span>
        <span class="gd">-    this._editing = true;</span>
        <span class="gd">-    this.triggerCallback(&#39;onEnterEditMode&#39;);</span>
        <span class="gd">-    if (this.options.externalControl)</span>
        <span class="gd">-      this.options.externalControl.hide();</span>
        <span class="gd">-    this.element.hide();</span>
        <span class="gd">-    this.createForm();</span>
        <span class="gd">-    this.element.parentNode.insertBefore(this._form, this.element);</span>
        <span class="gd">-    if (!this.options.loadTextURL)</span>
        <span class="gd">-      this.postProcessEditField();</span>
        <span class="gd">-    if (e) Event.stop(e);</span>
        <span class="gd">-  },</span>
        <span class="gd">-  enterHover: function(e) {</span>
        <span class="gd">-    if (this.options.hoverClassName)</span>
        <span class="gd">-      this.element.addClassName(this.options.hoverClassName);</span>
        <span class="gd">-    if (this._saving) return;</span>
        <span class="gd">-    this.triggerCallback(&#39;onEnterHover&#39;);</span>
        <span class="gd">-  },</span>
        <span class="gd">-  getText: function() {</span>
        <span class="gd">-    return this.element.innerHTML.unescapeHTML();</span>
        <span class="gd">-  },</span>
        <span class="gd">-  handleAJAXFailure: function(transport) {</span>
        <span class="gd">-    this.triggerCallback(&#39;onFailure&#39;, transport);</span>
        <span class="gd">-    if (this._oldInnerHTML) {</span>
        <span class="gd">-      this.element.innerHTML = this._oldInnerHTML;</span>
        <span class="gd">-      this._oldInnerHTML = null;</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gd">-  handleFormCancellation: function(e) {</span>
        <span class="gd">-    this.wrapUp();</span>
        <span class="gd">-    if (e) Event.stop(e);</span>
        <span class="gd">-  },</span>
        <span class="gd">-  handleFormSubmission: function(e) {</span>
        <span class="gd">-    var form = this._form;</span>
        <span class="gd">-    var value = $F(this._controls.editor);</span>
        <span class="gd">-    this.prepareSubmission();</span>
        <span class="gd">-    var params = this.options.callback(form, value) || &#39;&#39;;</span>
        <span class="gd">-    if (Object.isString(params))</span>
        <span class="gd">-      params = params.toQueryParams();</span>
        <span class="gd">-    params.editorId = this.element.id;</span>
        <span class="gd">-    if (this.options.htmlResponse) {</span>
        <span class="gd">-      var options = Object.extend({ evalScripts: true }, this.options.ajaxOptions);</span>
        <span class="gd">-      Object.extend(options, {</span>
        <span class="gd">-        parameters: params,</span>
        <span class="gd">-        onComplete: this._boundWrapperHandler,</span>
        <span class="gd">-        onFailure: this._boundFailureHandler</span>
        <span class="gd">-      });</span>
        <span class="gd">-      new Ajax.Updater({ success: this.element }, this.url, options);</span>
        <span class="gd">-    } else {</span>
        <span class="gd">-      var options = Object.extend({ method: &#39;get&#39; }, this.options.ajaxOptions);</span>
        <span class="gd">-      Object.extend(options, {</span>
        <span class="gd">-        parameters: params,</span>
        <span class="gd">-        onComplete: this._boundWrapperHandler,</span>
        <span class="gd">-        onFailure: this._boundFailureHandler</span>
        <span class="gd">-      });</span>
        <span class="gd">-      new Ajax.Request(this.url, options);</span>
        <span class="gd">-    }</span>
        <span class="gd">-    if (e) Event.stop(e);</span>
        <span class="gd">-  },</span>
        <span class="gd">-  leaveEditMode: function() {</span>
        <span class="gd">-    this.element.removeClassName(this.options.savingClassName);</span>
        <span class="gd">-    this.removeForm();</span>
        <span class="gd">-    this.leaveHover();</span>
        <span class="gd">-    this.element.style.backgroundColor = this._originalBackground;</span>
        <span class="gd">-    this.element.show();</span>
        <span class="gd">-    if (this.options.externalControl)</span>
        <span class="gd">-      this.options.externalControl.show();</span>
        <span class="gd">-    this._saving = false;</span>
        <span class="gd">-    this._editing = false;</span>
        <span class="gd">-    this._oldInnerHTML = null;</span>
        <span class="gd">-    this.triggerCallback(&#39;onLeaveEditMode&#39;);</span>
        <span class="gd">-  },</span>
        <span class="gd">-  leaveHover: function(e) {</span>
        <span class="gd">-    if (this.options.hoverClassName)</span>
        <span class="gd">-      this.element.removeClassName(this.options.hoverClassName);</span>
        <span class="gd">-    if (this._saving) return;</span>
        <span class="gd">-    this.triggerCallback(&#39;onLeaveHover&#39;);</span>
        <span class="gd">-  },</span>
        <span class="gd">-  loadExternalText: function() {</span>
        <span class="gd">-    this._form.addClassName(this.options.loadingClassName);</span>
        <span class="gd">-    this._controls.editor.disabled = true;</span>
        <span class="gd">-    var options = Object.extend({ method: &#39;get&#39; }, this.options.ajaxOptions);</span>
        <span class="gd">-    Object.extend(options, {</span>
        <span class="gd">-      parameters: &#39;editorId=&#39; + encodeURIComponent(this.element.id),</span>
        <span class="gd">-      onComplete: Prototype.emptyFunction,</span>
        <span class="gd">-      onSuccess: function(transport) {</span>
        <span class="gd">-        this._form.removeClassName(this.options.loadingClassName);</span>
        <span class="gd">-        var text = transport.responseText;</span>
        <span class="gd">-        if (this.options.stripLoadedTextTags)</span>
        <span class="gd">-          text = text.stripTags();</span>
        <span class="gd">-        this._controls.editor.value = text;</span>
        <span class="gd">-        this._controls.editor.disabled = false;</span>
        <span class="gd">-        this.postProcessEditField();</span>
        <span class="gd">-      }.bind(this),</span>
        <span class="gd">-      onFailure: this._boundFailureHandler</span>
        <span class="gd">-    });</span>
        <span class="gd">-    new Ajax.Request(this.options.loadTextURL, options);</span>
        <span class="gd">-  },</span>
        <span class="gd">-  postProcessEditField: function() {</span>
        <span class="gd">-    var fpc = this.options.fieldPostCreation;</span>
        <span class="gd">-    if (fpc)</span>
        <span class="gd">-      $(this._controls.editor)[&#39;focus&#39; == fpc ? &#39;focus&#39; : &#39;activate&#39;]();</span>
        <span class="gd">-  },</span>
        <span class="gd">-  prepareOptions: function() {</span>
        <span class="gd">-    this.options = Object.clone(Ajax.InPlaceEditor.DefaultOptions);</span>
        <span class="gd">-    Object.extend(this.options, Ajax.InPlaceEditor.DefaultCallbacks);</span>
        <span class="gd">-    [this._extraDefaultOptions].flatten().compact().each(function(defs) {</span>
        <span class="gd">-      Object.extend(this.options, defs);</span>
        <span class="gd">-    }.bind(this));</span>
        <span class="gd">-  },</span>
        <span class="gd">-  prepareSubmission: function() {</span>
        <span class="gd">-    this._saving = true;</span>
        <span class="gd">-    this.removeForm();</span>
        <span class="gd">-    this.leaveHover();</span>
        <span class="gd">-    this.showSaving();</span>
        <span class="gd">-  },</span>
        <span class="gd">-  registerListeners: function() {</span>
        <span class="gd">-    this._listeners = { };</span>
        <span class="gd">-    var listener;</span>
        <span class="gd">-    $H(Ajax.InPlaceEditor.Listeners).each(function(pair) {</span>
        <span class="gd">-      listener = this[pair.value].bind(this);</span>
        <span class="gd">-      this._listeners[pair.key] = listener;</span>
        <span class="gd">-      if (!this.options.externalControlOnly)</span>
        <span class="gd">-        this.element.observe(pair.key, listener);</span>
        <span class="gd">-      if (this.options.externalControl)</span>
        <span class="gd">-        this.options.externalControl.observe(pair.key, listener);</span>
        <span class="gd">-    }.bind(this));</span>
        <span class="gd">-  },</span>
        <span class="gd">-  removeForm: function() {</span>
        <span class="gd">-    if (!this._form) return;</span>
        <span class="gd">-    this._form.remove();</span>
        <span class="gd">-    this._form = null;</span>
        <span class="gd">-    this._controls = { };</span>
        <span class="gd">-  },</span>
        <span class="gd">-  showSaving: function() {</span>
        <span class="gd">-    this._oldInnerHTML = this.element.innerHTML;</span>
        <span class="gd">-    this.element.innerHTML = this.options.savingText;</span>
        <span class="gd">-    this.element.addClassName(this.options.savingClassName);</span>
        <span class="gd">-    this.element.style.backgroundColor = this._originalBackground;</span>
        <span class="gd">-    this.element.show();</span>
        <span class="gd">-  },</span>
        <span class="gd">-  triggerCallback: function(cbName, arg) {</span>
        <span class="gd">-    if (&#39;function&#39; == typeof this.options[cbName]) {</span>
        <span class="gd">-      this.options[cbName](this, arg);</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gd">-  unregisterListeners: function() {</span>
        <span class="gd">-    $H(this._listeners).each(function(pair) {</span>
        <span class="gd">-      if (!this.options.externalControlOnly)</span>
        <span class="gd">-        this.element.stopObserving(pair.key, pair.value);</span>
        <span class="gd">-      if (this.options.externalControl)</span>
        <span class="gd">-        this.options.externalControl.stopObserving(pair.key, pair.value);</span>
        <span class="gd">-    }.bind(this));</span>
        <span class="gd">-  },</span>
        <span class="gd">-  wrapUp: function(transport) {</span>
        <span class="gd">-    this.leaveEditMode();</span>
        <span class="gd">-    // Can&#39;t use triggerCallback due to backward compatibility: requires</span>
        <span class="gd">-    // binding + direct element</span>
        <span class="gd">-    this._boundComplete(transport, this.element);</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-Object.extend(Ajax.InPlaceEditor.prototype, {</span>
        <span class="gd">-  dispose: Ajax.InPlaceEditor.prototype.destroy</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-Ajax.InPlaceCollectionEditor = Class.create(Ajax.InPlaceEditor, {</span>
        <span class="gd">-  initialize: function($super, element, url, options) {</span>
        <span class="gd">-    this._extraDefaultOptions = Ajax.InPlaceCollectionEditor.DefaultOptions;</span>
        <span class="gd">-    $super(element, url, options);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  createEditField: function() {</span>
        <span class="gd">-    var list = document.createElement(&#39;select&#39;);</span>
        <span class="gd">-    list.name = this.options.paramName;</span>
        <span class="gd">-    list.size = 1;</span>
        <span class="gd">-    this._controls.editor = list;</span>
        <span class="gd">-    this._collection = this.options.collection || [];</span>
        <span class="gd">-    if (this.options.loadCollectionURL)</span>
        <span class="gd">-      this.loadCollection();</span>
        <span class="gd">-    else</span>
        <span class="gd">-      this.checkForExternalText();</span>
        <span class="gd">-    this._form.appendChild(this._controls.editor);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  loadCollection: function() {</span>
        <span class="gd">-    this._form.addClassName(this.options.loadingClassName);</span>
        <span class="gd">-    this.showLoadingText(this.options.loadingCollectionText);</span>
        <span class="gd">-    var options = Object.extend({ method: &#39;get&#39; }, this.options.ajaxOptions);</span>
        <span class="gd">-    Object.extend(options, {</span>
        <span class="gd">-      parameters: &#39;editorId=&#39; + encodeURIComponent(this.element.id),</span>
        <span class="gd">-      onComplete: Prototype.emptyFunction,</span>
        <span class="gd">-      onSuccess: function(transport) {</span>
        <span class="gd">-        var js = transport.responseText.strip();</span>
        <span class="gd">-        if (!/^\[.*\]$/.test(js)) // TODO: improve sanity check</span>
        <span class="gd">-          throw(&#39;Server returned an invalid collection representation.&#39;);</span>
        <span class="gd">-        this._collection = eval(js);</span>
        <span class="gd">-        this.checkForExternalText();</span>
        <span class="gd">-      }.bind(this),</span>
        <span class="gd">-      onFailure: this.onFailure</span>
        <span class="gd">-    });</span>
        <span class="gd">-    new Ajax.Request(this.options.loadCollectionURL, options);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  showLoadingText: function(text) {</span>
        <span class="gd">-    this._controls.editor.disabled = true;</span>
        <span class="gd">-    var tempOption = this._controls.editor.firstChild;</span>
        <span class="gd">-    if (!tempOption) {</span>
        <span class="gd">-      tempOption = document.createElement(&#39;option&#39;);</span>
        <span class="gd">-      tempOption.value = &#39;&#39;;</span>
        <span class="gd">-      this._controls.editor.appendChild(tempOption);</span>
        <span class="gd">-      tempOption.selected = true;</span>
        <span class="gd">-    }</span>
        <span class="gd">-    tempOption.update((text || &#39;&#39;).stripScripts().stripTags());</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  checkForExternalText: function() {</span>
        <span class="gd">-    this._text = this.getText();</span>
        <span class="gd">-    if (this.options.loadTextURL)</span>
        <span class="gd">-      this.loadExternalText();</span>
        <span class="gd">-    else</span>
        <span class="gd">-      this.buildOptionList();</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  loadExternalText: function() {</span>
        <span class="gd">-    this.showLoadingText(this.options.loadingText);</span>
        <span class="gd">-    var options = Object.extend({ method: &#39;get&#39; }, this.options.ajaxOptions);</span>
        <span class="gd">-    Object.extend(options, {</span>
        <span class="gd">-      parameters: &#39;editorId=&#39; + encodeURIComponent(this.element.id),</span>
        <span class="gd">-      onComplete: Prototype.emptyFunction,</span>
        <span class="gd">-      onSuccess: function(transport) {</span>
        <span class="gd">-        this._text = transport.responseText.strip();</span>
        <span class="gd">-        this.buildOptionList();</span>
        <span class="gd">-      }.bind(this),</span>
        <span class="gd">-      onFailure: this.onFailure</span>
        <span class="gd">-    });</span>
        <span class="gd">-    new Ajax.Request(this.options.loadTextURL, options);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  buildOptionList: function() {</span>
        <span class="gd">-    this._form.removeClassName(this.options.loadingClassName);</span>
        <span class="gd">-    this._collection = this._collection.map(function(entry) {</span>
        <span class="gd">-      return 2 === entry.length ? entry : [entry, entry].flatten();</span>
        <span class="gd">-    });</span>
        <span class="gd">-    var marker = (&#39;value&#39; in this.options) ? this.options.value : this._text;</span>
        <span class="gd">-    var textFound = this._collection.any(function(entry) {</span>
        <span class="gd">-      return entry[0] == marker;</span>
        <span class="gd">-    }.bind(this));</span>
        <span class="gd">-    this._controls.editor.update(&#39;&#39;);</span>
        <span class="gd">-    var option;</span>
        <span class="gd">-    this._collection.each(function(entry, index) {</span>
        <span class="gd">-      option = document.createElement(&#39;option&#39;);</span>
        <span class="gd">-      option.value = entry[0];</span>
        <span class="gd">-      option.selected = textFound ? entry[0] == marker : 0 == index;</span>
        <span class="gd">-      option.appendChild(document.createTextNode(entry[1]));</span>
        <span class="gd">-      this._controls.editor.appendChild(option);</span>
        <span class="gd">-    }.bind(this));</span>
        <span class="gd">-    this._controls.editor.disabled = false;</span>
        <span class="gd">-    Field.scrollFreeActivate(this._controls.editor);</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-//**** DEPRECATION LAYER FOR InPlace[Collection]Editor! ****</span>
        <span class="gd">-//**** This only  exists for a while,  in order to  let ****</span>
        <span class="gd">-//**** users adapt to  the new API.  Read up on the new ****</span>
        <span class="gd">-//**** API and convert your code to it ASAP!            ****</span>
        <span class="gd">-</span>
        <span class="gd">-Ajax.InPlaceEditor.prototype.initialize.dealWithDeprecatedOptions = function(options) {</span>
        <span class="gd">-  if (!options) return;</span>
        <span class="gd">-  function fallback(name, expr) {</span>
        <span class="gd">-    if (name in options || expr === undefined) return;</span>
        <span class="gd">-    options[name] = expr;</span>
        <span class="gd">-  };</span>
        <span class="gd">-  fallback(&#39;cancelControl&#39;, (options.cancelLink ? &#39;link&#39; : (options.cancelButton ? &#39;button&#39; :</span>
        <span class="gd">-    options.cancelLink == options.cancelButton == false ? false : undefined)));</span>
        <span class="gd">-  fallback(&#39;okControl&#39;, (options.okLink ? &#39;link&#39; : (options.okButton ? &#39;button&#39; :</span>
        <span class="gd">-    options.okLink == options.okButton == false ? false : undefined)));</span>
        <span class="gd">-  fallback(&#39;highlightColor&#39;, options.highlightcolor);</span>
        <span class="gd">-  fallback(&#39;highlightEndColor&#39;, options.highlightendcolor);</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Object.extend(Ajax.InPlaceEditor, {</span>
        <span class="gd">-  DefaultOptions: {</span>
        <span class="gd">-    ajaxOptions: { },</span>
        <span class="gd">-    autoRows: 3,                                // Use when multi-line w/ rows == 1</span>
        <span class="gd">-    cancelControl: &#39;link&#39;,                      // &#39;link&#39;|&#39;button&#39;|false</span>
        <span class="gd">-    cancelText: &#39;cancel&#39;,</span>
        <span class="gd">-    clickToEditText: &#39;Click to edit&#39;,</span>
        <span class="gd">-    externalControl: null,                      // id|elt</span>
        <span class="gd">-    externalControlOnly: false,</span>
        <span class="gd">-    fieldPostCreation: &#39;activate&#39;,              // &#39;activate&#39;|&#39;focus&#39;|false</span>
        <span class="gd">-    formClassName: &#39;inplaceeditor-form&#39;,</span>
        <span class="gd">-    formId: null,                               // id|elt</span>
        <span class="gd">-    highlightColor: &#39;#ffff99&#39;,</span>
        <span class="gd">-    highlightEndColor: &#39;#ffffff&#39;,</span>
        <span class="gd">-    hoverClassName: &#39;&#39;,</span>
        <span class="gd">-    htmlResponse: true,</span>
        <span class="gd">-    loadingClassName: &#39;inplaceeditor-loading&#39;,</span>
        <span class="gd">-    loadingText: &#39;Loading...&#39;,</span>
        <span class="gd">-    okControl: &#39;button&#39;,                        // &#39;link&#39;|&#39;button&#39;|false</span>
        <span class="gd">-    okText: &#39;ok&#39;,</span>
        <span class="gd">-    paramName: &#39;value&#39;,</span>
        <span class="gd">-    rows: 1,                                    // If 1 and multi-line, uses autoRows</span>
        <span class="gd">-    savingClassName: &#39;inplaceeditor-saving&#39;,</span>
        <span class="gd">-    savingText: &#39;Saving...&#39;,</span>
        <span class="gd">-    size: 0,</span>
        <span class="gd">-    stripLoadedTextTags: false,</span>
        <span class="gd">-    submitOnBlur: false,</span>
        <span class="gd">-    textAfterControls: &#39;&#39;,</span>
        <span class="gd">-    textBeforeControls: &#39;&#39;,</span>
        <span class="gd">-    textBetweenControls: &#39;&#39;</span>
        <span class="gd">-  },</span>
        <span class="gd">-  DefaultCallbacks: {</span>
        <span class="gd">-    callback: function(form) {</span>
        <span class="gd">-      return Form.serialize(form);</span>
        <span class="gd">-    },</span>
        <span class="gd">-    onComplete: function(transport, element) {</span>
        <span class="gd">-      // For backward compatibility, this one is bound to the IPE, and passes</span>
        <span class="gd">-      // the element directly.  It was too often customized, so we don&#39;t break it.</span>
        <span class="gd">-      new Effect.Highlight(element, {</span>
        <span class="gd">-        startcolor: this.options.highlightColor, keepBackgroundImage: true });</span>
        <span class="gd">-    },</span>
        <span class="gd">-    onEnterEditMode: null,</span>
        <span class="gd">-    onEnterHover: function(ipe) {</span>
        <span class="gd">-      ipe.element.style.backgroundColor = ipe.options.highlightColor;</span>
        <span class="gd">-      if (ipe._effect)</span>
        <span class="gd">-        ipe._effect.cancel();</span>
        <span class="gd">-    },</span>
        <span class="gd">-    onFailure: function(transport, ipe) {</span>
        <span class="gd">-      alert(&#39;Error communication with the server: &#39; + transport.responseText.stripTags());</span>
        <span class="gd">-    },</span>
        <span class="gd">-    onFormCustomization: null, // Takes the IPE and its generated form, after editor, before controls.</span>
        <span class="gd">-    onLeaveEditMode: null,</span>
        <span class="gd">-    onLeaveHover: function(ipe) {</span>
        <span class="gd">-      ipe._effect = new Effect.Highlight(ipe.element, {</span>
        <span class="gd">-        startcolor: ipe.options.highlightColor, endcolor: ipe.options.highlightEndColor,</span>
        <span class="gd">-        restorecolor: ipe._originalBackground, keepBackgroundImage: true</span>
        <span class="gd">-      });</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gd">-  Listeners: {</span>
        <span class="gd">-    click: &#39;enterEditMode&#39;,</span>
        <span class="gd">-    keydown: &#39;checkForEscapeOrReturn&#39;,</span>
        <span class="gd">-    mouseover: &#39;enterHover&#39;,</span>
        <span class="gd">-    mouseout: &#39;leaveHover&#39;</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-Ajax.InPlaceCollectionEditor.DefaultOptions = {</span>
        <span class="gd">-  loadingCollectionText: &#39;Loading options...&#39;</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-// Delayed observer, like Form.Element.Observer,</span>
        <span class="gd">-// but waits for delay after last key input</span>
        <span class="gd">-// Ideal for live-search fields</span>
        <span class="gd">-</span>
        <span class="gd">-Form.Element.DelayedObserver = Class.create({</span>
        <span class="gd">-  initialize: function(element, delay, callback) {</span>
        <span class="gd">-    this.delay     = delay || 0.5;</span>
        <span class="gd">-    this.element   = $(element);</span>
        <span class="gd">-    this.callback  = callback;</span>
        <span class="gd">-    this.timer     = null;</span>
        <span class="gd">-    this.lastValue = $F(this.element);</span>
        <span class="gd">-    Event.observe(this.element,&#39;keyup&#39;,this.delayedListener.bindAsEventListener(this));</span>
        <span class="gd">-  },</span>
        <span class="gd">-  delayedListener: function(event) {</span>
        <span class="gd">-    if(this.lastValue == $F(this.element)) return;</span>
        <span class="gd">-    if(this.timer) clearTimeout(this.timer);</span>
        <span class="gd">-    this.timer = setTimeout(this.onTimerEvent.bind(this), this.delay * 1000);</span>
        <span class="gd">-    this.lastValue = $F(this.element);</span>
        <span class="gd">-  },</span>
        <span class="gd">-  onTimerEvent: function() {</span>
        <span class="gd">-    this.timer = null;</span>
        <span class="gd">-    this.callback(this.element, $F(this.element));</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        \ No newline at end of file
        </pre></div>
        <h2>
          <a href='full/#public-javascripts-dragdrop-js'>public/javascripts/dragdrop.js</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -1,974 +0,0 @@</span>
        <span class="gd">-// script.aculo.us dragdrop.js v1.8.3, Thu Oct 08 11:23:33 +0200 2009</span>
        <span class="gd">-</span>
        <span class="gd">-// Copyright (c) 2005-2009 Thomas Fuchs (http://script.aculo.us, http://mir.aculo.us)</span>
        <span class="gd">-//</span>
        <span class="gd">-// script.aculo.us is freely distributable under the terms of an MIT-style license.</span>
        <span class="gd">-// For details, see the script.aculo.us web site: http://script.aculo.us/</span>
        <span class="gd">-</span>
        <span class="gd">-if(Object.isUndefined(Effect))</span>
        <span class="gd">-  throw(&quot;dragdrop.js requires including script.aculo.us&#39; effects.js library&quot;);</span>
        <span class="gd">-</span>
        <span class="gd">-var Droppables = {</span>
        <span class="gd">-  drops: [],</span>
        <span class="gd">-</span>
        <span class="gd">-  remove: function(element) {</span>
        <span class="gd">-    this.drops = this.drops.reject(function(d) { return d.element==$(element) });</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  add: function(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    var options = Object.extend({</span>
        <span class="gd">-      greedy:     true,</span>
        <span class="gd">-      hoverclass: null,</span>
        <span class="gd">-      tree:       false</span>
        <span class="gd">-    }, arguments[1] || { });</span>
        <span class="gd">-</span>
        <span class="gd">-    // cache containers</span>
        <span class="gd">-    if(options.containment) {</span>
        <span class="gd">-      options._containers = [];</span>
        <span class="gd">-      var containment = options.containment;</span>
        <span class="gd">-      if(Object.isArray(containment)) {</span>
        <span class="gd">-        containment.each( function(c) { options._containers.push($(c)) });</span>
        <span class="gd">-      } else {</span>
        <span class="gd">-        options._containers.push($(containment));</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    if(options.accept) options.accept = [options.accept].flatten();</span>
        <span class="gd">-</span>
        <span class="gd">-    Element.makePositioned(element); // fix IE</span>
        <span class="gd">-    options.element = element;</span>
        <span class="gd">-</span>
        <span class="gd">-    this.drops.push(options);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  findDeepestChild: function(drops) {</span>
        <span class="gd">-    deepest = drops[0];</span>
        <span class="gd">-</span>
        <span class="gd">-    for (i = 1; i &lt; drops.length; ++i)</span>
        <span class="gd">-      if (Element.isParent(drops[i].element, deepest.element))</span>
        <span class="gd">-        deepest = drops[i];</span>
        <span class="gd">-</span>
        <span class="gd">-    return deepest;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  isContained: function(element, drop) {</span>
        <span class="gd">-    var containmentNode;</span>
        <span class="gd">-    if(drop.tree) {</span>
        <span class="gd">-      containmentNode = element.treeNode;</span>
        <span class="gd">-    } else {</span>
        <span class="gd">-      containmentNode = element.parentNode;</span>
        <span class="gd">-    }</span>
        <span class="gd">-    return drop._containers.detect(function(c) { return containmentNode == c });</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  isAffected: function(point, element, drop) {</span>
        <span class="gd">-    return (</span>
        <span class="gd">-      (drop.element!=element) &amp;&amp;</span>
        <span class="gd">-      ((!drop._containers) ||</span>
        <span class="gd">-        this.isContained(element, drop)) &amp;&amp;</span>
        <span class="gd">-      ((!drop.accept) ||</span>
        <span class="gd">-        (Element.classNames(element).detect(</span>
        <span class="gd">-          function(v) { return drop.accept.include(v) } ) )) &amp;&amp;</span>
        <span class="gd">-      Position.within(drop.element, point[0], point[1]) );</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  deactivate: function(drop) {</span>
        <span class="gd">-    if(drop.hoverclass)</span>
        <span class="gd">-      Element.removeClassName(drop.element, drop.hoverclass);</span>
        <span class="gd">-    this.last_active = null;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  activate: function(drop) {</span>
        <span class="gd">-    if(drop.hoverclass)</span>
        <span class="gd">-      Element.addClassName(drop.element, drop.hoverclass);</span>
        <span class="gd">-    this.last_active = drop;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  show: function(point, element) {</span>
        <span class="gd">-    if(!this.drops.length) return;</span>
        <span class="gd">-    var drop, affected = [];</span>
        <span class="gd">-</span>
        <span class="gd">-    this.drops.each( function(drop) {</span>
        <span class="gd">-      if(Droppables.isAffected(point, element, drop))</span>
        <span class="gd">-        affected.push(drop);</span>
        <span class="gd">-    });</span>
        <span class="gd">-</span>
        <span class="gd">-    if(affected.length&gt;0)</span>
        <span class="gd">-      drop = Droppables.findDeepestChild(affected);</span>
        <span class="gd">-</span>
        <span class="gd">-    if(this.last_active &amp;&amp; this.last_active != drop) this.deactivate(this.last_active);</span>
        <span class="gd">-    if (drop) {</span>
        <span class="gd">-      Position.within(drop.element, point[0], point[1]);</span>
        <span class="gd">-      if(drop.onHover)</span>
        <span class="gd">-        drop.onHover(element, drop.element, Position.overlap(drop.overlap, drop.element));</span>
        <span class="gd">-</span>
        <span class="gd">-      if (drop != this.last_active) Droppables.activate(drop);</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  fire: function(event, element) {</span>
        <span class="gd">-    if(!this.last_active) return;</span>
        <span class="gd">-    Position.prepare();</span>
        <span class="gd">-</span>
        <span class="gd">-    if (this.isAffected([Event.pointerX(event), Event.pointerY(event)], element, this.last_active))</span>
        <span class="gd">-      if (this.last_active.onDrop) {</span>
        <span class="gd">-        this.last_active.onDrop(element, this.last_active.element, event);</span>
        <span class="gd">-        return true;</span>
        <span class="gd">-      }</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  reset: function() {</span>
        <span class="gd">-    if(this.last_active)</span>
        <span class="gd">-      this.deactivate(this.last_active);</span>
        <span class="gd">-  }</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-var Draggables = {</span>
        <span class="gd">-  drags: [],</span>
        <span class="gd">-  observers: [],</span>
        <span class="gd">-</span>
        <span class="gd">-  register: function(draggable) {</span>
        <span class="gd">-    if(this.drags.length == 0) {</span>
        <span class="gd">-      this.eventMouseUp   = this.endDrag.bindAsEventListener(this);</span>
        <span class="gd">-      this.eventMouseMove = this.updateDrag.bindAsEventListener(this);</span>
        <span class="gd">-      this.eventKeypress  = this.keyPress.bindAsEventListener(this);</span>
        <span class="gd">-</span>
        <span class="gd">-      Event.observe(document, &quot;mouseup&quot;, this.eventMouseUp);</span>
        <span class="gd">-      Event.observe(document, &quot;mousemove&quot;, this.eventMouseMove);</span>
        <span class="gd">-      Event.observe(document, &quot;keypress&quot;, this.eventKeypress);</span>
        <span class="gd">-    }</span>
        <span class="gd">-    this.drags.push(draggable);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  unregister: function(draggable) {</span>
        <span class="gd">-    this.drags = this.drags.reject(function(d) { return d==draggable });</span>
        <span class="gd">-    if(this.drags.length == 0) {</span>
        <span class="gd">-      Event.stopObserving(document, &quot;mouseup&quot;, this.eventMouseUp);</span>
        <span class="gd">-      Event.stopObserving(document, &quot;mousemove&quot;, this.eventMouseMove);</span>
        <span class="gd">-      Event.stopObserving(document, &quot;keypress&quot;, this.eventKeypress);</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  activate: function(draggable) {</span>
        <span class="gd">-    if(draggable.options.delay) {</span>
        <span class="gd">-      this._timeout = setTimeout(function() {</span>
        <span class="gd">-        Draggables._timeout = null;</span>
        <span class="gd">-        window.focus();</span>
        <span class="gd">-        Draggables.activeDraggable = draggable;</span>
        <span class="gd">-      }.bind(this), draggable.options.delay);</span>
        <span class="gd">-    } else {</span>
        <span class="gd">-      window.focus(); // allows keypress events if window isn&#39;t currently focused, fails for Safari</span>
        <span class="gd">-      this.activeDraggable = draggable;</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  deactivate: function() {</span>
        <span class="gd">-    this.activeDraggable = null;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  updateDrag: function(event) {</span>
        <span class="gd">-    if(!this.activeDraggable) return;</span>
        <span class="gd">-    var pointer = [Event.pointerX(event), Event.pointerY(event)];</span>
        <span class="gd">-    // Mozilla-based browsers fire successive mousemove events with</span>
        <span class="gd">-    // the same coordinates, prevent needless redrawing (moz bug?)</span>
        <span class="gd">-    if(this._lastPointer &amp;&amp; (this._lastPointer.inspect() == pointer.inspect())) return;</span>
        <span class="gd">-    this._lastPointer = pointer;</span>
        <span class="gd">-</span>
        <span class="gd">-    this.activeDraggable.updateDrag(event, pointer);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  endDrag: function(event) {</span>
        <span class="gd">-    if(this._timeout) {</span>
        <span class="gd">-      clearTimeout(this._timeout);</span>
        <span class="gd">-      this._timeout = null;</span>
        <span class="gd">-    }</span>
        <span class="gd">-    if(!this.activeDraggable) return;</span>
        <span class="gd">-    this._lastPointer = null;</span>
        <span class="gd">-    this.activeDraggable.endDrag(event);</span>
        <span class="gd">-    this.activeDraggable = null;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  keyPress: function(event) {</span>
        <span class="gd">-    if(this.activeDraggable)</span>
        <span class="gd">-      this.activeDraggable.keyPress(event);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  addObserver: function(observer) {</span>
        <span class="gd">-    this.observers.push(observer);</span>
        <span class="gd">-    this._cacheObserverCallbacks();</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  removeObserver: function(element) {  // element instead of observer fixes mem leaks</span>
        <span class="gd">-    this.observers = this.observers.reject( function(o) { return o.element==element });</span>
        <span class="gd">-    this._cacheObserverCallbacks();</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  notify: function(eventName, draggable, event) {  // &#39;onStart&#39;, &#39;onEnd&#39;, &#39;onDrag&#39;</span>
        <span class="gd">-    if(this[eventName+&#39;Count&#39;] &gt; 0)</span>
        <span class="gd">-      this.observers.each( function(o) {</span>
        <span class="gd">-        if(o[eventName]) o[eventName](eventName, draggable, event);</span>
        <span class="gd">-      });</span>
        <span class="gd">-    if(draggable.options[eventName]) draggable.options[eventName](draggable, event);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  _cacheObserverCallbacks: function() {</span>
        <span class="gd">-    [&#39;onStart&#39;,&#39;onEnd&#39;,&#39;onDrag&#39;].each( function(eventName) {</span>
        <span class="gd">-      Draggables[eventName+&#39;Count&#39;] = Draggables.observers.select(</span>
        <span class="gd">-        function(o) { return o[eventName]; }</span>
        <span class="gd">-      ).length;</span>
        <span class="gd">-    });</span>
        <span class="gd">-  }</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-/*--------------------------------------------------------------------------*/</span>
        <span class="gd">-</span>
        <span class="gd">-var Draggable = Class.create({</span>
        <span class="gd">-  initialize: function(element) {</span>
        <span class="gd">-    var defaults = {</span>
        <span class="gd">-      handle: false,</span>
        <span class="gd">-      reverteffect: function(element, top_offset, left_offset) {</span>
        <span class="gd">-        var dur = Math.sqrt(Math.abs(top_offset^2)+Math.abs(left_offset^2))*0.02;</span>
        <span class="gd">-        new Effect.Move(element, { x: -left_offset, y: -top_offset, duration: dur,</span>
        <span class="gd">-          queue: {scope:&#39;_draggable&#39;, position:&#39;end&#39;}</span>
        <span class="gd">-        });</span>
        <span class="gd">-      },</span>
        <span class="gd">-      endeffect: function(element) {</span>
        <span class="gd">-        var toOpacity = Object.isNumber(element._opacity) ? element._opacity : 1.0;</span>
        <span class="gd">-        new Effect.Opacity(element, {duration:0.2, from:0.7, to:toOpacity,</span>
        <span class="gd">-          queue: {scope:&#39;_draggable&#39;, position:&#39;end&#39;},</span>
        <span class="gd">-          afterFinish: function(){</span>
        <span class="gd">-            Draggable._dragging[element] = false</span>
        <span class="gd">-          }</span>
        <span class="gd">-        });</span>
        <span class="gd">-      },</span>
        <span class="gd">-      zindex: 1000,</span>
        <span class="gd">-      revert: false,</span>
        <span class="gd">-      quiet: false,</span>
        <span class="gd">-      scroll: false,</span>
        <span class="gd">-      scrollSensitivity: 20,</span>
        <span class="gd">-      scrollSpeed: 15,</span>
        <span class="gd">-      snap: false,  // false, or xy or [x,y] or function(x,y){ return [x,y] }</span>
        <span class="gd">-      delay: 0</span>
        <span class="gd">-    };</span>
        <span class="gd">-</span>
        <span class="gd">-    if(!arguments[1] || Object.isUndefined(arguments[1].endeffect))</span>
        <span class="gd">-      Object.extend(defaults, {</span>
        <span class="gd">-        starteffect: function(element) {</span>
        <span class="gd">-          element._opacity = Element.getOpacity(element);</span>
        <span class="gd">-          Draggable._dragging[element] = true;</span>
        <span class="gd">-          new Effect.Opacity(element, {duration:0.2, from:element._opacity, to:0.7});</span>
        <span class="gd">-        }</span>
        <span class="gd">-      });</span>
        <span class="gd">-</span>
        <span class="gd">-    var options = Object.extend(defaults, arguments[1] || { });</span>
        <span class="gd">-</span>
        <span class="gd">-    this.element = $(element);</span>
        <span class="gd">-</span>
        <span class="gd">-    if(options.handle &amp;&amp; Object.isString(options.handle))</span>
        <span class="gd">-      this.handle = this.element.down(&#39;.&#39;+options.handle, 0);</span>
        <span class="gd">-</span>
        <span class="gd">-    if(!this.handle) this.handle = $(options.handle);</span>
        <span class="gd">-    if(!this.handle) this.handle = this.element;</span>
        <span class="gd">-</span>
        <span class="gd">-    if(options.scroll &amp;&amp; !options.scroll.scrollTo &amp;&amp; !options.scroll.outerHTML) {</span>
        <span class="gd">-      options.scroll = $(options.scroll);</span>
        <span class="gd">-      this._isScrollChild = Element.childOf(this.element, options.scroll);</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    Element.makePositioned(this.element); // fix IE</span>
        <span class="gd">-</span>
        <span class="gd">-    this.options  = options;</span>
        <span class="gd">-    this.dragging = false;</span>
        <span class="gd">-</span>
        <span class="gd">-    this.eventMouseDown = this.initDrag.bindAsEventListener(this);</span>
        <span class="gd">-    Event.observe(this.handle, &quot;mousedown&quot;, this.eventMouseDown);</span>
        <span class="gd">-</span>
        <span class="gd">-    Draggables.register(this);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  destroy: function() {</span>
        <span class="gd">-    Event.stopObserving(this.handle, &quot;mousedown&quot;, this.eventMouseDown);</span>
        <span class="gd">-    Draggables.unregister(this);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  currentDelta: function() {</span>
        <span class="gd">-    return([</span>
        <span class="gd">-      parseInt(Element.getStyle(this.element,&#39;left&#39;) || &#39;0&#39;),</span>
        <span class="gd">-      parseInt(Element.getStyle(this.element,&#39;top&#39;) || &#39;0&#39;)]);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  initDrag: function(event) {</span>
        <span class="gd">-    if(!Object.isUndefined(Draggable._dragging[this.element]) &amp;&amp;</span>
        <span class="gd">-      Draggable._dragging[this.element]) return;</span>
        <span class="gd">-    if(Event.isLeftClick(event)) {</span>
        <span class="gd">-      // abort on form elements, fixes a Firefox issue</span>
        <span class="gd">-      var src = Event.element(event);</span>
        <span class="gd">-      if((tag_name = src.tagName.toUpperCase()) &amp;&amp; (</span>
        <span class="gd">-        tag_name==&#39;INPUT&#39; ||</span>
        <span class="gd">-        tag_name==&#39;SELECT&#39; ||</span>
        <span class="gd">-        tag_name==&#39;OPTION&#39; ||</span>
        <span class="gd">-        tag_name==&#39;BUTTON&#39; ||</span>
        <span class="gd">-        tag_name==&#39;TEXTAREA&#39;)) return;</span>
        <span class="gd">-</span>
        <span class="gd">-      var pointer = [Event.pointerX(event), Event.pointerY(event)];</span>
        <span class="gd">-      var pos     = this.element.cumulativeOffset();</span>
        <span class="gd">-      this.offset = [0,1].map( function(i) { return (pointer[i] - pos[i]) });</span>
        <span class="gd">-</span>
        <span class="gd">-      Draggables.activate(this);</span>
        <span class="gd">-      Event.stop(event);</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  startDrag: function(event) {</span>
        <span class="gd">-    this.dragging = true;</span>
        <span class="gd">-    if(!this.delta)</span>
        <span class="gd">-      this.delta = this.currentDelta();</span>
        <span class="gd">-</span>
        <span class="gd">-    if(this.options.zindex) {</span>
        <span class="gd">-      this.originalZ = parseInt(Element.getStyle(this.element,&#39;z-index&#39;) || 0);</span>
        <span class="gd">-      this.element.style.zIndex = this.options.zindex;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    if(this.options.ghosting) {</span>
        <span class="gd">-      this._clone = this.element.cloneNode(true);</span>
        <span class="gd">-      this._originallyAbsolute = (this.element.getStyle(&#39;position&#39;) == &#39;absolute&#39;);</span>
        <span class="gd">-      if (!this._originallyAbsolute)</span>
        <span class="gd">-        Position.absolutize(this.element);</span>
        <span class="gd">-      this.element.parentNode.insertBefore(this._clone, this.element);</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    if(this.options.scroll) {</span>
        <span class="gd">-      if (this.options.scroll == window) {</span>
        <span class="gd">-        var where = this._getWindowScroll(this.options.scroll);</span>
        <span class="gd">-        this.originalScrollLeft = where.left;</span>
        <span class="gd">-        this.originalScrollTop = where.top;</span>
        <span class="gd">-      } else {</span>
        <span class="gd">-        this.originalScrollLeft = this.options.scroll.scrollLeft;</span>
        <span class="gd">-        this.originalScrollTop = this.options.scroll.scrollTop;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    Draggables.notify(&#39;onStart&#39;, this, event);</span>
        <span class="gd">-</span>
        <span class="gd">-    if(this.options.starteffect) this.options.starteffect(this.element);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  updateDrag: function(event, pointer) {</span>
        <span class="gd">-    if(!this.dragging) this.startDrag(event);</span>
        <span class="gd">-</span>
        <span class="gd">-    if(!this.options.quiet){</span>
        <span class="gd">-      Position.prepare();</span>
        <span class="gd">-      Droppables.show(pointer, this.element);</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    Draggables.notify(&#39;onDrag&#39;, this, event);</span>
        <span class="gd">-</span>
        <span class="gd">-    this.draw(pointer);</span>
        <span class="gd">-    if(this.options.change) this.options.change(this);</span>
        <span class="gd">-</span>
        <span class="gd">-    if(this.options.scroll) {</span>
        <span class="gd">-      this.stopScrolling();</span>
        <span class="gd">-</span>
        <span class="gd">-      var p;</span>
        <span class="gd">-      if (this.options.scroll == window) {</span>
        <span class="gd">-        with(this._getWindowScroll(this.options.scroll)) { p = [ left, top, left+width, top+height ]; }</span>
        <span class="gd">-      } else {</span>
        <span class="gd">-        p = Position.page(this.options.scroll);</span>
        <span class="gd">-        p[0] += this.options.scroll.scrollLeft + Position.deltaX;</span>
        <span class="gd">-        p[1] += this.options.scroll.scrollTop + Position.deltaY;</span>
        <span class="gd">-        p.push(p[0]+this.options.scroll.offsetWidth);</span>
        <span class="gd">-        p.push(p[1]+this.options.scroll.offsetHeight);</span>
        <span class="gd">-      }</span>
        <span class="gd">-      var speed = [0,0];</span>
        <span class="gd">-      if(pointer[0] &lt; (p[0]+this.options.scrollSensitivity)) speed[0] = pointer[0]-(p[0]+this.options.scrollSensitivity);</span>
        <span class="gd">-      if(pointer[1] &lt; (p[1]+this.options.scrollSensitivity)) speed[1] = pointer[1]-(p[1]+this.options.scrollSensitivity);</span>
        <span class="gd">-      if(pointer[0] &gt; (p[2]-this.options.scrollSensitivity)) speed[0] = pointer[0]-(p[2]-this.options.scrollSensitivity);</span>
        <span class="gd">-      if(pointer[1] &gt; (p[3]-this.options.scrollSensitivity)) speed[1] = pointer[1]-(p[3]-this.options.scrollSensitivity);</span>
        <span class="gd">-      this.startScrolling(speed);</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    // fix AppleWebKit rendering</span>
        <span class="gd">-    if(Prototype.Browser.WebKit) window.scrollBy(0,0);</span>
        <span class="gd">-</span>
        <span class="gd">-    Event.stop(event);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  finishDrag: function(event, success) {</span>
        <span class="gd">-    this.dragging = false;</span>
        <span class="gd">-</span>
        <span class="gd">-    if(this.options.quiet){</span>
        <span class="gd">-      Position.prepare();</span>
        <span class="gd">-      var pointer = [Event.pointerX(event), Event.pointerY(event)];</span>
        <span class="gd">-      Droppables.show(pointer, this.element);</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    if(this.options.ghosting) {</span>
        <span class="gd">-      if (!this._originallyAbsolute)</span>
        <span class="gd">-        Position.relativize(this.element);</span>
        <span class="gd">-      delete this._originallyAbsolute;</span>
        <span class="gd">-      Element.remove(this._clone);</span>
        <span class="gd">-      this._clone = null;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    var dropped = false;</span>
        <span class="gd">-    if(success) {</span>
        <span class="gd">-      dropped = Droppables.fire(event, this.element);</span>
        <span class="gd">-      if (!dropped) dropped = false;</span>
        <span class="gd">-    }</span>
        <span class="gd">-    if(dropped &amp;&amp; this.options.onDropped) this.options.onDropped(this.element);</span>
        <span class="gd">-    Draggables.notify(&#39;onEnd&#39;, this, event);</span>
        <span class="gd">-</span>
        <span class="gd">-    var revert = this.options.revert;</span>
        <span class="gd">-    if(revert &amp;&amp; Object.isFunction(revert)) revert = revert(this.element);</span>
        <span class="gd">-</span>
        <span class="gd">-    var d = this.currentDelta();</span>
        <span class="gd">-    if(revert &amp;&amp; this.options.reverteffect) {</span>
        <span class="gd">-      if (dropped == 0 || revert != &#39;failure&#39;)</span>
        <span class="gd">-        this.options.reverteffect(this.element,</span>
        <span class="gd">-          d[1]-this.delta[1], d[0]-this.delta[0]);</span>
        <span class="gd">-    } else {</span>
        <span class="gd">-      this.delta = d;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    if(this.options.zindex)</span>
        <span class="gd">-      this.element.style.zIndex = this.originalZ;</span>
        <span class="gd">-</span>
        <span class="gd">-    if(this.options.endeffect)</span>
        <span class="gd">-      this.options.endeffect(this.element);</span>
        <span class="gd">-</span>
        <span class="gd">-    Draggables.deactivate(this);</span>
        <span class="gd">-    Droppables.reset();</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  keyPress: function(event) {</span>
        <span class="gd">-    if(event.keyCode!=Event.KEY_ESC) return;</span>
        <span class="gd">-    this.finishDrag(event, false);</span>
        <span class="gd">-    Event.stop(event);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  endDrag: function(event) {</span>
        <span class="gd">-    if(!this.dragging) return;</span>
        <span class="gd">-    this.stopScrolling();</span>
        <span class="gd">-    this.finishDrag(event, true);</span>
        <span class="gd">-    Event.stop(event);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  draw: function(point) {</span>
        <span class="gd">-    var pos = this.element.cumulativeOffset();</span>
        <span class="gd">-    if(this.options.ghosting) {</span>
        <span class="gd">-      var r   = Position.realOffset(this.element);</span>
        <span class="gd">-      pos[0] += r[0] - Position.deltaX; pos[1] += r[1] - Position.deltaY;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    var d = this.currentDelta();</span>
        <span class="gd">-    pos[0] -= d[0]; pos[1] -= d[1];</span>
        <span class="gd">-</span>
        <span class="gd">-    if(this.options.scroll &amp;&amp; (this.options.scroll != window &amp;&amp; this._isScrollChild)) {</span>
        <span class="gd">-      pos[0] -= this.options.scroll.scrollLeft-this.originalScrollLeft;</span>
        <span class="gd">-      pos[1] -= this.options.scroll.scrollTop-this.originalScrollTop;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    var p = [0,1].map(function(i){</span>
        <span class="gd">-      return (point[i]-pos[i]-this.offset[i])</span>
        <span class="gd">-    }.bind(this));</span>
        <span class="gd">-</span>
        <span class="gd">-    if(this.options.snap) {</span>
        <span class="gd">-      if(Object.isFunction(this.options.snap)) {</span>
        <span class="gd">-        p = this.options.snap(p[0],p[1],this);</span>
        <span class="gd">-      } else {</span>
        <span class="gd">-      if(Object.isArray(this.options.snap)) {</span>
        <span class="gd">-        p = p.map( function(v, i) {</span>
        <span class="gd">-          return (v/this.options.snap[i]).round()*this.options.snap[i] }.bind(this));</span>
        <span class="gd">-      } else {</span>
        <span class="gd">-        p = p.map( function(v) {</span>
        <span class="gd">-          return (v/this.options.snap).round()*this.options.snap }.bind(this));</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }}</span>
        <span class="gd">-</span>
        <span class="gd">-    var style = this.element.style;</span>
        <span class="gd">-    if((!this.options.constraint) || (this.options.constraint==&#39;horizontal&#39;))</span>
        <span class="gd">-      style.left = p[0] + &quot;px&quot;;</span>
        <span class="gd">-    if((!this.options.constraint) || (this.options.constraint==&#39;vertical&#39;))</span>
        <span class="gd">-      style.top  = p[1] + &quot;px&quot;;</span>
        <span class="gd">-</span>
        <span class="gd">-    if(style.visibility==&quot;hidden&quot;) style.visibility = &quot;&quot;; // fix gecko rendering</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  stopScrolling: function() {</span>
        <span class="gd">-    if(this.scrollInterval) {</span>
        <span class="gd">-      clearInterval(this.scrollInterval);</span>
        <span class="gd">-      this.scrollInterval = null;</span>
        <span class="gd">-      Draggables._lastScrollPointer = null;</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  startScrolling: function(speed) {</span>
        <span class="gd">-    if(!(speed[0] || speed[1])) return;</span>
        <span class="gd">-    this.scrollSpeed = [speed[0]*this.options.scrollSpeed,speed[1]*this.options.scrollSpeed];</span>
        <span class="gd">-    this.lastScrolled = new Date();</span>
        <span class="gd">-    this.scrollInterval = setInterval(this.scroll.bind(this), 10);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  scroll: function() {</span>
        <span class="gd">-    var current = new Date();</span>
        <span class="gd">-    var delta = current - this.lastScrolled;</span>
        <span class="gd">-    this.lastScrolled = current;</span>
        <span class="gd">-    if(this.options.scroll == window) {</span>
        <span class="gd">-      with (this._getWindowScroll(this.options.scroll)) {</span>
        <span class="gd">-        if (this.scrollSpeed[0] || this.scrollSpeed[1]) {</span>
        <span class="gd">-          var d = delta / 1000;</span>
        <span class="gd">-          this.options.scroll.scrollTo( left + d*this.scrollSpeed[0], top + d*this.scrollSpeed[1] );</span>
        <span class="gd">-        }</span>
        <span class="gd">-      }</span>
        <span class="gd">-    } else {</span>
        <span class="gd">-      this.options.scroll.scrollLeft += this.scrollSpeed[0] * delta / 1000;</span>
        <span class="gd">-      this.options.scroll.scrollTop  += this.scrollSpeed[1] * delta / 1000;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    Position.prepare();</span>
        <span class="gd">-    Droppables.show(Draggables._lastPointer, this.element);</span>
        <span class="gd">-    Draggables.notify(&#39;onDrag&#39;, this);</span>
        <span class="gd">-    if (this._isScrollChild) {</span>
        <span class="gd">-      Draggables._lastScrollPointer = Draggables._lastScrollPointer || $A(Draggables._lastPointer);</span>
        <span class="gd">-      Draggables._lastScrollPointer[0] += this.scrollSpeed[0] * delta / 1000;</span>
        <span class="gd">-      Draggables._lastScrollPointer[1] += this.scrollSpeed[1] * delta / 1000;</span>
        <span class="gd">-      if (Draggables._lastScrollPointer[0] &lt; 0)</span>
        <span class="gd">-        Draggables._lastScrollPointer[0] = 0;</span>
        <span class="gd">-      if (Draggables._lastScrollPointer[1] &lt; 0)</span>
        <span class="gd">-        Draggables._lastScrollPointer[1] = 0;</span>
        <span class="gd">-      this.draw(Draggables._lastScrollPointer);</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    if(this.options.change) this.options.change(this);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  _getWindowScroll: function(w) {</span>
        <span class="gd">-    var T, L, W, H;</span>
        <span class="gd">-    with (w.document) {</span>
        <span class="gd">-      if (w.document.documentElement &amp;&amp; documentElement.scrollTop) {</span>
        <span class="gd">-        T = documentElement.scrollTop;</span>
        <span class="gd">-        L = documentElement.scrollLeft;</span>
        <span class="gd">-      } else if (w.document.body) {</span>
        <span class="gd">-        T = body.scrollTop;</span>
        <span class="gd">-        L = body.scrollLeft;</span>
        <span class="gd">-      }</span>
        <span class="gd">-      if (w.innerWidth) {</span>
        <span class="gd">-        W = w.innerWidth;</span>
        <span class="gd">-        H = w.innerHeight;</span>
        <span class="gd">-      } else if (w.document.documentElement &amp;&amp; documentElement.clientWidth) {</span>
        <span class="gd">-        W = documentElement.clientWidth;</span>
        <span class="gd">-        H = documentElement.clientHeight;</span>
        <span class="gd">-      } else {</span>
        <span class="gd">-        W = body.offsetWidth;</span>
        <span class="gd">-        H = body.offsetHeight;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-    return { top: T, left: L, width: W, height: H };</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-Draggable._dragging = { };</span>
        <span class="gd">-</span>
        <span class="gd">-/*--------------------------------------------------------------------------*/</span>
        <span class="gd">-</span>
        <span class="gd">-var SortableObserver = Class.create({</span>
        <span class="gd">-  initialize: function(element, observer) {</span>
        <span class="gd">-    this.element   = $(element);</span>
        <span class="gd">-    this.observer  = observer;</span>
        <span class="gd">-    this.lastValue = Sortable.serialize(this.element);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  onStart: function() {</span>
        <span class="gd">-    this.lastValue = Sortable.serialize(this.element);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  onEnd: function() {</span>
        <span class="gd">-    Sortable.unmark();</span>
        <span class="gd">-    if(this.lastValue != Sortable.serialize(this.element))</span>
        <span class="gd">-      this.observer(this.element)</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-var Sortable = {</span>
        <span class="gd">-  SERIALIZE_RULE: /^[^_\-](?:[A-Za-z0-9\-\_]*)[_](.*)$/,</span>
        <span class="gd">-</span>
        <span class="gd">-  sortables: { },</span>
        <span class="gd">-</span>
        <span class="gd">-  _findRootElement: function(element) {</span>
        <span class="gd">-    while (element.tagName.toUpperCase() != &quot;BODY&quot;) {</span>
        <span class="gd">-      if(element.id &amp;&amp; Sortable.sortables[element.id]) return element;</span>
        <span class="gd">-      element = element.parentNode;</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  options: function(element) {</span>
        <span class="gd">-    element = Sortable._findRootElement($(element));</span>
        <span class="gd">-    if(!element) return;</span>
        <span class="gd">-    return Sortable.sortables[element.id];</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  destroy: function(element){</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    var s = Sortable.sortables[element.id];</span>
        <span class="gd">-</span>
        <span class="gd">-    if(s) {</span>
        <span class="gd">-      Draggables.removeObserver(s.element);</span>
        <span class="gd">-      s.droppables.each(function(d){ Droppables.remove(d) });</span>
        <span class="gd">-      s.draggables.invoke(&#39;destroy&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-      delete Sortable.sortables[s.element.id];</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  create: function(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    var options = Object.extend({</span>
        <span class="gd">-      element:     element,</span>
        <span class="gd">-      tag:         &#39;li&#39;,       // assumes li children, override with tag: &#39;tagname&#39;</span>
        <span class="gd">-      dropOnEmpty: false,</span>
        <span class="gd">-      tree:        false,</span>
        <span class="gd">-      treeTag:     &#39;ul&#39;,</span>
        <span class="gd">-      overlap:     &#39;vertical&#39;, // one of &#39;vertical&#39;, &#39;horizontal&#39;</span>
        <span class="gd">-      constraint:  &#39;vertical&#39;, // one of &#39;vertical&#39;, &#39;horizontal&#39;, false</span>
        <span class="gd">-      containment: element,    // also takes array of elements (or id&#39;s); or false</span>
        <span class="gd">-      handle:      false,      // or a CSS class</span>
        <span class="gd">-      only:        false,</span>
        <span class="gd">-      delay:       0,</span>
        <span class="gd">-      hoverclass:  null,</span>
        <span class="gd">-      ghosting:    false,</span>
        <span class="gd">-      quiet:       false,</span>
        <span class="gd">-      scroll:      false,</span>
        <span class="gd">-      scrollSensitivity: 20,</span>
        <span class="gd">-      scrollSpeed: 15,</span>
        <span class="gd">-      format:      this.SERIALIZE_RULE,</span>
        <span class="gd">-</span>
        <span class="gd">-      // these take arrays of elements or ids and can be</span>
        <span class="gd">-      // used for better initialization performance</span>
        <span class="gd">-      elements:    false,</span>
        <span class="gd">-      handles:     false,</span>
        <span class="gd">-</span>
        <span class="gd">-      onChange:    Prototype.emptyFunction,</span>
        <span class="gd">-      onUpdate:    Prototype.emptyFunction</span>
        <span class="gd">-    }, arguments[1] || { });</span>
        <span class="gd">-</span>
        <span class="gd">-    // clear any old sortable with same element</span>
        <span class="gd">-    this.destroy(element);</span>
        <span class="gd">-</span>
        <span class="gd">-    // build options for the draggables</span>
        <span class="gd">-    var options_for_draggable = {</span>
        <span class="gd">-      revert:      true,</span>
        <span class="gd">-      quiet:       options.quiet,</span>
        <span class="gd">-      scroll:      options.scroll,</span>
        <span class="gd">-      scrollSpeed: options.scrollSpeed,</span>
        <span class="gd">-      scrollSensitivity: options.scrollSensitivity,</span>
        <span class="gd">-      delay:       options.delay,</span>
        <span class="gd">-      ghosting:    options.ghosting,</span>
        <span class="gd">-      constraint:  options.constraint,</span>
        <span class="gd">-      handle:      options.handle };</span>
        <span class="gd">-</span>
        <span class="gd">-    if(options.starteffect)</span>
        <span class="gd">-      options_for_draggable.starteffect = options.starteffect;</span>
        <span class="gd">-</span>
        <span class="gd">-    if(options.reverteffect)</span>
        <span class="gd">-      options_for_draggable.reverteffect = options.reverteffect;</span>
        <span class="gd">-    else</span>
        <span class="gd">-      if(options.ghosting) options_for_draggable.reverteffect = function(element) {</span>
        <span class="gd">-        element.style.top  = 0;</span>
        <span class="gd">-        element.style.left = 0;</span>
        <span class="gd">-      };</span>
        <span class="gd">-</span>
        <span class="gd">-    if(options.endeffect)</span>
        <span class="gd">-      options_for_draggable.endeffect = options.endeffect;</span>
        <span class="gd">-</span>
        <span class="gd">-    if(options.zindex)</span>
        <span class="gd">-      options_for_draggable.zindex = options.zindex;</span>
        <span class="gd">-</span>
        <span class="gd">-    // build options for the droppables</span>
        <span class="gd">-    var options_for_droppable = {</span>
        <span class="gd">-      overlap:     options.overlap,</span>
        <span class="gd">-      containment: options.containment,</span>
        <span class="gd">-      tree:        options.tree,</span>
        <span class="gd">-      hoverclass:  options.hoverclass,</span>
        <span class="gd">-      onHover:     Sortable.onHover</span>
        <span class="gd">-    };</span>
        <span class="gd">-</span>
        <span class="gd">-    var options_for_tree = {</span>
        <span class="gd">-      onHover:      Sortable.onEmptyHover,</span>
        <span class="gd">-      overlap:      options.overlap,</span>
        <span class="gd">-      containment:  options.containment,</span>
        <span class="gd">-      hoverclass:   options.hoverclass</span>
        <span class="gd">-    };</span>
        <span class="gd">-</span>
        <span class="gd">-    // fix for gecko engine</span>
        <span class="gd">-    Element.cleanWhitespace(element);</span>
        <span class="gd">-</span>
        <span class="gd">-    options.draggables = [];</span>
        <span class="gd">-    options.droppables = [];</span>
        <span class="gd">-</span>
        <span class="gd">-    // drop on empty handling</span>
        <span class="gd">-    if(options.dropOnEmpty || options.tree) {</span>
        <span class="gd">-      Droppables.add(element, options_for_tree);</span>
        <span class="gd">-      options.droppables.push(element);</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    (options.elements || this.findElements(element, options) || []).each( function(e,i) {</span>
        <span class="gd">-      var handle = options.handles ? $(options.handles[i]) :</span>
        <span class="gd">-        (options.handle ? $(e).select(&#39;.&#39; + options.handle)[0] : e);</span>
        <span class="gd">-      options.draggables.push(</span>
        <span class="gd">-        new Draggable(e, Object.extend(options_for_draggable, { handle: handle })));</span>
        <span class="gd">-      Droppables.add(e, options_for_droppable);</span>
        <span class="gd">-      if(options.tree) e.treeNode = element;</span>
        <span class="gd">-      options.droppables.push(e);</span>
        <span class="gd">-    });</span>
        <span class="gd">-</span>
        <span class="gd">-    if(options.tree) {</span>
        <span class="gd">-      (Sortable.findTreeElements(element, options) || []).each( function(e) {</span>
        <span class="gd">-        Droppables.add(e, options_for_tree);</span>
        <span class="gd">-        e.treeNode = element;</span>
        <span class="gd">-        options.droppables.push(e);</span>
        <span class="gd">-      });</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    // keep reference</span>
        <span class="gd">-    this.sortables[element.identify()] = options;</span>
        <span class="gd">-</span>
        <span class="gd">-    // for onupdate</span>
        <span class="gd">-    Draggables.addObserver(new SortableObserver(element, options.onUpdate));</span>
        <span class="gd">-</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  // return all suitable-for-sortable elements in a guaranteed order</span>
        <span class="gd">-  findElements: function(element, options) {</span>
        <span class="gd">-    return Element.findChildren(</span>
        <span class="gd">-      element, options.only, options.tree ? true : false, options.tag);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  findTreeElements: function(element, options) {</span>
        <span class="gd">-    return Element.findChildren(</span>
        <span class="gd">-      element, options.only, options.tree ? true : false, options.treeTag);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  onHover: function(element, dropon, overlap) {</span>
        <span class="gd">-    if(Element.isParent(dropon, element)) return;</span>
        <span class="gd">-</span>
        <span class="gd">-    if(overlap &gt; .33 &amp;&amp; overlap &lt; .66 &amp;&amp; Sortable.options(dropon).tree) {</span>
        <span class="gd">-      return;</span>
        <span class="gd">-    } else if(overlap&gt;0.5) {</span>
        <span class="gd">-      Sortable.mark(dropon, &#39;before&#39;);</span>
        <span class="gd">-      if(dropon.previousSibling != element) {</span>
        <span class="gd">-        var oldParentNode = element.parentNode;</span>
        <span class="gd">-        element.style.visibility = &quot;hidden&quot;; // fix gecko rendering</span>
        <span class="gd">-        dropon.parentNode.insertBefore(element, dropon);</span>
        <span class="gd">-        if(dropon.parentNode!=oldParentNode)</span>
        <span class="gd">-          Sortable.options(oldParentNode).onChange(element);</span>
        <span class="gd">-        Sortable.options(dropon.parentNode).onChange(element);</span>
        <span class="gd">-      }</span>
        <span class="gd">-    } else {</span>
        <span class="gd">-      Sortable.mark(dropon, &#39;after&#39;);</span>
        <span class="gd">-      var nextElement = dropon.nextSibling || null;</span>
        <span class="gd">-      if(nextElement != element) {</span>
        <span class="gd">-        var oldParentNode = element.parentNode;</span>
        <span class="gd">-        element.style.visibility = &quot;hidden&quot;; // fix gecko rendering</span>
        <span class="gd">-        dropon.parentNode.insertBefore(element, nextElement);</span>
        <span class="gd">-        if(dropon.parentNode!=oldParentNode)</span>
        <span class="gd">-          Sortable.options(oldParentNode).onChange(element);</span>
        <span class="gd">-        Sortable.options(dropon.parentNode).onChange(element);</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  onEmptyHover: function(element, dropon, overlap) {</span>
        <span class="gd">-    var oldParentNode = element.parentNode;</span>
        <span class="gd">-    var droponOptions = Sortable.options(dropon);</span>
        <span class="gd">-</span>
        <span class="gd">-    if(!Element.isParent(dropon, element)) {</span>
        <span class="gd">-      var index;</span>
        <span class="gd">-</span>
        <span class="gd">-      var children = Sortable.findElements(dropon, {tag: droponOptions.tag, only: droponOptions.only});</span>
        <span class="gd">-      var child = null;</span>
        <span class="gd">-</span>
        <span class="gd">-      if(children) {</span>
        <span class="gd">-        var offset = Element.offsetSize(dropon, droponOptions.overlap) * (1.0 - overlap);</span>
        <span class="gd">-</span>
        <span class="gd">-        for (index = 0; index &lt; children.length; index += 1) {</span>
        <span class="gd">-          if (offset - Element.offsetSize (children[index], droponOptions.overlap) &gt;= 0) {</span>
        <span class="gd">-            offset -= Element.offsetSize (children[index], droponOptions.overlap);</span>
        <span class="gd">-          } else if (offset - (Element.offsetSize (children[index], droponOptions.overlap) / 2) &gt;= 0) {</span>
        <span class="gd">-            child = index + 1 &lt; children.length ? children[index + 1] : null;</span>
        <span class="gd">-            break;</span>
        <span class="gd">-          } else {</span>
        <span class="gd">-            child = children[index];</span>
        <span class="gd">-            break;</span>
        <span class="gd">-          }</span>
        <span class="gd">-        }</span>
        <span class="gd">-      }</span>
        <span class="gd">-</span>
        <span class="gd">-      dropon.insertBefore(element, child);</span>
        <span class="gd">-</span>
        <span class="gd">-      Sortable.options(oldParentNode).onChange(element);</span>
        <span class="gd">-      droponOptions.onChange(element);</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  unmark: function() {</span>
        <span class="gd">-    if(Sortable._marker) Sortable._marker.hide();</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  mark: function(dropon, position) {</span>
        <span class="gd">-    // mark on ghosting only</span>
        <span class="gd">-    var sortable = Sortable.options(dropon.parentNode);</span>
        <span class="gd">-    if(sortable &amp;&amp; !sortable.ghosting) return;</span>
        <span class="gd">-</span>
        <span class="gd">-    if(!Sortable._marker) {</span>
        <span class="gd">-      Sortable._marker =</span>
        <span class="gd">-        ($(&#39;dropmarker&#39;) || Element.extend(document.createElement(&#39;DIV&#39;))).</span>
        <span class="gd">-          hide().addClassName(&#39;dropmarker&#39;).setStyle({position:&#39;absolute&#39;});</span>
        <span class="gd">-      document.getElementsByTagName(&quot;body&quot;).item(0).appendChild(Sortable._marker);</span>
        <span class="gd">-    }</span>
        <span class="gd">-    var offsets = dropon.cumulativeOffset();</span>
        <span class="gd">-    Sortable._marker.setStyle({left: offsets[0]+&#39;px&#39;, top: offsets[1] + &#39;px&#39;});</span>
        <span class="gd">-</span>
        <span class="gd">-    if(position==&#39;after&#39;)</span>
        <span class="gd">-      if(sortable.overlap == &#39;horizontal&#39;)</span>
        <span class="gd">-        Sortable._marker.setStyle({left: (offsets[0]+dropon.clientWidth) + &#39;px&#39;});</span>
        <span class="gd">-      else</span>
        <span class="gd">-        Sortable._marker.setStyle({top: (offsets[1]+dropon.clientHeight) + &#39;px&#39;});</span>
        <span class="gd">-</span>
        <span class="gd">-    Sortable._marker.show();</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  _tree: function(element, options, parent) {</span>
        <span class="gd">-    var children = Sortable.findElements(element, options) || [];</span>
        <span class="gd">-</span>
        <span class="gd">-    for (var i = 0; i &lt; children.length; ++i) {</span>
        <span class="gd">-      var match = children[i].id.match(options.format);</span>
        <span class="gd">-</span>
        <span class="gd">-      if (!match) continue;</span>
        <span class="gd">-</span>
        <span class="gd">-      var child = {</span>
        <span class="gd">-        id: encodeURIComponent(match ? match[1] : null),</span>
        <span class="gd">-        element: element,</span>
        <span class="gd">-        parent: parent,</span>
        <span class="gd">-        children: [],</span>
        <span class="gd">-        position: parent.children.length,</span>
        <span class="gd">-        container: $(children[i]).down(options.treeTag)</span>
        <span class="gd">-      };</span>
        <span class="gd">-</span>
        <span class="gd">-      /* Get the element containing the children and recurse over it */</span>
        <span class="gd">-      if (child.container)</span>
        <span class="gd">-        this._tree(child.container, options, child);</span>
        <span class="gd">-</span>
        <span class="gd">-      parent.children.push (child);</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    return parent;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  tree: function(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    var sortableOptions = this.options(element);</span>
        <span class="gd">-    var options = Object.extend({</span>
        <span class="gd">-      tag: sortableOptions.tag,</span>
        <span class="gd">-      treeTag: sortableOptions.treeTag,</span>
        <span class="gd">-      only: sortableOptions.only,</span>
        <span class="gd">-      name: element.id,</span>
        <span class="gd">-      format: sortableOptions.format</span>
        <span class="gd">-    }, arguments[1] || { });</span>
        <span class="gd">-</span>
        <span class="gd">-    var root = {</span>
        <span class="gd">-      id: null,</span>
        <span class="gd">-      parent: null,</span>
        <span class="gd">-      children: [],</span>
        <span class="gd">-      container: element,</span>
        <span class="gd">-      position: 0</span>
        <span class="gd">-    };</span>
        <span class="gd">-</span>
        <span class="gd">-    return Sortable._tree(element, options, root);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  /* Construct a [i] index for a particular node */</span>
        <span class="gd">-  _constructIndex: function(node) {</span>
        <span class="gd">-    var index = &#39;&#39;;</span>
        <span class="gd">-    do {</span>
        <span class="gd">-      if (node.id) index = &#39;[&#39; + node.position + &#39;]&#39; + index;</span>
        <span class="gd">-    } while ((node = node.parent) != null);</span>
        <span class="gd">-    return index;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  sequence: function(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    var options = Object.extend(this.options(element), arguments[1] || { });</span>
        <span class="gd">-</span>
        <span class="gd">-    return $(this.findElements(element, options) || []).map( function(item) {</span>
        <span class="gd">-      return item.id.match(options.format) ? item.id.match(options.format)[1] : &#39;&#39;;</span>
        <span class="gd">-    });</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  setSequence: function(element, new_sequence) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    var options = Object.extend(this.options(element), arguments[2] || { });</span>
        <span class="gd">-</span>
        <span class="gd">-    var nodeMap = { };</span>
        <span class="gd">-    this.findElements(element, options).each( function(n) {</span>
        <span class="gd">-        if (n.id.match(options.format))</span>
        <span class="gd">-            nodeMap[n.id.match(options.format)[1]] = [n, n.parentNode];</span>
        <span class="gd">-        n.parentNode.removeChild(n);</span>
        <span class="gd">-    });</span>
        <span class="gd">-</span>
        <span class="gd">-    new_sequence.each(function(ident) {</span>
        <span class="gd">-      var n = nodeMap[ident];</span>
        <span class="gd">-      if (n) {</span>
        <span class="gd">-        n[1].appendChild(n[0]);</span>
        <span class="gd">-        delete nodeMap[ident];</span>
        <span class="gd">-      }</span>
        <span class="gd">-    });</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  serialize: function(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    var options = Object.extend(Sortable.options(element), arguments[1] || { });</span>
        <span class="gd">-    var name = encodeURIComponent(</span>
        <span class="gd">-      (arguments[1] &amp;&amp; arguments[1].name) ? arguments[1].name : element.id);</span>
        <span class="gd">-</span>
        <span class="gd">-    if (options.tree) {</span>
        <span class="gd">-      return Sortable.tree(element, arguments[1]).children.map( function (item) {</span>
        <span class="gd">-        return [name + Sortable._constructIndex(item) + &quot;[id]=&quot; +</span>
        <span class="gd">-                encodeURIComponent(item.id)].concat(item.children.map(arguments.callee));</span>
        <span class="gd">-      }).flatten().join(&#39;&amp;&#39;);</span>
        <span class="gd">-    } else {</span>
        <span class="gd">-      return Sortable.sequence(element, arguments[1]).map( function(item) {</span>
        <span class="gd">-        return name + &quot;[]=&quot; + encodeURIComponent(item);</span>
        <span class="gd">-      }).join(&#39;&amp;&#39;);</span>
        <span class="gd">-    }</span>
        <span class="gd">-  }</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-// Returns true if child is contained within element</span>
        <span class="gd">-Element.isParent = function(child, element) {</span>
        <span class="gd">-  if (!child.parentNode || child == element) return false;</span>
        <span class="gd">-  if (child.parentNode == element) return true;</span>
        <span class="gd">-  return Element.isParent(child.parentNode, element);</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Element.findChildren = function(element, only, recursive, tagName) {</span>
        <span class="gd">-  if(!element.hasChildNodes()) return null;</span>
        <span class="gd">-  tagName = tagName.toUpperCase();</span>
        <span class="gd">-  if(only) only = [only].flatten();</span>
        <span class="gd">-  var elements = [];</span>
        <span class="gd">-  $A(element.childNodes).each( function(e) {</span>
        <span class="gd">-    if(e.tagName &amp;&amp; e.tagName.toUpperCase()==tagName &amp;&amp;</span>
        <span class="gd">-      (!only || (Element.classNames(e).detect(function(v) { return only.include(v) }))))</span>
        <span class="gd">-        elements.push(e);</span>
        <span class="gd">-    if(recursive) {</span>
        <span class="gd">-      var grandchildren = Element.findChildren(e, only, recursive, tagName);</span>
        <span class="gd">-      if(grandchildren) elements.push(grandchildren);</span>
        <span class="gd">-    }</span>
        <span class="gd">-  });</span>
        <span class="gd">-</span>
        <span class="gd">-  return (elements.length&gt;0 ? elements.flatten() : []);</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Element.offsetSize = function (element, type) {</span>
        <span class="gd">-  return element[&#39;offset&#39; + ((type==&#39;vertical&#39; || type==&#39;height&#39;) ? &#39;Height&#39; : &#39;Width&#39;)];</span>
        <span class="gd">-};</span>
        \ No newline at end of file
        </pre></div>
        <h2>
          <a href='full/#public-javascripts-effects-js'>public/javascripts/effects.js</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -1,1123 +0,0 @@</span>
        <span class="gd">-// script.aculo.us effects.js v1.8.3, Thu Oct 08 11:23:33 +0200 2009</span>
        <span class="gd">-</span>
        <span class="gd">-// Copyright (c) 2005-2009 Thomas Fuchs (http://script.aculo.us, http://mir.aculo.us)</span>
        <span class="gd">-// Contributors:</span>
        <span class="gd">-//  Justin Palmer (http://encytemedia.com/)</span>
        <span class="gd">-//  Mark Pilgrim (http://diveintomark.org/)</span>
        <span class="gd">-//  Martin Bialasinki</span>
        <span class="gd">-//</span>
        <span class="gd">-// script.aculo.us is freely distributable under the terms of an MIT-style license.</span>
        <span class="gd">-// For details, see the script.aculo.us web site: http://script.aculo.us/</span>
        <span class="gd">-</span>
        <span class="gd">-// converts rgb() and #xxx to #xxxxxx format,</span>
        <span class="gd">-// returns self (or first argument) if not convertable</span>
        <span class="gd">-String.prototype.parseColor = function() {</span>
        <span class="gd">-  var color = &#39;#&#39;;</span>
        <span class="gd">-  if (this.slice(0,4) == &#39;rgb(&#39;) {</span>
        <span class="gd">-    var cols = this.slice(4,this.length-1).split(&#39;,&#39;);</span>
        <span class="gd">-    var i=0; do { color += parseInt(cols[i]).toColorPart() } while (++i&lt;3);</span>
        <span class="gd">-  } else {</span>
        <span class="gd">-    if (this.slice(0,1) == &#39;#&#39;) {</span>
        <span class="gd">-      if (this.length==4) for(var i=1;i&lt;4;i++) color += (this.charAt(i) + this.charAt(i)).toLowerCase();</span>
        <span class="gd">-      if (this.length==7) color = this.toLowerCase();</span>
        <span class="gd">-    }</span>
        <span class="gd">-  }</span>
        <span class="gd">-  return (color.length==7 ? color : (arguments[0] || this));</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-/*--------------------------------------------------------------------------*/</span>
        <span class="gd">-</span>
        <span class="gd">-Element.collectTextNodes = function(element) {</span>
        <span class="gd">-  return $A($(element).childNodes).collect( function(node) {</span>
        <span class="gd">-    return (node.nodeType==3 ? node.nodeValue :</span>
        <span class="gd">-      (node.hasChildNodes() ? Element.collectTextNodes(node) : &#39;&#39;));</span>
        <span class="gd">-  }).flatten().join(&#39;&#39;);</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Element.collectTextNodesIgnoreClass = function(element, className) {</span>
        <span class="gd">-  return $A($(element).childNodes).collect( function(node) {</span>
        <span class="gd">-    return (node.nodeType==3 ? node.nodeValue :</span>
        <span class="gd">-      ((node.hasChildNodes() &amp;&amp; !Element.hasClassName(node,className)) ?</span>
        <span class="gd">-        Element.collectTextNodesIgnoreClass(node, className) : &#39;&#39;));</span>
        <span class="gd">-  }).flatten().join(&#39;&#39;);</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Element.setContentZoom = function(element, percent) {</span>
        <span class="gd">-  element = $(element);</span>
        <span class="gd">-  element.setStyle({fontSize: (percent/100) + &#39;em&#39;});</span>
        <span class="gd">-  if (Prototype.Browser.WebKit) window.scrollBy(0,0);</span>
        <span class="gd">-  return element;</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Element.getInlineOpacity = function(element){</span>
        <span class="gd">-  return $(element).style.opacity || &#39;&#39;;</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Element.forceRerendering = function(element) {</span>
        <span class="gd">-  try {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    var n = document.createTextNode(&#39; &#39;);</span>
        <span class="gd">-    element.appendChild(n);</span>
        <span class="gd">-    element.removeChild(n);</span>
        <span class="gd">-  } catch(e) { }</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-/*--------------------------------------------------------------------------*/</span>
        <span class="gd">-</span>
        <span class="gd">-var Effect = {</span>
        <span class="gd">-  _elementDoesNotExistError: {</span>
        <span class="gd">-    name: &#39;ElementDoesNotExistError&#39;,</span>
        <span class="gd">-    message: &#39;The specified DOM element does not exist, but is required for this effect to operate&#39;</span>
        <span class="gd">-  },</span>
        <span class="gd">-  Transitions: {</span>
        <span class="gd">-    linear: Prototype.K,</span>
        <span class="gd">-    sinoidal: function(pos) {</span>
        <span class="gd">-      return (-Math.cos(pos*Math.PI)/2) + .5;</span>
        <span class="gd">-    },</span>
        <span class="gd">-    reverse: function(pos) {</span>
        <span class="gd">-      return 1-pos;</span>
        <span class="gd">-    },</span>
        <span class="gd">-    flicker: function(pos) {</span>
        <span class="gd">-      var pos = ((-Math.cos(pos*Math.PI)/4) + .75) + Math.random()/4;</span>
        <span class="gd">-      return pos &gt; 1 ? 1 : pos;</span>
        <span class="gd">-    },</span>
        <span class="gd">-    wobble: function(pos) {</span>
        <span class="gd">-      return (-Math.cos(pos*Math.PI*(9*pos))/2) + .5;</span>
        <span class="gd">-    },</span>
        <span class="gd">-    pulse: function(pos, pulses) {</span>
        <span class="gd">-      return (-Math.cos((pos*((pulses||5)-.5)*2)*Math.PI)/2) + .5;</span>
        <span class="gd">-    },</span>
        <span class="gd">-    spring: function(pos) {</span>
        <span class="gd">-      return 1 - (Math.cos(pos * 4.5 * Math.PI) * Math.exp(-pos * 6));</span>
        <span class="gd">-    },</span>
        <span class="gd">-    none: function(pos) {</span>
        <span class="gd">-      return 0;</span>
        <span class="gd">-    },</span>
        <span class="gd">-    full: function(pos) {</span>
        <span class="gd">-      return 1;</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gd">-  DefaultOptions: {</span>
        <span class="gd">-    duration:   1.0,   // seconds</span>
        <span class="gd">-    fps:        100,   // 100= assume 66fps max.</span>
        <span class="gd">-    sync:       false, // true for combining</span>
        <span class="gd">-    from:       0.0,</span>
        <span class="gd">-    to:         1.0,</span>
        <span class="gd">-    delay:      0.0,</span>
        <span class="gd">-    queue:      &#39;parallel&#39;</span>
        <span class="gd">-  },</span>
        <span class="gd">-  tagifyText: function(element) {</span>
        <span class="gd">-    var tagifyStyle = &#39;position:relative&#39;;</span>
        <span class="gd">-    if (Prototype.Browser.IE) tagifyStyle += &#39;;zoom:1&#39;;</span>
        <span class="gd">-</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    $A(element.childNodes).each( function(child) {</span>
        <span class="gd">-      if (child.nodeType==3) {</span>
        <span class="gd">-        child.nodeValue.toArray().each( function(character) {</span>
        <span class="gd">-          element.insertBefore(</span>
        <span class="gd">-            new Element(&#39;span&#39;, {style: tagifyStyle}).update(</span>
        <span class="gd">-              character == &#39; &#39; ? String.fromCharCode(160) : character),</span>
        <span class="gd">-              child);</span>
        <span class="gd">-        });</span>
        <span class="gd">-        Element.remove(child);</span>
        <span class="gd">-      }</span>
        <span class="gd">-    });</span>
        <span class="gd">-  },</span>
        <span class="gd">-  multiple: function(element, effect) {</span>
        <span class="gd">-    var elements;</span>
        <span class="gd">-    if (((typeof element == &#39;object&#39;) ||</span>
        <span class="gd">-        Object.isFunction(element)) &amp;&amp;</span>
        <span class="gd">-       (element.length))</span>
        <span class="gd">-      elements = element;</span>
        <span class="gd">-    else</span>
        <span class="gd">-      elements = $(element).childNodes;</span>
        <span class="gd">-</span>
        <span class="gd">-    var options = Object.extend({</span>
        <span class="gd">-      speed: 0.1,</span>
        <span class="gd">-      delay: 0.0</span>
        <span class="gd">-    }, arguments[2] || { });</span>
        <span class="gd">-    var masterDelay = options.delay;</span>
        <span class="gd">-</span>
        <span class="gd">-    $A(elements).each( function(element, index) {</span>
        <span class="gd">-      new effect(element, Object.extend(options, { delay: index * options.speed + masterDelay }));</span>
        <span class="gd">-    });</span>
        <span class="gd">-  },</span>
        <span class="gd">-  PAIRS: {</span>
        <span class="gd">-    &#39;slide&#39;:  [&#39;SlideDown&#39;,&#39;SlideUp&#39;],</span>
        <span class="gd">-    &#39;blind&#39;:  [&#39;BlindDown&#39;,&#39;BlindUp&#39;],</span>
        <span class="gd">-    &#39;appear&#39;: [&#39;Appear&#39;,&#39;Fade&#39;]</span>
        <span class="gd">-  },</span>
        <span class="gd">-  toggle: function(element, effect, options) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    effect  = (effect || &#39;appear&#39;).toLowerCase();</span>
        <span class="gd">-</span>
        <span class="gd">-    return Effect[ Effect.PAIRS[ effect ][ element.visible() ? 1 : 0 ] ](element, Object.extend({</span>
        <span class="gd">-      queue: { position:&#39;end&#39;, scope:(element.id || &#39;global&#39;), limit: 1 }</span>
        <span class="gd">-    }, options || {}));</span>
        <span class="gd">-  }</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Effect.DefaultOptions.transition = Effect.Transitions.sinoidal;</span>
        <span class="gd">-</span>
        <span class="gd">-/* ------------- core effects ------------- */</span>
        <span class="gd">-</span>
        <span class="gd">-Effect.ScopedQueue = Class.create(Enumerable, {</span>
        <span class="gd">-  initialize: function() {</span>
        <span class="gd">-    this.effects  = [];</span>
        <span class="gd">-    this.interval = null;</span>
        <span class="gd">-  },</span>
        <span class="gd">-  _each: function(iterator) {</span>
        <span class="gd">-    this.effects._each(iterator);</span>
        <span class="gd">-  },</span>
        <span class="gd">-  add: function(effect) {</span>
        <span class="gd">-    var timestamp = new Date().getTime();</span>
        <span class="gd">-</span>
        <span class="gd">-    var position = Object.isString(effect.options.queue) ?</span>
        <span class="gd">-      effect.options.queue : effect.options.queue.position;</span>
        <span class="gd">-</span>
        <span class="gd">-    switch(position) {</span>
        <span class="gd">-      case &#39;front&#39;:</span>
        <span class="gd">-        // move unstarted effects after this effect</span>
        <span class="gd">-        this.effects.findAll(function(e){ return e.state==&#39;idle&#39; }).each( function(e) {</span>
        <span class="gd">-            e.startOn  += effect.finishOn;</span>
        <span class="gd">-            e.finishOn += effect.finishOn;</span>
        <span class="gd">-          });</span>
        <span class="gd">-        break;</span>
        <span class="gd">-      case &#39;with-last&#39;:</span>
        <span class="gd">-        timestamp = this.effects.pluck(&#39;startOn&#39;).max() || timestamp;</span>
        <span class="gd">-        break;</span>
        <span class="gd">-      case &#39;end&#39;:</span>
        <span class="gd">-        // start effect after last queued effect has finished</span>
        <span class="gd">-        timestamp = this.effects.pluck(&#39;finishOn&#39;).max() || timestamp;</span>
        <span class="gd">-        break;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    effect.startOn  += timestamp;</span>
        <span class="gd">-    effect.finishOn += timestamp;</span>
        <span class="gd">-</span>
        <span class="gd">-    if (!effect.options.queue.limit || (this.effects.length &lt; effect.options.queue.limit))</span>
        <span class="gd">-      this.effects.push(effect);</span>
        <span class="gd">-</span>
        <span class="gd">-    if (!this.interval)</span>
        <span class="gd">-      this.interval = setInterval(this.loop.bind(this), 15);</span>
        <span class="gd">-  },</span>
        <span class="gd">-  remove: function(effect) {</span>
        <span class="gd">-    this.effects = this.effects.reject(function(e) { return e==effect });</span>
        <span class="gd">-    if (this.effects.length == 0) {</span>
        <span class="gd">-      clearInterval(this.interval);</span>
        <span class="gd">-      this.interval = null;</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gd">-  loop: function() {</span>
        <span class="gd">-    var timePos = new Date().getTime();</span>
        <span class="gd">-    for(var i=0, len=this.effects.length;i&lt;len;i++)</span>
        <span class="gd">-      this.effects[i] &amp;&amp; this.effects[i].loop(timePos);</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-Effect.Queues = {</span>
        <span class="gd">-  instances: $H(),</span>
        <span class="gd">-  get: function(queueName) {</span>
        <span class="gd">-    if (!Object.isString(queueName)) return queueName;</span>
        <span class="gd">-</span>
        <span class="gd">-    return this.instances.get(queueName) ||</span>
        <span class="gd">-      this.instances.set(queueName, new Effect.ScopedQueue());</span>
        <span class="gd">-  }</span>
        <span class="gd">-};</span>
        <span class="gd">-Effect.Queue = Effect.Queues.get(&#39;global&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-Effect.Base = Class.create({</span>
        <span class="gd">-  position: null,</span>
        <span class="gd">-  start: function(options) {</span>
        <span class="gd">-    if (options &amp;&amp; options.transition === false) options.transition = Effect.Transitions.linear;</span>
        <span class="gd">-    this.options      = Object.extend(Object.extend({ },Effect.DefaultOptions), options || { });</span>
        <span class="gd">-    this.currentFrame = 0;</span>
        <span class="gd">-    this.state        = &#39;idle&#39;;</span>
        <span class="gd">-    this.startOn      = this.options.delay*1000;</span>
        <span class="gd">-    this.finishOn     = this.startOn+(this.options.duration*1000);</span>
        <span class="gd">-    this.fromToDelta  = this.options.to-this.options.from;</span>
        <span class="gd">-    this.totalTime    = this.finishOn-this.startOn;</span>
        <span class="gd">-    this.totalFrames  = this.options.fps*this.options.duration;</span>
        <span class="gd">-</span>
        <span class="gd">-    this.render = (function() {</span>
        <span class="gd">-      function dispatch(effect, eventName) {</span>
        <span class="gd">-        if (effect.options[eventName + &#39;Internal&#39;])</span>
        <span class="gd">-          effect.options[eventName + &#39;Internal&#39;](effect);</span>
        <span class="gd">-        if (effect.options[eventName])</span>
        <span class="gd">-          effect.options[eventName](effect);</span>
        <span class="gd">-      }</span>
        <span class="gd">-</span>
        <span class="gd">-      return function(pos) {</span>
        <span class="gd">-        if (this.state === &quot;idle&quot;) {</span>
        <span class="gd">-          this.state = &quot;running&quot;;</span>
        <span class="gd">-          dispatch(this, &#39;beforeSetup&#39;);</span>
        <span class="gd">-          if (this.setup) this.setup();</span>
        <span class="gd">-          dispatch(this, &#39;afterSetup&#39;);</span>
        <span class="gd">-        }</span>
        <span class="gd">-        if (this.state === &quot;running&quot;) {</span>
        <span class="gd">-          pos = (this.options.transition(pos) * this.fromToDelta) + this.options.from;</span>
        <span class="gd">-          this.position = pos;</span>
        <span class="gd">-          dispatch(this, &#39;beforeUpdate&#39;);</span>
        <span class="gd">-          if (this.update) this.update(pos);</span>
        <span class="gd">-          dispatch(this, &#39;afterUpdate&#39;);</span>
        <span class="gd">-        }</span>
        <span class="gd">-      };</span>
        <span class="gd">-    })();</span>
        <span class="gd">-</span>
        <span class="gd">-    this.event(&#39;beforeStart&#39;);</span>
        <span class="gd">-    if (!this.options.sync)</span>
        <span class="gd">-      Effect.Queues.get(Object.isString(this.options.queue) ?</span>
        <span class="gd">-        &#39;global&#39; : this.options.queue.scope).add(this);</span>
        <span class="gd">-  },</span>
        <span class="gd">-  loop: function(timePos) {</span>
        <span class="gd">-    if (timePos &gt;= this.startOn) {</span>
        <span class="gd">-      if (timePos &gt;= this.finishOn) {</span>
        <span class="gd">-        this.render(1.0);</span>
        <span class="gd">-        this.cancel();</span>
        <span class="gd">-        this.event(&#39;beforeFinish&#39;);</span>
        <span class="gd">-        if (this.finish) this.finish();</span>
        <span class="gd">-        this.event(&#39;afterFinish&#39;);</span>
        <span class="gd">-        return;</span>
        <span class="gd">-      }</span>
        <span class="gd">-      var pos   = (timePos - this.startOn) / this.totalTime,</span>
        <span class="gd">-          frame = (pos * this.totalFrames).round();</span>
        <span class="gd">-      if (frame &gt; this.currentFrame) {</span>
        <span class="gd">-        this.render(pos);</span>
        <span class="gd">-        this.currentFrame = frame;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gd">-  cancel: function() {</span>
        <span class="gd">-    if (!this.options.sync)</span>
        <span class="gd">-      Effect.Queues.get(Object.isString(this.options.queue) ?</span>
        <span class="gd">-        &#39;global&#39; : this.options.queue.scope).remove(this);</span>
        <span class="gd">-    this.state = &#39;finished&#39;;</span>
        <span class="gd">-  },</span>
        <span class="gd">-  event: function(eventName) {</span>
        <span class="gd">-    if (this.options[eventName + &#39;Internal&#39;]) this.options[eventName + &#39;Internal&#39;](this);</span>
        <span class="gd">-    if (this.options[eventName]) this.options[eventName](this);</span>
        <span class="gd">-  },</span>
        <span class="gd">-  inspect: function() {</span>
        <span class="gd">-    var data = $H();</span>
        <span class="gd">-    for(property in this)</span>
        <span class="gd">-      if (!Object.isFunction(this[property])) data.set(property, this[property]);</span>
        <span class="gd">-    return &#39;#&lt;Effect:&#39; + data.inspect() + &#39;,options:&#39; + $H(this.options).inspect() + &#39;&gt;&#39;;</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-Effect.Parallel = Class.create(Effect.Base, {</span>
        <span class="gd">-  initialize: function(effects) {</span>
        <span class="gd">-    this.effects = effects || [];</span>
        <span class="gd">-    this.start(arguments[1]);</span>
        <span class="gd">-  },</span>
        <span class="gd">-  update: function(position) {</span>
        <span class="gd">-    this.effects.invoke(&#39;render&#39;, position);</span>
        <span class="gd">-  },</span>
        <span class="gd">-  finish: function(position) {</span>
        <span class="gd">-    this.effects.each( function(effect) {</span>
        <span class="gd">-      effect.render(1.0);</span>
        <span class="gd">-      effect.cancel();</span>
        <span class="gd">-      effect.event(&#39;beforeFinish&#39;);</span>
        <span class="gd">-      if (effect.finish) effect.finish(position);</span>
        <span class="gd">-      effect.event(&#39;afterFinish&#39;);</span>
        <span class="gd">-    });</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-Effect.Tween = Class.create(Effect.Base, {</span>
        <span class="gd">-  initialize: function(object, from, to) {</span>
        <span class="gd">-    object = Object.isString(object) ? $(object) : object;</span>
        <span class="gd">-    var args = $A(arguments), method = args.last(),</span>
        <span class="gd">-      options = args.length == 5 ? args[3] : null;</span>
        <span class="gd">-    this.method = Object.isFunction(method) ? method.bind(object) :</span>
        <span class="gd">-      Object.isFunction(object[method]) ? object[method].bind(object) :</span>
        <span class="gd">-      function(value) { object[method] = value };</span>
        <span class="gd">-    this.start(Object.extend({ from: from, to: to }, options || { }));</span>
        <span class="gd">-  },</span>
        <span class="gd">-  update: function(position) {</span>
        <span class="gd">-    this.method(position);</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-Effect.Event = Class.create(Effect.Base, {</span>
        <span class="gd">-  initialize: function() {</span>
        <span class="gd">-    this.start(Object.extend({ duration: 0 }, arguments[0] || { }));</span>
        <span class="gd">-  },</span>
        <span class="gd">-  update: Prototype.emptyFunction</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-Effect.Opacity = Class.create(Effect.Base, {</span>
        <span class="gd">-  initialize: function(element) {</span>
        <span class="gd">-    this.element = $(element);</span>
        <span class="gd">-    if (!this.element) throw(Effect._elementDoesNotExistError);</span>
        <span class="gd">-    // make this work on IE on elements without &#39;layout&#39;</span>
        <span class="gd">-    if (Prototype.Browser.IE &amp;&amp; (!this.element.currentStyle.hasLayout))</span>
        <span class="gd">-      this.element.setStyle({zoom: 1});</span>
        <span class="gd">-    var options = Object.extend({</span>
        <span class="gd">-      from: this.element.getOpacity() || 0.0,</span>
        <span class="gd">-      to:   1.0</span>
        <span class="gd">-    }, arguments[1] || { });</span>
        <span class="gd">-    this.start(options);</span>
        <span class="gd">-  },</span>
        <span class="gd">-  update: function(position) {</span>
        <span class="gd">-    this.element.setOpacity(position);</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-Effect.Move = Class.create(Effect.Base, {</span>
        <span class="gd">-  initialize: function(element) {</span>
        <span class="gd">-    this.element = $(element);</span>
        <span class="gd">-    if (!this.element) throw(Effect._elementDoesNotExistError);</span>
        <span class="gd">-    var options = Object.extend({</span>
        <span class="gd">-      x:    0,</span>
        <span class="gd">-      y:    0,</span>
        <span class="gd">-      mode: &#39;relative&#39;</span>
        <span class="gd">-    }, arguments[1] || { });</span>
        <span class="gd">-    this.start(options);</span>
        <span class="gd">-  },</span>
        <span class="gd">-  setup: function() {</span>
        <span class="gd">-    this.element.makePositioned();</span>
        <span class="gd">-    this.originalLeft = parseFloat(this.element.getStyle(&#39;left&#39;) || &#39;0&#39;);</span>
        <span class="gd">-    this.originalTop  = parseFloat(this.element.getStyle(&#39;top&#39;)  || &#39;0&#39;);</span>
        <span class="gd">-    if (this.options.mode == &#39;absolute&#39;) {</span>
        <span class="gd">-      this.options.x = this.options.x - this.originalLeft;</span>
        <span class="gd">-      this.options.y = this.options.y - this.originalTop;</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gd">-  update: function(position) {</span>
        <span class="gd">-    this.element.setStyle({</span>
        <span class="gd">-      left: (this.options.x  * position + this.originalLeft).round() + &#39;px&#39;,</span>
        <span class="gd">-      top:  (this.options.y  * position + this.originalTop).round()  + &#39;px&#39;</span>
        <span class="gd">-    });</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-// for backwards compatibility</span>
        <span class="gd">-Effect.MoveBy = function(element, toTop, toLeft) {</span>
        <span class="gd">-  return new Effect.Move(element,</span>
        <span class="gd">-    Object.extend({ x: toLeft, y: toTop }, arguments[3] || { }));</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Effect.Scale = Class.create(Effect.Base, {</span>
        <span class="gd">-  initialize: function(element, percent) {</span>
        <span class="gd">-    this.element = $(element);</span>
        <span class="gd">-    if (!this.element) throw(Effect._elementDoesNotExistError);</span>
        <span class="gd">-    var options = Object.extend({</span>
        <span class="gd">-      scaleX: true,</span>
        <span class="gd">-      scaleY: true,</span>
        <span class="gd">-      scaleContent: true,</span>
        <span class="gd">-      scaleFromCenter: false,</span>
        <span class="gd">-      scaleMode: &#39;box&#39;,        // &#39;box&#39; or &#39;contents&#39; or { } with provided values</span>
        <span class="gd">-      scaleFrom: 100.0,</span>
        <span class="gd">-      scaleTo:   percent</span>
        <span class="gd">-    }, arguments[2] || { });</span>
        <span class="gd">-    this.start(options);</span>
        <span class="gd">-  },</span>
        <span class="gd">-  setup: function() {</span>
        <span class="gd">-    this.restoreAfterFinish = this.options.restoreAfterFinish || false;</span>
        <span class="gd">-    this.elementPositioning = this.element.getStyle(&#39;position&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-    this.originalStyle = { };</span>
        <span class="gd">-    [&#39;top&#39;,&#39;left&#39;,&#39;width&#39;,&#39;height&#39;,&#39;fontSize&#39;].each( function(k) {</span>
        <span class="gd">-      this.originalStyle[k] = this.element.style[k];</span>
        <span class="gd">-    }.bind(this));</span>
        <span class="gd">-</span>
        <span class="gd">-    this.originalTop  = this.element.offsetTop;</span>
        <span class="gd">-    this.originalLeft = this.element.offsetLeft;</span>
        <span class="gd">-</span>
        <span class="gd">-    var fontSize = this.element.getStyle(&#39;font-size&#39;) || &#39;100%&#39;;</span>
        <span class="gd">-    [&#39;em&#39;,&#39;px&#39;,&#39;%&#39;,&#39;pt&#39;].each( function(fontSizeType) {</span>
        <span class="gd">-      if (fontSize.indexOf(fontSizeType)&gt;0) {</span>
        <span class="gd">-        this.fontSize     = parseFloat(fontSize);</span>
        <span class="gd">-        this.fontSizeType = fontSizeType;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }.bind(this));</span>
        <span class="gd">-</span>
        <span class="gd">-    this.factor = (this.options.scaleTo - this.options.scaleFrom)/100;</span>
        <span class="gd">-</span>
        <span class="gd">-    this.dims = null;</span>
        <span class="gd">-    if (this.options.scaleMode==&#39;box&#39;)</span>
        <span class="gd">-      this.dims = [this.element.offsetHeight, this.element.offsetWidth];</span>
        <span class="gd">-    if (/^content/.test(this.options.scaleMode))</span>
        <span class="gd">-      this.dims = [this.element.scrollHeight, this.element.scrollWidth];</span>
        <span class="gd">-    if (!this.dims)</span>
        <span class="gd">-      this.dims = [this.options.scaleMode.originalHeight,</span>
        <span class="gd">-                   this.options.scaleMode.originalWidth];</span>
        <span class="gd">-  },</span>
        <span class="gd">-  update: function(position) {</span>
        <span class="gd">-    var currentScale = (this.options.scaleFrom/100.0) + (this.factor * position);</span>
        <span class="gd">-    if (this.options.scaleContent &amp;&amp; this.fontSize)</span>
        <span class="gd">-      this.element.setStyle({fontSize: this.fontSize * currentScale + this.fontSizeType });</span>
        <span class="gd">-    this.setDimensions(this.dims[0] * currentScale, this.dims[1] * currentScale);</span>
        <span class="gd">-  },</span>
        <span class="gd">-  finish: function(position) {</span>
        <span class="gd">-    if (this.restoreAfterFinish) this.element.setStyle(this.originalStyle);</span>
        <span class="gd">-  },</span>
        <span class="gd">-  setDimensions: function(height, width) {</span>
        <span class="gd">-    var d = { };</span>
        <span class="gd">-    if (this.options.scaleX) d.width = width.round() + &#39;px&#39;;</span>
        <span class="gd">-    if (this.options.scaleY) d.height = height.round() + &#39;px&#39;;</span>
        <span class="gd">-    if (this.options.scaleFromCenter) {</span>
        <span class="gd">-      var topd  = (height - this.dims[0])/2;</span>
        <span class="gd">-      var leftd = (width  - this.dims[1])/2;</span>
        <span class="gd">-      if (this.elementPositioning == &#39;absolute&#39;) {</span>
        <span class="gd">-        if (this.options.scaleY) d.top = this.originalTop-topd + &#39;px&#39;;</span>
        <span class="gd">-        if (this.options.scaleX) d.left = this.originalLeft-leftd + &#39;px&#39;;</span>
        <span class="gd">-      } else {</span>
        <span class="gd">-        if (this.options.scaleY) d.top = -topd + &#39;px&#39;;</span>
        <span class="gd">-        if (this.options.scaleX) d.left = -leftd + &#39;px&#39;;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-    this.element.setStyle(d);</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-Effect.Highlight = Class.create(Effect.Base, {</span>
        <span class="gd">-  initialize: function(element) {</span>
        <span class="gd">-    this.element = $(element);</span>
        <span class="gd">-    if (!this.element) throw(Effect._elementDoesNotExistError);</span>
        <span class="gd">-    var options = Object.extend({ startcolor: &#39;#ffff99&#39; }, arguments[1] || { });</span>
        <span class="gd">-    this.start(options);</span>
        <span class="gd">-  },</span>
        <span class="gd">-  setup: function() {</span>
        <span class="gd">-    // Prevent executing on elements not in the layout flow</span>
        <span class="gd">-    if (this.element.getStyle(&#39;display&#39;)==&#39;none&#39;) { this.cancel(); return; }</span>
        <span class="gd">-    // Disable background image during the effect</span>
        <span class="gd">-    this.oldStyle = { };</span>
        <span class="gd">-    if (!this.options.keepBackgroundImage) {</span>
        <span class="gd">-      this.oldStyle.backgroundImage = this.element.getStyle(&#39;background-image&#39;);</span>
        <span class="gd">-      this.element.setStyle({backgroundImage: &#39;none&#39;});</span>
        <span class="gd">-    }</span>
        <span class="gd">-    if (!this.options.endcolor)</span>
        <span class="gd">-      this.options.endcolor = this.element.getStyle(&#39;background-color&#39;).parseColor(&#39;#ffffff&#39;);</span>
        <span class="gd">-    if (!this.options.restorecolor)</span>
        <span class="gd">-      this.options.restorecolor = this.element.getStyle(&#39;background-color&#39;);</span>
        <span class="gd">-    // init color calculations</span>
        <span class="gd">-    this._base  = $R(0,2).map(function(i){ return parseInt(this.options.startcolor.slice(i*2+1,i*2+3),16) }.bind(this));</span>
        <span class="gd">-    this._delta = $R(0,2).map(function(i){ return parseInt(this.options.endcolor.slice(i*2+1,i*2+3),16)-this._base[i] }.bind(this));</span>
        <span class="gd">-  },</span>
        <span class="gd">-  update: function(position) {</span>
        <span class="gd">-    this.element.setStyle({backgroundColor: $R(0,2).inject(&#39;#&#39;,function(m,v,i){</span>
        <span class="gd">-      return m+((this._base[i]+(this._delta[i]*position)).round().toColorPart()); }.bind(this)) });</span>
        <span class="gd">-  },</span>
        <span class="gd">-  finish: function() {</span>
        <span class="gd">-    this.element.setStyle(Object.extend(this.oldStyle, {</span>
        <span class="gd">-      backgroundColor: this.options.restorecolor</span>
        <span class="gd">-    }));</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-Effect.ScrollTo = function(element) {</span>
        <span class="gd">-  var options = arguments[1] || { },</span>
        <span class="gd">-  scrollOffsets = document.viewport.getScrollOffsets(),</span>
        <span class="gd">-  elementOffsets = $(element).cumulativeOffset();</span>
        <span class="gd">-</span>
        <span class="gd">-  if (options.offset) elementOffsets[1] += options.offset;</span>
        <span class="gd">-</span>
        <span class="gd">-  return new Effect.Tween(null,</span>
        <span class="gd">-    scrollOffsets.top,</span>
        <span class="gd">-    elementOffsets[1],</span>
        <span class="gd">-    options,</span>
        <span class="gd">-    function(p){ scrollTo(scrollOffsets.left, p.round()); }</span>
        <span class="gd">-  );</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-/* ------------- combination effects ------------- */</span>
        <span class="gd">-</span>
        <span class="gd">-Effect.Fade = function(element) {</span>
        <span class="gd">-  element = $(element);</span>
        <span class="gd">-  var oldOpacity = element.getInlineOpacity();</span>
        <span class="gd">-  var options = Object.extend({</span>
        <span class="gd">-    from: element.getOpacity() || 1.0,</span>
        <span class="gd">-    to:   0.0,</span>
        <span class="gd">-    afterFinishInternal: function(effect) {</span>
        <span class="gd">-      if (effect.options.to!=0) return;</span>
        <span class="gd">-      effect.element.hide().setStyle({opacity: oldOpacity});</span>
        <span class="gd">-    }</span>
        <span class="gd">-  }, arguments[1] || { });</span>
        <span class="gd">-  return new Effect.Opacity(element,options);</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Effect.Appear = function(element) {</span>
        <span class="gd">-  element = $(element);</span>
        <span class="gd">-  var options = Object.extend({</span>
        <span class="gd">-  from: (element.getStyle(&#39;display&#39;) == &#39;none&#39; ? 0.0 : element.getOpacity() || 0.0),</span>
        <span class="gd">-  to:   1.0,</span>
        <span class="gd">-  // force Safari to render floated elements properly</span>
        <span class="gd">-  afterFinishInternal: function(effect) {</span>
        <span class="gd">-    effect.element.forceRerendering();</span>
        <span class="gd">-  },</span>
        <span class="gd">-  beforeSetup: function(effect) {</span>
        <span class="gd">-    effect.element.setOpacity(effect.options.from).show();</span>
        <span class="gd">-  }}, arguments[1] || { });</span>
        <span class="gd">-  return new Effect.Opacity(element,options);</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Effect.Puff = function(element) {</span>
        <span class="gd">-  element = $(element);</span>
        <span class="gd">-  var oldStyle = {</span>
        <span class="gd">-    opacity: element.getInlineOpacity(),</span>
        <span class="gd">-    position: element.getStyle(&#39;position&#39;),</span>
        <span class="gd">-    top:  element.style.top,</span>
        <span class="gd">-    left: element.style.left,</span>
        <span class="gd">-    width: element.style.width,</span>
        <span class="gd">-    height: element.style.height</span>
        <span class="gd">-  };</span>
        <span class="gd">-  return new Effect.Parallel(</span>
        <span class="gd">-   [ new Effect.Scale(element, 200,</span>
        <span class="gd">-      { sync: true, scaleFromCenter: true, scaleContent: true, restoreAfterFinish: true }),</span>
        <span class="gd">-     new Effect.Opacity(element, { sync: true, to: 0.0 } ) ],</span>
        <span class="gd">-     Object.extend({ duration: 1.0,</span>
        <span class="gd">-      beforeSetupInternal: function(effect) {</span>
        <span class="gd">-        Position.absolutize(effect.effects[0].element);</span>
        <span class="gd">-      },</span>
        <span class="gd">-      afterFinishInternal: function(effect) {</span>
        <span class="gd">-         effect.effects[0].element.hide().setStyle(oldStyle); }</span>
        <span class="gd">-     }, arguments[1] || { })</span>
        <span class="gd">-   );</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Effect.BlindUp = function(element) {</span>
        <span class="gd">-  element = $(element);</span>
        <span class="gd">-  element.makeClipping();</span>
        <span class="gd">-  return new Effect.Scale(element, 0,</span>
        <span class="gd">-    Object.extend({ scaleContent: false,</span>
        <span class="gd">-      scaleX: false,</span>
        <span class="gd">-      restoreAfterFinish: true,</span>
        <span class="gd">-      afterFinishInternal: function(effect) {</span>
        <span class="gd">-        effect.element.hide().undoClipping();</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }, arguments[1] || { })</span>
        <span class="gd">-  );</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Effect.BlindDown = function(element) {</span>
        <span class="gd">-  element = $(element);</span>
        <span class="gd">-  var elementDimensions = element.getDimensions();</span>
        <span class="gd">-  return new Effect.Scale(element, 100, Object.extend({</span>
        <span class="gd">-    scaleContent: false,</span>
        <span class="gd">-    scaleX: false,</span>
        <span class="gd">-    scaleFrom: 0,</span>
        <span class="gd">-    scaleMode: {originalHeight: elementDimensions.height, originalWidth: elementDimensions.width},</span>
        <span class="gd">-    restoreAfterFinish: true,</span>
        <span class="gd">-    afterSetup: function(effect) {</span>
        <span class="gd">-      effect.element.makeClipping().setStyle({height: &#39;0px&#39;}).show();</span>
        <span class="gd">-    },</span>
        <span class="gd">-    afterFinishInternal: function(effect) {</span>
        <span class="gd">-      effect.element.undoClipping();</span>
        <span class="gd">-    }</span>
        <span class="gd">-  }, arguments[1] || { }));</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Effect.SwitchOff = function(element) {</span>
        <span class="gd">-  element = $(element);</span>
        <span class="gd">-  var oldOpacity = element.getInlineOpacity();</span>
        <span class="gd">-  return new Effect.Appear(element, Object.extend({</span>
        <span class="gd">-    duration: 0.4,</span>
        <span class="gd">-    from: 0,</span>
        <span class="gd">-    transition: Effect.Transitions.flicker,</span>
        <span class="gd">-    afterFinishInternal: function(effect) {</span>
        <span class="gd">-      new Effect.Scale(effect.element, 1, {</span>
        <span class="gd">-        duration: 0.3, scaleFromCenter: true,</span>
        <span class="gd">-        scaleX: false, scaleContent: false, restoreAfterFinish: true,</span>
        <span class="gd">-        beforeSetup: function(effect) {</span>
        <span class="gd">-          effect.element.makePositioned().makeClipping();</span>
        <span class="gd">-        },</span>
        <span class="gd">-        afterFinishInternal: function(effect) {</span>
        <span class="gd">-          effect.element.hide().undoClipping().undoPositioned().setStyle({opacity: oldOpacity});</span>
        <span class="gd">-        }</span>
        <span class="gd">-      });</span>
        <span class="gd">-    }</span>
        <span class="gd">-  }, arguments[1] || { }));</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Effect.DropOut = function(element) {</span>
        <span class="gd">-  element = $(element);</span>
        <span class="gd">-  var oldStyle = {</span>
        <span class="gd">-    top: element.getStyle(&#39;top&#39;),</span>
        <span class="gd">-    left: element.getStyle(&#39;left&#39;),</span>
        <span class="gd">-    opacity: element.getInlineOpacity() };</span>
        <span class="gd">-  return new Effect.Parallel(</span>
        <span class="gd">-    [ new Effect.Move(element, {x: 0, y: 100, sync: true }),</span>
        <span class="gd">-      new Effect.Opacity(element, { sync: true, to: 0.0 }) ],</span>
        <span class="gd">-    Object.extend(</span>
        <span class="gd">-      { duration: 0.5,</span>
        <span class="gd">-        beforeSetup: function(effect) {</span>
        <span class="gd">-          effect.effects[0].element.makePositioned();</span>
        <span class="gd">-        },</span>
        <span class="gd">-        afterFinishInternal: function(effect) {</span>
        <span class="gd">-          effect.effects[0].element.hide().undoPositioned().setStyle(oldStyle);</span>
        <span class="gd">-        }</span>
        <span class="gd">-      }, arguments[1] || { }));</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Effect.Shake = function(element) {</span>
        <span class="gd">-  element = $(element);</span>
        <span class="gd">-  var options = Object.extend({</span>
        <span class="gd">-    distance: 20,</span>
        <span class="gd">-    duration: 0.5</span>
        <span class="gd">-  }, arguments[1] || {});</span>
        <span class="gd">-  var distance = parseFloat(options.distance);</span>
        <span class="gd">-  var split = parseFloat(options.duration) / 10.0;</span>
        <span class="gd">-  var oldStyle = {</span>
        <span class="gd">-    top: element.getStyle(&#39;top&#39;),</span>
        <span class="gd">-    left: element.getStyle(&#39;left&#39;) };</span>
        <span class="gd">-    return new Effect.Move(element,</span>
        <span class="gd">-      { x:  distance, y: 0, duration: split, afterFinishInternal: function(effect) {</span>
        <span class="gd">-    new Effect.Move(effect.element,</span>
        <span class="gd">-      { x: -distance*2, y: 0, duration: split*2,  afterFinishInternal: function(effect) {</span>
        <span class="gd">-    new Effect.Move(effect.element,</span>
        <span class="gd">-      { x:  distance*2, y: 0, duration: split*2,  afterFinishInternal: function(effect) {</span>
        <span class="gd">-    new Effect.Move(effect.element,</span>
        <span class="gd">-      { x: -distance*2, y: 0, duration: split*2,  afterFinishInternal: function(effect) {</span>
        <span class="gd">-    new Effect.Move(effect.element,</span>
        <span class="gd">-      { x:  distance*2, y: 0, duration: split*2,  afterFinishInternal: function(effect) {</span>
        <span class="gd">-    new Effect.Move(effect.element,</span>
        <span class="gd">-      { x: -distance, y: 0, duration: split, afterFinishInternal: function(effect) {</span>
        <span class="gd">-        effect.element.undoPositioned().setStyle(oldStyle);</span>
        <span class="gd">-  }}); }}); }}); }}); }}); }});</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Effect.SlideDown = function(element) {</span>
        <span class="gd">-  element = $(element).cleanWhitespace();</span>
        <span class="gd">-  // SlideDown need to have the content of the element wrapped in a container element with fixed height!</span>
        <span class="gd">-  var oldInnerBottom = element.down().getStyle(&#39;bottom&#39;);</span>
        <span class="gd">-  var elementDimensions = element.getDimensions();</span>
        <span class="gd">-  return new Effect.Scale(element, 100, Object.extend({</span>
        <span class="gd">-    scaleContent: false,</span>
        <span class="gd">-    scaleX: false,</span>
        <span class="gd">-    scaleFrom: window.opera ? 0 : 1,</span>
        <span class="gd">-    scaleMode: {originalHeight: elementDimensions.height, originalWidth: elementDimensions.width},</span>
        <span class="gd">-    restoreAfterFinish: true,</span>
        <span class="gd">-    afterSetup: function(effect) {</span>
        <span class="gd">-      effect.element.makePositioned();</span>
        <span class="gd">-      effect.element.down().makePositioned();</span>
        <span class="gd">-      if (window.opera) effect.element.setStyle({top: &#39;&#39;});</span>
        <span class="gd">-      effect.element.makeClipping().setStyle({height: &#39;0px&#39;}).show();</span>
        <span class="gd">-    },</span>
        <span class="gd">-    afterUpdateInternal: function(effect) {</span>
        <span class="gd">-      effect.element.down().setStyle({bottom:</span>
        <span class="gd">-        (effect.dims[0] - effect.element.clientHeight) + &#39;px&#39; });</span>
        <span class="gd">-    },</span>
        <span class="gd">-    afterFinishInternal: function(effect) {</span>
        <span class="gd">-      effect.element.undoClipping().undoPositioned();</span>
        <span class="gd">-      effect.element.down().undoPositioned().setStyle({bottom: oldInnerBottom}); }</span>
        <span class="gd">-    }, arguments[1] || { })</span>
        <span class="gd">-  );</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Effect.SlideUp = function(element) {</span>
        <span class="gd">-  element = $(element).cleanWhitespace();</span>
        <span class="gd">-  var oldInnerBottom = element.down().getStyle(&#39;bottom&#39;);</span>
        <span class="gd">-  var elementDimensions = element.getDimensions();</span>
        <span class="gd">-  return new Effect.Scale(element, window.opera ? 0 : 1,</span>
        <span class="gd">-   Object.extend({ scaleContent: false,</span>
        <span class="gd">-    scaleX: false,</span>
        <span class="gd">-    scaleMode: &#39;box&#39;,</span>
        <span class="gd">-    scaleFrom: 100,</span>
        <span class="gd">-    scaleMode: {originalHeight: elementDimensions.height, originalWidth: elementDimensions.width},</span>
        <span class="gd">-    restoreAfterFinish: true,</span>
        <span class="gd">-    afterSetup: function(effect) {</span>
        <span class="gd">-      effect.element.makePositioned();</span>
        <span class="gd">-      effect.element.down().makePositioned();</span>
        <span class="gd">-      if (window.opera) effect.element.setStyle({top: &#39;&#39;});</span>
        <span class="gd">-      effect.element.makeClipping().show();</span>
        <span class="gd">-    },</span>
        <span class="gd">-    afterUpdateInternal: function(effect) {</span>
        <span class="gd">-      effect.element.down().setStyle({bottom:</span>
        <span class="gd">-        (effect.dims[0] - effect.element.clientHeight) + &#39;px&#39; });</span>
        <span class="gd">-    },</span>
        <span class="gd">-    afterFinishInternal: function(effect) {</span>
        <span class="gd">-      effect.element.hide().undoClipping().undoPositioned();</span>
        <span class="gd">-      effect.element.down().undoPositioned().setStyle({bottom: oldInnerBottom});</span>
        <span class="gd">-    }</span>
        <span class="gd">-   }, arguments[1] || { })</span>
        <span class="gd">-  );</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-// Bug in opera makes the TD containing this element expand for a instance after finish</span>
        <span class="gd">-Effect.Squish = function(element) {</span>
        <span class="gd">-  return new Effect.Scale(element, window.opera ? 1 : 0, {</span>
        <span class="gd">-    restoreAfterFinish: true,</span>
        <span class="gd">-    beforeSetup: function(effect) {</span>
        <span class="gd">-      effect.element.makeClipping();</span>
        <span class="gd">-    },</span>
        <span class="gd">-    afterFinishInternal: function(effect) {</span>
        <span class="gd">-      effect.element.hide().undoClipping();</span>
        <span class="gd">-    }</span>
        <span class="gd">-  });</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Effect.Grow = function(element) {</span>
        <span class="gd">-  element = $(element);</span>
        <span class="gd">-  var options = Object.extend({</span>
        <span class="gd">-    direction: &#39;center&#39;,</span>
        <span class="gd">-    moveTransition: Effect.Transitions.sinoidal,</span>
        <span class="gd">-    scaleTransition: Effect.Transitions.sinoidal,</span>
        <span class="gd">-    opacityTransition: Effect.Transitions.full</span>
        <span class="gd">-  }, arguments[1] || { });</span>
        <span class="gd">-  var oldStyle = {</span>
        <span class="gd">-    top: element.style.top,</span>
        <span class="gd">-    left: element.style.left,</span>
        <span class="gd">-    height: element.style.height,</span>
        <span class="gd">-    width: element.style.width,</span>
        <span class="gd">-    opacity: element.getInlineOpacity() };</span>
        <span class="gd">-</span>
        <span class="gd">-  var dims = element.getDimensions();</span>
        <span class="gd">-  var initialMoveX, initialMoveY;</span>
        <span class="gd">-  var moveX, moveY;</span>
        <span class="gd">-</span>
        <span class="gd">-  switch (options.direction) {</span>
        <span class="gd">-    case &#39;top-left&#39;:</span>
        <span class="gd">-      initialMoveX = initialMoveY = moveX = moveY = 0;</span>
        <span class="gd">-      break;</span>
        <span class="gd">-    case &#39;top-right&#39;:</span>
        <span class="gd">-      initialMoveX = dims.width;</span>
        <span class="gd">-      initialMoveY = moveY = 0;</span>
        <span class="gd">-      moveX = -dims.width;</span>
        <span class="gd">-      break;</span>
        <span class="gd">-    case &#39;bottom-left&#39;:</span>
        <span class="gd">-      initialMoveX = moveX = 0;</span>
        <span class="gd">-      initialMoveY = dims.height;</span>
        <span class="gd">-      moveY = -dims.height;</span>
        <span class="gd">-      break;</span>
        <span class="gd">-    case &#39;bottom-right&#39;:</span>
        <span class="gd">-      initialMoveX = dims.width;</span>
        <span class="gd">-      initialMoveY = dims.height;</span>
        <span class="gd">-      moveX = -dims.width;</span>
        <span class="gd">-      moveY = -dims.height;</span>
        <span class="gd">-      break;</span>
        <span class="gd">-    case &#39;center&#39;:</span>
        <span class="gd">-      initialMoveX = dims.width / 2;</span>
        <span class="gd">-      initialMoveY = dims.height / 2;</span>
        <span class="gd">-      moveX = -dims.width / 2;</span>
        <span class="gd">-      moveY = -dims.height / 2;</span>
        <span class="gd">-      break;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  return new Effect.Move(element, {</span>
        <span class="gd">-    x: initialMoveX,</span>
        <span class="gd">-    y: initialMoveY,</span>
        <span class="gd">-    duration: 0.01,</span>
        <span class="gd">-    beforeSetup: function(effect) {</span>
        <span class="gd">-      effect.element.hide().makeClipping().makePositioned();</span>
        <span class="gd">-    },</span>
        <span class="gd">-    afterFinishInternal: function(effect) {</span>
        <span class="gd">-      new Effect.Parallel(</span>
        <span class="gd">-        [ new Effect.Opacity(effect.element, { sync: true, to: 1.0, from: 0.0, transition: options.opacityTransition }),</span>
        <span class="gd">-          new Effect.Move(effect.element, { x: moveX, y: moveY, sync: true, transition: options.moveTransition }),</span>
        <span class="gd">-          new Effect.Scale(effect.element, 100, {</span>
        <span class="gd">-            scaleMode: { originalHeight: dims.height, originalWidth: dims.width },</span>
        <span class="gd">-            sync: true, scaleFrom: window.opera ? 1 : 0, transition: options.scaleTransition, restoreAfterFinish: true})</span>
        <span class="gd">-        ], Object.extend({</span>
        <span class="gd">-             beforeSetup: function(effect) {</span>
        <span class="gd">-               effect.effects[0].element.setStyle({height: &#39;0px&#39;}).show();</span>
        <span class="gd">-             },</span>
        <span class="gd">-             afterFinishInternal: function(effect) {</span>
        <span class="gd">-               effect.effects[0].element.undoClipping().undoPositioned().setStyle(oldStyle);</span>
        <span class="gd">-             }</span>
        <span class="gd">-           }, options)</span>
        <span class="gd">-      );</span>
        <span class="gd">-    }</span>
        <span class="gd">-  });</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Effect.Shrink = function(element) {</span>
        <span class="gd">-  element = $(element);</span>
        <span class="gd">-  var options = Object.extend({</span>
        <span class="gd">-    direction: &#39;center&#39;,</span>
        <span class="gd">-    moveTransition: Effect.Transitions.sinoidal,</span>
        <span class="gd">-    scaleTransition: Effect.Transitions.sinoidal,</span>
        <span class="gd">-    opacityTransition: Effect.Transitions.none</span>
        <span class="gd">-  }, arguments[1] || { });</span>
        <span class="gd">-  var oldStyle = {</span>
        <span class="gd">-    top: element.style.top,</span>
        <span class="gd">-    left: element.style.left,</span>
        <span class="gd">-    height: element.style.height,</span>
        <span class="gd">-    width: element.style.width,</span>
        <span class="gd">-    opacity: element.getInlineOpacity() };</span>
        <span class="gd">-</span>
        <span class="gd">-  var dims = element.getDimensions();</span>
        <span class="gd">-  var moveX, moveY;</span>
        <span class="gd">-</span>
        <span class="gd">-  switch (options.direction) {</span>
        <span class="gd">-    case &#39;top-left&#39;:</span>
        <span class="gd">-      moveX = moveY = 0;</span>
        <span class="gd">-      break;</span>
        <span class="gd">-    case &#39;top-right&#39;:</span>
        <span class="gd">-      moveX = dims.width;</span>
        <span class="gd">-      moveY = 0;</span>
        <span class="gd">-      break;</span>
        <span class="gd">-    case &#39;bottom-left&#39;:</span>
        <span class="gd">-      moveX = 0;</span>
        <span class="gd">-      moveY = dims.height;</span>
        <span class="gd">-      break;</span>
        <span class="gd">-    case &#39;bottom-right&#39;:</span>
        <span class="gd">-      moveX = dims.width;</span>
        <span class="gd">-      moveY = dims.height;</span>
        <span class="gd">-      break;</span>
        <span class="gd">-    case &#39;center&#39;:</span>
        <span class="gd">-      moveX = dims.width / 2;</span>
        <span class="gd">-      moveY = dims.height / 2;</span>
        <span class="gd">-      break;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  return new Effect.Parallel(</span>
        <span class="gd">-    [ new Effect.Opacity(element, { sync: true, to: 0.0, from: 1.0, transition: options.opacityTransition }),</span>
        <span class="gd">-      new Effect.Scale(element, window.opera ? 1 : 0, { sync: true, transition: options.scaleTransition, restoreAfterFinish: true}),</span>
        <span class="gd">-      new Effect.Move(element, { x: moveX, y: moveY, sync: true, transition: options.moveTransition })</span>
        <span class="gd">-    ], Object.extend({</span>
        <span class="gd">-         beforeStartInternal: function(effect) {</span>
        <span class="gd">-           effect.effects[0].element.makePositioned().makeClipping();</span>
        <span class="gd">-         },</span>
        <span class="gd">-         afterFinishInternal: function(effect) {</span>
        <span class="gd">-           effect.effects[0].element.hide().undoClipping().undoPositioned().setStyle(oldStyle); }</span>
        <span class="gd">-       }, options)</span>
        <span class="gd">-  );</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Effect.Pulsate = function(element) {</span>
        <span class="gd">-  element = $(element);</span>
        <span class="gd">-  var options    = arguments[1] || { },</span>
        <span class="gd">-    oldOpacity = element.getInlineOpacity(),</span>
        <span class="gd">-    transition = options.transition || Effect.Transitions.linear,</span>
        <span class="gd">-    reverser   = function(pos){</span>
        <span class="gd">-      return 1 - transition((-Math.cos((pos*(options.pulses||5)*2)*Math.PI)/2) + .5);</span>
        <span class="gd">-    };</span>
        <span class="gd">-</span>
        <span class="gd">-  return new Effect.Opacity(element,</span>
        <span class="gd">-    Object.extend(Object.extend({  duration: 2.0, from: 0,</span>
        <span class="gd">-      afterFinishInternal: function(effect) { effect.element.setStyle({opacity: oldOpacity}); }</span>
        <span class="gd">-    }, options), {transition: reverser}));</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Effect.Fold = function(element) {</span>
        <span class="gd">-  element = $(element);</span>
        <span class="gd">-  var oldStyle = {</span>
        <span class="gd">-    top: element.style.top,</span>
        <span class="gd">-    left: element.style.left,</span>
        <span class="gd">-    width: element.style.width,</span>
        <span class="gd">-    height: element.style.height };</span>
        <span class="gd">-  element.makeClipping();</span>
        <span class="gd">-  return new Effect.Scale(element, 5, Object.extend({</span>
        <span class="gd">-    scaleContent: false,</span>
        <span class="gd">-    scaleX: false,</span>
        <span class="gd">-    afterFinishInternal: function(effect) {</span>
        <span class="gd">-    new Effect.Scale(element, 1, {</span>
        <span class="gd">-      scaleContent: false,</span>
        <span class="gd">-      scaleY: false,</span>
        <span class="gd">-      afterFinishInternal: function(effect) {</span>
        <span class="gd">-        effect.element.hide().undoClipping().setStyle(oldStyle);</span>
        <span class="gd">-      } });</span>
        <span class="gd">-  }}, arguments[1] || { }));</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Effect.Morph = Class.create(Effect.Base, {</span>
        <span class="gd">-  initialize: function(element) {</span>
        <span class="gd">-    this.element = $(element);</span>
        <span class="gd">-    if (!this.element) throw(Effect._elementDoesNotExistError);</span>
        <span class="gd">-    var options = Object.extend({</span>
        <span class="gd">-      style: { }</span>
        <span class="gd">-    }, arguments[1] || { });</span>
        <span class="gd">-</span>
        <span class="gd">-    if (!Object.isString(options.style)) this.style = $H(options.style);</span>
        <span class="gd">-    else {</span>
        <span class="gd">-      if (options.style.include(&#39;:&#39;))</span>
        <span class="gd">-        this.style = options.style.parseStyle();</span>
        <span class="gd">-      else {</span>
        <span class="gd">-        this.element.addClassName(options.style);</span>
        <span class="gd">-        this.style = $H(this.element.getStyles());</span>
        <span class="gd">-        this.element.removeClassName(options.style);</span>
        <span class="gd">-        var css = this.element.getStyles();</span>
        <span class="gd">-        this.style = this.style.reject(function(style) {</span>
        <span class="gd">-          return style.value == css[style.key];</span>
        <span class="gd">-        });</span>
        <span class="gd">-        options.afterFinishInternal = function(effect) {</span>
        <span class="gd">-          effect.element.addClassName(effect.options.style);</span>
        <span class="gd">-          effect.transforms.each(function(transform) {</span>
        <span class="gd">-            effect.element.style[transform.style] = &#39;&#39;;</span>
        <span class="gd">-          });</span>
        <span class="gd">-        };</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-    this.start(options);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  setup: function(){</span>
        <span class="gd">-    function parseColor(color){</span>
        <span class="gd">-      if (!color || [&#39;rgba(0, 0, 0, 0)&#39;,&#39;transparent&#39;].include(color)) color = &#39;#ffffff&#39;;</span>
        <span class="gd">-      color = color.parseColor();</span>
        <span class="gd">-      return $R(0,2).map(function(i){</span>
        <span class="gd">-        return parseInt( color.slice(i*2+1,i*2+3), 16 );</span>
        <span class="gd">-      });</span>
        <span class="gd">-    }</span>
        <span class="gd">-    this.transforms = this.style.map(function(pair){</span>
        <span class="gd">-      var property = pair[0], value = pair[1], unit = null;</span>
        <span class="gd">-</span>
        <span class="gd">-      if (value.parseColor(&#39;#zzzzzz&#39;) != &#39;#zzzzzz&#39;) {</span>
        <span class="gd">-        value = value.parseColor();</span>
        <span class="gd">-        unit  = &#39;color&#39;;</span>
        <span class="gd">-      } else if (property == &#39;opacity&#39;) {</span>
        <span class="gd">-        value = parseFloat(value);</span>
        <span class="gd">-        if (Prototype.Browser.IE &amp;&amp; (!this.element.currentStyle.hasLayout))</span>
        <span class="gd">-          this.element.setStyle({zoom: 1});</span>
        <span class="gd">-      } else if (Element.CSS_LENGTH.test(value)) {</span>
        <span class="gd">-          var components = value.match(/^([\+\-]?[0-9\.]+)(.*)$/);</span>
        <span class="gd">-          value = parseFloat(components[1]);</span>
        <span class="gd">-          unit = (components.length == 3) ? components[2] : null;</span>
        <span class="gd">-      }</span>
        <span class="gd">-</span>
        <span class="gd">-      var originalValue = this.element.getStyle(property);</span>
        <span class="gd">-      return {</span>
        <span class="gd">-        style: property.camelize(),</span>
        <span class="gd">-        originalValue: unit==&#39;color&#39; ? parseColor(originalValue) : parseFloat(originalValue || 0),</span>
        <span class="gd">-        targetValue: unit==&#39;color&#39; ? parseColor(value) : value,</span>
        <span class="gd">-        unit: unit</span>
        <span class="gd">-      };</span>
        <span class="gd">-    }.bind(this)).reject(function(transform){</span>
        <span class="gd">-      return (</span>
        <span class="gd">-        (transform.originalValue == transform.targetValue) ||</span>
        <span class="gd">-        (</span>
        <span class="gd">-          transform.unit != &#39;color&#39; &amp;&amp;</span>
        <span class="gd">-          (isNaN(transform.originalValue) || isNaN(transform.targetValue))</span>
        <span class="gd">-        )</span>
        <span class="gd">-      );</span>
        <span class="gd">-    });</span>
        <span class="gd">-  },</span>
        <span class="gd">-  update: function(position) {</span>
        <span class="gd">-    var style = { }, transform, i = this.transforms.length;</span>
        <span class="gd">-    while(i--)</span>
        <span class="gd">-      style[(transform = this.transforms[i]).style] =</span>
        <span class="gd">-        transform.unit==&#39;color&#39; ? &#39;#&#39;+</span>
        <span class="gd">-          (Math.round(transform.originalValue[0]+</span>
        <span class="gd">-            (transform.targetValue[0]-transform.originalValue[0])*position)).toColorPart() +</span>
        <span class="gd">-          (Math.round(transform.originalValue[1]+</span>
        <span class="gd">-            (transform.targetValue[1]-transform.originalValue[1])*position)).toColorPart() +</span>
        <span class="gd">-          (Math.round(transform.originalValue[2]+</span>
        <span class="gd">-            (transform.targetValue[2]-transform.originalValue[2])*position)).toColorPart() :</span>
        <span class="gd">-        (transform.originalValue +</span>
        <span class="gd">-          (transform.targetValue - transform.originalValue) * position).toFixed(3) +</span>
        <span class="gd">-            (transform.unit === null ? &#39;&#39; : transform.unit);</span>
        <span class="gd">-    this.element.setStyle(style, true);</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-Effect.Transform = Class.create({</span>
        <span class="gd">-  initialize: function(tracks){</span>
        <span class="gd">-    this.tracks  = [];</span>
        <span class="gd">-    this.options = arguments[1] || { };</span>
        <span class="gd">-    this.addTracks(tracks);</span>
        <span class="gd">-  },</span>
        <span class="gd">-  addTracks: function(tracks){</span>
        <span class="gd">-    tracks.each(function(track){</span>
        <span class="gd">-      track = $H(track);</span>
        <span class="gd">-      var data = track.values().first();</span>
        <span class="gd">-      this.tracks.push($H({</span>
        <span class="gd">-        ids:     track.keys().first(),</span>
        <span class="gd">-        effect:  Effect.Morph,</span>
        <span class="gd">-        options: { style: data }</span>
        <span class="gd">-      }));</span>
        <span class="gd">-    }.bind(this));</span>
        <span class="gd">-    return this;</span>
        <span class="gd">-  },</span>
        <span class="gd">-  play: function(){</span>
        <span class="gd">-    return new Effect.Parallel(</span>
        <span class="gd">-      this.tracks.map(function(track){</span>
        <span class="gd">-        var ids = track.get(&#39;ids&#39;), effect = track.get(&#39;effect&#39;), options = track.get(&#39;options&#39;);</span>
        <span class="gd">-        var elements = [$(ids) || $$(ids)].flatten();</span>
        <span class="gd">-        return elements.map(function(e){ return new effect(e, Object.extend({ sync:true }, options)) });</span>
        <span class="gd">-      }).flatten(),</span>
        <span class="gd">-      this.options</span>
        <span class="gd">-    );</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-Element.CSS_PROPERTIES = $w(</span>
        <span class="gd">-  &#39;backgroundColor backgroundPosition borderBottomColor borderBottomStyle &#39; +</span>
        <span class="gd">-  &#39;borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth &#39; +</span>
        <span class="gd">-  &#39;borderRightColor borderRightStyle borderRightWidth borderSpacing &#39; +</span>
        <span class="gd">-  &#39;borderTopColor borderTopStyle borderTopWidth bottom clip color &#39; +</span>
        <span class="gd">-  &#39;fontSize fontWeight height left letterSpacing lineHeight &#39; +</span>
        <span class="gd">-  &#39;marginBottom marginLeft marginRight marginTop markerOffset maxHeight &#39;+</span>
        <span class="gd">-  &#39;maxWidth minHeight minWidth opacity outlineColor outlineOffset &#39; +</span>
        <span class="gd">-  &#39;outlineWidth paddingBottom paddingLeft paddingRight paddingTop &#39; +</span>
        <span class="gd">-  &#39;right textIndent top width wordSpacing zIndex&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-Element.CSS_LENGTH = /^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;</span>
        <span class="gd">-</span>
        <span class="gd">-String.__parseStyleElement = document.createElement(&#39;div&#39;);</span>
        <span class="gd">-String.prototype.parseStyle = function(){</span>
        <span class="gd">-  var style, styleRules = $H();</span>
        <span class="gd">-  if (Prototype.Browser.WebKit)</span>
        <span class="gd">-    style = new Element(&#39;div&#39;,{style:this}).style;</span>
        <span class="gd">-  else {</span>
        <span class="gd">-    String.__parseStyleElement.innerHTML = &#39;&lt;div style=&quot;&#39; + this + &#39;&quot;&gt;&lt;/div&gt;&#39;;</span>
        <span class="gd">-    style = String.__parseStyleElement.childNodes[0].style;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  Element.CSS_PROPERTIES.each(function(property){</span>
        <span class="gd">-    if (style[property]) styleRules.set(property, style[property]);</span>
        <span class="gd">-  });</span>
        <span class="gd">-</span>
        <span class="gd">-  if (Prototype.Browser.IE &amp;&amp; this.include(&#39;opacity&#39;))</span>
        <span class="gd">-    styleRules.set(&#39;opacity&#39;, this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1]);</span>
        <span class="gd">-</span>
        <span class="gd">-  return styleRules;</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-if (document.defaultView &amp;&amp; document.defaultView.getComputedStyle) {</span>
        <span class="gd">-  Element.getStyles = function(element) {</span>
        <span class="gd">-    var css = document.defaultView.getComputedStyle($(element), null);</span>
        <span class="gd">-    return Element.CSS_PROPERTIES.inject({ }, function(styles, property) {</span>
        <span class="gd">-      styles[property] = css[property];</span>
        <span class="gd">-      return styles;</span>
        <span class="gd">-    });</span>
        <span class="gd">-  };</span>
        <span class="gd">-} else {</span>
        <span class="gd">-  Element.getStyles = function(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    var css = element.currentStyle, styles;</span>
        <span class="gd">-    styles = Element.CSS_PROPERTIES.inject({ }, function(results, property) {</span>
        <span class="gd">-      results[property] = css[property];</span>
        <span class="gd">-      return results;</span>
        <span class="gd">-    });</span>
        <span class="gd">-    if (!styles.opacity) styles.opacity = element.getOpacity();</span>
        <span class="gd">-    return styles;</span>
        <span class="gd">-  };</span>
        <span class="gd">-}</span>
        <span class="gd">-</span>
        <span class="gd">-Effect.Methods = {</span>
        <span class="gd">-  morph: function(element, style) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    new Effect.Morph(element, Object.extend({ style: style }, arguments[2] || { }));</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  },</span>
        <span class="gd">-  visualEffect: function(element, effect, options) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    var s = effect.dasherize().camelize(), klass = s.charAt(0).toUpperCase() + s.substring(1);</span>
        <span class="gd">-    new Effect[klass](element, options);</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  },</span>
        <span class="gd">-  highlight: function(element, options) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    new Effect.Highlight(element, options);</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  }</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-$w(&#39;fade appear grow shrink fold blindUp blindDown slideUp slideDown &#39;+</span>
        <span class="gd">-  &#39;pulsate shake puff squish switchOff dropOut&#39;).each(</span>
        <span class="gd">-  function(effect) {</span>
        <span class="gd">-    Effect.Methods[effect] = function(element, options){</span>
        <span class="gd">-      element = $(element);</span>
        <span class="gd">-      Effect[effect.charAt(0).toUpperCase() + effect.substring(1)](element, options);</span>
        <span class="gd">-      return element;</span>
        <span class="gd">-    };</span>
        <span class="gd">-  }</span>
        <span class="gd">-);</span>
        <span class="gd">-</span>
        <span class="gd">-$w(&#39;getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles&#39;).each(</span>
        <span class="gd">-  function(f) { Effect.Methods[f] = Element[f]; }</span>
        <span class="gd">-);</span>
        <span class="gd">-</span>
        <span class="gd">-Element.addMethods(Effect.Methods);</span>
        \ No newline at end of file
        </pre></div>
        <h2>
          <a href='full/#public-javascripts-prototype-js'>public/javascripts/prototype.js</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -1,6001 +0,0 @@</span>
        <span class="gd">-/*  Prototype JavaScript framework, version 1.7_rc2</span>
        <span class="gd">- *  (c) 2005-2010 Sam Stephenson</span>
        <span class="gd">- *</span>
        <span class="gd">- *  Prototype is freely distributable under the terms of an MIT-style license.</span>
        <span class="gd">- *  For details, see the Prototype web site: http://www.prototypejs.org/</span>
        <span class="gd">- *</span>
        <span class="gd">- *--------------------------------------------------------------------------*/</span>
        <span class="gd">-</span>
        <span class="gd">-var Prototype = {</span>
        <span class="gd">-</span>
        <span class="gd">-  Version: &#39;1.7_rc2&#39;,</span>
        <span class="gd">-</span>
        <span class="gd">-  Browser: (function(){</span>
        <span class="gd">-    var ua = navigator.userAgent;</span>
        <span class="gd">-    var isOpera = Object.prototype.toString.call(window.opera) == &#39;[object Opera]&#39;;</span>
        <span class="gd">-    return {</span>
        <span class="gd">-      IE:             !!window.attachEvent &amp;&amp; !isOpera,</span>
        <span class="gd">-      Opera:          isOpera,</span>
        <span class="gd">-      WebKit:         ua.indexOf(&#39;AppleWebKit/&#39;) &gt; -1,</span>
        <span class="gd">-      Gecko:          ua.indexOf(&#39;Gecko&#39;) &gt; -1 &amp;&amp; ua.indexOf(&#39;KHTML&#39;) === -1,</span>
        <span class="gd">-      MobileSafari:   /Apple.*Mobile/.test(ua)</span>
        <span class="gd">-    }</span>
        <span class="gd">-  })(),</span>
        <span class="gd">-</span>
        <span class="gd">-  BrowserFeatures: {</span>
        <span class="gd">-    XPath: !!document.evaluate,</span>
        <span class="gd">-</span>
        <span class="gd">-    SelectorsAPI: !!document.querySelector,</span>
        <span class="gd">-</span>
        <span class="gd">-    ElementExtensions: (function() {</span>
        <span class="gd">-      var constructor = window.Element || window.HTMLElement;</span>
        <span class="gd">-      return !!(constructor &amp;&amp; constructor.prototype);</span>
        <span class="gd">-    })(),</span>
        <span class="gd">-    SpecificElementExtensions: (function() {</span>
        <span class="gd">-      if (typeof window.HTMLDivElement !== &#39;undefined&#39;)</span>
        <span class="gd">-        return true;</span>
        <span class="gd">-</span>
        <span class="gd">-      var div = document.createElement(&#39;div&#39;),</span>
        <span class="gd">-          form = document.createElement(&#39;form&#39;),</span>
        <span class="gd">-          isSupported = false;</span>
        <span class="gd">-</span>
        <span class="gd">-      if (div[&#39;__proto__&#39;] &amp;&amp; (div[&#39;__proto__&#39;] !== form[&#39;__proto__&#39;])) {</span>
        <span class="gd">-        isSupported = true;</span>
        <span class="gd">-      }</span>
        <span class="gd">-</span>
        <span class="gd">-      div = form = null;</span>
        <span class="gd">-</span>
        <span class="gd">-      return isSupported;</span>
        <span class="gd">-    })()</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  ScriptFragment: &#39;&lt;script[^&gt;]*&gt;([\\S\\s]*?)&lt;\/script&gt;&#39;,</span>
        <span class="gd">-  JSONFilter: /^\/\*-secure-([\s\S]*)\*\/\s*$/,</span>
        <span class="gd">-</span>
        <span class="gd">-  emptyFunction: function() { },</span>
        <span class="gd">-</span>
        <span class="gd">-  K: function(x) { return x }</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-if (Prototype.Browser.MobileSafari)</span>
        <span class="gd">-  Prototype.BrowserFeatures.SpecificElementExtensions = false;</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-var Abstract = { };</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-var Try = {</span>
        <span class="gd">-  these: function() {</span>
        <span class="gd">-    var returnValue;</span>
        <span class="gd">-</span>
        <span class="gd">-    for (var i = 0, length = arguments.length; i &lt; length; i++) {</span>
        <span class="gd">-      var lambda = arguments[i];</span>
        <span class="gd">-      try {</span>
        <span class="gd">-        returnValue = lambda();</span>
        <span class="gd">-        break;</span>
        <span class="gd">-      } catch (e) { }</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    return returnValue;</span>
        <span class="gd">-  }</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-/* Based on Alex Arnell&#39;s inheritance implementation. */</span>
        <span class="gd">-</span>
        <span class="gd">-var Class = (function() {</span>
        <span class="gd">-</span>
        <span class="gd">-  var IS_DONTENUM_BUGGY = (function(){</span>
        <span class="gd">-    for (var p in { toString: 1 }) {</span>
        <span class="gd">-      if (p === &#39;toString&#39;) return false;</span>
        <span class="gd">-    }</span>
        <span class="gd">-    return true;</span>
        <span class="gd">-  })();</span>
        <span class="gd">-</span>
        <span class="gd">-  function subclass() {};</span>
        <span class="gd">-  function create() {</span>
        <span class="gd">-    var parent = null, properties = $A(arguments);</span>
        <span class="gd">-    if (Object.isFunction(properties[0]))</span>
        <span class="gd">-      parent = properties.shift();</span>
        <span class="gd">-</span>
        <span class="gd">-    function klass() {</span>
        <span class="gd">-      this.initialize.apply(this, arguments);</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    Object.extend(klass, Class.Methods);</span>
        <span class="gd">-    klass.superclass = parent;</span>
        <span class="gd">-    klass.subclasses = [];</span>
        <span class="gd">-</span>
        <span class="gd">-    if (parent) {</span>
        <span class="gd">-      subclass.prototype = parent.prototype;</span>
        <span class="gd">-      klass.prototype = new subclass;</span>
        <span class="gd">-      parent.subclasses.push(klass);</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    for (var i = 0, length = properties.length; i &lt; length; i++)</span>
        <span class="gd">-      klass.addMethods(properties[i]);</span>
        <span class="gd">-</span>
        <span class="gd">-    if (!klass.prototype.initialize)</span>
        <span class="gd">-      klass.prototype.initialize = Prototype.emptyFunction;</span>
        <span class="gd">-</span>
        <span class="gd">-    klass.prototype.constructor = klass;</span>
        <span class="gd">-    return klass;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function addMethods(source) {</span>
        <span class="gd">-    var ancestor   = this.superclass &amp;&amp; this.superclass.prototype,</span>
        <span class="gd">-        properties = Object.keys(source);</span>
        <span class="gd">-</span>
        <span class="gd">-    if (IS_DONTENUM_BUGGY) {</span>
        <span class="gd">-      if (source.toString != Object.prototype.toString)</span>
        <span class="gd">-        properties.push(&quot;toString&quot;);</span>
        <span class="gd">-      if (source.valueOf != Object.prototype.valueOf)</span>
        <span class="gd">-        properties.push(&quot;valueOf&quot;);</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    for (var i = 0, length = properties.length; i &lt; length; i++) {</span>
        <span class="gd">-      var property = properties[i], value = source[property];</span>
        <span class="gd">-      if (ancestor &amp;&amp; Object.isFunction(value) &amp;&amp;</span>
        <span class="gd">-          value.argumentNames()[0] == &quot;$super&quot;) {</span>
        <span class="gd">-        var method = value;</span>
        <span class="gd">-        value = (function(m) {</span>
        <span class="gd">-          return function() { return ancestor[m].apply(this, arguments); };</span>
        <span class="gd">-        })(property).wrap(method);</span>
        <span class="gd">-</span>
        <span class="gd">-        value.valueOf = method.valueOf.bind(method);</span>
        <span class="gd">-        value.toString = method.toString.bind(method);</span>
        <span class="gd">-      }</span>
        <span class="gd">-      this.prototype[property] = value;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    return this;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  return {</span>
        <span class="gd">-    create: create,</span>
        <span class="gd">-    Methods: {</span>
        <span class="gd">-      addMethods: addMethods</span>
        <span class="gd">-    }</span>
        <span class="gd">-  };</span>
        <span class="gd">-})();</span>
        <span class="gd">-(function() {</span>
        <span class="gd">-</span>
        <span class="gd">-  var _toString = Object.prototype.toString,</span>
        <span class="gd">-      NULL_TYPE = &#39;Null&#39;,</span>
        <span class="gd">-      UNDEFINED_TYPE = &#39;Undefined&#39;,</span>
        <span class="gd">-      BOOLEAN_TYPE = &#39;Boolean&#39;,</span>
        <span class="gd">-      NUMBER_TYPE = &#39;Number&#39;,</span>
        <span class="gd">-      STRING_TYPE = &#39;String&#39;,</span>
        <span class="gd">-      OBJECT_TYPE = &#39;Object&#39;,</span>
        <span class="gd">-      BOOLEAN_CLASS = &#39;[object Boolean]&#39;,</span>
        <span class="gd">-      NUMBER_CLASS = &#39;[object Number]&#39;,</span>
        <span class="gd">-      STRING_CLASS = &#39;[object String]&#39;,</span>
        <span class="gd">-      ARRAY_CLASS = &#39;[object Array]&#39;,</span>
        <span class="gd">-      NATIVE_JSON_STRINGIFY_SUPPORT = window.JSON &amp;&amp;</span>
        <span class="gd">-        typeof JSON.stringify === &#39;function&#39; &amp;&amp;</span>
        <span class="gd">-        JSON.stringify(0) === &#39;0&#39; &amp;&amp;</span>
        <span class="gd">-        typeof JSON.stringify(Prototype.K) === &#39;undefined&#39;;</span>
        <span class="gd">-</span>
        <span class="gd">-  function Type(o) {</span>
        <span class="gd">-    switch(o) {</span>
        <span class="gd">-      case null: return NULL_TYPE;</span>
        <span class="gd">-      case (void 0): return UNDEFINED_TYPE;</span>
        <span class="gd">-    }</span>
        <span class="gd">-    var type = typeof o;</span>
        <span class="gd">-    switch(type) {</span>
        <span class="gd">-      case &#39;boolean&#39;: return BOOLEAN_TYPE;</span>
        <span class="gd">-      case &#39;number&#39;:  return NUMBER_TYPE;</span>
        <span class="gd">-      case &#39;string&#39;:  return STRING_TYPE;</span>
        <span class="gd">-    }</span>
        <span class="gd">-    return OBJECT_TYPE;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function extend(destination, source) {</span>
        <span class="gd">-    for (var property in source)</span>
        <span class="gd">-      destination[property] = source[property];</span>
        <span class="gd">-    return destination;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function inspect(object) {</span>
        <span class="gd">-    try {</span>
        <span class="gd">-      if (isUndefined(object)) return &#39;undefined&#39;;</span>
        <span class="gd">-      if (object === null) return &#39;null&#39;;</span>
        <span class="gd">-      return object.inspect ? object.inspect() : String(object);</span>
        <span class="gd">-    } catch (e) {</span>
        <span class="gd">-      if (e instanceof RangeError) return &#39;...&#39;;</span>
        <span class="gd">-      throw e;</span>
        <span class="gd">-    }</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function toJSON(value) {</span>
        <span class="gd">-    return Str(&#39;&#39;, { &#39;&#39;: value }, []);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function Str(key, holder, stack) {</span>
        <span class="gd">-    var value = holder[key],</span>
        <span class="gd">-        type = typeof value;</span>
        <span class="gd">-</span>
        <span class="gd">-    if (Type(value) === OBJECT_TYPE &amp;&amp; typeof value.toJSON === &#39;function&#39;) {</span>
        <span class="gd">-      value = value.toJSON(key);</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    var _class = _toString.call(value);</span>
        <span class="gd">-</span>
        <span class="gd">-    switch (_class) {</span>
        <span class="gd">-      case NUMBER_CLASS:</span>
        <span class="gd">-      case BOOLEAN_CLASS:</span>
        <span class="gd">-      case STRING_CLASS:</span>
        <span class="gd">-        value = value.valueOf();</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    switch (value) {</span>
        <span class="gd">-      case null: return &#39;null&#39;;</span>
        <span class="gd">-      case true: return &#39;true&#39;;</span>
        <span class="gd">-      case false: return &#39;false&#39;;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    type = typeof value;</span>
        <span class="gd">-    switch (type) {</span>
        <span class="gd">-      case &#39;string&#39;:</span>
        <span class="gd">-        return value.inspect(true);</span>
        <span class="gd">-      case &#39;number&#39;:</span>
        <span class="gd">-        return isFinite(value) ? String(value) : &#39;null&#39;;</span>
        <span class="gd">-      case &#39;object&#39;:</span>
        <span class="gd">-</span>
        <span class="gd">-        for (var i = 0, length = stack.length; i &lt; length; i++) {</span>
        <span class="gd">-          if (stack[i] === value) { throw new TypeError(); }</span>
        <span class="gd">-        }</span>
        <span class="gd">-        stack.push(value);</span>
        <span class="gd">-</span>
        <span class="gd">-        var partial = [];</span>
        <span class="gd">-        if (_class === ARRAY_CLASS) {</span>
        <span class="gd">-          for (var i = 0, length = value.length; i &lt; length; i++) {</span>
        <span class="gd">-            var str = Str(i, value, stack);</span>
        <span class="gd">-            partial.push(typeof str === &#39;undefined&#39; ? &#39;null&#39; : str);</span>
        <span class="gd">-          }</span>
        <span class="gd">-          partial = &#39;[&#39; + partial.join(&#39;,&#39;) + &#39;]&#39;;</span>
        <span class="gd">-        } else {</span>
        <span class="gd">-          var keys = Object.keys(value);</span>
        <span class="gd">-          for (var i = 0, length = keys.length; i &lt; length; i++) {</span>
        <span class="gd">-            var key = keys[i], str = Str(key, value, stack);</span>
        <span class="gd">-            if (typeof str !== &quot;undefined&quot;) {</span>
        <span class="gd">-               partial.push(key.inspect(true)+ &#39;:&#39; + str);</span>
        <span class="gd">-             }</span>
        <span class="gd">-          }</span>
        <span class="gd">-          partial = &#39;{&#39; + partial.join(&#39;,&#39;) + &#39;}&#39;;</span>
        <span class="gd">-        }</span>
        <span class="gd">-        stack.pop();</span>
        <span class="gd">-        return partial;</span>
        <span class="gd">-    }</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function stringify(object) {</span>
        <span class="gd">-    return JSON.stringify(object);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function toQueryString(object) {</span>
        <span class="gd">-    return $H(object).toQueryString();</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function toHTML(object) {</span>
        <span class="gd">-    return object &amp;&amp; object.toHTML ? object.toHTML() : String.interpret(object);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function keys(object) {</span>
        <span class="gd">-    if (Type(object) !== OBJECT_TYPE) { throw new TypeError(); }</span>
        <span class="gd">-    var results = [];</span>
        <span class="gd">-    for (var property in object) {</span>
        <span class="gd">-      if (object.hasOwnProperty(property)) {</span>
        <span class="gd">-        results.push(property);</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-    return results;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function values(object) {</span>
        <span class="gd">-    var results = [];</span>
        <span class="gd">-    for (var property in object)</span>
        <span class="gd">-      results.push(object[property]);</span>
        <span class="gd">-    return results;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function clone(object) {</span>
        <span class="gd">-    return extend({ }, object);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function isElement(object) {</span>
        <span class="gd">-    return !!(object &amp;&amp; object.nodeType == 1);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function isArray(object) {</span>
        <span class="gd">-    return _toString.call(object) === ARRAY_CLASS;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  var hasNativeIsArray = (typeof Array.isArray == &#39;function&#39;)</span>
        <span class="gd">-    &amp;&amp; Array.isArray([]) &amp;&amp; !Array.isArray({});</span>
        <span class="gd">-</span>
        <span class="gd">-  if (hasNativeIsArray) {</span>
        <span class="gd">-    isArray = Array.isArray;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function isHash(object) {</span>
        <span class="gd">-    return object instanceof Hash;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function isFunction(object) {</span>
        <span class="gd">-    return typeof object === &quot;function&quot;;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function isString(object) {</span>
        <span class="gd">-    return _toString.call(object) === STRING_CLASS;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function isNumber(object) {</span>
        <span class="gd">-    return _toString.call(object) === NUMBER_CLASS;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function isUndefined(object) {</span>
        <span class="gd">-    return typeof object === &quot;undefined&quot;;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  extend(Object, {</span>
        <span class="gd">-    extend:        extend,</span>
        <span class="gd">-    inspect:       inspect,</span>
        <span class="gd">-    toJSON:        NATIVE_JSON_STRINGIFY_SUPPORT ? stringify : toJSON,</span>
        <span class="gd">-    toQueryString: toQueryString,</span>
        <span class="gd">-    toHTML:        toHTML,</span>
        <span class="gd">-    keys:          Object.keys || keys,</span>
        <span class="gd">-    values:        values,</span>
        <span class="gd">-    clone:         clone,</span>
        <span class="gd">-    isElement:     isElement,</span>
        <span class="gd">-    isArray:       isArray,</span>
        <span class="gd">-    isHash:        isHash,</span>
        <span class="gd">-    isFunction:    isFunction,</span>
        <span class="gd">-    isString:      isString,</span>
        <span class="gd">-    isNumber:      isNumber,</span>
        <span class="gd">-    isUndefined:   isUndefined</span>
        <span class="gd">-  });</span>
        <span class="gd">-})();</span>
        <span class="gd">-Object.extend(Function.prototype, (function() {</span>
        <span class="gd">-  var slice = Array.prototype.slice;</span>
        <span class="gd">-</span>
        <span class="gd">-  function update(array, args) {</span>
        <span class="gd">-    var arrayLength = array.length, length = args.length;</span>
        <span class="gd">-    while (length--) array[arrayLength + length] = args[length];</span>
        <span class="gd">-    return array;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function merge(array, args) {</span>
        <span class="gd">-    array = slice.call(array, 0);</span>
        <span class="gd">-    return update(array, args);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function argumentNames() {</span>
        <span class="gd">-    var names = this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1]</span>
        <span class="gd">-      .replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g, &#39;&#39;)</span>
        <span class="gd">-      .replace(/\s+/g, &#39;&#39;).split(&#39;,&#39;);</span>
        <span class="gd">-    return names.length == 1 &amp;&amp; !names[0] ? [] : names;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function bind(context) {</span>
        <span class="gd">-    if (arguments.length &lt; 2 &amp;&amp; Object.isUndefined(arguments[0])) return this;</span>
        <span class="gd">-    var __method = this, args = slice.call(arguments, 1);</span>
        <span class="gd">-    return function() {</span>
        <span class="gd">-      var a = merge(args, arguments);</span>
        <span class="gd">-      return __method.apply(context, a);</span>
        <span class="gd">-    }</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function bindAsEventListener(context) {</span>
        <span class="gd">-    var __method = this, args = slice.call(arguments, 1);</span>
        <span class="gd">-    return function(event) {</span>
        <span class="gd">-      var a = update([event || window.event], args);</span>
        <span class="gd">-      return __method.apply(context, a);</span>
        <span class="gd">-    }</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function curry() {</span>
        <span class="gd">-    if (!arguments.length) return this;</span>
        <span class="gd">-    var __method = this, args = slice.call(arguments, 0);</span>
        <span class="gd">-    return function() {</span>
        <span class="gd">-      var a = merge(args, arguments);</span>
        <span class="gd">-      return __method.apply(this, a);</span>
        <span class="gd">-    }</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function delay(timeout) {</span>
        <span class="gd">-    var __method = this, args = slice.call(arguments, 1);</span>
        <span class="gd">-    timeout = timeout * 1000;</span>
        <span class="gd">-    return window.setTimeout(function() {</span>
        <span class="gd">-      return __method.apply(__method, args);</span>
        <span class="gd">-    }, timeout);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function defer() {</span>
        <span class="gd">-    var args = update([0.01], arguments);</span>
        <span class="gd">-    return this.delay.apply(this, args);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function wrap(wrapper) {</span>
        <span class="gd">-    var __method = this;</span>
        <span class="gd">-    return function() {</span>
        <span class="gd">-      var a = update([__method.bind(this)], arguments);</span>
        <span class="gd">-      return wrapper.apply(this, a);</span>
        <span class="gd">-    }</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function methodize() {</span>
        <span class="gd">-    if (this._methodized) return this._methodized;</span>
        <span class="gd">-    var __method = this;</span>
        <span class="gd">-    return this._methodized = function() {</span>
        <span class="gd">-      var a = update([this], arguments);</span>
        <span class="gd">-      return __method.apply(null, a);</span>
        <span class="gd">-    };</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  return {</span>
        <span class="gd">-    argumentNames:       argumentNames,</span>
        <span class="gd">-    bind:                bind,</span>
        <span class="gd">-    bindAsEventListener: bindAsEventListener,</span>
        <span class="gd">-    curry:               curry,</span>
        <span class="gd">-    delay:               delay,</span>
        <span class="gd">-    defer:               defer,</span>
        <span class="gd">-    wrap:                wrap,</span>
        <span class="gd">-    methodize:           methodize</span>
        <span class="gd">-  }</span>
        <span class="gd">-})());</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-(function(proto) {</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-  function toISOString() {</span>
        <span class="gd">-    return this.getUTCFullYear() + &#39;-&#39; +</span>
        <span class="gd">-      (this.getUTCMonth() + 1).toPaddedString(2) + &#39;-&#39; +</span>
        <span class="gd">-      this.getUTCDate().toPaddedString(2) + &#39;T&#39; +</span>
        <span class="gd">-      this.getUTCHours().toPaddedString(2) + &#39;:&#39; +</span>
        <span class="gd">-      this.getUTCMinutes().toPaddedString(2) + &#39;:&#39; +</span>
        <span class="gd">-      this.getUTCSeconds().toPaddedString(2) + &#39;Z&#39;;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-  function toJSON() {</span>
        <span class="gd">-    return this.toISOString();</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  if (!proto.toISOString) proto.toISOString = toISOString;</span>
        <span class="gd">-  if (!proto.toJSON) proto.toJSON = toJSON;</span>
        <span class="gd">-</span>
        <span class="gd">-})(Date.prototype);</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-RegExp.prototype.match = RegExp.prototype.test;</span>
        <span class="gd">-</span>
        <span class="gd">-RegExp.escape = function(str) {</span>
        <span class="gd">-  return String(str).replace(/([.*+?^=!:${}()|[\]\/\\])/g, &#39;\\$1&#39;);</span>
        <span class="gd">-};</span>
        <span class="gd">-var PeriodicalExecuter = Class.create({</span>
        <span class="gd">-  initialize: function(callback, frequency) {</span>
        <span class="gd">-    this.callback = callback;</span>
        <span class="gd">-    this.frequency = frequency;</span>
        <span class="gd">-    this.currentlyExecuting = false;</span>
        <span class="gd">-</span>
        <span class="gd">-    this.registerCallback();</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  registerCallback: function() {</span>
        <span class="gd">-    this.timer = setInterval(this.onTimerEvent.bind(this), this.frequency * 1000);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  execute: function() {</span>
        <span class="gd">-    this.callback(this);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  stop: function() {</span>
        <span class="gd">-    if (!this.timer) return;</span>
        <span class="gd">-    clearInterval(this.timer);</span>
        <span class="gd">-    this.timer = null;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  onTimerEvent: function() {</span>
        <span class="gd">-    if (!this.currentlyExecuting) {</span>
        <span class="gd">-      try {</span>
        <span class="gd">-        this.currentlyExecuting = true;</span>
        <span class="gd">-        this.execute();</span>
        <span class="gd">-        this.currentlyExecuting = false;</span>
        <span class="gd">-      } catch(e) {</span>
        <span class="gd">-        this.currentlyExecuting = false;</span>
        <span class="gd">-        throw e;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-Object.extend(String, {</span>
        <span class="gd">-  interpret: function(value) {</span>
        <span class="gd">-    return value == null ? &#39;&#39; : String(value);</span>
        <span class="gd">-  },</span>
        <span class="gd">-  specialChar: {</span>
        <span class="gd">-    &#39;\b&#39;: &#39;\\b&#39;,</span>
        <span class="gd">-    &#39;\t&#39;: &#39;\\t&#39;,</span>
        <span class="gd">-    &#39;\n&#39;: &#39;\\n&#39;,</span>
        <span class="gd">-    &#39;\f&#39;: &#39;\\f&#39;,</span>
        <span class="gd">-    &#39;\r&#39;: &#39;\\r&#39;,</span>
        <span class="gd">-    &#39;\\&#39;: &#39;\\\\&#39;</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-Object.extend(String.prototype, (function() {</span>
        <span class="gd">-  var NATIVE_JSON_PARSE_SUPPORT = window.JSON &amp;&amp;</span>
        <span class="gd">-    typeof JSON.parse === &#39;function&#39; &amp;&amp;</span>
        <span class="gd">-    JSON.parse(&#39;{&quot;test&quot;: true}&#39;).test;</span>
        <span class="gd">-</span>
        <span class="gd">-  function prepareReplacement(replacement) {</span>
        <span class="gd">-    if (Object.isFunction(replacement)) return replacement;</span>
        <span class="gd">-    var template = new Template(replacement);</span>
        <span class="gd">-    return function(match) { return template.evaluate(match) };</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function gsub(pattern, replacement) {</span>
        <span class="gd">-    var result = &#39;&#39;, source = this, match;</span>
        <span class="gd">-    replacement = prepareReplacement(replacement);</span>
        <span class="gd">-</span>
        <span class="gd">-    if (Object.isString(pattern))</span>
        <span class="gd">-      pattern = RegExp.escape(pattern);</span>
        <span class="gd">-</span>
        <span class="gd">-    if (!(pattern.length || pattern.source)) {</span>
        <span class="gd">-      replacement = replacement(&#39;&#39;);</span>
        <span class="gd">-      return replacement + source.split(&#39;&#39;).join(replacement) + replacement;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    while (source.length &gt; 0) {</span>
        <span class="gd">-      if (match = source.match(pattern)) {</span>
        <span class="gd">-        result += source.slice(0, match.index);</span>
        <span class="gd">-        result += String.interpret(replacement(match));</span>
        <span class="gd">-        source  = source.slice(match.index + match[0].length);</span>
        <span class="gd">-      } else {</span>
        <span class="gd">-        result += source, source = &#39;&#39;;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-    return result;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function sub(pattern, replacement, count) {</span>
        <span class="gd">-    replacement = prepareReplacement(replacement);</span>
        <span class="gd">-    count = Object.isUndefined(count) ? 1 : count;</span>
        <span class="gd">-</span>
        <span class="gd">-    return this.gsub(pattern, function(match) {</span>
        <span class="gd">-      if (--count &lt; 0) return match[0];</span>
        <span class="gd">-      return replacement(match);</span>
        <span class="gd">-    });</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function scan(pattern, iterator) {</span>
        <span class="gd">-    this.gsub(pattern, iterator);</span>
        <span class="gd">-    return String(this);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function truncate(length, truncation) {</span>
        <span class="gd">-    length = length || 30;</span>
        <span class="gd">-    truncation = Object.isUndefined(truncation) ? &#39;...&#39; : truncation;</span>
        <span class="gd">-    return this.length &gt; length ?</span>
        <span class="gd">-      this.slice(0, length - truncation.length) + truncation : String(this);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function strip() {</span>
        <span class="gd">-    return this.replace(/^\s+/, &#39;&#39;).replace(/\s+$/, &#39;&#39;);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function stripTags() {</span>
        <span class="gd">-    return this.replace(/&lt;\w+(\s+(&quot;[^&quot;]*&quot;|&#39;[^&#39;]*&#39;|[^&gt;])+)?&gt;|&lt;\/\w+&gt;/gi, &#39;&#39;);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function stripScripts() {</span>
        <span class="gd">-    return this.replace(new RegExp(Prototype.ScriptFragment, &#39;img&#39;), &#39;&#39;);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function extractScripts() {</span>
        <span class="gd">-    var matchAll = new RegExp(Prototype.ScriptFragment, &#39;img&#39;),</span>
        <span class="gd">-        matchOne = new RegExp(Prototype.ScriptFragment, &#39;im&#39;);</span>
        <span class="gd">-    return (this.match(matchAll) || []).map(function(scriptTag) {</span>
        <span class="gd">-      return (scriptTag.match(matchOne) || [&#39;&#39;, &#39;&#39;])[1];</span>
        <span class="gd">-    });</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function evalScripts() {</span>
        <span class="gd">-    return this.extractScripts().map(function(script) { return eval(script) });</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function escapeHTML() {</span>
        <span class="gd">-    return this.replace(/&amp;/g,&#39;&amp;amp;&#39;).replace(/&lt;/g,&#39;&amp;lt;&#39;).replace(/&gt;/g,&#39;&amp;gt;&#39;);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function unescapeHTML() {</span>
        <span class="gd">-    return this.stripTags().replace(/&amp;lt;/g,&#39;&lt;&#39;).replace(/&amp;gt;/g,&#39;&gt;&#39;).replace(/&amp;amp;/g,&#39;&amp;&#39;);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-  function toQueryParams(separator) {</span>
        <span class="gd">-    var match = this.strip().match(/([^?#]*)(#.*)?$/);</span>
        <span class="gd">-    if (!match) return { };</span>
        <span class="gd">-</span>
        <span class="gd">-    return match[1].split(separator || &#39;&amp;&#39;).inject({ }, function(hash, pair) {</span>
        <span class="gd">-      if ((pair = pair.split(&#39;=&#39;))[0]) {</span>
        <span class="gd">-        var key = decodeURIComponent(pair.shift()),</span>
        <span class="gd">-            value = pair.length &gt; 1 ? pair.join(&#39;=&#39;) : pair[0];</span>
        <span class="gd">-</span>
        <span class="gd">-        if (value != undefined) value = decodeURIComponent(value);</span>
        <span class="gd">-</span>
        <span class="gd">-        if (key in hash) {</span>
        <span class="gd">-          if (!Object.isArray(hash[key])) hash[key] = [hash[key]];</span>
        <span class="gd">-          hash[key].push(value);</span>
        <span class="gd">-        }</span>
        <span class="gd">-        else hash[key] = value;</span>
        <span class="gd">-      }</span>
        <span class="gd">-      return hash;</span>
        <span class="gd">-    });</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function toArray() {</span>
        <span class="gd">-    return this.split(&#39;&#39;);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function succ() {</span>
        <span class="gd">-    return this.slice(0, this.length - 1) +</span>
        <span class="gd">-      String.fromCharCode(this.charCodeAt(this.length - 1) + 1);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function times(count) {</span>
        <span class="gd">-    return count &lt; 1 ? &#39;&#39; : new Array(count + 1).join(this);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function camelize() {</span>
        <span class="gd">-    return this.replace(/-+(.)?/g, function(match, chr) {</span>
        <span class="gd">-      return chr ? chr.toUpperCase() : &#39;&#39;;</span>
        <span class="gd">-    });</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function capitalize() {</span>
        <span class="gd">-    return this.charAt(0).toUpperCase() + this.substring(1).toLowerCase();</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function underscore() {</span>
        <span class="gd">-    return this.replace(/::/g, &#39;/&#39;)</span>
        <span class="gd">-               .replace(/([A-Z]+)([A-Z][a-z])/g, &#39;$1_$2&#39;)</span>
        <span class="gd">-               .replace(/([a-z\d])([A-Z])/g, &#39;$1_$2&#39;)</span>
        <span class="gd">-               .replace(/-/g, &#39;_&#39;)</span>
        <span class="gd">-               .toLowerCase();</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function dasherize() {</span>
        <span class="gd">-    return this.replace(/_/g, &#39;-&#39;);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function inspect(useDoubleQuotes) {</span>
        <span class="gd">-    var escapedString = this.replace(/[\x00-\x1f\\]/g, function(character) {</span>
        <span class="gd">-      if (character in String.specialChar) {</span>
        <span class="gd">-        return String.specialChar[character];</span>
        <span class="gd">-      }</span>
        <span class="gd">-      return &#39;\\u00&#39; + character.charCodeAt().toPaddedString(2, 16);</span>
        <span class="gd">-    });</span>
        <span class="gd">-    if (useDoubleQuotes) return &#39;&quot;&#39; + escapedString.replace(/&quot;/g, &#39;\\&quot;&#39;) + &#39;&quot;&#39;;</span>
        <span class="gd">-    return &quot;&#39;&quot; + escapedString.replace(/&#39;/g, &#39;\\\&#39;&#39;) + &quot;&#39;&quot;;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function unfilterJSON(filter) {</span>
        <span class="gd">-    return this.replace(filter || Prototype.JSONFilter, &#39;$1&#39;);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function isJSON() {</span>
        <span class="gd">-    var str = this;</span>
        <span class="gd">-    if (str.blank()) return false;</span>
        <span class="gd">-    str = str.replace(/\\(?:[&quot;\\\/bfnrt]|u[0-9a-fA-F]{4})/g, &#39;@&#39;);</span>
        <span class="gd">-    str = str.replace(/&quot;[^&quot;\\\n\r]*&quot;|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, &#39;]&#39;);</span>
        <span class="gd">-    str = str.replace(/(?:^|:|,)(?:\s*\[)+/g, &#39;&#39;);</span>
        <span class="gd">-    return (/^[\],:{}\s]*$/).test(str);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function evalJSON(sanitize) {</span>
        <span class="gd">-    var json = this.unfilterJSON(),</span>
        <span class="gd">-        cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;</span>
        <span class="gd">-    if (cx.test(json)) {</span>
        <span class="gd">-      json = json.replace(cx, function (a) {</span>
        <span class="gd">-        return &#39;\\u&#39; + (&#39;0000&#39; + a.charCodeAt(0).toString(16)).slice(-4);</span>
        <span class="gd">-      });</span>
        <span class="gd">-    }</span>
        <span class="gd">-    try {</span>
        <span class="gd">-      if (!sanitize || json.isJSON()) return eval(&#39;(&#39; + json + &#39;)&#39;);</span>
        <span class="gd">-    } catch (e) { }</span>
        <span class="gd">-    throw new SyntaxError(&#39;Badly formed JSON string: &#39; + this.inspect());</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function parseJSON() {</span>
        <span class="gd">-    var json = this.unfilterJSON();</span>
        <span class="gd">-    return JSON.parse(json);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function include(pattern) {</span>
        <span class="gd">-    return this.indexOf(pattern) &gt; -1;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function startsWith(pattern) {</span>
        <span class="gd">-    return this.lastIndexOf(pattern, 0) === 0;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function endsWith(pattern) {</span>
        <span class="gd">-    var d = this.length - pattern.length;</span>
        <span class="gd">-    return d &gt;= 0 &amp;&amp; this.indexOf(pattern, d) === d;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function empty() {</span>
        <span class="gd">-    return this == &#39;&#39;;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function blank() {</span>
        <span class="gd">-    return /^\s*$/.test(this);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function interpolate(object, pattern) {</span>
        <span class="gd">-    return new Template(this, pattern).evaluate(object);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  return {</span>
        <span class="gd">-    gsub:           gsub,</span>
        <span class="gd">-    sub:            sub,</span>
        <span class="gd">-    scan:           scan,</span>
        <span class="gd">-    truncate:       truncate,</span>
        <span class="gd">-    strip:          String.prototype.trim || strip,</span>
        <span class="gd">-    stripTags:      stripTags,</span>
        <span class="gd">-    stripScripts:   stripScripts,</span>
        <span class="gd">-    extractScripts: extractScripts,</span>
        <span class="gd">-    evalScripts:    evalScripts,</span>
        <span class="gd">-    escapeHTML:     escapeHTML,</span>
        <span class="gd">-    unescapeHTML:   unescapeHTML,</span>
        <span class="gd">-    toQueryParams:  toQueryParams,</span>
        <span class="gd">-    parseQuery:     toQueryParams,</span>
        <span class="gd">-    toArray:        toArray,</span>
        <span class="gd">-    succ:           succ,</span>
        <span class="gd">-    times:          times,</span>
        <span class="gd">-    camelize:       camelize,</span>
        <span class="gd">-    capitalize:     capitalize,</span>
        <span class="gd">-    underscore:     underscore,</span>
        <span class="gd">-    dasherize:      dasherize,</span>
        <span class="gd">-    inspect:        inspect,</span>
        <span class="gd">-    unfilterJSON:   unfilterJSON,</span>
        <span class="gd">-    isJSON:         isJSON,</span>
        <span class="gd">-    evalJSON:       NATIVE_JSON_PARSE_SUPPORT ? parseJSON : evalJSON,</span>
        <span class="gd">-    include:        include,</span>
        <span class="gd">-    startsWith:     startsWith,</span>
        <span class="gd">-    endsWith:       endsWith,</span>
        <span class="gd">-    empty:          empty,</span>
        <span class="gd">-    blank:          blank,</span>
        <span class="gd">-    interpolate:    interpolate</span>
        <span class="gd">-  };</span>
        <span class="gd">-})());</span>
        <span class="gd">-</span>
        <span class="gd">-var Template = Class.create({</span>
        <span class="gd">-  initialize: function(template, pattern) {</span>
        <span class="gd">-    this.template = template.toString();</span>
        <span class="gd">-    this.pattern = pattern || Template.Pattern;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  evaluate: function(object) {</span>
        <span class="gd">-    if (object &amp;&amp; Object.isFunction(object.toTemplateReplacements))</span>
        <span class="gd">-      object = object.toTemplateReplacements();</span>
        <span class="gd">-</span>
        <span class="gd">-    return this.template.gsub(this.pattern, function(match) {</span>
        <span class="gd">-      if (object == null) return (match[1] + &#39;&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-      var before = match[1] || &#39;&#39;;</span>
        <span class="gd">-      if (before == &#39;\\&#39;) return match[2];</span>
        <span class="gd">-</span>
        <span class="gd">-      var ctx = object, expr = match[3],</span>
        <span class="gd">-          pattern = /^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;</span>
        <span class="gd">-</span>
        <span class="gd">-      match = pattern.exec(expr);</span>
        <span class="gd">-      if (match == null) return before;</span>
        <span class="gd">-</span>
        <span class="gd">-      while (match != null) {</span>
        <span class="gd">-        var comp = match[1].startsWith(&#39;[&#39;) ? match[2].replace(/\\\\]/g, &#39;]&#39;) : match[1];</span>
        <span class="gd">-        ctx = ctx[comp];</span>
        <span class="gd">-        if (null == ctx || &#39;&#39; == match[3]) break;</span>
        <span class="gd">-        expr = expr.substring(&#39;[&#39; == match[3] ? match[1].length : match[0].length);</span>
        <span class="gd">-        match = pattern.exec(expr);</span>
        <span class="gd">-      }</span>
        <span class="gd">-</span>
        <span class="gd">-      return before + String.interpret(ctx);</span>
        <span class="gd">-    });</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-Template.Pattern = /(^|.|\r|\n)(#\{(.*?)\})/;</span>
        <span class="gd">-</span>
        <span class="gd">-var $break = { };</span>
        <span class="gd">-</span>
        <span class="gd">-var Enumerable = (function() {</span>
        <span class="gd">-  function each(iterator, context) {</span>
        <span class="gd">-    var index = 0;</span>
        <span class="gd">-    try {</span>
        <span class="gd">-      this._each(function(value) {</span>
        <span class="gd">-        iterator.call(context, value, index++);</span>
        <span class="gd">-      });</span>
        <span class="gd">-    } catch (e) {</span>
        <span class="gd">-      if (e != $break) throw e;</span>
        <span class="gd">-    }</span>
        <span class="gd">-    return this;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function eachSlice(number, iterator, context) {</span>
        <span class="gd">-    var index = -number, slices = [], array = this.toArray();</span>
        <span class="gd">-    if (number &lt; 1) return array;</span>
        <span class="gd">-    while ((index += number) &lt; array.length)</span>
        <span class="gd">-      slices.push(array.slice(index, index+number));</span>
        <span class="gd">-    return slices.collect(iterator, context);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function all(iterator, context) {</span>
        <span class="gd">-    iterator = iterator || Prototype.K;</span>
        <span class="gd">-    var result = true;</span>
        <span class="gd">-    this.each(function(value, index) {</span>
        <span class="gd">-      result = result &amp;&amp; !!iterator.call(context, value, index);</span>
        <span class="gd">-      if (!result) throw $break;</span>
        <span class="gd">-    });</span>
        <span class="gd">-    return result;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function any(iterator, context) {</span>
        <span class="gd">-    iterator = iterator || Prototype.K;</span>
        <span class="gd">-    var result = false;</span>
        <span class="gd">-    this.each(function(value, index) {</span>
        <span class="gd">-      if (result = !!iterator.call(context, value, index))</span>
        <span class="gd">-        throw $break;</span>
        <span class="gd">-    });</span>
        <span class="gd">-    return result;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function collect(iterator, context) {</span>
        <span class="gd">-    iterator = iterator || Prototype.K;</span>
        <span class="gd">-    var results = [];</span>
        <span class="gd">-    this.each(function(value, index) {</span>
        <span class="gd">-      results.push(iterator.call(context, value, index));</span>
        <span class="gd">-    });</span>
        <span class="gd">-    return results;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function detect(iterator, context) {</span>
        <span class="gd">-    var result;</span>
        <span class="gd">-    this.each(function(value, index) {</span>
        <span class="gd">-      if (iterator.call(context, value, index)) {</span>
        <span class="gd">-        result = value;</span>
        <span class="gd">-        throw $break;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    });</span>
        <span class="gd">-    return result;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function findAll(iterator, context) {</span>
        <span class="gd">-    var results = [];</span>
        <span class="gd">-    this.each(function(value, index) {</span>
        <span class="gd">-      if (iterator.call(context, value, index))</span>
        <span class="gd">-        results.push(value);</span>
        <span class="gd">-    });</span>
        <span class="gd">-    return results;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function grep(filter, iterator, context) {</span>
        <span class="gd">-    iterator = iterator || Prototype.K;</span>
        <span class="gd">-    var results = [];</span>
        <span class="gd">-</span>
        <span class="gd">-    if (Object.isString(filter))</span>
        <span class="gd">-      filter = new RegExp(RegExp.escape(filter));</span>
        <span class="gd">-</span>
        <span class="gd">-    this.each(function(value, index) {</span>
        <span class="gd">-      if (filter.match(value))</span>
        <span class="gd">-        results.push(iterator.call(context, value, index));</span>
        <span class="gd">-    });</span>
        <span class="gd">-    return results;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function include(object) {</span>
        <span class="gd">-    if (Object.isFunction(this.indexOf))</span>
        <span class="gd">-      if (this.indexOf(object) != -1) return true;</span>
        <span class="gd">-</span>
        <span class="gd">-    var found = false;</span>
        <span class="gd">-    this.each(function(value) {</span>
        <span class="gd">-      if (value == object) {</span>
        <span class="gd">-        found = true;</span>
        <span class="gd">-        throw $break;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    });</span>
        <span class="gd">-    return found;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function inGroupsOf(number, fillWith) {</span>
        <span class="gd">-    fillWith = Object.isUndefined(fillWith) ? null : fillWith;</span>
        <span class="gd">-    return this.eachSlice(number, function(slice) {</span>
        <span class="gd">-      while(slice.length &lt; number) slice.push(fillWith);</span>
        <span class="gd">-      return slice;</span>
        <span class="gd">-    });</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function inject(memo, iterator, context) {</span>
        <span class="gd">-    this.each(function(value, index) {</span>
        <span class="gd">-      memo = iterator.call(context, memo, value, index);</span>
        <span class="gd">-    });</span>
        <span class="gd">-    return memo;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function invoke(method) {</span>
        <span class="gd">-    var args = $A(arguments).slice(1);</span>
        <span class="gd">-    return this.map(function(value) {</span>
        <span class="gd">-      return value[method].apply(value, args);</span>
        <span class="gd">-    });</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function max(iterator, context) {</span>
        <span class="gd">-    iterator = iterator || Prototype.K;</span>
        <span class="gd">-    var result;</span>
        <span class="gd">-    this.each(function(value, index) {</span>
        <span class="gd">-      value = iterator.call(context, value, index);</span>
        <span class="gd">-      if (result == null || value &gt;= result)</span>
        <span class="gd">-        result = value;</span>
        <span class="gd">-    });</span>
        <span class="gd">-    return result;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function min(iterator, context) {</span>
        <span class="gd">-    iterator = iterator || Prototype.K;</span>
        <span class="gd">-    var result;</span>
        <span class="gd">-    this.each(function(value, index) {</span>
        <span class="gd">-      value = iterator.call(context, value, index);</span>
        <span class="gd">-      if (result == null || value &lt; result)</span>
        <span class="gd">-        result = value;</span>
        <span class="gd">-    });</span>
        <span class="gd">-    return result;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function partition(iterator, context) {</span>
        <span class="gd">-    iterator = iterator || Prototype.K;</span>
        <span class="gd">-    var trues = [], falses = [];</span>
        <span class="gd">-    this.each(function(value, index) {</span>
        <span class="gd">-      (iterator.call(context, value, index) ?</span>
        <span class="gd">-        trues : falses).push(value);</span>
        <span class="gd">-    });</span>
        <span class="gd">-    return [trues, falses];</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function pluck(property) {</span>
        <span class="gd">-    var results = [];</span>
        <span class="gd">-    this.each(function(value) {</span>
        <span class="gd">-      results.push(value[property]);</span>
        <span class="gd">-    });</span>
        <span class="gd">-    return results;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function reject(iterator, context) {</span>
        <span class="gd">-    var results = [];</span>
        <span class="gd">-    this.each(function(value, index) {</span>
        <span class="gd">-      if (!iterator.call(context, value, index))</span>
        <span class="gd">-        results.push(value);</span>
        <span class="gd">-    });</span>
        <span class="gd">-    return results;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function sortBy(iterator, context) {</span>
        <span class="gd">-    return this.map(function(value, index) {</span>
        <span class="gd">-      return {</span>
        <span class="gd">-        value: value,</span>
        <span class="gd">-        criteria: iterator.call(context, value, index)</span>
        <span class="gd">-      };</span>
        <span class="gd">-    }).sort(function(left, right) {</span>
        <span class="gd">-      var a = left.criteria, b = right.criteria;</span>
        <span class="gd">-      return a &lt; b ? -1 : a &gt; b ? 1 : 0;</span>
        <span class="gd">-    }).pluck(&#39;value&#39;);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function toArray() {</span>
        <span class="gd">-    return this.map();</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function zip() {</span>
        <span class="gd">-    var iterator = Prototype.K, args = $A(arguments);</span>
        <span class="gd">-    if (Object.isFunction(args.last()))</span>
        <span class="gd">-      iterator = args.pop();</span>
        <span class="gd">-</span>
        <span class="gd">-    var collections = [this].concat(args).map($A);</span>
        <span class="gd">-    return this.map(function(value, index) {</span>
        <span class="gd">-      return iterator(collections.pluck(index));</span>
        <span class="gd">-    });</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function size() {</span>
        <span class="gd">-    return this.toArray().length;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function inspect() {</span>
        <span class="gd">-    return &#39;#&lt;Enumerable:&#39; + this.toArray().inspect() + &#39;&gt;&#39;;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-  return {</span>
        <span class="gd">-    each:       each,</span>
        <span class="gd">-    eachSlice:  eachSlice,</span>
        <span class="gd">-    all:        all,</span>
        <span class="gd">-    every:      all,</span>
        <span class="gd">-    any:        any,</span>
        <span class="gd">-    some:       any,</span>
        <span class="gd">-    collect:    collect,</span>
        <span class="gd">-    map:        collect,</span>
        <span class="gd">-    detect:     detect,</span>
        <span class="gd">-    findAll:    findAll,</span>
        <span class="gd">-    select:     findAll,</span>
        <span class="gd">-    filter:     findAll,</span>
        <span class="gd">-    grep:       grep,</span>
        <span class="gd">-    include:    include,</span>
        <span class="gd">-    member:     include,</span>
        <span class="gd">-    inGroupsOf: inGroupsOf,</span>
        <span class="gd">-    inject:     inject,</span>
        <span class="gd">-    invoke:     invoke,</span>
        <span class="gd">-    max:        max,</span>
        <span class="gd">-    min:        min,</span>
        <span class="gd">-    partition:  partition,</span>
        <span class="gd">-    pluck:      pluck,</span>
        <span class="gd">-    reject:     reject,</span>
        <span class="gd">-    sortBy:     sortBy,</span>
        <span class="gd">-    toArray:    toArray,</span>
        <span class="gd">-    entries:    toArray,</span>
        <span class="gd">-    zip:        zip,</span>
        <span class="gd">-    size:       size,</span>
        <span class="gd">-    inspect:    inspect,</span>
        <span class="gd">-    find:       detect</span>
        <span class="gd">-  };</span>
        <span class="gd">-})();</span>
        <span class="gd">-</span>
        <span class="gd">-function $A(iterable) {</span>
        <span class="gd">-  if (!iterable) return [];</span>
        <span class="gd">-  if (&#39;toArray&#39; in Object(iterable)) return iterable.toArray();</span>
        <span class="gd">-  var length = iterable.length || 0, results = new Array(length);</span>
        <span class="gd">-  while (length--) results[length] = iterable[length];</span>
        <span class="gd">-  return results;</span>
        <span class="gd">-}</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-function $w(string) {</span>
        <span class="gd">-  if (!Object.isString(string)) return [];</span>
        <span class="gd">-  string = string.strip();</span>
        <span class="gd">-  return string ? string.split(/\s+/) : [];</span>
        <span class="gd">-}</span>
        <span class="gd">-</span>
        <span class="gd">-Array.from = $A;</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-(function() {</span>
        <span class="gd">-  var arrayProto = Array.prototype,</span>
        <span class="gd">-      slice = arrayProto.slice,</span>
        <span class="gd">-      _each = arrayProto.forEach; // use native browser JS 1.6 implementation if available</span>
        <span class="gd">-</span>
        <span class="gd">-  function each(iterator) {</span>
        <span class="gd">-    for (var i = 0, length = this.length; i &lt; length; i++)</span>
        <span class="gd">-      iterator(this[i]);</span>
        <span class="gd">-  }</span>
        <span class="gd">-  if (!_each) _each = each;</span>
        <span class="gd">-</span>
        <span class="gd">-  function clear() {</span>
        <span class="gd">-    this.length = 0;</span>
        <span class="gd">-    return this;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function first() {</span>
        <span class="gd">-    return this[0];</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function last() {</span>
        <span class="gd">-    return this[this.length - 1];</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function compact() {</span>
        <span class="gd">-    return this.select(function(value) {</span>
        <span class="gd">-      return value != null;</span>
        <span class="gd">-    });</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function flatten() {</span>
        <span class="gd">-    return this.inject([], function(array, value) {</span>
        <span class="gd">-      if (Object.isArray(value))</span>
        <span class="gd">-        return array.concat(value.flatten());</span>
        <span class="gd">-      array.push(value);</span>
        <span class="gd">-      return array;</span>
        <span class="gd">-    });</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function without() {</span>
        <span class="gd">-    var values = slice.call(arguments, 0);</span>
        <span class="gd">-    return this.select(function(value) {</span>
        <span class="gd">-      return !values.include(value);</span>
        <span class="gd">-    });</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function reverse(inline) {</span>
        <span class="gd">-    return (inline === false ? this.toArray() : this)._reverse();</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function uniq(sorted) {</span>
        <span class="gd">-    return this.inject([], function(array, value, index) {</span>
        <span class="gd">-      if (0 == index || (sorted ? array.last() != value : !array.include(value)))</span>
        <span class="gd">-        array.push(value);</span>
        <span class="gd">-      return array;</span>
        <span class="gd">-    });</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function intersect(array) {</span>
        <span class="gd">-    return this.uniq().findAll(function(item) {</span>
        <span class="gd">-      return array.detect(function(value) { return item === value });</span>
        <span class="gd">-    });</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-  function clone() {</span>
        <span class="gd">-    return slice.call(this, 0);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function size() {</span>
        <span class="gd">-    return this.length;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function inspect() {</span>
        <span class="gd">-    return &#39;[&#39; + this.map(Object.inspect).join(&#39;, &#39;) + &#39;]&#39;;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function indexOf(item, i) {</span>
        <span class="gd">-    i || (i = 0);</span>
        <span class="gd">-    var length = this.length;</span>
        <span class="gd">-    if (i &lt; 0) i = length + i;</span>
        <span class="gd">-    for (; i &lt; length; i++)</span>
        <span class="gd">-      if (this[i] === item) return i;</span>
        <span class="gd">-    return -1;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function lastIndexOf(item, i) {</span>
        <span class="gd">-    i = isNaN(i) ? this.length : (i &lt; 0 ? this.length + i : i) + 1;</span>
        <span class="gd">-    var n = this.slice(0, i).reverse().indexOf(item);</span>
        <span class="gd">-    return (n &lt; 0) ? n : i - n - 1;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function concat() {</span>
        <span class="gd">-    var array = slice.call(this, 0), item;</span>
        <span class="gd">-    for (var i = 0, length = arguments.length; i &lt; length; i++) {</span>
        <span class="gd">-      item = arguments[i];</span>
        <span class="gd">-      if (Object.isArray(item) &amp;&amp; !(&#39;callee&#39; in item)) {</span>
        <span class="gd">-        for (var j = 0, arrayLength = item.length; j &lt; arrayLength; j++)</span>
        <span class="gd">-          array.push(item[j]);</span>
        <span class="gd">-      } else {</span>
        <span class="gd">-        array.push(item);</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-    return array;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  Object.extend(arrayProto, Enumerable);</span>
        <span class="gd">-</span>
        <span class="gd">-  if (!arrayProto._reverse)</span>
        <span class="gd">-    arrayProto._reverse = arrayProto.reverse;</span>
        <span class="gd">-</span>
        <span class="gd">-  Object.extend(arrayProto, {</span>
        <span class="gd">-    _each:     _each,</span>
        <span class="gd">-    clear:     clear,</span>
        <span class="gd">-    first:     first,</span>
        <span class="gd">-    last:      last,</span>
        <span class="gd">-    compact:   compact,</span>
        <span class="gd">-    flatten:   flatten,</span>
        <span class="gd">-    without:   without,</span>
        <span class="gd">-    reverse:   reverse,</span>
        <span class="gd">-    uniq:      uniq,</span>
        <span class="gd">-    intersect: intersect,</span>
        <span class="gd">-    clone:     clone,</span>
        <span class="gd">-    toArray:   clone,</span>
        <span class="gd">-    size:      size,</span>
        <span class="gd">-    inspect:   inspect</span>
        <span class="gd">-  });</span>
        <span class="gd">-</span>
        <span class="gd">-  var CONCAT_ARGUMENTS_BUGGY = (function() {</span>
        <span class="gd">-    return [].concat(arguments)[0][0] !== 1;</span>
        <span class="gd">-  })(1,2)</span>
        <span class="gd">-</span>
        <span class="gd">-  if (CONCAT_ARGUMENTS_BUGGY) arrayProto.concat = concat;</span>
        <span class="gd">-</span>
        <span class="gd">-  if (!arrayProto.indexOf) arrayProto.indexOf = indexOf;</span>
        <span class="gd">-  if (!arrayProto.lastIndexOf) arrayProto.lastIndexOf = lastIndexOf;</span>
        <span class="gd">-})();</span>
        <span class="gd">-function $H(object) {</span>
        <span class="gd">-  return new Hash(object);</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-var Hash = Class.create(Enumerable, (function() {</span>
        <span class="gd">-  function initialize(object) {</span>
        <span class="gd">-    this._object = Object.isHash(object) ? object.toObject() : Object.clone(object);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-  function _each(iterator) {</span>
        <span class="gd">-    for (var key in this._object) {</span>
        <span class="gd">-      var value = this._object[key], pair = [key, value];</span>
        <span class="gd">-      pair.key = key;</span>
        <span class="gd">-      pair.value = value;</span>
        <span class="gd">-      iterator(pair);</span>
        <span class="gd">-    }</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function set(key, value) {</span>
        <span class="gd">-    return this._object[key] = value;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function get(key) {</span>
        <span class="gd">-    if (this._object[key] !== Object.prototype[key])</span>
        <span class="gd">-      return this._object[key];</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function unset(key) {</span>
        <span class="gd">-    var value = this._object[key];</span>
        <span class="gd">-    delete this._object[key];</span>
        <span class="gd">-    return value;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function toObject() {</span>
        <span class="gd">-    return Object.clone(this._object);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-  function keys() {</span>
        <span class="gd">-    return this.pluck(&#39;key&#39;);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function values() {</span>
        <span class="gd">-    return this.pluck(&#39;value&#39;);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function index(value) {</span>
        <span class="gd">-    var match = this.detect(function(pair) {</span>
        <span class="gd">-      return pair.value === value;</span>
        <span class="gd">-    });</span>
        <span class="gd">-    return match &amp;&amp; match.key;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function merge(object) {</span>
        <span class="gd">-    return this.clone().update(object);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function update(object) {</span>
        <span class="gd">-    return new Hash(object).inject(this, function(result, pair) {</span>
        <span class="gd">-      result.set(pair.key, pair.value);</span>
        <span class="gd">-      return result;</span>
        <span class="gd">-    });</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function toQueryPair(key, value) {</span>
        <span class="gd">-    if (Object.isUndefined(value)) return key;</span>
        <span class="gd">-    return key + &#39;=&#39; + encodeURIComponent(String.interpret(value));</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function toQueryString() {</span>
        <span class="gd">-    return this.inject([], function(results, pair) {</span>
        <span class="gd">-      var key = encodeURIComponent(pair.key), values = pair.value;</span>
        <span class="gd">-</span>
        <span class="gd">-      if (values &amp;&amp; typeof values == &#39;object&#39;) {</span>
        <span class="gd">-        if (Object.isArray(values))</span>
        <span class="gd">-          return results.concat(values.map(toQueryPair.curry(key)));</span>
        <span class="gd">-      } else results.push(toQueryPair(key, values));</span>
        <span class="gd">-      return results;</span>
        <span class="gd">-    }).join(&#39;&amp;&#39;);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function inspect() {</span>
        <span class="gd">-    return &#39;#&lt;Hash:{&#39; + this.map(function(pair) {</span>
        <span class="gd">-      return pair.map(Object.inspect).join(&#39;: &#39;);</span>
        <span class="gd">-    }).join(&#39;, &#39;) + &#39;}&gt;&#39;;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function clone() {</span>
        <span class="gd">-    return new Hash(this);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  return {</span>
        <span class="gd">-    initialize:             initialize,</span>
        <span class="gd">-    _each:                  _each,</span>
        <span class="gd">-    set:                    set,</span>
        <span class="gd">-    get:                    get,</span>
        <span class="gd">-    unset:                  unset,</span>
        <span class="gd">-    toObject:               toObject,</span>
        <span class="gd">-    toTemplateReplacements: toObject,</span>
        <span class="gd">-    keys:                   keys,</span>
        <span class="gd">-    values:                 values,</span>
        <span class="gd">-    index:                  index,</span>
        <span class="gd">-    merge:                  merge,</span>
        <span class="gd">-    update:                 update,</span>
        <span class="gd">-    toQueryString:          toQueryString,</span>
        <span class="gd">-    inspect:                inspect,</span>
        <span class="gd">-    toJSON:                 toObject,</span>
        <span class="gd">-    clone:                  clone</span>
        <span class="gd">-  };</span>
        <span class="gd">-})());</span>
        <span class="gd">-</span>
        <span class="gd">-Hash.from = $H;</span>
        <span class="gd">-Object.extend(Number.prototype, (function() {</span>
        <span class="gd">-  function toColorPart() {</span>
        <span class="gd">-    return this.toPaddedString(2, 16);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function succ() {</span>
        <span class="gd">-    return this + 1;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function times(iterator, context) {</span>
        <span class="gd">-    $R(0, this, true).each(iterator, context);</span>
        <span class="gd">-    return this;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function toPaddedString(length, radix) {</span>
        <span class="gd">-    var string = this.toString(radix || 10);</span>
        <span class="gd">-    return &#39;0&#39;.times(length - string.length) + string;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function abs() {</span>
        <span class="gd">-    return Math.abs(this);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function round() {</span>
        <span class="gd">-    return Math.round(this);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function ceil() {</span>
        <span class="gd">-    return Math.ceil(this);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function floor() {</span>
        <span class="gd">-    return Math.floor(this);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  return {</span>
        <span class="gd">-    toColorPart:    toColorPart,</span>
        <span class="gd">-    succ:           succ,</span>
        <span class="gd">-    times:          times,</span>
        <span class="gd">-    toPaddedString: toPaddedString,</span>
        <span class="gd">-    abs:            abs,</span>
        <span class="gd">-    round:          round,</span>
        <span class="gd">-    ceil:           ceil,</span>
        <span class="gd">-    floor:          floor</span>
        <span class="gd">-  };</span>
        <span class="gd">-})());</span>
        <span class="gd">-</span>
        <span class="gd">-function $R(start, end, exclusive) {</span>
        <span class="gd">-  return new ObjectRange(start, end, exclusive);</span>
        <span class="gd">-}</span>
        <span class="gd">-</span>
        <span class="gd">-var ObjectRange = Class.create(Enumerable, (function() {</span>
        <span class="gd">-  function initialize(start, end, exclusive) {</span>
        <span class="gd">-    this.start = start;</span>
        <span class="gd">-    this.end = end;</span>
        <span class="gd">-    this.exclusive = exclusive;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function _each(iterator) {</span>
        <span class="gd">-    var value = this.start;</span>
        <span class="gd">-    while (this.include(value)) {</span>
        <span class="gd">-      iterator(value);</span>
        <span class="gd">-      value = value.succ();</span>
        <span class="gd">-    }</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function include(value) {</span>
        <span class="gd">-    if (value &lt; this.start)</span>
        <span class="gd">-      return false;</span>
        <span class="gd">-    if (this.exclusive)</span>
        <span class="gd">-      return value &lt; this.end;</span>
        <span class="gd">-    return value &lt;= this.end;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  return {</span>
        <span class="gd">-    initialize: initialize,</span>
        <span class="gd">-    _each:      _each,</span>
        <span class="gd">-    include:    include</span>
        <span class="gd">-  };</span>
        <span class="gd">-})());</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-var Ajax = {</span>
        <span class="gd">-  getTransport: function() {</span>
        <span class="gd">-    return Try.these(</span>
        <span class="gd">-      function() {return new XMLHttpRequest()},</span>
        <span class="gd">-      function() {return new ActiveXObject(&#39;Msxml2.XMLHTTP&#39;)},</span>
        <span class="gd">-      function() {return new ActiveXObject(&#39;Microsoft.XMLHTTP&#39;)}</span>
        <span class="gd">-    ) || false;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  activeRequestCount: 0</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Ajax.Responders = {</span>
        <span class="gd">-  responders: [],</span>
        <span class="gd">-</span>
        <span class="gd">-  _each: function(iterator) {</span>
        <span class="gd">-    this.responders._each(iterator);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  register: function(responder) {</span>
        <span class="gd">-    if (!this.include(responder))</span>
        <span class="gd">-      this.responders.push(responder);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  unregister: function(responder) {</span>
        <span class="gd">-    this.responders = this.responders.without(responder);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  dispatch: function(callback, request, transport, json) {</span>
        <span class="gd">-    this.each(function(responder) {</span>
        <span class="gd">-      if (Object.isFunction(responder[callback])) {</span>
        <span class="gd">-        try {</span>
        <span class="gd">-          responder[callback].apply(responder, [request, transport, json]);</span>
        <span class="gd">-        } catch (e) { }</span>
        <span class="gd">-      }</span>
        <span class="gd">-    });</span>
        <span class="gd">-  }</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Object.extend(Ajax.Responders, Enumerable);</span>
        <span class="gd">-</span>
        <span class="gd">-Ajax.Responders.register({</span>
        <span class="gd">-  onCreate:   function() { Ajax.activeRequestCount++ },</span>
        <span class="gd">-  onComplete: function() { Ajax.activeRequestCount-- }</span>
        <span class="gd">-});</span>
        <span class="gd">-Ajax.Base = Class.create({</span>
        <span class="gd">-  initialize: function(options) {</span>
        <span class="gd">-    this.options = {</span>
        <span class="gd">-      method:       &#39;post&#39;,</span>
        <span class="gd">-      asynchronous: true,</span>
        <span class="gd">-      contentType:  &#39;application/x-www-form-urlencoded&#39;,</span>
        <span class="gd">-      encoding:     &#39;UTF-8&#39;,</span>
        <span class="gd">-      parameters:   &#39;&#39;,</span>
        <span class="gd">-      evalJSON:     true,</span>
        <span class="gd">-      evalJS:       true</span>
        <span class="gd">-    };</span>
        <span class="gd">-    Object.extend(this.options, options || { });</span>
        <span class="gd">-</span>
        <span class="gd">-    this.options.method = this.options.method.toLowerCase();</span>
        <span class="gd">-</span>
        <span class="gd">-    if (Object.isString(this.options.parameters))</span>
        <span class="gd">-      this.options.parameters = this.options.parameters.toQueryParams();</span>
        <span class="gd">-    else if (Object.isHash(this.options.parameters))</span>
        <span class="gd">-      this.options.parameters = this.options.parameters.toObject();</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-Ajax.Request = Class.create(Ajax.Base, {</span>
        <span class="gd">-  _complete: false,</span>
        <span class="gd">-</span>
        <span class="gd">-  initialize: function($super, url, options) {</span>
        <span class="gd">-    $super(options);</span>
        <span class="gd">-    this.transport = Ajax.getTransport();</span>
        <span class="gd">-    this.request(url);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  request: function(url) {</span>
        <span class="gd">-    this.url = url;</span>
        <span class="gd">-    this.method = this.options.method;</span>
        <span class="gd">-    var params = Object.clone(this.options.parameters);</span>
        <span class="gd">-</span>
        <span class="gd">-    if (![&#39;get&#39;, &#39;post&#39;].include(this.method)) {</span>
        <span class="gd">-      params[&#39;_method&#39;] = this.method;</span>
        <span class="gd">-      this.method = &#39;post&#39;;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    this.parameters = params;</span>
        <span class="gd">-</span>
        <span class="gd">-    if (params = Object.toQueryString(params)) {</span>
        <span class="gd">-      if (this.method == &#39;get&#39;)</span>
        <span class="gd">-        this.url += (this.url.include(&#39;?&#39;) ? &#39;&amp;&#39; : &#39;?&#39;) + params;</span>
        <span class="gd">-      else if (/Konqueror|Safari|KHTML/.test(navigator.userAgent))</span>
        <span class="gd">-        params += &#39;&amp;_=&#39;;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    try {</span>
        <span class="gd">-      var response = new Ajax.Response(this);</span>
        <span class="gd">-      if (this.options.onCreate) this.options.onCreate(response);</span>
        <span class="gd">-      Ajax.Responders.dispatch(&#39;onCreate&#39;, this, response);</span>
        <span class="gd">-</span>
        <span class="gd">-      this.transport.open(this.method.toUpperCase(), this.url,</span>
        <span class="gd">-        this.options.asynchronous);</span>
        <span class="gd">-</span>
        <span class="gd">-      if (this.options.asynchronous) this.respondToReadyState.bind(this).defer(1);</span>
        <span class="gd">-</span>
        <span class="gd">-      this.transport.onreadystatechange = this.onStateChange.bind(this);</span>
        <span class="gd">-      this.setRequestHeaders();</span>
        <span class="gd">-</span>
        <span class="gd">-      this.body = this.method == &#39;post&#39; ? (this.options.postBody || params) : null;</span>
        <span class="gd">-      this.transport.send(this.body);</span>
        <span class="gd">-</span>
        <span class="gd">-      /* Force Firefox to handle ready state 4 for synchronous requests */</span>
        <span class="gd">-      if (!this.options.asynchronous &amp;&amp; this.transport.overrideMimeType)</span>
        <span class="gd">-        this.onStateChange();</span>
        <span class="gd">-</span>
        <span class="gd">-    }</span>
        <span class="gd">-    catch (e) {</span>
        <span class="gd">-      this.dispatchException(e);</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  onStateChange: function() {</span>
        <span class="gd">-    var readyState = this.transport.readyState;</span>
        <span class="gd">-    if (readyState &gt; 1 &amp;&amp; !((readyState == 4) &amp;&amp; this._complete))</span>
        <span class="gd">-      this.respondToReadyState(this.transport.readyState);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  setRequestHeaders: function() {</span>
        <span class="gd">-    var headers = {</span>
        <span class="gd">-      &#39;X-Requested-With&#39;: &#39;XMLHttpRequest&#39;,</span>
        <span class="gd">-      &#39;X-Prototype-Version&#39;: Prototype.Version,</span>
        <span class="gd">-      &#39;Accept&#39;: &#39;text/javascript, text/html, application/xml, text/xml, */*&#39;</span>
        <span class="gd">-    };</span>
        <span class="gd">-</span>
        <span class="gd">-    if (this.method == &#39;post&#39;) {</span>
        <span class="gd">-      headers[&#39;Content-type&#39;] = this.options.contentType +</span>
        <span class="gd">-        (this.options.encoding ? &#39;; charset=&#39; + this.options.encoding : &#39;&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-      /* Force &quot;Connection: close&quot; for older Mozilla browsers to work</span>
        <span class="gd">-       * around a bug where XMLHttpRequest sends an incorrect</span>
        <span class="gd">-       * Content-length header. See Mozilla Bugzilla #246651.</span>
        <span class="gd">-       */</span>
        <span class="gd">-      if (this.transport.overrideMimeType &amp;&amp;</span>
        <span class="gd">-          (navigator.userAgent.match(/Gecko\/(\d{4})/) || [0,2005])[1] &lt; 2005)</span>
        <span class="gd">-            headers[&#39;Connection&#39;] = &#39;close&#39;;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    if (typeof this.options.requestHeaders == &#39;object&#39;) {</span>
        <span class="gd">-      var extras = this.options.requestHeaders;</span>
        <span class="gd">-</span>
        <span class="gd">-      if (Object.isFunction(extras.push))</span>
        <span class="gd">-        for (var i = 0, length = extras.length; i &lt; length; i += 2)</span>
        <span class="gd">-          headers[extras[i]] = extras[i+1];</span>
        <span class="gd">-      else</span>
        <span class="gd">-        $H(extras).each(function(pair) { headers[pair.key] = pair.value });</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    for (var name in headers)</span>
        <span class="gd">-      this.transport.setRequestHeader(name, headers[name]);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  success: function() {</span>
        <span class="gd">-    var status = this.getStatus();</span>
        <span class="gd">-    return !status || (status &gt;= 200 &amp;&amp; status &lt; 300);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  getStatus: function() {</span>
        <span class="gd">-    try {</span>
        <span class="gd">-      return this.transport.status || 0;</span>
        <span class="gd">-    } catch (e) { return 0 }</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  respondToReadyState: function(readyState) {</span>
        <span class="gd">-    var state = Ajax.Request.Events[readyState], response = new Ajax.Response(this);</span>
        <span class="gd">-</span>
        <span class="gd">-    if (state == &#39;Complete&#39;) {</span>
        <span class="gd">-      try {</span>
        <span class="gd">-        this._complete = true;</span>
        <span class="gd">-        (this.options[&#39;on&#39; + response.status]</span>
        <span class="gd">-         || this.options[&#39;on&#39; + (this.success() ? &#39;Success&#39; : &#39;Failure&#39;)]</span>
        <span class="gd">-         || Prototype.emptyFunction)(response, response.headerJSON);</span>
        <span class="gd">-      } catch (e) {</span>
        <span class="gd">-        this.dispatchException(e);</span>
        <span class="gd">-      }</span>
        <span class="gd">-</span>
        <span class="gd">-      var contentType = response.getHeader(&#39;Content-type&#39;);</span>
        <span class="gd">-      if (this.options.evalJS == &#39;force&#39;</span>
        <span class="gd">-          || (this.options.evalJS &amp;&amp; this.isSameOrigin() &amp;&amp; contentType</span>
        <span class="gd">-          &amp;&amp; contentType.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i)))</span>
        <span class="gd">-        this.evalResponse();</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    try {</span>
        <span class="gd">-      (this.options[&#39;on&#39; + state] || Prototype.emptyFunction)(response, response.headerJSON);</span>
        <span class="gd">-      Ajax.Responders.dispatch(&#39;on&#39; + state, this, response, response.headerJSON);</span>
        <span class="gd">-    } catch (e) {</span>
        <span class="gd">-      this.dispatchException(e);</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    if (state == &#39;Complete&#39;) {</span>
        <span class="gd">-      this.transport.onreadystatechange = Prototype.emptyFunction;</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  isSameOrigin: function() {</span>
        <span class="gd">-    var m = this.url.match(/^\s*https?:\/\/[^\/]*/);</span>
        <span class="gd">-    return !m || (m[0] == &#39;#{protocol}//#{domain}#{port}&#39;.interpolate({</span>
        <span class="gd">-      protocol: location.protocol,</span>
        <span class="gd">-      domain: document.domain,</span>
        <span class="gd">-      port: location.port ? &#39;:&#39; + location.port : &#39;&#39;</span>
        <span class="gd">-    }));</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  getHeader: function(name) {</span>
        <span class="gd">-    try {</span>
        <span class="gd">-      return this.transport.getResponseHeader(name) || null;</span>
        <span class="gd">-    } catch (e) { return null; }</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  evalResponse: function() {</span>
        <span class="gd">-    try {</span>
        <span class="gd">-      return eval((this.transport.responseText || &#39;&#39;).unfilterJSON());</span>
        <span class="gd">-    } catch (e) {</span>
        <span class="gd">-      this.dispatchException(e);</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  dispatchException: function(exception) {</span>
        <span class="gd">-    (this.options.onException || Prototype.emptyFunction)(this, exception);</span>
        <span class="gd">-    Ajax.Responders.dispatch(&#39;onException&#39;, this, exception);</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-Ajax.Request.Events =</span>
        <span class="gd">-  [&#39;Uninitialized&#39;, &#39;Loading&#39;, &#39;Loaded&#39;, &#39;Interactive&#39;, &#39;Complete&#39;];</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-Ajax.Response = Class.create({</span>
        <span class="gd">-  initialize: function(request){</span>
        <span class="gd">-    this.request = request;</span>
        <span class="gd">-    var transport  = this.transport  = request.transport,</span>
        <span class="gd">-        readyState = this.readyState = transport.readyState;</span>
        <span class="gd">-</span>
        <span class="gd">-    if ((readyState &gt; 2 &amp;&amp; !Prototype.Browser.IE) || readyState == 4) {</span>
        <span class="gd">-      this.status       = this.getStatus();</span>
        <span class="gd">-      this.statusText   = this.getStatusText();</span>
        <span class="gd">-      this.responseText = String.interpret(transport.responseText);</span>
        <span class="gd">-      this.headerJSON   = this._getHeaderJSON();</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    if (readyState == 4) {</span>
        <span class="gd">-      var xml = transport.responseXML;</span>
        <span class="gd">-      this.responseXML  = Object.isUndefined(xml) ? null : xml;</span>
        <span class="gd">-      this.responseJSON = this._getResponseJSON();</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  status:      0,</span>
        <span class="gd">-</span>
        <span class="gd">-  statusText: &#39;&#39;,</span>
        <span class="gd">-</span>
        <span class="gd">-  getStatus: Ajax.Request.prototype.getStatus,</span>
        <span class="gd">-</span>
        <span class="gd">-  getStatusText: function() {</span>
        <span class="gd">-    try {</span>
        <span class="gd">-      return this.transport.statusText || &#39;&#39;;</span>
        <span class="gd">-    } catch (e) { return &#39;&#39; }</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  getHeader: Ajax.Request.prototype.getHeader,</span>
        <span class="gd">-</span>
        <span class="gd">-  getAllHeaders: function() {</span>
        <span class="gd">-    try {</span>
        <span class="gd">-      return this.getAllResponseHeaders();</span>
        <span class="gd">-    } catch (e) { return null }</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  getResponseHeader: function(name) {</span>
        <span class="gd">-    return this.transport.getResponseHeader(name);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  getAllResponseHeaders: function() {</span>
        <span class="gd">-    return this.transport.getAllResponseHeaders();</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  _getHeaderJSON: function() {</span>
        <span class="gd">-    var json = this.getHeader(&#39;X-JSON&#39;);</span>
        <span class="gd">-    if (!json) return null;</span>
        <span class="gd">-    json = decodeURIComponent(escape(json));</span>
        <span class="gd">-    try {</span>
        <span class="gd">-      return json.evalJSON(this.request.options.sanitizeJSON ||</span>
        <span class="gd">-        !this.request.isSameOrigin());</span>
        <span class="gd">-    } catch (e) {</span>
        <span class="gd">-      this.request.dispatchException(e);</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  _getResponseJSON: function() {</span>
        <span class="gd">-    var options = this.request.options;</span>
        <span class="gd">-    if (!options.evalJSON || (options.evalJSON != &#39;force&#39; &amp;&amp;</span>
        <span class="gd">-      !(this.getHeader(&#39;Content-type&#39;) || &#39;&#39;).include(&#39;application/json&#39;)) ||</span>
        <span class="gd">-        this.responseText.blank())</span>
        <span class="gd">-          return null;</span>
        <span class="gd">-    try {</span>
        <span class="gd">-      return this.responseText.evalJSON(options.sanitizeJSON ||</span>
        <span class="gd">-        !this.request.isSameOrigin());</span>
        <span class="gd">-    } catch (e) {</span>
        <span class="gd">-      this.request.dispatchException(e);</span>
        <span class="gd">-    }</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-Ajax.Updater = Class.create(Ajax.Request, {</span>
        <span class="gd">-  initialize: function($super, container, url, options) {</span>
        <span class="gd">-    this.container = {</span>
        <span class="gd">-      success: (container.success || container),</span>
        <span class="gd">-      failure: (container.failure || (container.success ? null : container))</span>
        <span class="gd">-    };</span>
        <span class="gd">-</span>
        <span class="gd">-    options = Object.clone(options);</span>
        <span class="gd">-    var onComplete = options.onComplete;</span>
        <span class="gd">-    options.onComplete = (function(response, json) {</span>
        <span class="gd">-      this.updateContent(response.responseText);</span>
        <span class="gd">-      if (Object.isFunction(onComplete)) onComplete(response, json);</span>
        <span class="gd">-    }).bind(this);</span>
        <span class="gd">-</span>
        <span class="gd">-    $super(url, options);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  updateContent: function(responseText) {</span>
        <span class="gd">-    var receiver = this.container[this.success() ? &#39;success&#39; : &#39;failure&#39;],</span>
        <span class="gd">-        options = this.options;</span>
        <span class="gd">-</span>
        <span class="gd">-    if (!options.evalScripts) responseText = responseText.stripScripts();</span>
        <span class="gd">-</span>
        <span class="gd">-    if (receiver = $(receiver)) {</span>
        <span class="gd">-      if (options.insertion) {</span>
        <span class="gd">-        if (Object.isString(options.insertion)) {</span>
        <span class="gd">-          var insertion = { }; insertion[options.insertion] = responseText;</span>
        <span class="gd">-          receiver.insert(insertion);</span>
        <span class="gd">-        }</span>
        <span class="gd">-        else options.insertion(receiver, responseText);</span>
        <span class="gd">-      }</span>
        <span class="gd">-      else receiver.update(responseText);</span>
        <span class="gd">-    }</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-Ajax.PeriodicalUpdater = Class.create(Ajax.Base, {</span>
        <span class="gd">-  initialize: function($super, container, url, options) {</span>
        <span class="gd">-    $super(options);</span>
        <span class="gd">-    this.onComplete = this.options.onComplete;</span>
        <span class="gd">-</span>
        <span class="gd">-    this.frequency = (this.options.frequency || 2);</span>
        <span class="gd">-    this.decay = (this.options.decay || 1);</span>
        <span class="gd">-</span>
        <span class="gd">-    this.updater = { };</span>
        <span class="gd">-    this.container = container;</span>
        <span class="gd">-    this.url = url;</span>
        <span class="gd">-</span>
        <span class="gd">-    this.start();</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  start: function() {</span>
        <span class="gd">-    this.options.onComplete = this.updateComplete.bind(this);</span>
        <span class="gd">-    this.onTimerEvent();</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  stop: function() {</span>
        <span class="gd">-    this.updater.options.onComplete = undefined;</span>
        <span class="gd">-    clearTimeout(this.timer);</span>
        <span class="gd">-    (this.onComplete || Prototype.emptyFunction).apply(this, arguments);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  updateComplete: function(response) {</span>
        <span class="gd">-    if (this.options.decay) {</span>
        <span class="gd">-      this.decay = (response.responseText == this.lastText ?</span>
        <span class="gd">-        this.decay * this.options.decay : 1);</span>
        <span class="gd">-</span>
        <span class="gd">-      this.lastText = response.responseText;</span>
        <span class="gd">-    }</span>
        <span class="gd">-    this.timer = this.onTimerEvent.bind(this).delay(this.decay * this.frequency);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  onTimerEvent: function() {</span>
        <span class="gd">-    this.updater = new Ajax.Updater(this.container, this.url, this.options);</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-function $(element) {</span>
        <span class="gd">-  if (arguments.length &gt; 1) {</span>
        <span class="gd">-    for (var i = 0, elements = [], length = arguments.length; i &lt; length; i++)</span>
        <span class="gd">-      elements.push($(arguments[i]));</span>
        <span class="gd">-    return elements;</span>
        <span class="gd">-  }</span>
        <span class="gd">-  if (Object.isString(element))</span>
        <span class="gd">-    element = document.getElementById(element);</span>
        <span class="gd">-  return Element.extend(element);</span>
        <span class="gd">-}</span>
        <span class="gd">-</span>
        <span class="gd">-if (Prototype.BrowserFeatures.XPath) {</span>
        <span class="gd">-  document._getElementsByXPath = function(expression, parentElement) {</span>
        <span class="gd">-    var results = [];</span>
        <span class="gd">-    var query = document.evaluate(expression, $(parentElement) || document,</span>
        <span class="gd">-      null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);</span>
        <span class="gd">-    for (var i = 0, length = query.snapshotLength; i &lt; length; i++)</span>
        <span class="gd">-      results.push(Element.extend(query.snapshotItem(i)));</span>
        <span class="gd">-    return results;</span>
        <span class="gd">-  };</span>
        <span class="gd">-}</span>
        <span class="gd">-</span>
        <span class="gd">-/*--------------------------------------------------------------------------*/</span>
        <span class="gd">-</span>
        <span class="gd">-if (!Node) var Node = { };</span>
        <span class="gd">-</span>
        <span class="gd">-if (!Node.ELEMENT_NODE) {</span>
        <span class="gd">-  Object.extend(Node, {</span>
        <span class="gd">-    ELEMENT_NODE: 1,</span>
        <span class="gd">-    ATTRIBUTE_NODE: 2,</span>
        <span class="gd">-    TEXT_NODE: 3,</span>
        <span class="gd">-    CDATA_SECTION_NODE: 4,</span>
        <span class="gd">-    ENTITY_REFERENCE_NODE: 5,</span>
        <span class="gd">-    ENTITY_NODE: 6,</span>
        <span class="gd">-    PROCESSING_INSTRUCTION_NODE: 7,</span>
        <span class="gd">-    COMMENT_NODE: 8,</span>
        <span class="gd">-    DOCUMENT_NODE: 9,</span>
        <span class="gd">-    DOCUMENT_TYPE_NODE: 10,</span>
        <span class="gd">-    DOCUMENT_FRAGMENT_NODE: 11,</span>
        <span class="gd">-    NOTATION_NODE: 12</span>
        <span class="gd">-  });</span>
        <span class="gd">-}</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-(function(global) {</span>
        <span class="gd">-</span>
        <span class="gd">-  var HAS_EXTENDED_CREATE_ELEMENT_SYNTAX = (function(){</span>
        <span class="gd">-    try {</span>
        <span class="gd">-      var el = document.createElement(&#39;&lt;input name=&quot;x&quot;&gt;&#39;);</span>
        <span class="gd">-      return el.tagName.toLowerCase() === &#39;input&#39; &amp;&amp; el.name === &#39;x&#39;;</span>
        <span class="gd">-    }</span>
        <span class="gd">-    catch(err) {</span>
        <span class="gd">-      return false;</span>
        <span class="gd">-    }</span>
        <span class="gd">-  })();</span>
        <span class="gd">-</span>
        <span class="gd">-  var element = global.Element;</span>
        <span class="gd">-</span>
        <span class="gd">-  global.Element = function(tagName, attributes) {</span>
        <span class="gd">-    attributes = attributes || { };</span>
        <span class="gd">-    tagName = tagName.toLowerCase();</span>
        <span class="gd">-    var cache = Element.cache;</span>
        <span class="gd">-    if (HAS_EXTENDED_CREATE_ELEMENT_SYNTAX &amp;&amp; attributes.name) {</span>
        <span class="gd">-      tagName = &#39;&lt;&#39; + tagName + &#39; name=&quot;&#39; + attributes.name + &#39;&quot;&gt;&#39;;</span>
        <span class="gd">-      delete attributes.name;</span>
        <span class="gd">-      return Element.writeAttribute(document.createElement(tagName), attributes);</span>
        <span class="gd">-    }</span>
        <span class="gd">-    if (!cache[tagName]) cache[tagName] = Element.extend(document.createElement(tagName));</span>
        <span class="gd">-    return Element.writeAttribute(cache[tagName].cloneNode(false), attributes);</span>
        <span class="gd">-  };</span>
        <span class="gd">-</span>
        <span class="gd">-  Object.extend(global.Element, element || { });</span>
        <span class="gd">-  if (element) global.Element.prototype = element.prototype;</span>
        <span class="gd">-</span>
        <span class="gd">-})(this);</span>
        <span class="gd">-</span>
        <span class="gd">-Element.idCounter = 1;</span>
        <span class="gd">-Element.cache = { };</span>
        <span class="gd">-</span>
        <span class="gd">-function purgeElement(element) {</span>
        <span class="gd">-  var uid = element._prototypeUID;</span>
        <span class="gd">-  if (uid) {</span>
        <span class="gd">-    Element.stopObserving(element);</span>
        <span class="gd">-    element._prototypeUID = void 0;</span>
        <span class="gd">-    delete Element.Storage[uid];</span>
        <span class="gd">-  }</span>
        <span class="gd">-}</span>
        <span class="gd">-</span>
        <span class="gd">-Element.Methods = {</span>
        <span class="gd">-  visible: function(element) {</span>
        <span class="gd">-    return $(element).style.display != &#39;none&#39;;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  toggle: function(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    Element[Element.visible(element) ? &#39;hide&#39; : &#39;show&#39;](element);</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  hide: function(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    element.style.display = &#39;none&#39;;</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  show: function(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    element.style.display = &#39;&#39;;</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  remove: function(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    element.parentNode.removeChild(element);</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  update: (function(){</span>
        <span class="gd">-</span>
        <span class="gd">-    var SELECT_ELEMENT_INNERHTML_BUGGY = (function(){</span>
        <span class="gd">-      var el = document.createElement(&quot;select&quot;),</span>
        <span class="gd">-          isBuggy = true;</span>
        <span class="gd">-      el.innerHTML = &quot;&lt;option value=\&quot;test\&quot;&gt;test&lt;/option&gt;&quot;;</span>
        <span class="gd">-      if (el.options &amp;&amp; el.options[0]) {</span>
        <span class="gd">-        isBuggy = el.options[0].nodeName.toUpperCase() !== &quot;OPTION&quot;;</span>
        <span class="gd">-      }</span>
        <span class="gd">-      el = null;</span>
        <span class="gd">-      return isBuggy;</span>
        <span class="gd">-    })();</span>
        <span class="gd">-</span>
        <span class="gd">-    var TABLE_ELEMENT_INNERHTML_BUGGY = (function(){</span>
        <span class="gd">-      try {</span>
        <span class="gd">-        var el = document.createElement(&quot;table&quot;);</span>
        <span class="gd">-        if (el &amp;&amp; el.tBodies) {</span>
        <span class="gd">-          el.innerHTML = &quot;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;test&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&quot;;</span>
        <span class="gd">-          var isBuggy = typeof el.tBodies[0] == &quot;undefined&quot;;</span>
        <span class="gd">-          el = null;</span>
        <span class="gd">-          return isBuggy;</span>
        <span class="gd">-        }</span>
        <span class="gd">-      } catch (e) {</span>
        <span class="gd">-        return true;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    })();</span>
        <span class="gd">-</span>
        <span class="gd">-    var SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING = (function () {</span>
        <span class="gd">-      var s = document.createElement(&quot;script&quot;),</span>
        <span class="gd">-          isBuggy = false;</span>
        <span class="gd">-      try {</span>
        <span class="gd">-        s.appendChild(document.createTextNode(&quot;&quot;));</span>
        <span class="gd">-        isBuggy = !s.firstChild ||</span>
        <span class="gd">-          s.firstChild &amp;&amp; s.firstChild.nodeType !== 3;</span>
        <span class="gd">-      } catch (e) {</span>
        <span class="gd">-        isBuggy = true;</span>
        <span class="gd">-      }</span>
        <span class="gd">-      s = null;</span>
        <span class="gd">-      return isBuggy;</span>
        <span class="gd">-    })();</span>
        <span class="gd">-</span>
        <span class="gd">-    function update(element, content) {</span>
        <span class="gd">-      element = $(element);</span>
        <span class="gd">-</span>
        <span class="gd">-      var descendants = element.getElementsByTagName(&#39;*&#39;),</span>
        <span class="gd">-       i = descendants.length;</span>
        <span class="gd">-      while (i--) purgeElement(descendants[i]);</span>
        <span class="gd">-</span>
        <span class="gd">-      if (content &amp;&amp; content.toElement)</span>
        <span class="gd">-        content = content.toElement();</span>
        <span class="gd">-</span>
        <span class="gd">-      if (Object.isElement(content))</span>
        <span class="gd">-        return element.update().insert(content);</span>
        <span class="gd">-</span>
        <span class="gd">-      content = Object.toHTML(content);</span>
        <span class="gd">-</span>
        <span class="gd">-      var tagName = element.tagName.toUpperCase();</span>
        <span class="gd">-</span>
        <span class="gd">-      if (tagName === &#39;SCRIPT&#39; &amp;&amp; SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING) {</span>
        <span class="gd">-        element.text = content;</span>
        <span class="gd">-        return element;</span>
        <span class="gd">-      }</span>
        <span class="gd">-</span>
        <span class="gd">-      if (SELECT_ELEMENT_INNERHTML_BUGGY || TABLE_ELEMENT_INNERHTML_BUGGY) {</span>
        <span class="gd">-        if (tagName in Element._insertionTranslations.tags) {</span>
        <span class="gd">-          while (element.firstChild) {</span>
        <span class="gd">-            element.removeChild(element.firstChild);</span>
        <span class="gd">-          }</span>
        <span class="gd">-          Element._getContentFromAnonymousElement(tagName, content.stripScripts())</span>
        <span class="gd">-            .each(function(node) {</span>
        <span class="gd">-              element.appendChild(node)</span>
        <span class="gd">-            });</span>
        <span class="gd">-        }</span>
        <span class="gd">-        else {</span>
        <span class="gd">-          element.innerHTML = content.stripScripts();</span>
        <span class="gd">-        }</span>
        <span class="gd">-      }</span>
        <span class="gd">-      else {</span>
        <span class="gd">-        element.innerHTML = content.stripScripts();</span>
        <span class="gd">-      }</span>
        <span class="gd">-</span>
        <span class="gd">-      content.evalScripts.bind(content).defer();</span>
        <span class="gd">-      return element;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    return update;</span>
        <span class="gd">-  })(),</span>
        <span class="gd">-</span>
        <span class="gd">-  replace: function(element, content) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    if (content &amp;&amp; content.toElement) content = content.toElement();</span>
        <span class="gd">-    else if (!Object.isElement(content)) {</span>
        <span class="gd">-      content = Object.toHTML(content);</span>
        <span class="gd">-      var range = element.ownerDocument.createRange();</span>
        <span class="gd">-      range.selectNode(element);</span>
        <span class="gd">-      content.evalScripts.bind(content).defer();</span>
        <span class="gd">-      content = range.createContextualFragment(content.stripScripts());</span>
        <span class="gd">-    }</span>
        <span class="gd">-    element.parentNode.replaceChild(content, element);</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  insert: function(element, insertions) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-</span>
        <span class="gd">-    if (Object.isString(insertions) || Object.isNumber(insertions) ||</span>
        <span class="gd">-        Object.isElement(insertions) || (insertions &amp;&amp; (insertions.toElement || insertions.toHTML)))</span>
        <span class="gd">-          insertions = {bottom:insertions};</span>
        <span class="gd">-</span>
        <span class="gd">-    var content, insert, tagName, childNodes;</span>
        <span class="gd">-</span>
        <span class="gd">-    for (var position in insertions) {</span>
        <span class="gd">-      content  = insertions[position];</span>
        <span class="gd">-      position = position.toLowerCase();</span>
        <span class="gd">-      insert = Element._insertionTranslations[position];</span>
        <span class="gd">-</span>
        <span class="gd">-      if (content &amp;&amp; content.toElement) content = content.toElement();</span>
        <span class="gd">-      if (Object.isElement(content)) {</span>
        <span class="gd">-        insert(element, content);</span>
        <span class="gd">-        continue;</span>
        <span class="gd">-      }</span>
        <span class="gd">-</span>
        <span class="gd">-      content = Object.toHTML(content);</span>
        <span class="gd">-</span>
        <span class="gd">-      tagName = ((position == &#39;before&#39; || position == &#39;after&#39;)</span>
        <span class="gd">-        ? element.parentNode : element).tagName.toUpperCase();</span>
        <span class="gd">-</span>
        <span class="gd">-      childNodes = Element._getContentFromAnonymousElement(tagName, content.stripScripts());</span>
        <span class="gd">-</span>
        <span class="gd">-      if (position == &#39;top&#39; || position == &#39;after&#39;) childNodes.reverse();</span>
        <span class="gd">-      childNodes.each(insert.curry(element));</span>
        <span class="gd">-</span>
        <span class="gd">-      content.evalScripts.bind(content).defer();</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  wrap: function(element, wrapper, attributes) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    if (Object.isElement(wrapper))</span>
        <span class="gd">-      $(wrapper).writeAttribute(attributes || { });</span>
        <span class="gd">-    else if (Object.isString(wrapper)) wrapper = new Element(wrapper, attributes);</span>
        <span class="gd">-    else wrapper = new Element(&#39;div&#39;, wrapper);</span>
        <span class="gd">-    if (element.parentNode)</span>
        <span class="gd">-      element.parentNode.replaceChild(wrapper, element);</span>
        <span class="gd">-    wrapper.appendChild(element);</span>
        <span class="gd">-    return wrapper;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  inspect: function(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    var result = &#39;&lt;&#39; + element.tagName.toLowerCase();</span>
        <span class="gd">-    $H({&#39;id&#39;: &#39;id&#39;, &#39;className&#39;: &#39;class&#39;}).each(function(pair) {</span>
        <span class="gd">-      var property = pair.first(),</span>
        <span class="gd">-          attribute = pair.last(),</span>
        <span class="gd">-          value = (element[property] || &#39;&#39;).toString();</span>
        <span class="gd">-      if (value) result += &#39; &#39; + attribute + &#39;=&#39; + value.inspect(true);</span>
        <span class="gd">-    });</span>
        <span class="gd">-    return result + &#39;&gt;&#39;;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  recursivelyCollect: function(element, property, maximumLength) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    maximumLength = maximumLength || -1;</span>
        <span class="gd">-    var elements = [];</span>
        <span class="gd">-</span>
        <span class="gd">-    while (element = element[property]) {</span>
        <span class="gd">-      if (element.nodeType == 1)</span>
        <span class="gd">-        elements.push(Element.extend(element));</span>
        <span class="gd">-      if (elements.length == maximumLength)</span>
        <span class="gd">-        break;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    return elements;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  ancestors: function(element) {</span>
        <span class="gd">-    return Element.recursivelyCollect(element, &#39;parentNode&#39;);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  descendants: function(element) {</span>
        <span class="gd">-    return Element.select(element, &quot;*&quot;);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  firstDescendant: function(element) {</span>
        <span class="gd">-    element = $(element).firstChild;</span>
        <span class="gd">-    while (element &amp;&amp; element.nodeType != 1) element = element.nextSibling;</span>
        <span class="gd">-    return $(element);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  immediateDescendants: function(element) {</span>
        <span class="gd">-    var results = [], child = $(element).firstChild;</span>
        <span class="gd">-    while (child) {</span>
        <span class="gd">-      if (child.nodeType === 1) {</span>
        <span class="gd">-        results.push(Element.extend(child));</span>
        <span class="gd">-      }</span>
        <span class="gd">-      child = child.nextSibling;</span>
        <span class="gd">-    }</span>
        <span class="gd">-    return results;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  previousSiblings: function(element, maximumLength) {</span>
        <span class="gd">-    return Element.recursivelyCollect(element, &#39;previousSibling&#39;);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  nextSiblings: function(element) {</span>
        <span class="gd">-    return Element.recursivelyCollect(element, &#39;nextSibling&#39;);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  siblings: function(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    return Element.previousSiblings(element).reverse()</span>
        <span class="gd">-      .concat(Element.nextSiblings(element));</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  match: function(element, selector) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    if (Object.isString(selector))</span>
        <span class="gd">-      return Prototype.Selector.match(element, selector);</span>
        <span class="gd">-    return selector.match(element);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  up: function(element, expression, index) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    if (arguments.length == 1) return $(element.parentNode);</span>
        <span class="gd">-    var ancestors = Element.ancestors(element);</span>
        <span class="gd">-    return Object.isNumber(expression) ? ancestors[expression] :</span>
        <span class="gd">-      Prototype.Selector.find(ancestors, expression, index);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  down: function(element, expression, index) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    if (arguments.length == 1) return Element.firstDescendant(element);</span>
        <span class="gd">-    return Object.isNumber(expression) ? Element.descendants(element)[expression] :</span>
        <span class="gd">-      Element.select(element, expression)[index || 0];</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  previous: function(element, expression, index) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    if (Object.isNumber(expression)) index = expression, expression = false;</span>
        <span class="gd">-    if (!Object.isNumber(index)) index = 0;</span>
        <span class="gd">-</span>
        <span class="gd">-    if (expression) {</span>
        <span class="gd">-      return Prototype.Selector.find(element.previousSiblings(), expression, index);</span>
        <span class="gd">-    } else {</span>
        <span class="gd">-      return element.recursivelyCollect(&quot;previousSibling&quot;, index + 1)[index];</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  next: function(element, expression, index) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    if (Object.isNumber(expression)) index = expression, expression = false;</span>
        <span class="gd">-    if (!Object.isNumber(index)) index = 0;</span>
        <span class="gd">-</span>
        <span class="gd">-    if (expression) {</span>
        <span class="gd">-      return Prototype.Selector.find(element.nextSiblings(), expression, index);</span>
        <span class="gd">-    } else {</span>
        <span class="gd">-      var maximumLength = Object.isNumber(index) ? index + 1 : 1;</span>
        <span class="gd">-      return element.recursivelyCollect(&quot;nextSibling&quot;, index + 1)[index];</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-  select: function(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    var expressions = Array.prototype.slice.call(arguments, 1).join(&#39;, &#39;);</span>
        <span class="gd">-    return Prototype.Selector.select(expressions, element);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  adjacent: function(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    var expressions = Array.prototype.slice.call(arguments, 1).join(&#39;, &#39;);</span>
        <span class="gd">-    return Prototype.Selector.select(expressions, element.parentNode).without(element);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  identify: function(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    var id = Element.readAttribute(element, &#39;id&#39;);</span>
        <span class="gd">-    if (id) return id;</span>
        <span class="gd">-    do { id = &#39;anonymous_element_&#39; + Element.idCounter++ } while ($(id));</span>
        <span class="gd">-    Element.writeAttribute(element, &#39;id&#39;, id);</span>
        <span class="gd">-    return id;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  readAttribute: function(element, name) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    if (Prototype.Browser.IE) {</span>
        <span class="gd">-      var t = Element._attributeTranslations.read;</span>
        <span class="gd">-      if (t.values[name]) return t.values[name](element, name);</span>
        <span class="gd">-      if (t.names[name]) name = t.names[name];</span>
        <span class="gd">-      if (name.include(&#39;:&#39;)) {</span>
        <span class="gd">-        return (!element.attributes || !element.attributes[name]) ? null :</span>
        <span class="gd">-         element.attributes[name].value;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-    return element.getAttribute(name);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  writeAttribute: function(element, name, value) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    var attributes = { }, t = Element._attributeTranslations.write;</span>
        <span class="gd">-</span>
        <span class="gd">-    if (typeof name == &#39;object&#39;) attributes = name;</span>
        <span class="gd">-    else attributes[name] = Object.isUndefined(value) ? true : value;</span>
        <span class="gd">-</span>
        <span class="gd">-    for (var attr in attributes) {</span>
        <span class="gd">-      name = t.names[attr] || attr;</span>
        <span class="gd">-      value = attributes[attr];</span>
        <span class="gd">-      if (t.values[attr]) name = t.values[attr](element, value);</span>
        <span class="gd">-      if (value === false || value === null)</span>
        <span class="gd">-        element.removeAttribute(name);</span>
        <span class="gd">-      else if (value === true)</span>
        <span class="gd">-        element.setAttribute(name, name);</span>
        <span class="gd">-      else element.setAttribute(name, value);</span>
        <span class="gd">-    }</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  getHeight: function(element) {</span>
        <span class="gd">-    return Element.getDimensions(element).height;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  getWidth: function(element) {</span>
        <span class="gd">-    return Element.getDimensions(element).width;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  classNames: function(element) {</span>
        <span class="gd">-    return new Element.ClassNames(element);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  hasClassName: function(element, className) {</span>
        <span class="gd">-    if (!(element = $(element))) return;</span>
        <span class="gd">-    var elementClassName = element.className;</span>
        <span class="gd">-    return (elementClassName.length &gt; 0 &amp;&amp; (elementClassName == className ||</span>
        <span class="gd">-      new RegExp(&quot;(^|\\s)&quot; + className + &quot;(\\s|$)&quot;).test(elementClassName)));</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  addClassName: function(element, className) {</span>
        <span class="gd">-    if (!(element = $(element))) return;</span>
        <span class="gd">-    if (!Element.hasClassName(element, className))</span>
        <span class="gd">-      element.className += (element.className ? &#39; &#39; : &#39;&#39;) + className;</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  removeClassName: function(element, className) {</span>
        <span class="gd">-    if (!(element = $(element))) return;</span>
        <span class="gd">-    element.className = element.className.replace(</span>
        <span class="gd">-      new RegExp(&quot;(^|\\s+)&quot; + className + &quot;(\\s+|$)&quot;), &#39; &#39;).strip();</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  toggleClassName: function(element, className) {</span>
        <span class="gd">-    if (!(element = $(element))) return;</span>
        <span class="gd">-    return Element[Element.hasClassName(element, className) ?</span>
        <span class="gd">-      &#39;removeClassName&#39; : &#39;addClassName&#39;](element, className);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  cleanWhitespace: function(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    var node = element.firstChild;</span>
        <span class="gd">-    while (node) {</span>
        <span class="gd">-      var nextNode = node.nextSibling;</span>
        <span class="gd">-      if (node.nodeType == 3 &amp;&amp; !/\S/.test(node.nodeValue))</span>
        <span class="gd">-        element.removeChild(node);</span>
        <span class="gd">-      node = nextNode;</span>
        <span class="gd">-    }</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  empty: function(element) {</span>
        <span class="gd">-    return $(element).innerHTML.blank();</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  descendantOf: function(element, ancestor) {</span>
        <span class="gd">-    element = $(element), ancestor = $(ancestor);</span>
        <span class="gd">-</span>
        <span class="gd">-    if (element.compareDocumentPosition)</span>
        <span class="gd">-      return (element.compareDocumentPosition(ancestor) &amp; 8) === 8;</span>
        <span class="gd">-</span>
        <span class="gd">-    if (ancestor.contains)</span>
        <span class="gd">-      return ancestor.contains(element) &amp;&amp; ancestor !== element;</span>
        <span class="gd">-</span>
        <span class="gd">-    while (element = element.parentNode)</span>
        <span class="gd">-      if (element == ancestor) return true;</span>
        <span class="gd">-</span>
        <span class="gd">-    return false;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  scrollTo: function(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    var pos = Element.cumulativeOffset(element);</span>
        <span class="gd">-    window.scrollTo(pos[0], pos[1]);</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  getStyle: function(element, style) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    style = style == &#39;float&#39; ? &#39;cssFloat&#39; : style.camelize();</span>
        <span class="gd">-    var value = element.style[style];</span>
        <span class="gd">-    if (!value || value == &#39;auto&#39;) {</span>
        <span class="gd">-      var css = document.defaultView.getComputedStyle(element, null);</span>
        <span class="gd">-      value = css ? css[style] : null;</span>
        <span class="gd">-    }</span>
        <span class="gd">-    if (style == &#39;opacity&#39;) return value ? parseFloat(value) : 1.0;</span>
        <span class="gd">-    return value == &#39;auto&#39; ? null : value;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  getOpacity: function(element) {</span>
        <span class="gd">-    return $(element).getStyle(&#39;opacity&#39;);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  setStyle: function(element, styles) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    var elementStyle = element.style, match;</span>
        <span class="gd">-    if (Object.isString(styles)) {</span>
        <span class="gd">-      element.style.cssText += &#39;;&#39; + styles;</span>
        <span class="gd">-      return styles.include(&#39;opacity&#39;) ?</span>
        <span class="gd">-        element.setOpacity(styles.match(/opacity:\s*(\d?\.?\d*)/)[1]) : element;</span>
        <span class="gd">-    }</span>
        <span class="gd">-    for (var property in styles)</span>
        <span class="gd">-      if (property == &#39;opacity&#39;) element.setOpacity(styles[property]);</span>
        <span class="gd">-      else</span>
        <span class="gd">-        elementStyle[(property == &#39;float&#39; || property == &#39;cssFloat&#39;) ?</span>
        <span class="gd">-          (Object.isUndefined(elementStyle.styleFloat) ? &#39;cssFloat&#39; : &#39;styleFloat&#39;) :</span>
        <span class="gd">-            property] = styles[property];</span>
        <span class="gd">-</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  setOpacity: function(element, value) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    element.style.opacity = (value == 1 || value === &#39;&#39;) ? &#39;&#39; :</span>
        <span class="gd">-      (value &lt; 0.00001) ? 0 : value;</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  makePositioned: function(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    var pos = Element.getStyle(element, &#39;position&#39;);</span>
        <span class="gd">-    if (pos == &#39;static&#39; || !pos) {</span>
        <span class="gd">-      element._madePositioned = true;</span>
        <span class="gd">-      element.style.position = &#39;relative&#39;;</span>
        <span class="gd">-      if (Prototype.Browser.Opera) {</span>
        <span class="gd">-        element.style.top = 0;</span>
        <span class="gd">-        element.style.left = 0;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  undoPositioned: function(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    if (element._madePositioned) {</span>
        <span class="gd">-      element._madePositioned = undefined;</span>
        <span class="gd">-      element.style.position =</span>
        <span class="gd">-        element.style.top =</span>
        <span class="gd">-        element.style.left =</span>
        <span class="gd">-        element.style.bottom =</span>
        <span class="gd">-        element.style.right = &#39;&#39;;</span>
        <span class="gd">-    }</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  makeClipping: function(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    if (element._overflow) return element;</span>
        <span class="gd">-    element._overflow = Element.getStyle(element, &#39;overflow&#39;) || &#39;auto&#39;;</span>
        <span class="gd">-    if (element._overflow !== &#39;hidden&#39;)</span>
        <span class="gd">-      element.style.overflow = &#39;hidden&#39;;</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  undoClipping: function(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    if (!element._overflow) return element;</span>
        <span class="gd">-    element.style.overflow = element._overflow == &#39;auto&#39; ? &#39;&#39; : element._overflow;</span>
        <span class="gd">-    element._overflow = null;</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  cumulativeOffset: function(element) {</span>
        <span class="gd">-    var valueT = 0, valueL = 0;</span>
        <span class="gd">-    if (element.parentNode) {</span>
        <span class="gd">-      do {</span>
        <span class="gd">-        valueT += element.offsetTop  || 0;</span>
        <span class="gd">-        valueL += element.offsetLeft || 0;</span>
        <span class="gd">-        element = element.offsetParent;</span>
        <span class="gd">-      } while (element);</span>
        <span class="gd">-    }</span>
        <span class="gd">-    return Element._returnOffset(valueL, valueT);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  positionedOffset: function(element) {</span>
        <span class="gd">-    var valueT = 0, valueL = 0;</span>
        <span class="gd">-    do {</span>
        <span class="gd">-      valueT += element.offsetTop  || 0;</span>
        <span class="gd">-      valueL += element.offsetLeft || 0;</span>
        <span class="gd">-      element = element.offsetParent;</span>
        <span class="gd">-      if (element) {</span>
        <span class="gd">-        if (element.tagName.toUpperCase() == &#39;BODY&#39;) break;</span>
        <span class="gd">-        var p = Element.getStyle(element, &#39;position&#39;);</span>
        <span class="gd">-        if (p !== &#39;static&#39;) break;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    } while (element);</span>
        <span class="gd">-    return Element._returnOffset(valueL, valueT);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  absolutize: function(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    if (Element.getStyle(element, &#39;position&#39;) == &#39;absolute&#39;) return element;</span>
        <span class="gd">-</span>
        <span class="gd">-    var offsets = Element.positionedOffset(element),</span>
        <span class="gd">-        top     = offsets[1],</span>
        <span class="gd">-        left    = offsets[0],</span>
        <span class="gd">-        width   = element.clientWidth,</span>
        <span class="gd">-        height  = element.clientHeight;</span>
        <span class="gd">-</span>
        <span class="gd">-    element._originalLeft   = left - parseFloat(element.style.left  || 0);</span>
        <span class="gd">-    element._originalTop    = top  - parseFloat(element.style.top || 0);</span>
        <span class="gd">-    element._originalWidth  = element.style.width;</span>
        <span class="gd">-    element._originalHeight = element.style.height;</span>
        <span class="gd">-</span>
        <span class="gd">-    element.style.position = &#39;absolute&#39;;</span>
        <span class="gd">-    element.style.top    = top + &#39;px&#39;;</span>
        <span class="gd">-    element.style.left   = left + &#39;px&#39;;</span>
        <span class="gd">-    element.style.width  = width + &#39;px&#39;;</span>
        <span class="gd">-    element.style.height = height + &#39;px&#39;;</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  relativize: function(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    if (Element.getStyle(element, &#39;position&#39;) == &#39;relative&#39;) return element;</span>
        <span class="gd">-</span>
        <span class="gd">-    element.style.position = &#39;relative&#39;;</span>
        <span class="gd">-    var top  = parseFloat(element.style.top  || 0) - (element._originalTop || 0),</span>
        <span class="gd">-        left = parseFloat(element.style.left || 0) - (element._originalLeft || 0);</span>
        <span class="gd">-</span>
        <span class="gd">-    element.style.top    = top + &#39;px&#39;;</span>
        <span class="gd">-    element.style.left   = left + &#39;px&#39;;</span>
        <span class="gd">-    element.style.height = element._originalHeight;</span>
        <span class="gd">-    element.style.width  = element._originalWidth;</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  cumulativeScrollOffset: function(element) {</span>
        <span class="gd">-    var valueT = 0, valueL = 0;</span>
        <span class="gd">-    do {</span>
        <span class="gd">-      valueT += element.scrollTop  || 0;</span>
        <span class="gd">-      valueL += element.scrollLeft || 0;</span>
        <span class="gd">-      element = element.parentNode;</span>
        <span class="gd">-    } while (element);</span>
        <span class="gd">-    return Element._returnOffset(valueL, valueT);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  getOffsetParent: function(element) {</span>
        <span class="gd">-    if (element.offsetParent) return $(element.offsetParent);</span>
        <span class="gd">-    if (element == document.body) return $(element);</span>
        <span class="gd">-</span>
        <span class="gd">-    while ((element = element.parentNode) &amp;&amp; element != document.body)</span>
        <span class="gd">-      if (Element.getStyle(element, &#39;position&#39;) != &#39;static&#39;)</span>
        <span class="gd">-        return $(element);</span>
        <span class="gd">-</span>
        <span class="gd">-    return $(document.body);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  viewportOffset: function(forElement) {</span>
        <span class="gd">-    var valueT = 0,</span>
        <span class="gd">-        valueL = 0,</span>
        <span class="gd">-        element = forElement;</span>
        <span class="gd">-</span>
        <span class="gd">-    do {</span>
        <span class="gd">-      valueT += element.offsetTop  || 0;</span>
        <span class="gd">-      valueL += element.offsetLeft || 0;</span>
        <span class="gd">-</span>
        <span class="gd">-      if (element.offsetParent == document.body &amp;&amp;</span>
        <span class="gd">-        Element.getStyle(element, &#39;position&#39;) == &#39;absolute&#39;) break;</span>
        <span class="gd">-</span>
        <span class="gd">-    } while (element = element.offsetParent);</span>
        <span class="gd">-</span>
        <span class="gd">-    element = forElement;</span>
        <span class="gd">-    do {</span>
        <span class="gd">-      if (!Prototype.Browser.Opera || (element.tagName &amp;&amp; (element.tagName.toUpperCase() == &#39;BODY&#39;))) {</span>
        <span class="gd">-        valueT -= element.scrollTop  || 0;</span>
        <span class="gd">-        valueL -= element.scrollLeft || 0;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    } while (element = element.parentNode);</span>
        <span class="gd">-</span>
        <span class="gd">-    return Element._returnOffset(valueL, valueT);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  clonePosition: function(element, source) {</span>
        <span class="gd">-    var options = Object.extend({</span>
        <span class="gd">-      setLeft:    true,</span>
        <span class="gd">-      setTop:     true,</span>
        <span class="gd">-      setWidth:   true,</span>
        <span class="gd">-      setHeight:  true,</span>
        <span class="gd">-      offsetTop:  0,</span>
        <span class="gd">-      offsetLeft: 0</span>
        <span class="gd">-    }, arguments[2] || { });</span>
        <span class="gd">-</span>
        <span class="gd">-    source = $(source);</span>
        <span class="gd">-    var p = Element.viewportOffset(source), delta = [0, 0], parent = null;</span>
        <span class="gd">-</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-</span>
        <span class="gd">-    if (Element.getStyle(element, &#39;position&#39;) == &#39;absolute&#39;) {</span>
        <span class="gd">-      parent = Element.getOffsetParent(element);</span>
        <span class="gd">-      delta = Element.viewportOffset(parent);</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    if (parent == document.body) {</span>
        <span class="gd">-      delta[0] -= document.body.offsetLeft;</span>
        <span class="gd">-      delta[1] -= document.body.offsetTop;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    if (options.setLeft)   element.style.left  = (p[0] - delta[0] + options.offsetLeft) + &#39;px&#39;;</span>
        <span class="gd">-    if (options.setTop)    element.style.top   = (p[1] - delta[1] + options.offsetTop) + &#39;px&#39;;</span>
        <span class="gd">-    if (options.setWidth)  element.style.width = source.offsetWidth + &#39;px&#39;;</span>
        <span class="gd">-    if (options.setHeight) element.style.height = source.offsetHeight + &#39;px&#39;;</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  }</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Object.extend(Element.Methods, {</span>
        <span class="gd">-  getElementsBySelector: Element.Methods.select,</span>
        <span class="gd">-</span>
        <span class="gd">-  childElements: Element.Methods.immediateDescendants</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-Element._attributeTranslations = {</span>
        <span class="gd">-  write: {</span>
        <span class="gd">-    names: {</span>
        <span class="gd">-      className: &#39;class&#39;,</span>
        <span class="gd">-      htmlFor:   &#39;for&#39;</span>
        <span class="gd">-    },</span>
        <span class="gd">-    values: { }</span>
        <span class="gd">-  }</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-if (Prototype.Browser.Opera) {</span>
        <span class="gd">-  Element.Methods.getStyle = Element.Methods.getStyle.wrap(</span>
        <span class="gd">-    function(proceed, element, style) {</span>
        <span class="gd">-      switch (style) {</span>
        <span class="gd">-        case &#39;left&#39;: case &#39;top&#39;: case &#39;right&#39;: case &#39;bottom&#39;:</span>
        <span class="gd">-          if (proceed(element, &#39;position&#39;) === &#39;static&#39;) return null;</span>
        <span class="gd">-        case &#39;height&#39;: case &#39;width&#39;:</span>
        <span class="gd">-          if (!Element.visible(element)) return null;</span>
        <span class="gd">-</span>
        <span class="gd">-          var dim = parseInt(proceed(element, style), 10);</span>
        <span class="gd">-</span>
        <span class="gd">-          if (dim !== element[&#39;offset&#39; + style.capitalize()])</span>
        <span class="gd">-            return dim + &#39;px&#39;;</span>
        <span class="gd">-</span>
        <span class="gd">-          var properties;</span>
        <span class="gd">-          if (style === &#39;height&#39;) {</span>
        <span class="gd">-            properties = [&#39;border-top-width&#39;, &#39;padding-top&#39;,</span>
        <span class="gd">-             &#39;padding-bottom&#39;, &#39;border-bottom-width&#39;];</span>
        <span class="gd">-          }</span>
        <span class="gd">-          else {</span>
        <span class="gd">-            properties = [&#39;border-left-width&#39;, &#39;padding-left&#39;,</span>
        <span class="gd">-             &#39;padding-right&#39;, &#39;border-right-width&#39;];</span>
        <span class="gd">-          }</span>
        <span class="gd">-          return properties.inject(dim, function(memo, property) {</span>
        <span class="gd">-            var val = proceed(element, property);</span>
        <span class="gd">-            return val === null ? memo : memo - parseInt(val, 10);</span>
        <span class="gd">-          }) + &#39;px&#39;;</span>
        <span class="gd">-        default: return proceed(element, style);</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-  );</span>
        <span class="gd">-</span>
        <span class="gd">-  Element.Methods.readAttribute = Element.Methods.readAttribute.wrap(</span>
        <span class="gd">-    function(proceed, element, attribute) {</span>
        <span class="gd">-      if (attribute === &#39;title&#39;) return element.title;</span>
        <span class="gd">-      return proceed(element, attribute);</span>
        <span class="gd">-    }</span>
        <span class="gd">-  );</span>
        <span class="gd">-}</span>
        <span class="gd">-</span>
        <span class="gd">-else if (Prototype.Browser.IE) {</span>
        <span class="gd">-  Element.Methods.getOffsetParent = Element.Methods.getOffsetParent.wrap(</span>
        <span class="gd">-    function(proceed, element) {</span>
        <span class="gd">-      element = $(element);</span>
        <span class="gd">-      if (!element.parentNode) return $(document.body);</span>
        <span class="gd">-      var position = element.getStyle(&#39;position&#39;);</span>
        <span class="gd">-      if (position !== &#39;static&#39;) return proceed(element);</span>
        <span class="gd">-      element.setStyle({ position: &#39;relative&#39; });</span>
        <span class="gd">-      var value = proceed(element);</span>
        <span class="gd">-      element.setStyle({ position: position });</span>
        <span class="gd">-      return value;</span>
        <span class="gd">-    }</span>
        <span class="gd">-  );</span>
        <span class="gd">-</span>
        <span class="gd">-  $w(&#39;positionedOffset viewportOffset&#39;).each(function(method) {</span>
        <span class="gd">-    Element.Methods[method] = Element.Methods[method].wrap(</span>
        <span class="gd">-      function(proceed, element) {</span>
        <span class="gd">-        element = $(element);</span>
        <span class="gd">-        if (!element.parentNode) return Element._returnOffset(0, 0);</span>
        <span class="gd">-        var position = element.getStyle(&#39;position&#39;);</span>
        <span class="gd">-        if (position !== &#39;static&#39;) return proceed(element);</span>
        <span class="gd">-        var offsetParent = element.getOffsetParent();</span>
        <span class="gd">-        if (offsetParent &amp;&amp; offsetParent.getStyle(&#39;position&#39;) === &#39;fixed&#39;)</span>
        <span class="gd">-          offsetParent.setStyle({ zoom: 1 });</span>
        <span class="gd">-        element.setStyle({ position: &#39;relative&#39; });</span>
        <span class="gd">-        var value = proceed(element);</span>
        <span class="gd">-        element.setStyle({ position: position });</span>
        <span class="gd">-        return value;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    );</span>
        <span class="gd">-  });</span>
        <span class="gd">-</span>
        <span class="gd">-  Element.Methods.getStyle = function(element, style) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    style = (style == &#39;float&#39; || style == &#39;cssFloat&#39;) ? &#39;styleFloat&#39; : style.camelize();</span>
        <span class="gd">-    var value = element.style[style];</span>
        <span class="gd">-    if (!value &amp;&amp; element.currentStyle) value = element.currentStyle[style];</span>
        <span class="gd">-</span>
        <span class="gd">-    if (style == &#39;opacity&#39;) {</span>
        <span class="gd">-      if (value = (element.getStyle(&#39;filter&#39;) || &#39;&#39;).match(/alpha\(opacity=(.*)\)/))</span>
        <span class="gd">-        if (value[1]) return parseFloat(value[1]) / 100;</span>
        <span class="gd">-      return 1.0;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    if (value == &#39;auto&#39;) {</span>
        <span class="gd">-      if ((style == &#39;width&#39; || style == &#39;height&#39;) &amp;&amp; (element.getStyle(&#39;display&#39;) != &#39;none&#39;))</span>
        <span class="gd">-        return element[&#39;offset&#39; + style.capitalize()] + &#39;px&#39;;</span>
        <span class="gd">-      return null;</span>
        <span class="gd">-    }</span>
        <span class="gd">-    return value;</span>
        <span class="gd">-  };</span>
        <span class="gd">-</span>
        <span class="gd">-  Element.Methods.setOpacity = function(element, value) {</span>
        <span class="gd">-    function stripAlpha(filter){</span>
        <span class="gd">-      return filter.replace(/alpha\([^\)]*\)/gi,&#39;&#39;);</span>
        <span class="gd">-    }</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    var currentStyle = element.currentStyle;</span>
        <span class="gd">-    if ((currentStyle &amp;&amp; !currentStyle.hasLayout) ||</span>
        <span class="gd">-      (!currentStyle &amp;&amp; element.style.zoom == &#39;normal&#39;))</span>
        <span class="gd">-        element.style.zoom = 1;</span>
        <span class="gd">-</span>
        <span class="gd">-    var filter = element.getStyle(&#39;filter&#39;), style = element.style;</span>
        <span class="gd">-    if (value == 1 || value === &#39;&#39;) {</span>
        <span class="gd">-      (filter = stripAlpha(filter)) ?</span>
        <span class="gd">-        style.filter = filter : style.removeAttribute(&#39;filter&#39;);</span>
        <span class="gd">-      return element;</span>
        <span class="gd">-    } else if (value &lt; 0.00001) value = 0;</span>
        <span class="gd">-    style.filter = stripAlpha(filter) +</span>
        <span class="gd">-      &#39;alpha(opacity=&#39; + (value * 100) + &#39;)&#39;;</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  };</span>
        <span class="gd">-</span>
        <span class="gd">-  Element._attributeTranslations = (function(){</span>
        <span class="gd">-</span>
        <span class="gd">-    var classProp = &#39;className&#39;,</span>
        <span class="gd">-        forProp = &#39;for&#39;,</span>
        <span class="gd">-        el = document.createElement(&#39;div&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-    el.setAttribute(classProp, &#39;x&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-    if (el.className !== &#39;x&#39;) {</span>
        <span class="gd">-      el.setAttribute(&#39;class&#39;, &#39;x&#39;);</span>
        <span class="gd">-      if (el.className === &#39;x&#39;) {</span>
        <span class="gd">-        classProp = &#39;class&#39;;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-    el = null;</span>
        <span class="gd">-</span>
        <span class="gd">-    el = document.createElement(&#39;label&#39;);</span>
        <span class="gd">-    el.setAttribute(forProp, &#39;x&#39;);</span>
        <span class="gd">-    if (el.htmlFor !== &#39;x&#39;) {</span>
        <span class="gd">-      el.setAttribute(&#39;htmlFor&#39;, &#39;x&#39;);</span>
        <span class="gd">-      if (el.htmlFor === &#39;x&#39;) {</span>
        <span class="gd">-        forProp = &#39;htmlFor&#39;;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-    el = null;</span>
        <span class="gd">-</span>
        <span class="gd">-    return {</span>
        <span class="gd">-      read: {</span>
        <span class="gd">-        names: {</span>
        <span class="gd">-          &#39;class&#39;:      classProp,</span>
        <span class="gd">-          &#39;className&#39;:  classProp,</span>
        <span class="gd">-          &#39;for&#39;:        forProp,</span>
        <span class="gd">-          &#39;htmlFor&#39;:    forProp</span>
        <span class="gd">-        },</span>
        <span class="gd">-        values: {</span>
        <span class="gd">-          _getAttr: function(element, attribute) {</span>
        <span class="gd">-            return element.getAttribute(attribute);</span>
        <span class="gd">-          },</span>
        <span class="gd">-          _getAttr2: function(element, attribute) {</span>
        <span class="gd">-            return element.getAttribute(attribute, 2);</span>
        <span class="gd">-          },</span>
        <span class="gd">-          _getAttrNode: function(element, attribute) {</span>
        <span class="gd">-            var node = element.getAttributeNode(attribute);</span>
        <span class="gd">-            return node ? node.value : &quot;&quot;;</span>
        <span class="gd">-          },</span>
        <span class="gd">-          _getEv: (function(){</span>
        <span class="gd">-</span>
        <span class="gd">-            var el = document.createElement(&#39;div&#39;), f;</span>
        <span class="gd">-            el.onclick = Prototype.emptyFunction;</span>
        <span class="gd">-            var value = el.getAttribute(&#39;onclick&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-            if (String(value).indexOf(&#39;{&#39;) &gt; -1) {</span>
        <span class="gd">-              f = function(element, attribute) {</span>
        <span class="gd">-                attribute = element.getAttribute(attribute);</span>
        <span class="gd">-                if (!attribute) return null;</span>
        <span class="gd">-                attribute = attribute.toString();</span>
        <span class="gd">-                attribute = attribute.split(&#39;{&#39;)[1];</span>
        <span class="gd">-                attribute = attribute.split(&#39;}&#39;)[0];</span>
        <span class="gd">-                return attribute.strip();</span>
        <span class="gd">-              };</span>
        <span class="gd">-            }</span>
        <span class="gd">-            else if (value === &#39;&#39;) {</span>
        <span class="gd">-              f = function(element, attribute) {</span>
        <span class="gd">-                attribute = element.getAttribute(attribute);</span>
        <span class="gd">-                if (!attribute) return null;</span>
        <span class="gd">-                return attribute.strip();</span>
        <span class="gd">-              };</span>
        <span class="gd">-            }</span>
        <span class="gd">-            el = null;</span>
        <span class="gd">-            return f;</span>
        <span class="gd">-          })(),</span>
        <span class="gd">-          _flag: function(element, attribute) {</span>
        <span class="gd">-            return $(element).hasAttribute(attribute) ? attribute : null;</span>
        <span class="gd">-          },</span>
        <span class="gd">-          style: function(element) {</span>
        <span class="gd">-            return element.style.cssText.toLowerCase();</span>
        <span class="gd">-          },</span>
        <span class="gd">-          title: function(element) {</span>
        <span class="gd">-            return element.title;</span>
        <span class="gd">-          }</span>
        <span class="gd">-        }</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-  })();</span>
        <span class="gd">-</span>
        <span class="gd">-  Element._attributeTranslations.write = {</span>
        <span class="gd">-    names: Object.extend({</span>
        <span class="gd">-      cellpadding: &#39;cellPadding&#39;,</span>
        <span class="gd">-      cellspacing: &#39;cellSpacing&#39;</span>
        <span class="gd">-    }, Element._attributeTranslations.read.names),</span>
        <span class="gd">-    values: {</span>
        <span class="gd">-      checked: function(element, value) {</span>
        <span class="gd">-        element.checked = !!value;</span>
        <span class="gd">-      },</span>
        <span class="gd">-</span>
        <span class="gd">-      style: function(element, value) {</span>
        <span class="gd">-        element.style.cssText = value ? value : &#39;&#39;;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-  };</span>
        <span class="gd">-</span>
        <span class="gd">-  Element._attributeTranslations.has = {};</span>
        <span class="gd">-</span>
        <span class="gd">-  $w(&#39;colSpan rowSpan vAlign dateTime accessKey tabIndex &#39; +</span>
        <span class="gd">-      &#39;encType maxLength readOnly longDesc frameBorder&#39;).each(function(attr) {</span>
        <span class="gd">-    Element._attributeTranslations.write.names[attr.toLowerCase()] = attr;</span>
        <span class="gd">-    Element._attributeTranslations.has[attr.toLowerCase()] = attr;</span>
        <span class="gd">-  });</span>
        <span class="gd">-</span>
        <span class="gd">-  (function(v) {</span>
        <span class="gd">-    Object.extend(v, {</span>
        <span class="gd">-      href:        v._getAttr2,</span>
        <span class="gd">-      src:         v._getAttr2,</span>
        <span class="gd">-      type:        v._getAttr,</span>
        <span class="gd">-      action:      v._getAttrNode,</span>
        <span class="gd">-      disabled:    v._flag,</span>
        <span class="gd">-      checked:     v._flag,</span>
        <span class="gd">-      readonly:    v._flag,</span>
        <span class="gd">-      multiple:    v._flag,</span>
        <span class="gd">-      onload:      v._getEv,</span>
        <span class="gd">-      onunload:    v._getEv,</span>
        <span class="gd">-      onclick:     v._getEv,</span>
        <span class="gd">-      ondblclick:  v._getEv,</span>
        <span class="gd">-      onmousedown: v._getEv,</span>
        <span class="gd">-      onmouseup:   v._getEv,</span>
        <span class="gd">-      onmouseover: v._getEv,</span>
        <span class="gd">-      onmousemove: v._getEv,</span>
        <span class="gd">-      onmouseout:  v._getEv,</span>
        <span class="gd">-      onfocus:     v._getEv,</span>
        <span class="gd">-      onblur:      v._getEv,</span>
        <span class="gd">-      onkeypress:  v._getEv,</span>
        <span class="gd">-      onkeydown:   v._getEv,</span>
        <span class="gd">-      onkeyup:     v._getEv,</span>
        <span class="gd">-      onsubmit:    v._getEv,</span>
        <span class="gd">-      onreset:     v._getEv,</span>
        <span class="gd">-      onselect:    v._getEv,</span>
        <span class="gd">-      onchange:    v._getEv</span>
        <span class="gd">-    });</span>
        <span class="gd">-  })(Element._attributeTranslations.read.values);</span>
        <span class="gd">-</span>
        <span class="gd">-  if (Prototype.BrowserFeatures.ElementExtensions) {</span>
        <span class="gd">-    (function() {</span>
        <span class="gd">-      function _descendants(element) {</span>
        <span class="gd">-        var nodes = element.getElementsByTagName(&#39;*&#39;), results = [];</span>
        <span class="gd">-        for (var i = 0, node; node = nodes[i]; i++)</span>
        <span class="gd">-          if (node.tagName !== &quot;!&quot;) // Filter out comment nodes.</span>
        <span class="gd">-            results.push(node);</span>
        <span class="gd">-        return results;</span>
        <span class="gd">-      }</span>
        <span class="gd">-</span>
        <span class="gd">-      Element.Methods.down = function(element, expression, index) {</span>
        <span class="gd">-        element = $(element);</span>
        <span class="gd">-        if (arguments.length == 1) return element.firstDescendant();</span>
        <span class="gd">-        return Object.isNumber(expression) ? _descendants(element)[expression] :</span>
        <span class="gd">-          Element.select(element, expression)[index || 0];</span>
        <span class="gd">-      }</span>
        <span class="gd">-    })();</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-}</span>
        <span class="gd">-</span>
        <span class="gd">-else if (Prototype.Browser.Gecko &amp;&amp; /rv:1\.8\.0/.test(navigator.userAgent)) {</span>
        <span class="gd">-  Element.Methods.setOpacity = function(element, value) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    element.style.opacity = (value == 1) ? 0.999999 :</span>
        <span class="gd">-      (value === &#39;&#39;) ? &#39;&#39; : (value &lt; 0.00001) ? 0 : value;</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  };</span>
        <span class="gd">-}</span>
        <span class="gd">-</span>
        <span class="gd">-else if (Prototype.Browser.WebKit) {</span>
        <span class="gd">-  Element.Methods.setOpacity = function(element, value) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    element.style.opacity = (value == 1 || value === &#39;&#39;) ? &#39;&#39; :</span>
        <span class="gd">-      (value &lt; 0.00001) ? 0 : value;</span>
        <span class="gd">-</span>
        <span class="gd">-    if (value == 1)</span>
        <span class="gd">-      if (element.tagName.toUpperCase() == &#39;IMG&#39; &amp;&amp; element.width) {</span>
        <span class="gd">-        element.width++; element.width--;</span>
        <span class="gd">-      } else try {</span>
        <span class="gd">-        var n = document.createTextNode(&#39; &#39;);</span>
        <span class="gd">-        element.appendChild(n);</span>
        <span class="gd">-        element.removeChild(n);</span>
        <span class="gd">-      } catch (e) { }</span>
        <span class="gd">-</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  };</span>
        <span class="gd">-</span>
        <span class="gd">-  Element.Methods.cumulativeOffset = function(element) {</span>
        <span class="gd">-    var valueT = 0, valueL = 0;</span>
        <span class="gd">-    do {</span>
        <span class="gd">-      valueT += element.offsetTop  || 0;</span>
        <span class="gd">-      valueL += element.offsetLeft || 0;</span>
        <span class="gd">-      if (element.offsetParent == document.body)</span>
        <span class="gd">-        if (Element.getStyle(element, &#39;position&#39;) == &#39;absolute&#39;) break;</span>
        <span class="gd">-</span>
        <span class="gd">-      element = element.offsetParent;</span>
        <span class="gd">-    } while (element);</span>
        <span class="gd">-</span>
        <span class="gd">-    return Element._returnOffset(valueL, valueT);</span>
        <span class="gd">-  };</span>
        <span class="gd">-}</span>
        <span class="gd">-</span>
        <span class="gd">-if (&#39;outerHTML&#39; in document.documentElement) {</span>
        <span class="gd">-  Element.Methods.replace = function(element, content) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-</span>
        <span class="gd">-    if (content &amp;&amp; content.toElement) content = content.toElement();</span>
        <span class="gd">-    if (Object.isElement(content)) {</span>
        <span class="gd">-      element.parentNode.replaceChild(content, element);</span>
        <span class="gd">-      return element;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    content = Object.toHTML(content);</span>
        <span class="gd">-    var parent = element.parentNode, tagName = parent.tagName.toUpperCase();</span>
        <span class="gd">-</span>
        <span class="gd">-    if (Element._insertionTranslations.tags[tagName]) {</span>
        <span class="gd">-      var nextSibling = element.next(),</span>
        <span class="gd">-          fragments = Element._getContentFromAnonymousElement(tagName, content.stripScripts());</span>
        <span class="gd">-      parent.removeChild(element);</span>
        <span class="gd">-      if (nextSibling)</span>
        <span class="gd">-        fragments.each(function(node) { parent.insertBefore(node, nextSibling) });</span>
        <span class="gd">-      else</span>
        <span class="gd">-        fragments.each(function(node) { parent.appendChild(node) });</span>
        <span class="gd">-    }</span>
        <span class="gd">-    else element.outerHTML = content.stripScripts();</span>
        <span class="gd">-</span>
        <span class="gd">-    content.evalScripts.bind(content).defer();</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  };</span>
        <span class="gd">-}</span>
        <span class="gd">-</span>
        <span class="gd">-Element._returnOffset = function(l, t) {</span>
        <span class="gd">-  var result = [l, t];</span>
        <span class="gd">-  result.left = l;</span>
        <span class="gd">-  result.top = t;</span>
        <span class="gd">-  return result;</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Element._getContentFromAnonymousElement = function(tagName, html) {</span>
        <span class="gd">-  var div = new Element(&#39;div&#39;),</span>
        <span class="gd">-      t = Element._insertionTranslations.tags[tagName];</span>
        <span class="gd">-  if (t) {</span>
        <span class="gd">-    div.innerHTML = t[0] + html + t[1];</span>
        <span class="gd">-    for (var i = t[2]; i--; ) {</span>
        <span class="gd">-      div = div.firstChild;</span>
        <span class="gd">-    }</span>
        <span class="gd">-  }</span>
        <span class="gd">-  else {</span>
        <span class="gd">-    div.innerHTML = html;</span>
        <span class="gd">-  }</span>
        <span class="gd">-  return $A(div.childNodes);</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Element._insertionTranslations = {</span>
        <span class="gd">-  before: function(element, node) {</span>
        <span class="gd">-    element.parentNode.insertBefore(node, element);</span>
        <span class="gd">-  },</span>
        <span class="gd">-  top: function(element, node) {</span>
        <span class="gd">-    element.insertBefore(node, element.firstChild);</span>
        <span class="gd">-  },</span>
        <span class="gd">-  bottom: function(element, node) {</span>
        <span class="gd">-    element.appendChild(node);</span>
        <span class="gd">-  },</span>
        <span class="gd">-  after: function(element, node) {</span>
        <span class="gd">-    element.parentNode.insertBefore(node, element.nextSibling);</span>
        <span class="gd">-  },</span>
        <span class="gd">-  tags: {</span>
        <span class="gd">-    TABLE:  [&#39;&lt;table&gt;&#39;,                &#39;&lt;/table&gt;&#39;,                   1],</span>
        <span class="gd">-    TBODY:  [&#39;&lt;table&gt;&lt;tbody&gt;&#39;,         &#39;&lt;/tbody&gt;&lt;/table&gt;&#39;,           2],</span>
        <span class="gd">-    TR:     [&#39;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&#39;,     &#39;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&#39;,      3],</span>
        <span class="gd">-    TD:     [&#39;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&#39;, &#39;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&#39;, 4],</span>
        <span class="gd">-    SELECT: [&#39;&lt;select&gt;&#39;,               &#39;&lt;/select&gt;&#39;,                  1]</span>
        <span class="gd">-  }</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-(function() {</span>
        <span class="gd">-  var tags = Element._insertionTranslations.tags;</span>
        <span class="gd">-  Object.extend(tags, {</span>
        <span class="gd">-    THEAD: tags.TBODY,</span>
        <span class="gd">-    TFOOT: tags.TBODY,</span>
        <span class="gd">-    TH:    tags.TD</span>
        <span class="gd">-  });</span>
        <span class="gd">-})();</span>
        <span class="gd">-</span>
        <span class="gd">-Element.Methods.Simulated = {</span>
        <span class="gd">-  hasAttribute: function(element, attribute) {</span>
        <span class="gd">-    attribute = Element._attributeTranslations.has[attribute] || attribute;</span>
        <span class="gd">-    var node = $(element).getAttributeNode(attribute);</span>
        <span class="gd">-    return !!(node &amp;&amp; node.specified);</span>
        <span class="gd">-  }</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Element.Methods.ByTag = { };</span>
        <span class="gd">-</span>
        <span class="gd">-Object.extend(Element, Element.Methods);</span>
        <span class="gd">-</span>
        <span class="gd">-(function(div) {</span>
        <span class="gd">-</span>
        <span class="gd">-  if (!Prototype.BrowserFeatures.ElementExtensions &amp;&amp; div[&#39;__proto__&#39;]) {</span>
        <span class="gd">-    window.HTMLElement = { };</span>
        <span class="gd">-    window.HTMLElement.prototype = div[&#39;__proto__&#39;];</span>
        <span class="gd">-    Prototype.BrowserFeatures.ElementExtensions = true;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  div = null;</span>
        <span class="gd">-</span>
        <span class="gd">-})(document.createElement(&#39;div&#39;));</span>
        <span class="gd">-</span>
        <span class="gd">-Element.extend = (function() {</span>
        <span class="gd">-</span>
        <span class="gd">-  function checkDeficiency(tagName) {</span>
        <span class="gd">-    if (typeof window.Element != &#39;undefined&#39;) {</span>
        <span class="gd">-      var proto = window.Element.prototype;</span>
        <span class="gd">-      if (proto) {</span>
        <span class="gd">-        var id = &#39;_&#39; + (Math.random()+&#39;&#39;).slice(2),</span>
        <span class="gd">-            el = document.createElement(tagName);</span>
        <span class="gd">-        proto[id] = &#39;x&#39;;</span>
        <span class="gd">-        var isBuggy = (el[id] !== &#39;x&#39;);</span>
        <span class="gd">-        delete proto[id];</span>
        <span class="gd">-        el = null;</span>
        <span class="gd">-        return isBuggy;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-    return false;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function extendElementWith(element, methods) {</span>
        <span class="gd">-    for (var property in methods) {</span>
        <span class="gd">-      var value = methods[property];</span>
        <span class="gd">-      if (Object.isFunction(value) &amp;&amp; !(property in element))</span>
        <span class="gd">-        element[property] = value.methodize();</span>
        <span class="gd">-    }</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  var HTMLOBJECTELEMENT_PROTOTYPE_BUGGY = checkDeficiency(&#39;object&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-  if (Prototype.BrowserFeatures.SpecificElementExtensions) {</span>
        <span class="gd">-    if (HTMLOBJECTELEMENT_PROTOTYPE_BUGGY) {</span>
        <span class="gd">-      return function(element) {</span>
        <span class="gd">-        if (element &amp;&amp; typeof element._extendedByPrototype == &#39;undefined&#39;) {</span>
        <span class="gd">-          var t = element.tagName;</span>
        <span class="gd">-          if (t &amp;&amp; (/^(?:object|applet|embed)$/i.test(t))) {</span>
        <span class="gd">-            extendElementWith(element, Element.Methods);</span>
        <span class="gd">-            extendElementWith(element, Element.Methods.Simulated);</span>
        <span class="gd">-            extendElementWith(element, Element.Methods.ByTag[t.toUpperCase()]);</span>
        <span class="gd">-          }</span>
        <span class="gd">-        }</span>
        <span class="gd">-        return element;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-    return Prototype.K;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  var Methods = { }, ByTag = Element.Methods.ByTag;</span>
        <span class="gd">-</span>
        <span class="gd">-  var extend = Object.extend(function(element) {</span>
        <span class="gd">-    if (!element || typeof element._extendedByPrototype != &#39;undefined&#39; ||</span>
        <span class="gd">-        element.nodeType != 1 || element == window) return element;</span>
        <span class="gd">-</span>
        <span class="gd">-    var methods = Object.clone(Methods),</span>
        <span class="gd">-        tagName = element.tagName.toUpperCase();</span>
        <span class="gd">-</span>
        <span class="gd">-    if (ByTag[tagName]) Object.extend(methods, ByTag[tagName]);</span>
        <span class="gd">-</span>
        <span class="gd">-    extendElementWith(element, methods);</span>
        <span class="gd">-</span>
        <span class="gd">-    element._extendedByPrototype = Prototype.emptyFunction;</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-</span>
        <span class="gd">-  }, {</span>
        <span class="gd">-    refresh: function() {</span>
        <span class="gd">-      if (!Prototype.BrowserFeatures.ElementExtensions) {</span>
        <span class="gd">-        Object.extend(Methods, Element.Methods);</span>
        <span class="gd">-        Object.extend(Methods, Element.Methods.Simulated);</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-  });</span>
        <span class="gd">-</span>
        <span class="gd">-  extend.refresh();</span>
        <span class="gd">-  return extend;</span>
        <span class="gd">-})();</span>
        <span class="gd">-</span>
        <span class="gd">-if (document.documentElement.hasAttribute) {</span>
        <span class="gd">-  Element.hasAttribute = function(element, attribute) {</span>
        <span class="gd">-    return element.hasAttribute(attribute);</span>
        <span class="gd">-  };</span>
        <span class="gd">-}</span>
        <span class="gd">-else {</span>
        <span class="gd">-  Element.hasAttribute = Element.Methods.Simulated.hasAttribute;</span>
        <span class="gd">-}</span>
        <span class="gd">-</span>
        <span class="gd">-Element.addMethods = function(methods) {</span>
        <span class="gd">-  var F = Prototype.BrowserFeatures, T = Element.Methods.ByTag;</span>
        <span class="gd">-</span>
        <span class="gd">-  if (!methods) {</span>
        <span class="gd">-    Object.extend(Form, Form.Methods);</span>
        <span class="gd">-    Object.extend(Form.Element, Form.Element.Methods);</span>
        <span class="gd">-    Object.extend(Element.Methods.ByTag, {</span>
        <span class="gd">-      &quot;FORM&quot;:     Object.clone(Form.Methods),</span>
        <span class="gd">-      &quot;INPUT&quot;:    Object.clone(Form.Element.Methods),</span>
        <span class="gd">-      &quot;SELECT&quot;:   Object.clone(Form.Element.Methods),</span>
        <span class="gd">-      &quot;TEXTAREA&quot;: Object.clone(Form.Element.Methods)</span>
        <span class="gd">-    });</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  if (arguments.length == 2) {</span>
        <span class="gd">-    var tagName = methods;</span>
        <span class="gd">-    methods = arguments[1];</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  if (!tagName) Object.extend(Element.Methods, methods || { });</span>
        <span class="gd">-  else {</span>
        <span class="gd">-    if (Object.isArray(tagName)) tagName.each(extend);</span>
        <span class="gd">-    else extend(tagName);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function extend(tagName) {</span>
        <span class="gd">-    tagName = tagName.toUpperCase();</span>
        <span class="gd">-    if (!Element.Methods.ByTag[tagName])</span>
        <span class="gd">-      Element.Methods.ByTag[tagName] = { };</span>
        <span class="gd">-    Object.extend(Element.Methods.ByTag[tagName], methods);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function copy(methods, destination, onlyIfAbsent) {</span>
        <span class="gd">-    onlyIfAbsent = onlyIfAbsent || false;</span>
        <span class="gd">-    for (var property in methods) {</span>
        <span class="gd">-      var value = methods[property];</span>
        <span class="gd">-      if (!Object.isFunction(value)) continue;</span>
        <span class="gd">-      if (!onlyIfAbsent || !(property in destination))</span>
        <span class="gd">-        destination[property] = value.methodize();</span>
        <span class="gd">-    }</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function findDOMClass(tagName) {</span>
        <span class="gd">-    var klass;</span>
        <span class="gd">-    var trans = {</span>
        <span class="gd">-      &quot;OPTGROUP&quot;: &quot;OptGroup&quot;, &quot;TEXTAREA&quot;: &quot;TextArea&quot;, &quot;P&quot;: &quot;Paragraph&quot;,</span>
        <span class="gd">-      &quot;FIELDSET&quot;: &quot;FieldSet&quot;, &quot;UL&quot;: &quot;UList&quot;, &quot;OL&quot;: &quot;OList&quot;, &quot;DL&quot;: &quot;DList&quot;,</span>
        <span class="gd">-      &quot;DIR&quot;: &quot;Directory&quot;, &quot;H1&quot;: &quot;Heading&quot;, &quot;H2&quot;: &quot;Heading&quot;, &quot;H3&quot;: &quot;Heading&quot;,</span>
        <span class="gd">-      &quot;H4&quot;: &quot;Heading&quot;, &quot;H5&quot;: &quot;Heading&quot;, &quot;H6&quot;: &quot;Heading&quot;, &quot;Q&quot;: &quot;Quote&quot;,</span>
        <span class="gd">-      &quot;INS&quot;: &quot;Mod&quot;, &quot;DEL&quot;: &quot;Mod&quot;, &quot;A&quot;: &quot;Anchor&quot;, &quot;IMG&quot;: &quot;Image&quot;, &quot;CAPTION&quot;:</span>
        <span class="gd">-      &quot;TableCaption&quot;, &quot;COL&quot;: &quot;TableCol&quot;, &quot;COLGROUP&quot;: &quot;TableCol&quot;, &quot;THEAD&quot;:</span>
        <span class="gd">-      &quot;TableSection&quot;, &quot;TFOOT&quot;: &quot;TableSection&quot;, &quot;TBODY&quot;: &quot;TableSection&quot;, &quot;TR&quot;:</span>
        <span class="gd">-      &quot;TableRow&quot;, &quot;TH&quot;: &quot;TableCell&quot;, &quot;TD&quot;: &quot;TableCell&quot;, &quot;FRAMESET&quot;:</span>
        <span class="gd">-      &quot;FrameSet&quot;, &quot;IFRAME&quot;: &quot;IFrame&quot;</span>
        <span class="gd">-    };</span>
        <span class="gd">-    if (trans[tagName]) klass = &#39;HTML&#39; + trans[tagName] + &#39;Element&#39;;</span>
        <span class="gd">-    if (window[klass]) return window[klass];</span>
        <span class="gd">-    klass = &#39;HTML&#39; + tagName + &#39;Element&#39;;</span>
        <span class="gd">-    if (window[klass]) return window[klass];</span>
        <span class="gd">-    klass = &#39;HTML&#39; + tagName.capitalize() + &#39;Element&#39;;</span>
        <span class="gd">-    if (window[klass]) return window[klass];</span>
        <span class="gd">-</span>
        <span class="gd">-    var element = document.createElement(tagName),</span>
        <span class="gd">-        proto = element[&#39;__proto__&#39;] || element.constructor.prototype;</span>
        <span class="gd">-</span>
        <span class="gd">-    element = null;</span>
        <span class="gd">-    return proto;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  var elementPrototype = window.HTMLElement ? HTMLElement.prototype :</span>
        <span class="gd">-   Element.prototype;</span>
        <span class="gd">-</span>
        <span class="gd">-  if (F.ElementExtensions) {</span>
        <span class="gd">-    copy(Element.Methods, elementPrototype);</span>
        <span class="gd">-    copy(Element.Methods.Simulated, elementPrototype, true);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  if (F.SpecificElementExtensions) {</span>
        <span class="gd">-    for (var tag in Element.Methods.ByTag) {</span>
        <span class="gd">-      var klass = findDOMClass(tag);</span>
        <span class="gd">-      if (Object.isUndefined(klass)) continue;</span>
        <span class="gd">-      copy(T[tag], klass.prototype);</span>
        <span class="gd">-    }</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  Object.extend(Element, Element.Methods);</span>
        <span class="gd">-  delete Element.ByTag;</span>
        <span class="gd">-</span>
        <span class="gd">-  if (Element.extend.refresh) Element.extend.refresh();</span>
        <span class="gd">-  Element.cache = { };</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-document.viewport = {</span>
        <span class="gd">-</span>
        <span class="gd">-  getDimensions: function() {</span>
        <span class="gd">-    return { width: this.getWidth(), height: this.getHeight() };</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  getScrollOffsets: function() {</span>
        <span class="gd">-    return Element._returnOffset(</span>
        <span class="gd">-      window.pageXOffset || document.documentElement.scrollLeft || document.body.scrollLeft,</span>
        <span class="gd">-      window.pageYOffset || document.documentElement.scrollTop  || document.body.scrollTop);</span>
        <span class="gd">-  }</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-(function(viewport) {</span>
        <span class="gd">-  var B = Prototype.Browser, doc = document, element, property = {};</span>
        <span class="gd">-</span>
        <span class="gd">-  function getRootElement() {</span>
        <span class="gd">-    if (B.WebKit &amp;&amp; !doc.evaluate)</span>
        <span class="gd">-      return document;</span>
        <span class="gd">-</span>
        <span class="gd">-    if (B.Opera &amp;&amp; window.parseFloat(window.opera.version()) &lt; 9.5)</span>
        <span class="gd">-      return document.body;</span>
        <span class="gd">-</span>
        <span class="gd">-    return document.documentElement;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function define(D) {</span>
        <span class="gd">-    if (!element) element = getRootElement();</span>
        <span class="gd">-</span>
        <span class="gd">-    property[D] = &#39;client&#39; + D;</span>
        <span class="gd">-</span>
        <span class="gd">-    viewport[&#39;get&#39; + D] = function() { return element[property[D]] };</span>
        <span class="gd">-    return viewport[&#39;get&#39; + D]();</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  viewport.getWidth  = define.curry(&#39;Width&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-  viewport.getHeight = define.curry(&#39;Height&#39;);</span>
        <span class="gd">-})(document.viewport);</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-Element.Storage = {</span>
        <span class="gd">-  UID: 1</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Element.addMethods({</span>
        <span class="gd">-  getStorage: function(element) {</span>
        <span class="gd">-    if (!(element = $(element))) return;</span>
        <span class="gd">-</span>
        <span class="gd">-    var uid;</span>
        <span class="gd">-    if (element === window) {</span>
        <span class="gd">-      uid = 0;</span>
        <span class="gd">-    } else {</span>
        <span class="gd">-      if (typeof element._prototypeUID === &quot;undefined&quot;)</span>
        <span class="gd">-        element._prototypeUID = Element.Storage.UID++;</span>
        <span class="gd">-      uid = element._prototypeUID;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    if (!Element.Storage[uid])</span>
        <span class="gd">-      Element.Storage[uid] = $H();</span>
        <span class="gd">-</span>
        <span class="gd">-    return Element.Storage[uid];</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  store: function(element, key, value) {</span>
        <span class="gd">-    if (!(element = $(element))) return;</span>
        <span class="gd">-</span>
        <span class="gd">-    if (arguments.length === 2) {</span>
        <span class="gd">-      Element.getStorage(element).update(key);</span>
        <span class="gd">-    } else {</span>
        <span class="gd">-      Element.getStorage(element).set(key, value);</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  retrieve: function(element, key, defaultValue) {</span>
        <span class="gd">-    if (!(element = $(element))) return;</span>
        <span class="gd">-    var hash = Element.getStorage(element), value = hash.get(key);</span>
        <span class="gd">-</span>
        <span class="gd">-    if (Object.isUndefined(value)) {</span>
        <span class="gd">-      hash.set(key, defaultValue);</span>
        <span class="gd">-      value = defaultValue;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    return value;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  clone: function(element, deep) {</span>
        <span class="gd">-    if (!(element = $(element))) return;</span>
        <span class="gd">-    var clone = element.cloneNode(deep);</span>
        <span class="gd">-    clone._prototypeUID = void 0;</span>
        <span class="gd">-    if (deep) {</span>
        <span class="gd">-      var descendants = Element.select(clone, &#39;*&#39;),</span>
        <span class="gd">-          i = descendants.length;</span>
        <span class="gd">-      while (i--) {</span>
        <span class="gd">-        descendants[i]._prototypeUID = void 0;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-    return Element.extend(clone);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  purge: function(element) {</span>
        <span class="gd">-    if (!(element = $(element))) return;</span>
        <span class="gd">-    purgeElement(element);</span>
        <span class="gd">-</span>
        <span class="gd">-    var descendants = element.getElementsByTagName(&#39;*&#39;),</span>
        <span class="gd">-     i = descendants.length;</span>
        <span class="gd">-</span>
        <span class="gd">-    while (i--) purgeElement(descendants[i]);</span>
        <span class="gd">-</span>
        <span class="gd">-    return null;</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-(function() {</span>
        <span class="gd">-</span>
        <span class="gd">-  function toDecimal(pctString) {</span>
        <span class="gd">-    var match = pctString.match(/^(\d+)%?$/i);</span>
        <span class="gd">-    if (!match) return null;</span>
        <span class="gd">-    return (Number(match[1]) / 100);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function getPixelValue(value, property) {</span>
        <span class="gd">-    if (Object.isElement(value)) {</span>
        <span class="gd">-      element = value;</span>
        <span class="gd">-      value = element.getStyle(property);</span>
        <span class="gd">-    }</span>
        <span class="gd">-    if (value === null) {</span>
        <span class="gd">-      return null;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    if ((/^(?:-)?\d+(\.\d+)?(px)?$/i).test(value)) {</span>
        <span class="gd">-      return window.parseFloat(value);</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    if (/\d/.test(value) &amp;&amp; element.runtimeStyle) {</span>
        <span class="gd">-      var style = element.style.left, rStyle = element.runtimeStyle.left;</span>
        <span class="gd">-      element.runtimeStyle.left = element.currentStyle.left;</span>
        <span class="gd">-      element.style.left = value || 0;</span>
        <span class="gd">-      value = element.style.pixelLeft;</span>
        <span class="gd">-      element.style.left = style;</span>
        <span class="gd">-      element.runtimeStyle.left = rStyle;</span>
        <span class="gd">-</span>
        <span class="gd">-      return value;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    if (value.include(&#39;%&#39;)) {</span>
        <span class="gd">-      var decimal = toDecimal(value);</span>
        <span class="gd">-      var whole;</span>
        <span class="gd">-      if (property.include(&#39;left&#39;) || property.include(&#39;right&#39;) ||</span>
        <span class="gd">-       property.include(&#39;width&#39;)) {</span>
        <span class="gd">-        whole = $(element.parentNode).measure(&#39;width&#39;);</span>
        <span class="gd">-      } else if (property.include(&#39;top&#39;) || property.include(&#39;bottom&#39;) ||</span>
        <span class="gd">-       property.include(&#39;height&#39;)) {</span>
        <span class="gd">-        whole = $(element.parentNode).measure(&#39;height&#39;);</span>
        <span class="gd">-      }</span>
        <span class="gd">-</span>
        <span class="gd">-      return whole * decimal;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    return 0;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function toCSSPixels(number) {</span>
        <span class="gd">-    if (Object.isString(number) &amp;&amp; number.endsWith(&#39;px&#39;)) {</span>
        <span class="gd">-      return number;</span>
        <span class="gd">-    }</span>
        <span class="gd">-    return number + &#39;px&#39;;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function isDisplayed(element) {</span>
        <span class="gd">-    var originalElement = element;</span>
        <span class="gd">-    while (element &amp;&amp; element.parentNode) {</span>
        <span class="gd">-      var display = element.getStyle(&#39;display&#39;);</span>
        <span class="gd">-      if (display === &#39;none&#39;) {</span>
        <span class="gd">-        return false;</span>
        <span class="gd">-      }</span>
        <span class="gd">-      element = $(element.parentNode);</span>
        <span class="gd">-    }</span>
        <span class="gd">-    return true;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  var hasLayout = Prototype.K;</span>
        <span class="gd">-  if (&#39;currentStyle&#39; in document.documentElement) {</span>
        <span class="gd">-    hasLayout = function(element) {</span>
        <span class="gd">-      if (!element.currentStyle.hasLayout) {</span>
        <span class="gd">-        element.style.zoom = 1;</span>
        <span class="gd">-      }</span>
        <span class="gd">-      return element;</span>
        <span class="gd">-    };</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function cssNameFor(key) {</span>
        <span class="gd">-    if (key.include(&#39;border&#39;)) key = key + &#39;-width&#39;;</span>
        <span class="gd">-    return key.camelize();</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  Element.Layout = Class.create(Hash, {</span>
        <span class="gd">-    initialize: function($super, element, preCompute) {</span>
        <span class="gd">-      $super();</span>
        <span class="gd">-      this.element = $(element);</span>
        <span class="gd">-</span>
        <span class="gd">-      Element.Layout.PROPERTIES.each( function(property) {</span>
        <span class="gd">-        this._set(property, null);</span>
        <span class="gd">-      }, this);</span>
        <span class="gd">-</span>
        <span class="gd">-      if (preCompute) {</span>
        <span class="gd">-        this._preComputing = true;</span>
        <span class="gd">-        this._begin();</span>
        <span class="gd">-        Element.Layout.PROPERTIES.each( this._compute, this );</span>
        <span class="gd">-        this._end();</span>
        <span class="gd">-        this._preComputing = false;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    },</span>
        <span class="gd">-</span>
        <span class="gd">-    _set: function(property, value) {</span>
        <span class="gd">-      return Hash.prototype.set.call(this, property, value);</span>
        <span class="gd">-    },</span>
        <span class="gd">-</span>
        <span class="gd">-    set: function(property, value) {</span>
        <span class="gd">-      throw &quot;Properties of Element.Layout are read-only.&quot;;</span>
        <span class="gd">-    },</span>
        <span class="gd">-</span>
        <span class="gd">-    get: function($super, property) {</span>
        <span class="gd">-      var value = $super(property);</span>
        <span class="gd">-      return value === null ? this._compute(property) : value;</span>
        <span class="gd">-    },</span>
        <span class="gd">-</span>
        <span class="gd">-    _begin: function() {</span>
        <span class="gd">-      if (this._prepared) return;</span>
        <span class="gd">-</span>
        <span class="gd">-      var element = this.element;</span>
        <span class="gd">-      if (isDisplayed(element)) {</span>
        <span class="gd">-        this._prepared = true;</span>
        <span class="gd">-        return;</span>
        <span class="gd">-      }</span>
        <span class="gd">-</span>
        <span class="gd">-      var originalStyles = {</span>
        <span class="gd">-        position:   element.style.position   || &#39;&#39;,</span>
        <span class="gd">-        width:      element.style.width      || &#39;&#39;,</span>
        <span class="gd">-        visibility: element.style.visibility || &#39;&#39;,</span>
        <span class="gd">-        display:    element.style.display    || &#39;&#39;</span>
        <span class="gd">-      };</span>
        <span class="gd">-</span>
        <span class="gd">-      element.store(&#39;prototype_original_styles&#39;, originalStyles);</span>
        <span class="gd">-</span>
        <span class="gd">-      var position = element.getStyle(&#39;position&#39;),</span>
        <span class="gd">-       width = element.getStyle(&#39;width&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-      element.setStyle({</span>
        <span class="gd">-        position:   &#39;absolute&#39;,</span>
        <span class="gd">-        visibility: &#39;hidden&#39;,</span>
        <span class="gd">-        display:    &#39;block&#39;</span>
        <span class="gd">-      });</span>
        <span class="gd">-</span>
        <span class="gd">-      var positionedWidth = element.getStyle(&#39;width&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-      var newWidth;</span>
        <span class="gd">-      if (width &amp;&amp; (positionedWidth === width)) {</span>
        <span class="gd">-        newWidth = getPixelValue(width);</span>
        <span class="gd">-      } else if (width &amp;&amp; (position === &#39;absolute&#39; || position === &#39;fixed&#39;)) {</span>
        <span class="gd">-        newWidth = getPixelValue(width);</span>
        <span class="gd">-      } else {</span>
        <span class="gd">-        var parent = element.parentNode, pLayout = $(parent).getLayout();</span>
        <span class="gd">-</span>
        <span class="gd">-        newWidth = pLayout.get(&#39;width&#39;) -</span>
        <span class="gd">-         this.get(&#39;margin-left&#39;) -</span>
        <span class="gd">-         this.get(&#39;border-left&#39;) -</span>
        <span class="gd">-         this.get(&#39;padding-left&#39;) -</span>
        <span class="gd">-         this.get(&#39;padding-right&#39;) -</span>
        <span class="gd">-         this.get(&#39;border-right&#39;) -</span>
        <span class="gd">-         this.get(&#39;margin-right&#39;);</span>
        <span class="gd">-      }</span>
        <span class="gd">-</span>
        <span class="gd">-      element.setStyle({ width: newWidth + &#39;px&#39; });</span>
        <span class="gd">-</span>
        <span class="gd">-      this._prepared = true;</span>
        <span class="gd">-    },</span>
        <span class="gd">-</span>
        <span class="gd">-    _end: function() {</span>
        <span class="gd">-      var element = this.element;</span>
        <span class="gd">-      var originalStyles = element.retrieve(&#39;prototype_original_styles&#39;);</span>
        <span class="gd">-      element.store(&#39;prototype_original_styles&#39;, null);</span>
        <span class="gd">-      element.setStyle(originalStyles);</span>
        <span class="gd">-      this._prepared = false;</span>
        <span class="gd">-    },</span>
        <span class="gd">-</span>
        <span class="gd">-    _compute: function(property) {</span>
        <span class="gd">-      var COMPUTATIONS = Element.Layout.COMPUTATIONS;</span>
        <span class="gd">-      if (!(property in COMPUTATIONS)) {</span>
        <span class="gd">-        throw &quot;Property not found.&quot;;</span>
        <span class="gd">-      }</span>
        <span class="gd">-      return this._set(property, COMPUTATIONS[property].call(this, this.element));</span>
        <span class="gd">-    },</span>
        <span class="gd">-</span>
        <span class="gd">-    toObject: function() {</span>
        <span class="gd">-      var args = $A(arguments);</span>
        <span class="gd">-      var keys = (args.length === 0) ? Element.Layout.PROPERTIES :</span>
        <span class="gd">-       args.join(&#39; &#39;).split(&#39; &#39;);</span>
        <span class="gd">-      var obj = {};</span>
        <span class="gd">-      keys.each( function(key) {</span>
        <span class="gd">-        if (!Element.Layout.PROPERTIES.include(key)) return;</span>
        <span class="gd">-        var value = this.get(key);</span>
        <span class="gd">-        if (value != null) obj[key] = value;</span>
        <span class="gd">-      }, this);</span>
        <span class="gd">-      return obj;</span>
        <span class="gd">-    },</span>
        <span class="gd">-</span>
        <span class="gd">-    toHash: function() {</span>
        <span class="gd">-      var obj = this.toObject.apply(this, arguments);</span>
        <span class="gd">-      return new Hash(obj);</span>
        <span class="gd">-    },</span>
        <span class="gd">-</span>
        <span class="gd">-    toCSS: function() {</span>
        <span class="gd">-      var args = $A(arguments);</span>
        <span class="gd">-      var keys = (args.length === 0) ? Element.Layout.PROPERTIES :</span>
        <span class="gd">-       args.join(&#39; &#39;).split(&#39; &#39;);</span>
        <span class="gd">-      var css = {};</span>
        <span class="gd">-</span>
        <span class="gd">-      keys.each( function(key) {</span>
        <span class="gd">-        if (!Element.Layout.PROPERTIES.include(key)) return;</span>
        <span class="gd">-        if (Element.Layout.COMPOSITE_PROPERTIES.include(key)) return;</span>
        <span class="gd">-</span>
        <span class="gd">-        var value = this.get(key);</span>
        <span class="gd">-        if (value != null) css[cssNameFor(key)] = value + &#39;px&#39;;</span>
        <span class="gd">-      }, this);</span>
        <span class="gd">-      return css;</span>
        <span class="gd">-    },</span>
        <span class="gd">-</span>
        <span class="gd">-    inspect: function() {</span>
        <span class="gd">-      return &quot;#&lt;Element.Layout&gt;&quot;;</span>
        <span class="gd">-    }</span>
        <span class="gd">-  });</span>
        <span class="gd">-</span>
        <span class="gd">-  Object.extend(Element.Layout, {</span>
        <span class="gd">-    PROPERTIES: $w(&#39;height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height&#39;),</span>
        <span class="gd">-</span>
        <span class="gd">-    COMPOSITE_PROPERTIES: $w(&#39;padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height&#39;),</span>
        <span class="gd">-</span>
        <span class="gd">-    COMPUTATIONS: {</span>
        <span class="gd">-      &#39;height&#39;: function(element) {</span>
        <span class="gd">-        if (!this._preComputing) this._begin();</span>
        <span class="gd">-</span>
        <span class="gd">-        var bHeight = this.get(&#39;border-box-height&#39;);</span>
        <span class="gd">-        if (bHeight &lt;= 0) return 0;</span>
        <span class="gd">-</span>
        <span class="gd">-        var bTop = this.get(&#39;border-top&#39;),</span>
        <span class="gd">-         bBottom = this.get(&#39;border-bottom&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-        var pTop = this.get(&#39;padding-top&#39;),</span>
        <span class="gd">-         pBottom = this.get(&#39;padding-bottom&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-        if (!this._preComputing) this._end();</span>
        <span class="gd">-</span>
        <span class="gd">-        return bHeight - bTop - bBottom - pTop - pBottom;</span>
        <span class="gd">-      },</span>
        <span class="gd">-</span>
        <span class="gd">-      &#39;width&#39;: function(element) {</span>
        <span class="gd">-        if (!this._preComputing) this._begin();</span>
        <span class="gd">-</span>
        <span class="gd">-        var bWidth = this.get(&#39;border-box-width&#39;);</span>
        <span class="gd">-        if (bWidth &lt;= 0) return 0;</span>
        <span class="gd">-</span>
        <span class="gd">-        var bLeft = this.get(&#39;border-left&#39;),</span>
        <span class="gd">-         bRight = this.get(&#39;border-right&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-        var pLeft = this.get(&#39;padding-left&#39;),</span>
        <span class="gd">-         pRight = this.get(&#39;padding-right&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-        if (!this._preComputing) this._end();</span>
        <span class="gd">-</span>
        <span class="gd">-        return bWidth - bLeft - bRight - pLeft - pRight;</span>
        <span class="gd">-      },</span>
        <span class="gd">-</span>
        <span class="gd">-      &#39;padding-box-height&#39;: function(element) {</span>
        <span class="gd">-        var height = this.get(&#39;height&#39;),</span>
        <span class="gd">-         pTop = this.get(&#39;padding-top&#39;),</span>
        <span class="gd">-         pBottom = this.get(&#39;padding-bottom&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-        return height + pTop + pBottom;</span>
        <span class="gd">-      },</span>
        <span class="gd">-</span>
        <span class="gd">-      &#39;padding-box-width&#39;: function(element) {</span>
        <span class="gd">-        var width = this.get(&#39;width&#39;),</span>
        <span class="gd">-         pLeft = this.get(&#39;padding-left&#39;),</span>
        <span class="gd">-         pRight = this.get(&#39;padding-right&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-        return width + pLeft + pRight;</span>
        <span class="gd">-      },</span>
        <span class="gd">-</span>
        <span class="gd">-      &#39;border-box-height&#39;: function(element) {</span>
        <span class="gd">-        return element.offsetHeight;</span>
        <span class="gd">-      },</span>
        <span class="gd">-</span>
        <span class="gd">-      &#39;border-box-width&#39;: function(element) {</span>
        <span class="gd">-        return element.offsetWidth;</span>
        <span class="gd">-      },</span>
        <span class="gd">-</span>
        <span class="gd">-      &#39;margin-box-height&#39;: function(element) {</span>
        <span class="gd">-        var bHeight = this.get(&#39;border-box-height&#39;),</span>
        <span class="gd">-         mTop = this.get(&#39;margin-top&#39;),</span>
        <span class="gd">-         mBottom = this.get(&#39;margin-bottom&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-        if (bHeight &lt;= 0) return 0;</span>
        <span class="gd">-</span>
        <span class="gd">-        return bHeight + mTop + mBottom;</span>
        <span class="gd">-      },</span>
        <span class="gd">-</span>
        <span class="gd">-      &#39;margin-box-width&#39;: function(element) {</span>
        <span class="gd">-        var bWidth = this.get(&#39;border-box-width&#39;),</span>
        <span class="gd">-         mLeft = this.get(&#39;margin-left&#39;),</span>
        <span class="gd">-         mRight = this.get(&#39;margin-right&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-        if (bWidth &lt;= 0) return 0;</span>
        <span class="gd">-</span>
        <span class="gd">-        return bWidth + mLeft + mRight;</span>
        <span class="gd">-      },</span>
        <span class="gd">-</span>
        <span class="gd">-      &#39;top&#39;: function(element) {</span>
        <span class="gd">-        var offset = element.positionedOffset();</span>
        <span class="gd">-        return offset.top;</span>
        <span class="gd">-      },</span>
        <span class="gd">-</span>
        <span class="gd">-      &#39;bottom&#39;: function(element) {</span>
        <span class="gd">-        var offset = element.positionedOffset(),</span>
        <span class="gd">-         parent = element.getOffsetParent(),</span>
        <span class="gd">-         pHeight = parent.measure(&#39;height&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-        var mHeight = this.get(&#39;border-box-height&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-        return pHeight - mHeight - offset.top;</span>
        <span class="gd">-      },</span>
        <span class="gd">-</span>
        <span class="gd">-      &#39;left&#39;: function(element) {</span>
        <span class="gd">-        var offset = element.positionedOffset();</span>
        <span class="gd">-        return offset.left;</span>
        <span class="gd">-      },</span>
        <span class="gd">-</span>
        <span class="gd">-      &#39;right&#39;: function(element) {</span>
        <span class="gd">-        var offset = element.positionedOffset(),</span>
        <span class="gd">-         parent = element.getOffsetParent(),</span>
        <span class="gd">-         pWidth = parent.measure(&#39;width&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-        var mWidth = this.get(&#39;border-box-width&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-        return pWidth - mWidth - offset.left;</span>
        <span class="gd">-      },</span>
        <span class="gd">-</span>
        <span class="gd">-      &#39;padding-top&#39;: function(element) {</span>
        <span class="gd">-        return getPixelValue(element, &#39;paddingTop&#39;);</span>
        <span class="gd">-      },</span>
        <span class="gd">-</span>
        <span class="gd">-      &#39;padding-bottom&#39;: function(element) {</span>
        <span class="gd">-        return getPixelValue(element, &#39;paddingBottom&#39;);</span>
        <span class="gd">-      },</span>
        <span class="gd">-</span>
        <span class="gd">-      &#39;padding-left&#39;: function(element) {</span>
        <span class="gd">-        return getPixelValue(element, &#39;paddingLeft&#39;);</span>
        <span class="gd">-      },</span>
        <span class="gd">-</span>
        <span class="gd">-      &#39;padding-right&#39;: function(element) {</span>
        <span class="gd">-        return getPixelValue(element, &#39;paddingRight&#39;);</span>
        <span class="gd">-      },</span>
        <span class="gd">-</span>
        <span class="gd">-      &#39;border-top&#39;: function(element) {</span>
        <span class="gd">-        return Object.isNumber(element.clientTop) ? element.clientTop :</span>
        <span class="gd">-         getPixelValue(element, &#39;borderTopWidth&#39;);</span>
        <span class="gd">-      },</span>
        <span class="gd">-</span>
        <span class="gd">-      &#39;border-bottom&#39;: function(element) {</span>
        <span class="gd">-        return Object.isNumber(element.clientBottom) ? element.clientBottom :</span>
        <span class="gd">-         getPixelValue(element, &#39;borderBottomWidth&#39;);</span>
        <span class="gd">-      },</span>
        <span class="gd">-</span>
        <span class="gd">-      &#39;border-left&#39;: function(element) {</span>
        <span class="gd">-        return Object.isNumber(element.clientLeft) ? element.clientLeft :</span>
        <span class="gd">-         getPixelValue(element, &#39;borderLeftWidth&#39;);</span>
        <span class="gd">-      },</span>
        <span class="gd">-</span>
        <span class="gd">-      &#39;border-right&#39;: function(element) {</span>
        <span class="gd">-        return Object.isNumber(element.clientRight) ? element.clientRight :</span>
        <span class="gd">-         getPixelValue(element, &#39;borderRightWidth&#39;);</span>
        <span class="gd">-      },</span>
        <span class="gd">-</span>
        <span class="gd">-      &#39;margin-top&#39;: function(element) {</span>
        <span class="gd">-        return getPixelValue(element, &#39;marginTop&#39;);</span>
        <span class="gd">-      },</span>
        <span class="gd">-</span>
        <span class="gd">-      &#39;margin-bottom&#39;: function(element) {</span>
        <span class="gd">-        return getPixelValue(element, &#39;marginBottom&#39;);</span>
        <span class="gd">-      },</span>
        <span class="gd">-</span>
        <span class="gd">-      &#39;margin-left&#39;: function(element) {</span>
        <span class="gd">-        return getPixelValue(element, &#39;marginLeft&#39;);</span>
        <span class="gd">-      },</span>
        <span class="gd">-</span>
        <span class="gd">-      &#39;margin-right&#39;: function(element) {</span>
        <span class="gd">-        return getPixelValue(element, &#39;marginRight&#39;);</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-  });</span>
        <span class="gd">-</span>
        <span class="gd">-  if (&#39;getBoundingClientRect&#39; in document.documentElement) {</span>
        <span class="gd">-    Object.extend(Element.Layout.COMPUTATIONS, {</span>
        <span class="gd">-      &#39;right&#39;: function(element) {</span>
        <span class="gd">-        var parent = hasLayout(element.getOffsetParent());</span>
        <span class="gd">-        var rect = element.getBoundingClientRect(),</span>
        <span class="gd">-         pRect = parent.getBoundingClientRect();</span>
        <span class="gd">-</span>
        <span class="gd">-        return (pRect.right - rect.right).round();</span>
        <span class="gd">-      },</span>
        <span class="gd">-</span>
        <span class="gd">-      &#39;bottom&#39;: function(element) {</span>
        <span class="gd">-        var parent = hasLayout(element.getOffsetParent());</span>
        <span class="gd">-        var rect = element.getBoundingClientRect(),</span>
        <span class="gd">-         pRect = parent.getBoundingClientRect();</span>
        <span class="gd">-</span>
        <span class="gd">-        return (pRect.bottom - rect.bottom).round();</span>
        <span class="gd">-      }</span>
        <span class="gd">-    });</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  Element.Offset = Class.create({</span>
        <span class="gd">-    initialize: function(left, top) {</span>
        <span class="gd">-      this.left = left.round();</span>
        <span class="gd">-      this.top  = top.round();</span>
        <span class="gd">-</span>
        <span class="gd">-      this[0] = this.left;</span>
        <span class="gd">-      this[1] = this.top;</span>
        <span class="gd">-    },</span>
        <span class="gd">-</span>
        <span class="gd">-    relativeTo: function(offset) {</span>
        <span class="gd">-      return new Element.Offset(</span>
        <span class="gd">-        this.left - offset.left,</span>
        <span class="gd">-        this.top  - offset.top</span>
        <span class="gd">-      );</span>
        <span class="gd">-    },</span>
        <span class="gd">-</span>
        <span class="gd">-    inspect: function() {</span>
        <span class="gd">-      return &quot;#&lt;Element.Offset left: #{left} top: #{top}&gt;&quot;.interpolate(this);</span>
        <span class="gd">-    },</span>
        <span class="gd">-</span>
        <span class="gd">-    toString: function() {</span>
        <span class="gd">-      return &quot;[#{left}, #{top}]&quot;.interpolate(this);</span>
        <span class="gd">-    },</span>
        <span class="gd">-</span>
        <span class="gd">-    toArray: function() {</span>
        <span class="gd">-      return [this.left, this.top];</span>
        <span class="gd">-    }</span>
        <span class="gd">-  });</span>
        <span class="gd">-</span>
        <span class="gd">-  function getLayout(element, preCompute) {</span>
        <span class="gd">-    return new Element.Layout(element, preCompute);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function measure(element, property) {</span>
        <span class="gd">-    return $(element).getLayout().get(property);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function getDimensions(element) {</span>
        <span class="gd">-    var layout = $(element).getLayout();</span>
        <span class="gd">-    return {</span>
        <span class="gd">-      width:  layout.get(&#39;width&#39;),</span>
        <span class="gd">-      height: layout.get(&#39;height&#39;)</span>
        <span class="gd">-    };</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function getOffsetParent(element) {</span>
        <span class="gd">-    if (isDetached(element)) return $(document.body);</span>
        <span class="gd">-</span>
        <span class="gd">-    var isInline = (Element.getStyle(element, &#39;display&#39;) === &#39;inline&#39;);</span>
        <span class="gd">-    if (!isInline &amp;&amp; element.offsetParent) return $(element.offsetParent);</span>
        <span class="gd">-    if (element === document.body) return $(element);</span>
        <span class="gd">-</span>
        <span class="gd">-    while ((element = element.parentNode) &amp;&amp; element !== document.body) {</span>
        <span class="gd">-      if (Element.getStyle(element, &#39;position&#39;) !== &#39;static&#39;) {</span>
        <span class="gd">-        return (element.nodeName === &#39;HTML&#39;) ? $(document.body) : $(element);</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    return $(document.body);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-  function cumulativeOffset(element) {</span>
        <span class="gd">-    var valueT = 0, valueL = 0;</span>
        <span class="gd">-    do {</span>
        <span class="gd">-      valueT += element.offsetTop  || 0;</span>
        <span class="gd">-      valueL += element.offsetLeft || 0;</span>
        <span class="gd">-      element = element.offsetParent;</span>
        <span class="gd">-    } while (element);</span>
        <span class="gd">-    return new Element.Offset(valueL, valueT);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function positionedOffset(element) {</span>
        <span class="gd">-    var layout = element.getLayout();</span>
        <span class="gd">-</span>
        <span class="gd">-    var valueT = 0, valueL = 0;</span>
        <span class="gd">-    do {</span>
        <span class="gd">-      valueT += element.offsetTop  || 0;</span>
        <span class="gd">-      valueL += element.offsetLeft || 0;</span>
        <span class="gd">-      element = element.offsetParent;</span>
        <span class="gd">-      if (element) {</span>
        <span class="gd">-        if (isBody(element)) break;</span>
        <span class="gd">-        var p = Element.getStyle(element, &#39;position&#39;);</span>
        <span class="gd">-        if (p !== &#39;static&#39;) break;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    } while (element);</span>
        <span class="gd">-</span>
        <span class="gd">-    valueL -= layout.get(&#39;margin-top&#39;);</span>
        <span class="gd">-    valueT -= layout.get(&#39;margin-left&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-    return new Element.Offset(valueL, valueT);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function cumulativeScrollOffset(element) {</span>
        <span class="gd">-    var valueT = 0, valueL = 0;</span>
        <span class="gd">-    do {</span>
        <span class="gd">-      valueT += element.scrollTop  || 0;</span>
        <span class="gd">-      valueL += element.scrollLeft || 0;</span>
        <span class="gd">-      element = element.parentNode;</span>
        <span class="gd">-    } while (element);</span>
        <span class="gd">-    return new Element.Offset(valueL, valueT);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function viewportOffset(forElement) {</span>
        <span class="gd">-    var valueT = 0, valueL = 0, docBody = document.body;</span>
        <span class="gd">-</span>
        <span class="gd">-    var element = forElement;</span>
        <span class="gd">-    do {</span>
        <span class="gd">-      valueT += element.offsetTop  || 0;</span>
        <span class="gd">-      valueL += element.offsetLeft || 0;</span>
        <span class="gd">-      if (element.offsetParent == docBody &amp;&amp;</span>
        <span class="gd">-        Element.getStyle(element, &#39;position&#39;) == &#39;absolute&#39;) break;</span>
        <span class="gd">-    } while (element = element.offsetParent);</span>
        <span class="gd">-</span>
        <span class="gd">-    element = forElement;</span>
        <span class="gd">-    do {</span>
        <span class="gd">-      if (element != docBody) {</span>
        <span class="gd">-        valueT -= element.scrollTop  || 0;</span>
        <span class="gd">-        valueL -= element.scrollLeft || 0;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    } while (element = element.parentNode);</span>
        <span class="gd">-    return new Element.Offset(valueL, valueT);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function absolutize(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-</span>
        <span class="gd">-    if (Element.getStyle(element, &#39;position&#39;) === &#39;absolute&#39;) {</span>
        <span class="gd">-      return element;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    var offsetParent = getOffsetParent(element);</span>
        <span class="gd">-    var eOffset = element.viewportOffset(),</span>
        <span class="gd">-     pOffset = offsetParent.viewportOffset();</span>
        <span class="gd">-</span>
        <span class="gd">-    var offset = eOffset.relativeTo(pOffset);</span>
        <span class="gd">-    var layout = element.getLayout();</span>
        <span class="gd">-</span>
        <span class="gd">-    element.store(&#39;prototype_absolutize_original_styles&#39;, {</span>
        <span class="gd">-      left:   element.getStyle(&#39;left&#39;),</span>
        <span class="gd">-      top:    element.getStyle(&#39;top&#39;),</span>
        <span class="gd">-      width:  element.getStyle(&#39;width&#39;),</span>
        <span class="gd">-      height: element.getStyle(&#39;height&#39;)</span>
        <span class="gd">-    });</span>
        <span class="gd">-</span>
        <span class="gd">-    element.setStyle({</span>
        <span class="gd">-      position: &#39;absolute&#39;,</span>
        <span class="gd">-      top:    offset.top + &#39;px&#39;,</span>
        <span class="gd">-      left:   offset.left + &#39;px&#39;,</span>
        <span class="gd">-      width:  layout.get(&#39;width&#39;) + &#39;px&#39;,</span>
        <span class="gd">-      height: layout.get(&#39;height&#39;) + &#39;px&#39;</span>
        <span class="gd">-    });</span>
        <span class="gd">-</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function relativize(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    if (Element.getStyle(element, &#39;position&#39;) === &#39;relative&#39;) {</span>
        <span class="gd">-      return element;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    var originalStyles =</span>
        <span class="gd">-     element.retrieve(&#39;prototype_absolutize_original_styles&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-    if (originalStyles) element.setStyle(originalStyles);</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  Element.addMethods({</span>
        <span class="gd">-    getLayout:              getLayout,</span>
        <span class="gd">-    measure:                measure,</span>
        <span class="gd">-    getDimensions:          getDimensions,</span>
        <span class="gd">-    getOffsetParent:        getOffsetParent,</span>
        <span class="gd">-    cumulativeOffset:       cumulativeOffset,</span>
        <span class="gd">-    positionedOffset:       positionedOffset,</span>
        <span class="gd">-    cumulativeScrollOffset: cumulativeScrollOffset,</span>
        <span class="gd">-    viewportOffset:         viewportOffset,</span>
        <span class="gd">-    absolutize:             absolutize,</span>
        <span class="gd">-    relativize:             relativize</span>
        <span class="gd">-  });</span>
        <span class="gd">-</span>
        <span class="gd">-  function isBody(element) {</span>
        <span class="gd">-    return element.nodeName.toUpperCase() === &#39;BODY&#39;;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function isDetached(element) {</span>
        <span class="gd">-    return element !== document.body &amp;&amp;</span>
        <span class="gd">-     !Element.descendantOf(element, document.body);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  if (&#39;getBoundingClientRect&#39; in document.documentElement) {</span>
        <span class="gd">-    Element.addMethods({</span>
        <span class="gd">-      viewportOffset: function(element) {</span>
        <span class="gd">-        element = $(element);</span>
        <span class="gd">-        if (isDetached(element)) return new Element.Offset(0, 0);</span>
        <span class="gd">-</span>
        <span class="gd">-        var rect  = element.getBoundingClientRect(),</span>
        <span class="gd">-         docEl = document.documentElement;</span>
        <span class="gd">-        return new Element.Offset(rect.left - docEl.clientLeft,</span>
        <span class="gd">-         rect.top - docEl.clientTop);</span>
        <span class="gd">-      },</span>
        <span class="gd">-</span>
        <span class="gd">-      positionedOffset: function(element) {</span>
        <span class="gd">-        element = $(element);</span>
        <span class="gd">-        var parent = element.getOffsetParent();</span>
        <span class="gd">-        if (isDetached(element)) return new Element.Offset(0, 0);</span>
        <span class="gd">-</span>
        <span class="gd">-        if (element.offsetParent &amp;&amp;</span>
        <span class="gd">-         element.offsetParent.nodeName.toUpperCase() === &#39;HTML&#39;) {</span>
        <span class="gd">-          return positionedOffset(element);</span>
        <span class="gd">-        }</span>
        <span class="gd">-</span>
        <span class="gd">-        var eOffset = element.viewportOffset(),</span>
        <span class="gd">-         pOffset = isBody(parent) ? viewportOffset(parent) :</span>
        <span class="gd">-          parent.viewportOffset();</span>
        <span class="gd">-        var retOffset = eOffset.relativeTo(pOffset);</span>
        <span class="gd">-</span>
        <span class="gd">-        var layout = element.getLayout();</span>
        <span class="gd">-        var top  = retOffset.top  - layout.get(&#39;margin-top&#39;);</span>
        <span class="gd">-        var left = retOffset.left - layout.get(&#39;margin-left&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-        return new Element.Offset(left, top);</span>
        <span class="gd">-      }</span>
        <span class="gd">-    });</span>
        <span class="gd">-  }</span>
        <span class="gd">-})();</span>
        <span class="gd">-window.$$ = function() {</span>
        <span class="gd">-  var expression = $A(arguments).join(&#39;, &#39;);</span>
        <span class="gd">-  return Prototype.Selector.select(expression, document);</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Prototype.Selector = (function() {</span>
        <span class="gd">-</span>
        <span class="gd">-  function select() {</span>
        <span class="gd">-    throw new Error(&#39;Method &quot;Prototype.Selector.select&quot; must be defined.&#39;);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function match() {</span>
        <span class="gd">-    throw new Error(&#39;Method &quot;Prototype.Selector.match&quot; must be defined.&#39;);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function find(elements, expression, index) {</span>
        <span class="gd">-    index = index || 0;</span>
        <span class="gd">-    var match = Prototype.Selector.match, length = elements.length, matchIndex = 0, i;</span>
        <span class="gd">-</span>
        <span class="gd">-    for (i = 0; i &lt; length; i++) {</span>
        <span class="gd">-      if (match(elements[i], expression) &amp;&amp; index == matchIndex++) {</span>
        <span class="gd">-        return Element.extend(elements[i]);</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function extendElements(elements) {</span>
        <span class="gd">-    for (var i = 0, length = elements.length; i &lt; length; i++) {</span>
        <span class="gd">-      Element.extend(elements[i]);</span>
        <span class="gd">-    }</span>
        <span class="gd">-    return elements;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-  var K = Prototype.K;</span>
        <span class="gd">-</span>
        <span class="gd">-  return {</span>
        <span class="gd">-    select: select,</span>
        <span class="gd">-    match: match,</span>
        <span class="gd">-    find: find,</span>
        <span class="gd">-    extendElements: (Element.extend === K) ? K : extendElements,</span>
        <span class="gd">-    extendElement: Element.extend</span>
        <span class="gd">-  };</span>
        <span class="gd">-})();</span>
        <span class="gd">-Prototype._original_property = window.Sizzle;</span>
        <span class="gd">-/*!</span>
        <span class="gd">- * Sizzle CSS Selector Engine - v1.0</span>
        <span class="gd">- *  Copyright 2009, The Dojo Foundation</span>
        <span class="gd">- *  Released under the MIT, BSD, and GPL Licenses.</span>
        <span class="gd">- *  More information: http://sizzlejs.com/</span>
        <span class="gd">- */</span>
        <span class="gd">-(function(){</span>
        <span class="gd">-</span>
        <span class="gd">-var chunker = /((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|[&#39;&quot;][^&#39;&quot;]*[&#39;&quot;]|[^[\]&#39;&quot;]+)+\]|\\.|[^ &gt;+~,(\[\\]+)+|[&gt;+~])(\s*,\s*)?((?:.|\r|\n)*)/g,</span>
        <span class="gd">-	done = 0,</span>
        <span class="gd">-	toString = Object.prototype.toString,</span>
        <span class="gd">-	hasDuplicate = false,</span>
        <span class="gd">-	baseHasDuplicate = true;</span>
        <span class="gd">-</span>
        <span class="gd">-[0, 0].sort(function(){</span>
        <span class="gd">-	baseHasDuplicate = false;</span>
        <span class="gd">-	return 0;</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-var Sizzle = function(selector, context, results, seed) {</span>
        <span class="gd">-	results = results || [];</span>
        <span class="gd">-	var origContext = context = context || document;</span>
        <span class="gd">-</span>
        <span class="gd">-	if ( context.nodeType !== 1 &amp;&amp; context.nodeType !== 9 ) {</span>
        <span class="gd">-		return [];</span>
        <span class="gd">-	}</span>
        <span class="gd">-</span>
        <span class="gd">-	if ( !selector || typeof selector !== &quot;string&quot; ) {</span>
        <span class="gd">-		return results;</span>
        <span class="gd">-	}</span>
        <span class="gd">-</span>
        <span class="gd">-	var parts = [], m, set, checkSet, check, mode, extra, prune = true, contextXML = isXML(context),</span>
        <span class="gd">-		soFar = selector;</span>
        <span class="gd">-</span>
        <span class="gd">-	while ( (chunker.exec(&quot;&quot;), m = chunker.exec(soFar)) !== null ) {</span>
        <span class="gd">-		soFar = m[3];</span>
        <span class="gd">-</span>
        <span class="gd">-		parts.push( m[1] );</span>
        <span class="gd">-</span>
        <span class="gd">-		if ( m[2] ) {</span>
        <span class="gd">-			extra = m[3];</span>
        <span class="gd">-			break;</span>
        <span class="gd">-		}</span>
        <span class="gd">-	}</span>
        <span class="gd">-</span>
        <span class="gd">-	if ( parts.length &gt; 1 &amp;&amp; origPOS.exec( selector ) ) {</span>
        <span class="gd">-		if ( parts.length === 2 &amp;&amp; Expr.relative[ parts[0] ] ) {</span>
        <span class="gd">-			set = posProcess( parts[0] + parts[1], context );</span>
        <span class="gd">-		} else {</span>
        <span class="gd">-			set = Expr.relative[ parts[0] ] ?</span>
        <span class="gd">-				[ context ] :</span>
        <span class="gd">-				Sizzle( parts.shift(), context );</span>
        <span class="gd">-</span>
        <span class="gd">-			while ( parts.length ) {</span>
        <span class="gd">-				selector = parts.shift();</span>
        <span class="gd">-</span>
        <span class="gd">-				if ( Expr.relative[ selector ] )</span>
        <span class="gd">-					selector += parts.shift();</span>
        <span class="gd">-</span>
        <span class="gd">-				set = posProcess( selector, set );</span>
        <span class="gd">-			}</span>
        <span class="gd">-		}</span>
        <span class="gd">-	} else {</span>
        <span class="gd">-		if ( !seed &amp;&amp; parts.length &gt; 1 &amp;&amp; context.nodeType === 9 &amp;&amp; !contextXML &amp;&amp;</span>
        <span class="gd">-				Expr.match.ID.test(parts[0]) &amp;&amp; !Expr.match.ID.test(parts[parts.length - 1]) ) {</span>
        <span class="gd">-			var ret = Sizzle.find( parts.shift(), context, contextXML );</span>
        <span class="gd">-			context = ret.expr ? Sizzle.filter( ret.expr, ret.set )[0] : ret.set[0];</span>
        <span class="gd">-		}</span>
        <span class="gd">-</span>
        <span class="gd">-		if ( context ) {</span>
        <span class="gd">-			var ret = seed ?</span>
        <span class="gd">-				{ expr: parts.pop(), set: makeArray(seed) } :</span>
        <span class="gd">-				Sizzle.find( parts.pop(), parts.length === 1 &amp;&amp; (parts[0] === &quot;~&quot; || parts[0] === &quot;+&quot;) &amp;&amp; context.parentNode ? context.parentNode : context, contextXML );</span>
        <span class="gd">-			set = ret.expr ? Sizzle.filter( ret.expr, ret.set ) : ret.set;</span>
        <span class="gd">-</span>
        <span class="gd">-			if ( parts.length &gt; 0 ) {</span>
        <span class="gd">-				checkSet = makeArray(set);</span>
        <span class="gd">-			} else {</span>
        <span class="gd">-				prune = false;</span>
        <span class="gd">-			}</span>
        <span class="gd">-</span>
        <span class="gd">-			while ( parts.length ) {</span>
        <span class="gd">-				var cur = parts.pop(), pop = cur;</span>
        <span class="gd">-</span>
        <span class="gd">-				if ( !Expr.relative[ cur ] ) {</span>
        <span class="gd">-					cur = &quot;&quot;;</span>
        <span class="gd">-				} else {</span>
        <span class="gd">-					pop = parts.pop();</span>
        <span class="gd">-				}</span>
        <span class="gd">-</span>
        <span class="gd">-				if ( pop == null ) {</span>
        <span class="gd">-					pop = context;</span>
        <span class="gd">-				}</span>
        <span class="gd">-</span>
        <span class="gd">-				Expr.relative[ cur ]( checkSet, pop, contextXML );</span>
        <span class="gd">-			}</span>
        <span class="gd">-		} else {</span>
        <span class="gd">-			checkSet = parts = [];</span>
        <span class="gd">-		}</span>
        <span class="gd">-	}</span>
        <span class="gd">-</span>
        <span class="gd">-	if ( !checkSet ) {</span>
        <span class="gd">-		checkSet = set;</span>
        <span class="gd">-	}</span>
        <span class="gd">-</span>
        <span class="gd">-	if ( !checkSet ) {</span>
        <span class="gd">-		throw &quot;Syntax error, unrecognized expression: &quot; + (cur || selector);</span>
        <span class="gd">-	}</span>
        <span class="gd">-</span>
        <span class="gd">-	if ( toString.call(checkSet) === &quot;[object Array]&quot; ) {</span>
        <span class="gd">-		if ( !prune ) {</span>
        <span class="gd">-			results.push.apply( results, checkSet );</span>
        <span class="gd">-		} else if ( context &amp;&amp; context.nodeType === 1 ) {</span>
        <span class="gd">-			for ( var i = 0; checkSet[i] != null; i++ ) {</span>
        <span class="gd">-				if ( checkSet[i] &amp;&amp; (checkSet[i] === true || checkSet[i].nodeType === 1 &amp;&amp; contains(context, checkSet[i])) ) {</span>
        <span class="gd">-					results.push( set[i] );</span>
        <span class="gd">-				}</span>
        <span class="gd">-			}</span>
        <span class="gd">-		} else {</span>
        <span class="gd">-			for ( var i = 0; checkSet[i] != null; i++ ) {</span>
        <span class="gd">-				if ( checkSet[i] &amp;&amp; checkSet[i].nodeType === 1 ) {</span>
        <span class="gd">-					results.push( set[i] );</span>
        <span class="gd">-				}</span>
        <span class="gd">-			}</span>
        <span class="gd">-		}</span>
        <span class="gd">-	} else {</span>
        <span class="gd">-		makeArray( checkSet, results );</span>
        <span class="gd">-	}</span>
        <span class="gd">-</span>
        <span class="gd">-	if ( extra ) {</span>
        <span class="gd">-		Sizzle( extra, origContext, results, seed );</span>
        <span class="gd">-		Sizzle.uniqueSort( results );</span>
        <span class="gd">-	}</span>
        <span class="gd">-</span>
        <span class="gd">-	return results;</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Sizzle.uniqueSort = function(results){</span>
        <span class="gd">-	if ( sortOrder ) {</span>
        <span class="gd">-		hasDuplicate = baseHasDuplicate;</span>
        <span class="gd">-		results.sort(sortOrder);</span>
        <span class="gd">-</span>
        <span class="gd">-		if ( hasDuplicate ) {</span>
        <span class="gd">-			for ( var i = 1; i &lt; results.length; i++ ) {</span>
        <span class="gd">-				if ( results[i] === results[i-1] ) {</span>
        <span class="gd">-					results.splice(i--, 1);</span>
        <span class="gd">-				}</span>
        <span class="gd">-			}</span>
        <span class="gd">-		}</span>
        <span class="gd">-	}</span>
        <span class="gd">-</span>
        <span class="gd">-	return results;</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Sizzle.matches = function(expr, set){</span>
        <span class="gd">-	return Sizzle(expr, null, null, set);</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Sizzle.find = function(expr, context, isXML){</span>
        <span class="gd">-	var set, match;</span>
        <span class="gd">-</span>
        <span class="gd">-	if ( !expr ) {</span>
        <span class="gd">-		return [];</span>
        <span class="gd">-	}</span>
        <span class="gd">-</span>
        <span class="gd">-	for ( var i = 0, l = Expr.order.length; i &lt; l; i++ ) {</span>
        <span class="gd">-		var type = Expr.order[i], match;</span>
        <span class="gd">-</span>
        <span class="gd">-		if ( (match = Expr.leftMatch[ type ].exec( expr )) ) {</span>
        <span class="gd">-			var left = match[1];</span>
        <span class="gd">-			match.splice(1,1);</span>
        <span class="gd">-</span>
        <span class="gd">-			if ( left.substr( left.length - 1 ) !== &quot;\\&quot; ) {</span>
        <span class="gd">-				match[1] = (match[1] || &quot;&quot;).replace(/\\/g, &quot;&quot;);</span>
        <span class="gd">-				set = Expr.find[ type ]( match, context, isXML );</span>
        <span class="gd">-				if ( set != null ) {</span>
        <span class="gd">-					expr = expr.replace( Expr.match[ type ], &quot;&quot; );</span>
        <span class="gd">-					break;</span>
        <span class="gd">-				}</span>
        <span class="gd">-			}</span>
        <span class="gd">-		}</span>
        <span class="gd">-	}</span>
        <span class="gd">-</span>
        <span class="gd">-	if ( !set ) {</span>
        <span class="gd">-		set = context.getElementsByTagName(&quot;*&quot;);</span>
        <span class="gd">-	}</span>
        <span class="gd">-</span>
        <span class="gd">-	return {set: set, expr: expr};</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Sizzle.filter = function(expr, set, inplace, not){</span>
        <span class="gd">-	var old = expr, result = [], curLoop = set, match, anyFound,</span>
        <span class="gd">-		isXMLFilter = set &amp;&amp; set[0] &amp;&amp; isXML(set[0]);</span>
        <span class="gd">-</span>
        <span class="gd">-	while ( expr &amp;&amp; set.length ) {</span>
        <span class="gd">-		for ( var type in Expr.filter ) {</span>
        <span class="gd">-			if ( (match = Expr.match[ type ].exec( expr )) != null ) {</span>
        <span class="gd">-				var filter = Expr.filter[ type ], found, item;</span>
        <span class="gd">-				anyFound = false;</span>
        <span class="gd">-</span>
        <span class="gd">-				if ( curLoop == result ) {</span>
        <span class="gd">-					result = [];</span>
        <span class="gd">-				}</span>
        <span class="gd">-</span>
        <span class="gd">-				if ( Expr.preFilter[ type ] ) {</span>
        <span class="gd">-					match = Expr.preFilter[ type ]( match, curLoop, inplace, result, not, isXMLFilter );</span>
        <span class="gd">-</span>
        <span class="gd">-					if ( !match ) {</span>
        <span class="gd">-						anyFound = found = true;</span>
        <span class="gd">-					} else if ( match === true ) {</span>
        <span class="gd">-						continue;</span>
        <span class="gd">-					}</span>
        <span class="gd">-				}</span>
        <span class="gd">-</span>
        <span class="gd">-				if ( match ) {</span>
        <span class="gd">-					for ( var i = 0; (item = curLoop[i]) != null; i++ ) {</span>
        <span class="gd">-						if ( item ) {</span>
        <span class="gd">-							found = filter( item, match, i, curLoop );</span>
        <span class="gd">-							var pass = not ^ !!found;</span>
        <span class="gd">-</span>
        <span class="gd">-							if ( inplace &amp;&amp; found != null ) {</span>
        <span class="gd">-								if ( pass ) {</span>
        <span class="gd">-									anyFound = true;</span>
        <span class="gd">-								} else {</span>
        <span class="gd">-									curLoop[i] = false;</span>
        <span class="gd">-								}</span>
        <span class="gd">-							} else if ( pass ) {</span>
        <span class="gd">-								result.push( item );</span>
        <span class="gd">-								anyFound = true;</span>
        <span class="gd">-							}</span>
        <span class="gd">-						}</span>
        <span class="gd">-					}</span>
        <span class="gd">-				}</span>
        <span class="gd">-</span>
        <span class="gd">-				if ( found !== undefined ) {</span>
        <span class="gd">-					if ( !inplace ) {</span>
        <span class="gd">-						curLoop = result;</span>
        <span class="gd">-					}</span>
        <span class="gd">-</span>
        <span class="gd">-					expr = expr.replace( Expr.match[ type ], &quot;&quot; );</span>
        <span class="gd">-</span>
        <span class="gd">-					if ( !anyFound ) {</span>
        <span class="gd">-						return [];</span>
        <span class="gd">-					}</span>
        <span class="gd">-</span>
        <span class="gd">-					break;</span>
        <span class="gd">-				}</span>
        <span class="gd">-			}</span>
        <span class="gd">-		}</span>
        <span class="gd">-</span>
        <span class="gd">-		if ( expr == old ) {</span>
        <span class="gd">-			if ( anyFound == null ) {</span>
        <span class="gd">-				throw &quot;Syntax error, unrecognized expression: &quot; + expr;</span>
        <span class="gd">-			} else {</span>
        <span class="gd">-				break;</span>
        <span class="gd">-			}</span>
        <span class="gd">-		}</span>
        <span class="gd">-</span>
        <span class="gd">-		old = expr;</span>
        <span class="gd">-	}</span>
        <span class="gd">-</span>
        <span class="gd">-	return curLoop;</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-var Expr = Sizzle.selectors = {</span>
        <span class="gd">-	order: [ &quot;ID&quot;, &quot;NAME&quot;, &quot;TAG&quot; ],</span>
        <span class="gd">-	match: {</span>
        <span class="gd">-		ID: /#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,</span>
        <span class="gd">-		CLASS: /\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,</span>
        <span class="gd">-		NAME: /\[name=[&#39;&quot;]*((?:[\w\u00c0-\uFFFF-]|\\.)+)[&#39;&quot;]*\]/,</span>
        <span class="gd">-		ATTR: /\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*([&#39;&quot;]*)(.*?)\3|)\s*\]/,</span>
        <span class="gd">-		TAG: /^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,</span>
        <span class="gd">-		CHILD: /:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,</span>
        <span class="gd">-		POS: /:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,</span>
        <span class="gd">-		PSEUDO: /:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\(([&#39;&quot;]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/</span>
        <span class="gd">-	},</span>
        <span class="gd">-	leftMatch: {},</span>
        <span class="gd">-	attrMap: {</span>
        <span class="gd">-		&quot;class&quot;: &quot;className&quot;,</span>
        <span class="gd">-		&quot;for&quot;: &quot;htmlFor&quot;</span>
        <span class="gd">-	},</span>
        <span class="gd">-	attrHandle: {</span>
        <span class="gd">-		href: function(elem){</span>
        <span class="gd">-			return elem.getAttribute(&quot;href&quot;);</span>
        <span class="gd">-		}</span>
        <span class="gd">-	},</span>
        <span class="gd">-	relative: {</span>
        <span class="gd">-		&quot;+&quot;: function(checkSet, part, isXML){</span>
        <span class="gd">-			var isPartStr = typeof part === &quot;string&quot;,</span>
        <span class="gd">-				isTag = isPartStr &amp;&amp; !/\W/.test(part),</span>
        <span class="gd">-				isPartStrNotTag = isPartStr &amp;&amp; !isTag;</span>
        <span class="gd">-</span>
        <span class="gd">-			if ( isTag &amp;&amp; !isXML ) {</span>
        <span class="gd">-				part = part.toUpperCase();</span>
        <span class="gd">-			}</span>
        <span class="gd">-</span>
        <span class="gd">-			for ( var i = 0, l = checkSet.length, elem; i &lt; l; i++ ) {</span>
        <span class="gd">-				if ( (elem = checkSet[i]) ) {</span>
        <span class="gd">-					while ( (elem = elem.previousSibling) &amp;&amp; elem.nodeType !== 1 ) {}</span>
        <span class="gd">-</span>
        <span class="gd">-					checkSet[i] = isPartStrNotTag || elem &amp;&amp; elem.nodeName === part ?</span>
        <span class="gd">-						elem || false :</span>
        <span class="gd">-						elem === part;</span>
        <span class="gd">-				}</span>
        <span class="gd">-			}</span>
        <span class="gd">-</span>
        <span class="gd">-			if ( isPartStrNotTag ) {</span>
        <span class="gd">-				Sizzle.filter( part, checkSet, true );</span>
        <span class="gd">-			}</span>
        <span class="gd">-		},</span>
        <span class="gd">-		&quot;&gt;&quot;: function(checkSet, part, isXML){</span>
        <span class="gd">-			var isPartStr = typeof part === &quot;string&quot;;</span>
        <span class="gd">-</span>
        <span class="gd">-			if ( isPartStr &amp;&amp; !/\W/.test(part) ) {</span>
        <span class="gd">-				part = isXML ? part : part.toUpperCase();</span>
        <span class="gd">-</span>
        <span class="gd">-				for ( var i = 0, l = checkSet.length; i &lt; l; i++ ) {</span>
        <span class="gd">-					var elem = checkSet[i];</span>
        <span class="gd">-					if ( elem ) {</span>
        <span class="gd">-						var parent = elem.parentNode;</span>
        <span class="gd">-						checkSet[i] = parent.nodeName === part ? parent : false;</span>
        <span class="gd">-					}</span>
        <span class="gd">-				}</span>
        <span class="gd">-			} else {</span>
        <span class="gd">-				for ( var i = 0, l = checkSet.length; i &lt; l; i++ ) {</span>
        <span class="gd">-					var elem = checkSet[i];</span>
        <span class="gd">-					if ( elem ) {</span>
        <span class="gd">-						checkSet[i] = isPartStr ?</span>
        <span class="gd">-							elem.parentNode :</span>
        <span class="gd">-							elem.parentNode === part;</span>
        <span class="gd">-					}</span>
        <span class="gd">-				}</span>
        <span class="gd">-</span>
        <span class="gd">-				if ( isPartStr ) {</span>
        <span class="gd">-					Sizzle.filter( part, checkSet, true );</span>
        <span class="gd">-				}</span>
        <span class="gd">-			}</span>
        <span class="gd">-		},</span>
        <span class="gd">-		&quot;&quot;: function(checkSet, part, isXML){</span>
        <span class="gd">-			var doneName = done++, checkFn = dirCheck;</span>
        <span class="gd">-</span>
        <span class="gd">-			if ( !/\W/.test(part) ) {</span>
        <span class="gd">-				var nodeCheck = part = isXML ? part : part.toUpperCase();</span>
        <span class="gd">-				checkFn = dirNodeCheck;</span>
        <span class="gd">-			}</span>
        <span class="gd">-</span>
        <span class="gd">-			checkFn(&quot;parentNode&quot;, part, doneName, checkSet, nodeCheck, isXML);</span>
        <span class="gd">-		},</span>
        <span class="gd">-		&quot;~&quot;: function(checkSet, part, isXML){</span>
        <span class="gd">-			var doneName = done++, checkFn = dirCheck;</span>
        <span class="gd">-</span>
        <span class="gd">-			if ( typeof part === &quot;string&quot; &amp;&amp; !/\W/.test(part) ) {</span>
        <span class="gd">-				var nodeCheck = part = isXML ? part : part.toUpperCase();</span>
        <span class="gd">-				checkFn = dirNodeCheck;</span>
        <span class="gd">-			}</span>
        <span class="gd">-</span>
        <span class="gd">-			checkFn(&quot;previousSibling&quot;, part, doneName, checkSet, nodeCheck, isXML);</span>
        <span class="gd">-		}</span>
        <span class="gd">-	},</span>
        <span class="gd">-	find: {</span>
        <span class="gd">-		ID: function(match, context, isXML){</span>
        <span class="gd">-			if ( typeof context.getElementById !== &quot;undefined&quot; &amp;&amp; !isXML ) {</span>
        <span class="gd">-				var m = context.getElementById(match[1]);</span>
        <span class="gd">-				return m ? [m] : [];</span>
        <span class="gd">-			}</span>
        <span class="gd">-		},</span>
        <span class="gd">-		NAME: function(match, context, isXML){</span>
        <span class="gd">-			if ( typeof context.getElementsByName !== &quot;undefined&quot; ) {</span>
        <span class="gd">-				var ret = [], results = context.getElementsByName(match[1]);</span>
        <span class="gd">-</span>
        <span class="gd">-				for ( var i = 0, l = results.length; i &lt; l; i++ ) {</span>
        <span class="gd">-					if ( results[i].getAttribute(&quot;name&quot;) === match[1] ) {</span>
        <span class="gd">-						ret.push( results[i] );</span>
        <span class="gd">-					}</span>
        <span class="gd">-				}</span>
        <span class="gd">-</span>
        <span class="gd">-				return ret.length === 0 ? null : ret;</span>
        <span class="gd">-			}</span>
        <span class="gd">-		},</span>
        <span class="gd">-		TAG: function(match, context){</span>
        <span class="gd">-			return context.getElementsByTagName(match[1]);</span>
        <span class="gd">-		}</span>
        <span class="gd">-	},</span>
        <span class="gd">-	preFilter: {</span>
        <span class="gd">-		CLASS: function(match, curLoop, inplace, result, not, isXML){</span>
        <span class="gd">-			match = &quot; &quot; + match[1].replace(/\\/g, &quot;&quot;) + &quot; &quot;;</span>
        <span class="gd">-</span>
        <span class="gd">-			if ( isXML ) {</span>
        <span class="gd">-				return match;</span>
        <span class="gd">-			}</span>
        <span class="gd">-</span>
        <span class="gd">-			for ( var i = 0, elem; (elem = curLoop[i]) != null; i++ ) {</span>
        <span class="gd">-				if ( elem ) {</span>
        <span class="gd">-					if ( not ^ (elem.className &amp;&amp; (&quot; &quot; + elem.className + &quot; &quot;).indexOf(match) &gt;= 0) ) {</span>
        <span class="gd">-						if ( !inplace )</span>
        <span class="gd">-							result.push( elem );</span>
        <span class="gd">-					} else if ( inplace ) {</span>
        <span class="gd">-						curLoop[i] = false;</span>
        <span class="gd">-					}</span>
        <span class="gd">-				}</span>
        <span class="gd">-			}</span>
        <span class="gd">-</span>
        <span class="gd">-			return false;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		ID: function(match){</span>
        <span class="gd">-			return match[1].replace(/\\/g, &quot;&quot;);</span>
        <span class="gd">-		},</span>
        <span class="gd">-		TAG: function(match, curLoop){</span>
        <span class="gd">-			for ( var i = 0; curLoop[i] === false; i++ ){}</span>
        <span class="gd">-			return curLoop[i] &amp;&amp; isXML(curLoop[i]) ? match[1] : match[1].toUpperCase();</span>
        <span class="gd">-		},</span>
        <span class="gd">-		CHILD: function(match){</span>
        <span class="gd">-			if ( match[1] == &quot;nth&quot; ) {</span>
        <span class="gd">-				var test = /(-?)(\d*)n((?:\+|-)?\d*)/.exec(</span>
        <span class="gd">-					match[2] == &quot;even&quot; &amp;&amp; &quot;2n&quot; || match[2] == &quot;odd&quot; &amp;&amp; &quot;2n+1&quot; ||</span>
        <span class="gd">-					!/\D/.test( match[2] ) &amp;&amp; &quot;0n+&quot; + match[2] || match[2]);</span>
        <span class="gd">-</span>
        <span class="gd">-				match[2] = (test[1] + (test[2] || 1)) - 0;</span>
        <span class="gd">-				match[3] = test[3] - 0;</span>
        <span class="gd">-			}</span>
        <span class="gd">-</span>
        <span class="gd">-			match[0] = done++;</span>
        <span class="gd">-</span>
        <span class="gd">-			return match;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		ATTR: function(match, curLoop, inplace, result, not, isXML){</span>
        <span class="gd">-			var name = match[1].replace(/\\/g, &quot;&quot;);</span>
        <span class="gd">-</span>
        <span class="gd">-			if ( !isXML &amp;&amp; Expr.attrMap[name] ) {</span>
        <span class="gd">-				match[1] = Expr.attrMap[name];</span>
        <span class="gd">-			}</span>
        <span class="gd">-</span>
        <span class="gd">-			if ( match[2] === &quot;~=&quot; ) {</span>
        <span class="gd">-				match[4] = &quot; &quot; + match[4] + &quot; &quot;;</span>
        <span class="gd">-			}</span>
        <span class="gd">-</span>
        <span class="gd">-			return match;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		PSEUDO: function(match, curLoop, inplace, result, not){</span>
        <span class="gd">-			if ( match[1] === &quot;not&quot; ) {</span>
        <span class="gd">-				if ( ( chunker.exec(match[3]) || &quot;&quot; ).length &gt; 1 || /^\w/.test(match[3]) ) {</span>
        <span class="gd">-					match[3] = Sizzle(match[3], null, null, curLoop);</span>
        <span class="gd">-				} else {</span>
        <span class="gd">-					var ret = Sizzle.filter(match[3], curLoop, inplace, true ^ not);</span>
        <span class="gd">-					if ( !inplace ) {</span>
        <span class="gd">-						result.push.apply( result, ret );</span>
        <span class="gd">-					}</span>
        <span class="gd">-					return false;</span>
        <span class="gd">-				}</span>
        <span class="gd">-			} else if ( Expr.match.POS.test( match[0] ) || Expr.match.CHILD.test( match[0] ) ) {</span>
        <span class="gd">-				return true;</span>
        <span class="gd">-			}</span>
        <span class="gd">-</span>
        <span class="gd">-			return match;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		POS: function(match){</span>
        <span class="gd">-			match.unshift( true );</span>
        <span class="gd">-			return match;</span>
        <span class="gd">-		}</span>
        <span class="gd">-	},</span>
        <span class="gd">-	filters: {</span>
        <span class="gd">-		enabled: function(elem){</span>
        <span class="gd">-			return elem.disabled === false &amp;&amp; elem.type !== &quot;hidden&quot;;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		disabled: function(elem){</span>
        <span class="gd">-			return elem.disabled === true;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		checked: function(elem){</span>
        <span class="gd">-			return elem.checked === true;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		selected: function(elem){</span>
        <span class="gd">-			elem.parentNode.selectedIndex;</span>
        <span class="gd">-			return elem.selected === true;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		parent: function(elem){</span>
        <span class="gd">-			return !!elem.firstChild;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		empty: function(elem){</span>
        <span class="gd">-			return !elem.firstChild;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		has: function(elem, i, match){</span>
        <span class="gd">-			return !!Sizzle( match[3], elem ).length;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		header: function(elem){</span>
        <span class="gd">-			return /h\d/i.test( elem.nodeName );</span>
        <span class="gd">-		},</span>
        <span class="gd">-		text: function(elem){</span>
        <span class="gd">-			return &quot;text&quot; === elem.type;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		radio: function(elem){</span>
        <span class="gd">-			return &quot;radio&quot; === elem.type;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		checkbox: function(elem){</span>
        <span class="gd">-			return &quot;checkbox&quot; === elem.type;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		file: function(elem){</span>
        <span class="gd">-			return &quot;file&quot; === elem.type;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		password: function(elem){</span>
        <span class="gd">-			return &quot;password&quot; === elem.type;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		submit: function(elem){</span>
        <span class="gd">-			return &quot;submit&quot; === elem.type;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		image: function(elem){</span>
        <span class="gd">-			return &quot;image&quot; === elem.type;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		reset: function(elem){</span>
        <span class="gd">-			return &quot;reset&quot; === elem.type;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		button: function(elem){</span>
        <span class="gd">-			return &quot;button&quot; === elem.type || elem.nodeName.toUpperCase() === &quot;BUTTON&quot;;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		input: function(elem){</span>
        <span class="gd">-			return /input|select|textarea|button/i.test(elem.nodeName);</span>
        <span class="gd">-		}</span>
        <span class="gd">-	},</span>
        <span class="gd">-	setFilters: {</span>
        <span class="gd">-		first: function(elem, i){</span>
        <span class="gd">-			return i === 0;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		last: function(elem, i, match, array){</span>
        <span class="gd">-			return i === array.length - 1;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		even: function(elem, i){</span>
        <span class="gd">-			return i % 2 === 0;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		odd: function(elem, i){</span>
        <span class="gd">-			return i % 2 === 1;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		lt: function(elem, i, match){</span>
        <span class="gd">-			return i &lt; match[3] - 0;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		gt: function(elem, i, match){</span>
        <span class="gd">-			return i &gt; match[3] - 0;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		nth: function(elem, i, match){</span>
        <span class="gd">-			return match[3] - 0 == i;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		eq: function(elem, i, match){</span>
        <span class="gd">-			return match[3] - 0 == i;</span>
        <span class="gd">-		}</span>
        <span class="gd">-	},</span>
        <span class="gd">-	filter: {</span>
        <span class="gd">-		PSEUDO: function(elem, match, i, array){</span>
        <span class="gd">-			var name = match[1], filter = Expr.filters[ name ];</span>
        <span class="gd">-</span>
        <span class="gd">-			if ( filter ) {</span>
        <span class="gd">-				return filter( elem, i, match, array );</span>
        <span class="gd">-			} else if ( name === &quot;contains&quot; ) {</span>
        <span class="gd">-				return (elem.textContent || elem.innerText || &quot;&quot;).indexOf(match[3]) &gt;= 0;</span>
        <span class="gd">-			} else if ( name === &quot;not&quot; ) {</span>
        <span class="gd">-				var not = match[3];</span>
        <span class="gd">-</span>
        <span class="gd">-				for ( var i = 0, l = not.length; i &lt; l; i++ ) {</span>
        <span class="gd">-					if ( not[i] === elem ) {</span>
        <span class="gd">-						return false;</span>
        <span class="gd">-					}</span>
        <span class="gd">-				}</span>
        <span class="gd">-</span>
        <span class="gd">-				return true;</span>
        <span class="gd">-			}</span>
        <span class="gd">-		},</span>
        <span class="gd">-		CHILD: function(elem, match){</span>
        <span class="gd">-			var type = match[1], node = elem;</span>
        <span class="gd">-			switch (type) {</span>
        <span class="gd">-				case &#39;only&#39;:</span>
        <span class="gd">-				case &#39;first&#39;:</span>
        <span class="gd">-					while ( (node = node.previousSibling) )  {</span>
        <span class="gd">-						if ( node.nodeType === 1 ) return false;</span>
        <span class="gd">-					}</span>
        <span class="gd">-					if ( type == &#39;first&#39;) return true;</span>
        <span class="gd">-					node = elem;</span>
        <span class="gd">-				case &#39;last&#39;:</span>
        <span class="gd">-					while ( (node = node.nextSibling) )  {</span>
        <span class="gd">-						if ( node.nodeType === 1 ) return false;</span>
        <span class="gd">-					}</span>
        <span class="gd">-					return true;</span>
        <span class="gd">-				case &#39;nth&#39;:</span>
        <span class="gd">-					var first = match[2], last = match[3];</span>
        <span class="gd">-</span>
        <span class="gd">-					if ( first == 1 &amp;&amp; last == 0 ) {</span>
        <span class="gd">-						return true;</span>
        <span class="gd">-					}</span>
        <span class="gd">-</span>
        <span class="gd">-					var doneName = match[0],</span>
        <span class="gd">-						parent = elem.parentNode;</span>
        <span class="gd">-</span>
        <span class="gd">-					if ( parent &amp;&amp; (parent.sizcache !== doneName || !elem.nodeIndex) ) {</span>
        <span class="gd">-						var count = 0;</span>
        <span class="gd">-						for ( node = parent.firstChild; node; node = node.nextSibling ) {</span>
        <span class="gd">-							if ( node.nodeType === 1 ) {</span>
        <span class="gd">-								node.nodeIndex = ++count;</span>
        <span class="gd">-							}</span>
        <span class="gd">-						}</span>
        <span class="gd">-						parent.sizcache = doneName;</span>
        <span class="gd">-					}</span>
        <span class="gd">-</span>
        <span class="gd">-					var diff = elem.nodeIndex - last;</span>
        <span class="gd">-					if ( first == 0 ) {</span>
        <span class="gd">-						return diff == 0;</span>
        <span class="gd">-					} else {</span>
        <span class="gd">-						return ( diff % first == 0 &amp;&amp; diff / first &gt;= 0 );</span>
        <span class="gd">-					}</span>
        <span class="gd">-			}</span>
        <span class="gd">-		},</span>
        <span class="gd">-		ID: function(elem, match){</span>
        <span class="gd">-			return elem.nodeType === 1 &amp;&amp; elem.getAttribute(&quot;id&quot;) === match;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		TAG: function(elem, match){</span>
        <span class="gd">-			return (match === &quot;*&quot; &amp;&amp; elem.nodeType === 1) || elem.nodeName === match;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		CLASS: function(elem, match){</span>
        <span class="gd">-			return (&quot; &quot; + (elem.className || elem.getAttribute(&quot;class&quot;)) + &quot; &quot;)</span>
        <span class="gd">-				.indexOf( match ) &gt; -1;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		ATTR: function(elem, match){</span>
        <span class="gd">-			var name = match[1],</span>
        <span class="gd">-				result = Expr.attrHandle[ name ] ?</span>
        <span class="gd">-					Expr.attrHandle[ name ]( elem ) :</span>
        <span class="gd">-					elem[ name ] != null ?</span>
        <span class="gd">-						elem[ name ] :</span>
        <span class="gd">-						elem.getAttribute( name ),</span>
        <span class="gd">-				value = result + &quot;&quot;,</span>
        <span class="gd">-				type = match[2],</span>
        <span class="gd">-				check = match[4];</span>
        <span class="gd">-</span>
        <span class="gd">-			return result == null ?</span>
        <span class="gd">-				type === &quot;!=&quot; :</span>
        <span class="gd">-				type === &quot;=&quot; ?</span>
        <span class="gd">-				value === check :</span>
        <span class="gd">-				type === &quot;*=&quot; ?</span>
        <span class="gd">-				value.indexOf(check) &gt;= 0 :</span>
        <span class="gd">-				type === &quot;~=&quot; ?</span>
        <span class="gd">-				(&quot; &quot; + value + &quot; &quot;).indexOf(check) &gt;= 0 :</span>
        <span class="gd">-				!check ?</span>
        <span class="gd">-				value &amp;&amp; result !== false :</span>
        <span class="gd">-				type === &quot;!=&quot; ?</span>
        <span class="gd">-				value != check :</span>
        <span class="gd">-				type === &quot;^=&quot; ?</span>
        <span class="gd">-				value.indexOf(check) === 0 :</span>
        <span class="gd">-				type === &quot;$=&quot; ?</span>
        <span class="gd">-				value.substr(value.length - check.length) === check :</span>
        <span class="gd">-				type === &quot;|=&quot; ?</span>
        <span class="gd">-				value === check || value.substr(0, check.length + 1) === check + &quot;-&quot; :</span>
        <span class="gd">-				false;</span>
        <span class="gd">-		},</span>
        <span class="gd">-		POS: function(elem, match, i, array){</span>
        <span class="gd">-			var name = match[2], filter = Expr.setFilters[ name ];</span>
        <span class="gd">-</span>
        <span class="gd">-			if ( filter ) {</span>
        <span class="gd">-				return filter( elem, i, match, array );</span>
        <span class="gd">-			}</span>
        <span class="gd">-		}</span>
        <span class="gd">-	}</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-var origPOS = Expr.match.POS;</span>
        <span class="gd">-</span>
        <span class="gd">-for ( var type in Expr.match ) {</span>
        <span class="gd">-	Expr.match[ type ] = new RegExp( Expr.match[ type ].source + /(?![^\[]*\])(?![^\(]*\))/.source );</span>
        <span class="gd">-	Expr.leftMatch[ type ] = new RegExp( /(^(?:.|\r|\n)*?)/.source + Expr.match[ type ].source );</span>
        <span class="gd">-}</span>
        <span class="gd">-</span>
        <span class="gd">-var makeArray = function(array, results) {</span>
        <span class="gd">-	array = Array.prototype.slice.call( array, 0 );</span>
        <span class="gd">-</span>
        <span class="gd">-	if ( results ) {</span>
        <span class="gd">-		results.push.apply( results, array );</span>
        <span class="gd">-		return results;</span>
        <span class="gd">-	}</span>
        <span class="gd">-</span>
        <span class="gd">-	return array;</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-try {</span>
        <span class="gd">-	Array.prototype.slice.call( document.documentElement.childNodes, 0 );</span>
        <span class="gd">-</span>
        <span class="gd">-} catch(e){</span>
        <span class="gd">-	makeArray = function(array, results) {</span>
        <span class="gd">-		var ret = results || [];</span>
        <span class="gd">-</span>
        <span class="gd">-		if ( toString.call(array) === &quot;[object Array]&quot; ) {</span>
        <span class="gd">-			Array.prototype.push.apply( ret, array );</span>
        <span class="gd">-		} else {</span>
        <span class="gd">-			if ( typeof array.length === &quot;number&quot; ) {</span>
        <span class="gd">-				for ( var i = 0, l = array.length; i &lt; l; i++ ) {</span>
        <span class="gd">-					ret.push( array[i] );</span>
        <span class="gd">-				}</span>
        <span class="gd">-			} else {</span>
        <span class="gd">-				for ( var i = 0; array[i]; i++ ) {</span>
        <span class="gd">-					ret.push( array[i] );</span>
        <span class="gd">-				}</span>
        <span class="gd">-			}</span>
        <span class="gd">-		}</span>
        <span class="gd">-</span>
        <span class="gd">-		return ret;</span>
        <span class="gd">-	};</span>
        <span class="gd">-}</span>
        <span class="gd">-</span>
        <span class="gd">-var sortOrder;</span>
        <span class="gd">-</span>
        <span class="gd">-if ( document.documentElement.compareDocumentPosition ) {</span>
        <span class="gd">-	sortOrder = function( a, b ) {</span>
        <span class="gd">-		if ( !a.compareDocumentPosition || !b.compareDocumentPosition ) {</span>
        <span class="gd">-			if ( a == b ) {</span>
        <span class="gd">-				hasDuplicate = true;</span>
        <span class="gd">-			}</span>
        <span class="gd">-			return 0;</span>
        <span class="gd">-		}</span>
        <span class="gd">-</span>
        <span class="gd">-		var ret = a.compareDocumentPosition(b) &amp; 4 ? -1 : a === b ? 0 : 1;</span>
        <span class="gd">-		if ( ret === 0 ) {</span>
        <span class="gd">-			hasDuplicate = true;</span>
        <span class="gd">-		}</span>
        <span class="gd">-		return ret;</span>
        <span class="gd">-	};</span>
        <span class="gd">-} else if ( &quot;sourceIndex&quot; in document.documentElement ) {</span>
        <span class="gd">-	sortOrder = function( a, b ) {</span>
        <span class="gd">-		if ( !a.sourceIndex || !b.sourceIndex ) {</span>
        <span class="gd">-			if ( a == b ) {</span>
        <span class="gd">-				hasDuplicate = true;</span>
        <span class="gd">-			}</span>
        <span class="gd">-			return 0;</span>
        <span class="gd">-		}</span>
        <span class="gd">-</span>
        <span class="gd">-		var ret = a.sourceIndex - b.sourceIndex;</span>
        <span class="gd">-		if ( ret === 0 ) {</span>
        <span class="gd">-			hasDuplicate = true;</span>
        <span class="gd">-		}</span>
        <span class="gd">-		return ret;</span>
        <span class="gd">-	};</span>
        <span class="gd">-} else if ( document.createRange ) {</span>
        <span class="gd">-	sortOrder = function( a, b ) {</span>
        <span class="gd">-		if ( !a.ownerDocument || !b.ownerDocument ) {</span>
        <span class="gd">-			if ( a == b ) {</span>
        <span class="gd">-				hasDuplicate = true;</span>
        <span class="gd">-			}</span>
        <span class="gd">-			return 0;</span>
        <span class="gd">-		}</span>
        <span class="gd">-</span>
        <span class="gd">-		var aRange = a.ownerDocument.createRange(), bRange = b.ownerDocument.createRange();</span>
        <span class="gd">-		aRange.setStart(a, 0);</span>
        <span class="gd">-		aRange.setEnd(a, 0);</span>
        <span class="gd">-		bRange.setStart(b, 0);</span>
        <span class="gd">-		bRange.setEnd(b, 0);</span>
        <span class="gd">-		var ret = aRange.compareBoundaryPoints(Range.START_TO_END, bRange);</span>
        <span class="gd">-		if ( ret === 0 ) {</span>
        <span class="gd">-			hasDuplicate = true;</span>
        <span class="gd">-		}</span>
        <span class="gd">-		return ret;</span>
        <span class="gd">-	};</span>
        <span class="gd">-}</span>
        <span class="gd">-</span>
        <span class="gd">-(function(){</span>
        <span class="gd">-	var form = document.createElement(&quot;div&quot;),</span>
        <span class="gd">-		id = &quot;script&quot; + (new Date).getTime();</span>
        <span class="gd">-	form.innerHTML = &quot;&lt;a name=&#39;&quot; + id + &quot;&#39;/&gt;&quot;;</span>
        <span class="gd">-</span>
        <span class="gd">-	var root = document.documentElement;</span>
        <span class="gd">-	root.insertBefore( form, root.firstChild );</span>
        <span class="gd">-</span>
        <span class="gd">-	if ( !!document.getElementById( id ) ) {</span>
        <span class="gd">-		Expr.find.ID = function(match, context, isXML){</span>
        <span class="gd">-			if ( typeof context.getElementById !== &quot;undefined&quot; &amp;&amp; !isXML ) {</span>
        <span class="gd">-				var m = context.getElementById(match[1]);</span>
        <span class="gd">-				return m ? m.id === match[1] || typeof m.getAttributeNode !== &quot;undefined&quot; &amp;&amp; m.getAttributeNode(&quot;id&quot;).nodeValue === match[1] ? [m] : undefined : [];</span>
        <span class="gd">-			}</span>
        <span class="gd">-		};</span>
        <span class="gd">-</span>
        <span class="gd">-		Expr.filter.ID = function(elem, match){</span>
        <span class="gd">-			var node = typeof elem.getAttributeNode !== &quot;undefined&quot; &amp;&amp; elem.getAttributeNode(&quot;id&quot;);</span>
        <span class="gd">-			return elem.nodeType === 1 &amp;&amp; node &amp;&amp; node.nodeValue === match;</span>
        <span class="gd">-		};</span>
        <span class="gd">-	}</span>
        <span class="gd">-</span>
        <span class="gd">-	root.removeChild( form );</span>
        <span class="gd">-	root = form = null; // release memory in IE</span>
        <span class="gd">-})();</span>
        <span class="gd">-</span>
        <span class="gd">-(function(){</span>
        <span class="gd">-</span>
        <span class="gd">-	var div = document.createElement(&quot;div&quot;);</span>
        <span class="gd">-	div.appendChild( document.createComment(&quot;&quot;) );</span>
        <span class="gd">-</span>
        <span class="gd">-	if ( div.getElementsByTagName(&quot;*&quot;).length &gt; 0 ) {</span>
        <span class="gd">-		Expr.find.TAG = function(match, context){</span>
        <span class="gd">-			var results = context.getElementsByTagName(match[1]);</span>
        <span class="gd">-</span>
        <span class="gd">-			if ( match[1] === &quot;*&quot; ) {</span>
        <span class="gd">-				var tmp = [];</span>
        <span class="gd">-</span>
        <span class="gd">-				for ( var i = 0; results[i]; i++ ) {</span>
        <span class="gd">-					if ( results[i].nodeType === 1 ) {</span>
        <span class="gd">-						tmp.push( results[i] );</span>
        <span class="gd">-					}</span>
        <span class="gd">-				}</span>
        <span class="gd">-</span>
        <span class="gd">-				results = tmp;</span>
        <span class="gd">-			}</span>
        <span class="gd">-</span>
        <span class="gd">-			return results;</span>
        <span class="gd">-		};</span>
        <span class="gd">-	}</span>
        <span class="gd">-</span>
        <span class="gd">-	div.innerHTML = &quot;&lt;a href=&#39;#&#39;&gt;&lt;/a&gt;&quot;;</span>
        <span class="gd">-	if ( div.firstChild &amp;&amp; typeof div.firstChild.getAttribute !== &quot;undefined&quot; &amp;&amp;</span>
        <span class="gd">-			div.firstChild.getAttribute(&quot;href&quot;) !== &quot;#&quot; ) {</span>
        <span class="gd">-		Expr.attrHandle.href = function(elem){</span>
        <span class="gd">-			return elem.getAttribute(&quot;href&quot;, 2);</span>
        <span class="gd">-		};</span>
        <span class="gd">-	}</span>
        <span class="gd">-</span>
        <span class="gd">-	div = null; // release memory in IE</span>
        <span class="gd">-})();</span>
        <span class="gd">-</span>
        <span class="gd">-if ( document.querySelectorAll ) (function(){</span>
        <span class="gd">-	var oldSizzle = Sizzle, div = document.createElement(&quot;div&quot;);</span>
        <span class="gd">-	div.innerHTML = &quot;&lt;p class=&#39;TEST&#39;&gt;&lt;/p&gt;&quot;;</span>
        <span class="gd">-</span>
        <span class="gd">-	if ( div.querySelectorAll &amp;&amp; div.querySelectorAll(&quot;.TEST&quot;).length === 0 ) {</span>
        <span class="gd">-		return;</span>
        <span class="gd">-	}</span>
        <span class="gd">-</span>
        <span class="gd">-	Sizzle = function(query, context, extra, seed){</span>
        <span class="gd">-		context = context || document;</span>
        <span class="gd">-</span>
        <span class="gd">-		if ( !seed &amp;&amp; context.nodeType === 9 &amp;&amp; !isXML(context) ) {</span>
        <span class="gd">-			try {</span>
        <span class="gd">-				return makeArray( context.querySelectorAll(query), extra );</span>
        <span class="gd">-			} catch(e){}</span>
        <span class="gd">-		}</span>
        <span class="gd">-</span>
        <span class="gd">-		return oldSizzle(query, context, extra, seed);</span>
        <span class="gd">-	};</span>
        <span class="gd">-</span>
        <span class="gd">-	for ( var prop in oldSizzle ) {</span>
        <span class="gd">-		Sizzle[ prop ] = oldSizzle[ prop ];</span>
        <span class="gd">-	}</span>
        <span class="gd">-</span>
        <span class="gd">-	div = null; // release memory in IE</span>
        <span class="gd">-})();</span>
        <span class="gd">-</span>
        <span class="gd">-if ( document.getElementsByClassName &amp;&amp; document.documentElement.getElementsByClassName ) (function(){</span>
        <span class="gd">-	var div = document.createElement(&quot;div&quot;);</span>
        <span class="gd">-	div.innerHTML = &quot;&lt;div class=&#39;test e&#39;&gt;&lt;/div&gt;&lt;div class=&#39;test&#39;&gt;&lt;/div&gt;&quot;;</span>
        <span class="gd">-</span>
        <span class="gd">-	if ( div.getElementsByClassName(&quot;e&quot;).length === 0 )</span>
        <span class="gd">-		return;</span>
        <span class="gd">-</span>
        <span class="gd">-	div.lastChild.className = &quot;e&quot;;</span>
        <span class="gd">-</span>
        <span class="gd">-	if ( div.getElementsByClassName(&quot;e&quot;).length === 1 )</span>
        <span class="gd">-		return;</span>
        <span class="gd">-</span>
        <span class="gd">-	Expr.order.splice(1, 0, &quot;CLASS&quot;);</span>
        <span class="gd">-	Expr.find.CLASS = function(match, context, isXML) {</span>
        <span class="gd">-		if ( typeof context.getElementsByClassName !== &quot;undefined&quot; &amp;&amp; !isXML ) {</span>
        <span class="gd">-			return context.getElementsByClassName(match[1]);</span>
        <span class="gd">-		}</span>
        <span class="gd">-	};</span>
        <span class="gd">-</span>
        <span class="gd">-	div = null; // release memory in IE</span>
        <span class="gd">-})();</span>
        <span class="gd">-</span>
        <span class="gd">-function dirNodeCheck( dir, cur, doneName, checkSet, nodeCheck, isXML ) {</span>
        <span class="gd">-	var sibDir = dir == &quot;previousSibling&quot; &amp;&amp; !isXML;</span>
        <span class="gd">-	for ( var i = 0, l = checkSet.length; i &lt; l; i++ ) {</span>
        <span class="gd">-		var elem = checkSet[i];</span>
        <span class="gd">-		if ( elem ) {</span>
        <span class="gd">-			if ( sibDir &amp;&amp; elem.nodeType === 1 ){</span>
        <span class="gd">-				elem.sizcache = doneName;</span>
        <span class="gd">-				elem.sizset = i;</span>
        <span class="gd">-			}</span>
        <span class="gd">-			elem = elem[dir];</span>
        <span class="gd">-			var match = false;</span>
        <span class="gd">-</span>
        <span class="gd">-			while ( elem ) {</span>
        <span class="gd">-				if ( elem.sizcache === doneName ) {</span>
        <span class="gd">-					match = checkSet[elem.sizset];</span>
        <span class="gd">-					break;</span>
        <span class="gd">-				}</span>
        <span class="gd">-</span>
        <span class="gd">-				if ( elem.nodeType === 1 &amp;&amp; !isXML ){</span>
        <span class="gd">-					elem.sizcache = doneName;</span>
        <span class="gd">-					elem.sizset = i;</span>
        <span class="gd">-				}</span>
        <span class="gd">-</span>
        <span class="gd">-				if ( elem.nodeName === cur ) {</span>
        <span class="gd">-					match = elem;</span>
        <span class="gd">-					break;</span>
        <span class="gd">-				}</span>
        <span class="gd">-</span>
        <span class="gd">-				elem = elem[dir];</span>
        <span class="gd">-			}</span>
        <span class="gd">-</span>
        <span class="gd">-			checkSet[i] = match;</span>
        <span class="gd">-		}</span>
        <span class="gd">-	}</span>
        <span class="gd">-}</span>
        <span class="gd">-</span>
        <span class="gd">-function dirCheck( dir, cur, doneName, checkSet, nodeCheck, isXML ) {</span>
        <span class="gd">-	var sibDir = dir == &quot;previousSibling&quot; &amp;&amp; !isXML;</span>
        <span class="gd">-	for ( var i = 0, l = checkSet.length; i &lt; l; i++ ) {</span>
        <span class="gd">-		var elem = checkSet[i];</span>
        <span class="gd">-		if ( elem ) {</span>
        <span class="gd">-			if ( sibDir &amp;&amp; elem.nodeType === 1 ) {</span>
        <span class="gd">-				elem.sizcache = doneName;</span>
        <span class="gd">-				elem.sizset = i;</span>
        <span class="gd">-			}</span>
        <span class="gd">-			elem = elem[dir];</span>
        <span class="gd">-			var match = false;</span>
        <span class="gd">-</span>
        <span class="gd">-			while ( elem ) {</span>
        <span class="gd">-				if ( elem.sizcache === doneName ) {</span>
        <span class="gd">-					match = checkSet[elem.sizset];</span>
        <span class="gd">-					break;</span>
        <span class="gd">-				}</span>
        <span class="gd">-</span>
        <span class="gd">-				if ( elem.nodeType === 1 ) {</span>
        <span class="gd">-					if ( !isXML ) {</span>
        <span class="gd">-						elem.sizcache = doneName;</span>
        <span class="gd">-						elem.sizset = i;</span>
        <span class="gd">-					}</span>
        <span class="gd">-					if ( typeof cur !== &quot;string&quot; ) {</span>
        <span class="gd">-						if ( elem === cur ) {</span>
        <span class="gd">-							match = true;</span>
        <span class="gd">-							break;</span>
        <span class="gd">-						}</span>
        <span class="gd">-</span>
        <span class="gd">-					} else if ( Sizzle.filter( cur, [elem] ).length &gt; 0 ) {</span>
        <span class="gd">-						match = elem;</span>
        <span class="gd">-						break;</span>
        <span class="gd">-					}</span>
        <span class="gd">-				}</span>
        <span class="gd">-</span>
        <span class="gd">-				elem = elem[dir];</span>
        <span class="gd">-			}</span>
        <span class="gd">-</span>
        <span class="gd">-			checkSet[i] = match;</span>
        <span class="gd">-		}</span>
        <span class="gd">-	}</span>
        <span class="gd">-}</span>
        <span class="gd">-</span>
        <span class="gd">-var contains = document.compareDocumentPosition ?  function(a, b){</span>
        <span class="gd">-	return a.compareDocumentPosition(b) &amp; 16;</span>
        <span class="gd">-} : function(a, b){</span>
        <span class="gd">-	return a !== b &amp;&amp; (a.contains ? a.contains(b) : true);</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-var isXML = function(elem){</span>
        <span class="gd">-	return elem.nodeType === 9 &amp;&amp; elem.documentElement.nodeName !== &quot;HTML&quot; ||</span>
        <span class="gd">-		!!elem.ownerDocument &amp;&amp; elem.ownerDocument.documentElement.nodeName !== &quot;HTML&quot;;</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-var posProcess = function(selector, context){</span>
        <span class="gd">-	var tmpSet = [], later = &quot;&quot;, match,</span>
        <span class="gd">-		root = context.nodeType ? [context] : context;</span>
        <span class="gd">-</span>
        <span class="gd">-	while ( (match = Expr.match.PSEUDO.exec( selector )) ) {</span>
        <span class="gd">-		later += match[0];</span>
        <span class="gd">-		selector = selector.replace( Expr.match.PSEUDO, &quot;&quot; );</span>
        <span class="gd">-	}</span>
        <span class="gd">-</span>
        <span class="gd">-	selector = Expr.relative[selector] ? selector + &quot;*&quot; : selector;</span>
        <span class="gd">-</span>
        <span class="gd">-	for ( var i = 0, l = root.length; i &lt; l; i++ ) {</span>
        <span class="gd">-		Sizzle( selector, root[i], tmpSet );</span>
        <span class="gd">-	}</span>
        <span class="gd">-</span>
        <span class="gd">-	return Sizzle.filter( later, tmpSet );</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-window.Sizzle = Sizzle;</span>
        <span class="gd">-</span>
        <span class="gd">-})();</span>
        <span class="gd">-</span>
        <span class="gd">-;(function(engine) {</span>
        <span class="gd">-  var extendElements = Prototype.Selector.extendElements;</span>
        <span class="gd">-</span>
        <span class="gd">-  function select(selector, scope) {</span>
        <span class="gd">-    return extendElements(engine(selector, scope || document));</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function match(element, selector) {</span>
        <span class="gd">-    return engine.matches(selector, [element]).length == 1;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  Prototype.Selector.engine = engine;</span>
        <span class="gd">-  Prototype.Selector.select = select;</span>
        <span class="gd">-  Prototype.Selector.match = match;</span>
        <span class="gd">-})(Sizzle);</span>
        <span class="gd">-</span>
        <span class="gd">-window.Sizzle = Prototype._original_property;</span>
        <span class="gd">-delete Prototype._original_property;</span>
        <span class="gd">-</span>
        <span class="gd">-var Form = {</span>
        <span class="gd">-  reset: function(form) {</span>
        <span class="gd">-    form = $(form);</span>
        <span class="gd">-    form.reset();</span>
        <span class="gd">-    return form;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  serializeElements: function(elements, options) {</span>
        <span class="gd">-    if (typeof options != &#39;object&#39;) options = { hash: !!options };</span>
        <span class="gd">-    else if (Object.isUndefined(options.hash)) options.hash = true;</span>
        <span class="gd">-    var key, value, submitted = false, submit = options.submit;</span>
        <span class="gd">-</span>
        <span class="gd">-    var data = elements.inject({ }, function(result, element) {</span>
        <span class="gd">-      if (!element.disabled &amp;&amp; element.name) {</span>
        <span class="gd">-        key = element.name; value = $(element).getValue();</span>
        <span class="gd">-        if (value != null &amp;&amp; element.type != &#39;file&#39; &amp;&amp; (element.type != &#39;submit&#39; || (!submitted &amp;&amp;</span>
        <span class="gd">-            submit !== false &amp;&amp; (!submit || key == submit) &amp;&amp; (submitted = true)))) {</span>
        <span class="gd">-          if (key in result) {</span>
        <span class="gd">-            if (!Object.isArray(result[key])) result[key] = [result[key]];</span>
        <span class="gd">-            result[key].push(value);</span>
        <span class="gd">-          }</span>
        <span class="gd">-          else result[key] = value;</span>
        <span class="gd">-        }</span>
        <span class="gd">-      }</span>
        <span class="gd">-      return result;</span>
        <span class="gd">-    });</span>
        <span class="gd">-</span>
        <span class="gd">-    return options.hash ? data : Object.toQueryString(data);</span>
        <span class="gd">-  }</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Form.Methods = {</span>
        <span class="gd">-  serialize: function(form, options) {</span>
        <span class="gd">-    return Form.serializeElements(Form.getElements(form), options);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  getElements: function(form) {</span>
        <span class="gd">-    var elements = $(form).getElementsByTagName(&#39;*&#39;),</span>
        <span class="gd">-        element,</span>
        <span class="gd">-        arr = [ ],</span>
        <span class="gd">-        serializers = Form.Element.Serializers;</span>
        <span class="gd">-    for (var i = 0; element = elements[i]; i++) {</span>
        <span class="gd">-      arr.push(element);</span>
        <span class="gd">-    }</span>
        <span class="gd">-    return arr.inject([], function(elements, child) {</span>
        <span class="gd">-      if (serializers[child.tagName.toLowerCase()])</span>
        <span class="gd">-        elements.push(Element.extend(child));</span>
        <span class="gd">-      return elements;</span>
        <span class="gd">-    })</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  getInputs: function(form, typeName, name) {</span>
        <span class="gd">-    form = $(form);</span>
        <span class="gd">-    var inputs = form.getElementsByTagName(&#39;input&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-    if (!typeName &amp;&amp; !name) return $A(inputs).map(Element.extend);</span>
        <span class="gd">-</span>
        <span class="gd">-    for (var i = 0, matchingInputs = [], length = inputs.length; i &lt; length; i++) {</span>
        <span class="gd">-      var input = inputs[i];</span>
        <span class="gd">-      if ((typeName &amp;&amp; input.type != typeName) || (name &amp;&amp; input.name != name))</span>
        <span class="gd">-        continue;</span>
        <span class="gd">-      matchingInputs.push(Element.extend(input));</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    return matchingInputs;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  disable: function(form) {</span>
        <span class="gd">-    form = $(form);</span>
        <span class="gd">-    Form.getElements(form).invoke(&#39;disable&#39;);</span>
        <span class="gd">-    return form;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  enable: function(form) {</span>
        <span class="gd">-    form = $(form);</span>
        <span class="gd">-    Form.getElements(form).invoke(&#39;enable&#39;);</span>
        <span class="gd">-    return form;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  findFirstElement: function(form) {</span>
        <span class="gd">-    var elements = $(form).getElements().findAll(function(element) {</span>
        <span class="gd">-      return &#39;hidden&#39; != element.type &amp;&amp; !element.disabled;</span>
        <span class="gd">-    });</span>
        <span class="gd">-    var firstByIndex = elements.findAll(function(element) {</span>
        <span class="gd">-      return element.hasAttribute(&#39;tabIndex&#39;) &amp;&amp; element.tabIndex &gt;= 0;</span>
        <span class="gd">-    }).sortBy(function(element) { return element.tabIndex }).first();</span>
        <span class="gd">-</span>
        <span class="gd">-    return firstByIndex ? firstByIndex : elements.find(function(element) {</span>
        <span class="gd">-      return /^(?:input|select|textarea)$/i.test(element.tagName);</span>
        <span class="gd">-    });</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  focusFirstElement: function(form) {</span>
        <span class="gd">-    form = $(form);</span>
        <span class="gd">-    form.findFirstElement().activate();</span>
        <span class="gd">-    return form;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  request: function(form, options) {</span>
        <span class="gd">-    form = $(form), options = Object.clone(options || { });</span>
        <span class="gd">-</span>
        <span class="gd">-    var params = options.parameters, action = form.readAttribute(&#39;action&#39;) || &#39;&#39;;</span>
        <span class="gd">-    if (action.blank()) action = window.location.href;</span>
        <span class="gd">-    options.parameters = form.serialize(true);</span>
        <span class="gd">-</span>
        <span class="gd">-    if (params) {</span>
        <span class="gd">-      if (Object.isString(params)) params = params.toQueryParams();</span>
        <span class="gd">-      Object.extend(options.parameters, params);</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    if (form.hasAttribute(&#39;method&#39;) &amp;&amp; !options.method)</span>
        <span class="gd">-      options.method = form.method;</span>
        <span class="gd">-</span>
        <span class="gd">-    return new Ajax.Request(action, options);</span>
        <span class="gd">-  }</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-/*--------------------------------------------------------------------------*/</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-Form.Element = {</span>
        <span class="gd">-  focus: function(element) {</span>
        <span class="gd">-    $(element).focus();</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  select: function(element) {</span>
        <span class="gd">-    $(element).select();</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  }</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Form.Element.Methods = {</span>
        <span class="gd">-</span>
        <span class="gd">-  serialize: function(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    if (!element.disabled &amp;&amp; element.name) {</span>
        <span class="gd">-      var value = element.getValue();</span>
        <span class="gd">-      if (value != undefined) {</span>
        <span class="gd">-        var pair = { };</span>
        <span class="gd">-        pair[element.name] = value;</span>
        <span class="gd">-        return Object.toQueryString(pair);</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-    return &#39;&#39;;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  getValue: function(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    var method = element.tagName.toLowerCase();</span>
        <span class="gd">-    return Form.Element.Serializers[method](element);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  setValue: function(element, value) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    var method = element.tagName.toLowerCase();</span>
        <span class="gd">-    Form.Element.Serializers[method](element, value);</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  clear: function(element) {</span>
        <span class="gd">-    $(element).value = &#39;&#39;;</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  present: function(element) {</span>
        <span class="gd">-    return $(element).value != &#39;&#39;;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  activate: function(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    try {</span>
        <span class="gd">-      element.focus();</span>
        <span class="gd">-      if (element.select &amp;&amp; (element.tagName.toLowerCase() != &#39;input&#39; ||</span>
        <span class="gd">-          !(/^(?:button|reset|submit)$/i.test(element.type))))</span>
        <span class="gd">-        element.select();</span>
        <span class="gd">-    } catch (e) { }</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  disable: function(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    element.disabled = true;</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  enable: function(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    element.disabled = false;</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  }</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-/*--------------------------------------------------------------------------*/</span>
        <span class="gd">-</span>
        <span class="gd">-var Field = Form.Element;</span>
        <span class="gd">-</span>
        <span class="gd">-var $F = Form.Element.Methods.getValue;</span>
        <span class="gd">-</span>
        <span class="gd">-/*--------------------------------------------------------------------------*/</span>
        <span class="gd">-</span>
        <span class="gd">-Form.Element.Serializers = {</span>
        <span class="gd">-  input: function(element, value) {</span>
        <span class="gd">-    switch (element.type.toLowerCase()) {</span>
        <span class="gd">-      case &#39;checkbox&#39;:</span>
        <span class="gd">-      case &#39;radio&#39;:</span>
        <span class="gd">-        return Form.Element.Serializers.inputSelector(element, value);</span>
        <span class="gd">-      default:</span>
        <span class="gd">-        return Form.Element.Serializers.textarea(element, value);</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  inputSelector: function(element, value) {</span>
        <span class="gd">-    if (Object.isUndefined(value)) return element.checked ? element.value : null;</span>
        <span class="gd">-    else element.checked = !!value;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  textarea: function(element, value) {</span>
        <span class="gd">-    if (Object.isUndefined(value)) return element.value;</span>
        <span class="gd">-    else element.value = value;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  select: function(element, value) {</span>
        <span class="gd">-    if (Object.isUndefined(value))</span>
        <span class="gd">-      return this[element.type == &#39;select-one&#39; ?</span>
        <span class="gd">-        &#39;selectOne&#39; : &#39;selectMany&#39;](element);</span>
        <span class="gd">-    else {</span>
        <span class="gd">-      var opt, currentValue, single = !Object.isArray(value);</span>
        <span class="gd">-      for (var i = 0, length = element.length; i &lt; length; i++) {</span>
        <span class="gd">-        opt = element.options[i];</span>
        <span class="gd">-        currentValue = this.optionValue(opt);</span>
        <span class="gd">-        if (single) {</span>
        <span class="gd">-          if (currentValue == value) {</span>
        <span class="gd">-            opt.selected = true;</span>
        <span class="gd">-            return;</span>
        <span class="gd">-          }</span>
        <span class="gd">-        }</span>
        <span class="gd">-        else opt.selected = value.include(currentValue);</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  selectOne: function(element) {</span>
        <span class="gd">-    var index = element.selectedIndex;</span>
        <span class="gd">-    return index &gt;= 0 ? this.optionValue(element.options[index]) : null;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  selectMany: function(element) {</span>
        <span class="gd">-    var values, length = element.length;</span>
        <span class="gd">-    if (!length) return null;</span>
        <span class="gd">-</span>
        <span class="gd">-    for (var i = 0, values = []; i &lt; length; i++) {</span>
        <span class="gd">-      var opt = element.options[i];</span>
        <span class="gd">-      if (opt.selected) values.push(this.optionValue(opt));</span>
        <span class="gd">-    }</span>
        <span class="gd">-    return values;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  optionValue: function(opt) {</span>
        <span class="gd">-    return Element.extend(opt).hasAttribute(&#39;value&#39;) ? opt.value : opt.text;</span>
        <span class="gd">-  }</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-/*--------------------------------------------------------------------------*/</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-Abstract.TimedObserver = Class.create(PeriodicalExecuter, {</span>
        <span class="gd">-  initialize: function($super, element, frequency, callback) {</span>
        <span class="gd">-    $super(callback, frequency);</span>
        <span class="gd">-    this.element   = $(element);</span>
        <span class="gd">-    this.lastValue = this.getValue();</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  execute: function() {</span>
        <span class="gd">-    var value = this.getValue();</span>
        <span class="gd">-    if (Object.isString(this.lastValue) &amp;&amp; Object.isString(value) ?</span>
        <span class="gd">-        this.lastValue != value : String(this.lastValue) != String(value)) {</span>
        <span class="gd">-      this.callback(this.element, value);</span>
        <span class="gd">-      this.lastValue = value;</span>
        <span class="gd">-    }</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-Form.Element.Observer = Class.create(Abstract.TimedObserver, {</span>
        <span class="gd">-  getValue: function() {</span>
        <span class="gd">-    return Form.Element.getValue(this.element);</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-Form.Observer = Class.create(Abstract.TimedObserver, {</span>
        <span class="gd">-  getValue: function() {</span>
        <span class="gd">-    return Form.serialize(this.element);</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-/*--------------------------------------------------------------------------*/</span>
        <span class="gd">-</span>
        <span class="gd">-Abstract.EventObserver = Class.create({</span>
        <span class="gd">-  initialize: function(element, callback) {</span>
        <span class="gd">-    this.element  = $(element);</span>
        <span class="gd">-    this.callback = callback;</span>
        <span class="gd">-</span>
        <span class="gd">-    this.lastValue = this.getValue();</span>
        <span class="gd">-    if (this.element.tagName.toLowerCase() == &#39;form&#39;)</span>
        <span class="gd">-      this.registerFormCallbacks();</span>
        <span class="gd">-    else</span>
        <span class="gd">-      this.registerCallback(this.element);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  onElementEvent: function() {</span>
        <span class="gd">-    var value = this.getValue();</span>
        <span class="gd">-    if (this.lastValue != value) {</span>
        <span class="gd">-      this.callback(this.element, value);</span>
        <span class="gd">-      this.lastValue = value;</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  registerFormCallbacks: function() {</span>
        <span class="gd">-    Form.getElements(this.element).each(this.registerCallback, this);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  registerCallback: function(element) {</span>
        <span class="gd">-    if (element.type) {</span>
        <span class="gd">-      switch (element.type.toLowerCase()) {</span>
        <span class="gd">-        case &#39;checkbox&#39;:</span>
        <span class="gd">-        case &#39;radio&#39;:</span>
        <span class="gd">-          Event.observe(element, &#39;click&#39;, this.onElementEvent.bind(this));</span>
        <span class="gd">-          break;</span>
        <span class="gd">-        default:</span>
        <span class="gd">-          Event.observe(element, &#39;change&#39;, this.onElementEvent.bind(this));</span>
        <span class="gd">-          break;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-Form.Element.EventObserver = Class.create(Abstract.EventObserver, {</span>
        <span class="gd">-  getValue: function() {</span>
        <span class="gd">-    return Form.Element.getValue(this.element);</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-Form.EventObserver = Class.create(Abstract.EventObserver, {</span>
        <span class="gd">-  getValue: function() {</span>
        <span class="gd">-    return Form.serialize(this.element);</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gd">-(function() {</span>
        <span class="gd">-</span>
        <span class="gd">-  var Event = {</span>
        <span class="gd">-    KEY_BACKSPACE: 8,</span>
        <span class="gd">-    KEY_TAB:       9,</span>
        <span class="gd">-    KEY_RETURN:   13,</span>
        <span class="gd">-    KEY_ESC:      27,</span>
        <span class="gd">-    KEY_LEFT:     37,</span>
        <span class="gd">-    KEY_UP:       38,</span>
        <span class="gd">-    KEY_RIGHT:    39,</span>
        <span class="gd">-    KEY_DOWN:     40,</span>
        <span class="gd">-    KEY_DELETE:   46,</span>
        <span class="gd">-    KEY_HOME:     36,</span>
        <span class="gd">-    KEY_END:      35,</span>
        <span class="gd">-    KEY_PAGEUP:   33,</span>
        <span class="gd">-    KEY_PAGEDOWN: 34,</span>
        <span class="gd">-    KEY_INSERT:   45,</span>
        <span class="gd">-</span>
        <span class="gd">-    cache: {}</span>
        <span class="gd">-  };</span>
        <span class="gd">-</span>
        <span class="gd">-  var docEl = document.documentElement;</span>
        <span class="gd">-  var MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED = &#39;onmouseenter&#39; in docEl</span>
        <span class="gd">-    &amp;&amp; &#39;onmouseleave&#39; in docEl;</span>
        <span class="gd">-</span>
        <span class="gd">-  var _isButton;</span>
        <span class="gd">-  if (Prototype.Browser.IE) {</span>
        <span class="gd">-    var buttonMap = { 0: 1, 1: 4, 2: 2 };</span>
        <span class="gd">-    _isButton = function(event, code) {</span>
        <span class="gd">-      return event.button === buttonMap[code];</span>
        <span class="gd">-    };</span>
        <span class="gd">-  } else if (Prototype.Browser.WebKit) {</span>
        <span class="gd">-    _isButton = function(event, code) {</span>
        <span class="gd">-      switch (code) {</span>
        <span class="gd">-        case 0: return event.which == 1 &amp;&amp; !event.metaKey;</span>
        <span class="gd">-        case 1: return event.which == 1 &amp;&amp; event.metaKey;</span>
        <span class="gd">-        default: return false;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    };</span>
        <span class="gd">-  } else {</span>
        <span class="gd">-    _isButton = function(event, code) {</span>
        <span class="gd">-      return event.which ? (event.which === code + 1) : (event.button === code);</span>
        <span class="gd">-    };</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function isLeftClick(event)   { return _isButton(event, 0) }</span>
        <span class="gd">-</span>
        <span class="gd">-  function isMiddleClick(event) { return _isButton(event, 1) }</span>
        <span class="gd">-</span>
        <span class="gd">-  function isRightClick(event)  { return _isButton(event, 2) }</span>
        <span class="gd">-</span>
        <span class="gd">-  function element(event) {</span>
        <span class="gd">-    event = Event.extend(event);</span>
        <span class="gd">-</span>
        <span class="gd">-    var node = event.target, type = event.type,</span>
        <span class="gd">-     currentTarget = event.currentTarget;</span>
        <span class="gd">-</span>
        <span class="gd">-    if (currentTarget &amp;&amp; currentTarget.tagName) {</span>
        <span class="gd">-      if (type === &#39;load&#39; || type === &#39;error&#39; ||</span>
        <span class="gd">-        (type === &#39;click&#39; &amp;&amp; currentTarget.tagName.toLowerCase() === &#39;input&#39;</span>
        <span class="gd">-          &amp;&amp; currentTarget.type === &#39;radio&#39;))</span>
        <span class="gd">-            node = currentTarget;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    if (node.nodeType == Node.TEXT_NODE)</span>
        <span class="gd">-      node = node.parentNode;</span>
        <span class="gd">-</span>
        <span class="gd">-    return Element.extend(node);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function findElement(event, expression) {</span>
        <span class="gd">-    var element = Event.element(event);</span>
        <span class="gd">-    if (!expression) return element;</span>
        <span class="gd">-    while (element) {</span>
        <span class="gd">-      if (Object.isElement(element) &amp;&amp; Prototype.Selector.match(element, expression)) {</span>
        <span class="gd">-        return Element.extend(element);</span>
        <span class="gd">-      }</span>
        <span class="gd">-      element = element.parentNode;</span>
        <span class="gd">-    }</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function pointer(event) {</span>
        <span class="gd">-    return { x: pointerX(event), y: pointerY(event) };</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function pointerX(event) {</span>
        <span class="gd">-    var docElement = document.documentElement,</span>
        <span class="gd">-     body = document.body || { scrollLeft: 0 };</span>
        <span class="gd">-</span>
        <span class="gd">-    return event.pageX || (event.clientX +</span>
        <span class="gd">-      (docElement.scrollLeft || body.scrollLeft) -</span>
        <span class="gd">-      (docElement.clientLeft || 0));</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function pointerY(event) {</span>
        <span class="gd">-    var docElement = document.documentElement,</span>
        <span class="gd">-     body = document.body || { scrollTop: 0 };</span>
        <span class="gd">-</span>
        <span class="gd">-    return  event.pageY || (event.clientY +</span>
        <span class="gd">-       (docElement.scrollTop || body.scrollTop) -</span>
        <span class="gd">-       (docElement.clientTop || 0));</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-  function stop(event) {</span>
        <span class="gd">-    Event.extend(event);</span>
        <span class="gd">-    event.preventDefault();</span>
        <span class="gd">-    event.stopPropagation();</span>
        <span class="gd">-</span>
        <span class="gd">-    event.stopped = true;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  Event.Methods = {</span>
        <span class="gd">-    isLeftClick: isLeftClick,</span>
        <span class="gd">-    isMiddleClick: isMiddleClick,</span>
        <span class="gd">-    isRightClick: isRightClick,</span>
        <span class="gd">-</span>
        <span class="gd">-    element: element,</span>
        <span class="gd">-    findElement: findElement,</span>
        <span class="gd">-</span>
        <span class="gd">-    pointer: pointer,</span>
        <span class="gd">-    pointerX: pointerX,</span>
        <span class="gd">-    pointerY: pointerY,</span>
        <span class="gd">-</span>
        <span class="gd">-    stop: stop</span>
        <span class="gd">-  };</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-  var methods = Object.keys(Event.Methods).inject({ }, function(m, name) {</span>
        <span class="gd">-    m[name] = Event.Methods[name].methodize();</span>
        <span class="gd">-    return m;</span>
        <span class="gd">-  });</span>
        <span class="gd">-</span>
        <span class="gd">-  if (Prototype.Browser.IE) {</span>
        <span class="gd">-    function _relatedTarget(event) {</span>
        <span class="gd">-      var element;</span>
        <span class="gd">-      switch (event.type) {</span>
        <span class="gd">-        case &#39;mouseover&#39;: element = event.fromElement; break;</span>
        <span class="gd">-        case &#39;mouseout&#39;:  element = event.toElement;   break;</span>
        <span class="gd">-        default: return null;</span>
        <span class="gd">-      }</span>
        <span class="gd">-      return Element.extend(element);</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    Object.extend(methods, {</span>
        <span class="gd">-      stopPropagation: function() { this.cancelBubble = true },</span>
        <span class="gd">-      preventDefault:  function() { this.returnValue = false },</span>
        <span class="gd">-      inspect: function() { return &#39;[object Event]&#39; }</span>
        <span class="gd">-    });</span>
        <span class="gd">-</span>
        <span class="gd">-    Event.extend = function(event, element) {</span>
        <span class="gd">-      if (!event) return false;</span>
        <span class="gd">-      if (event._extendedByPrototype) return event;</span>
        <span class="gd">-</span>
        <span class="gd">-      event._extendedByPrototype = Prototype.emptyFunction;</span>
        <span class="gd">-      var pointer = Event.pointer(event);</span>
        <span class="gd">-</span>
        <span class="gd">-      Object.extend(event, {</span>
        <span class="gd">-        target: event.srcElement || element,</span>
        <span class="gd">-        relatedTarget: _relatedTarget(event),</span>
        <span class="gd">-        pageX:  pointer.x,</span>
        <span class="gd">-        pageY:  pointer.y</span>
        <span class="gd">-      });</span>
        <span class="gd">-</span>
        <span class="gd">-      return Object.extend(event, methods);</span>
        <span class="gd">-    };</span>
        <span class="gd">-  } else {</span>
        <span class="gd">-    Event.prototype = window.Event.prototype || document.createEvent(&#39;HTMLEvents&#39;).__proto__;</span>
        <span class="gd">-    Object.extend(Event.prototype, methods);</span>
        <span class="gd">-    Event.extend = Prototype.K;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function _createResponder(element, eventName, handler) {</span>
        <span class="gd">-    var registry = Element.retrieve(element, &#39;prototype_event_registry&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-    if (Object.isUndefined(registry)) {</span>
        <span class="gd">-      CACHE.push(element);</span>
        <span class="gd">-      registry = Element.retrieve(element, &#39;prototype_event_registry&#39;, $H());</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    var respondersForEvent = registry.get(eventName);</span>
        <span class="gd">-    if (Object.isUndefined(respondersForEvent)) {</span>
        <span class="gd">-      respondersForEvent = [];</span>
        <span class="gd">-      registry.set(eventName, respondersForEvent);</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    if (respondersForEvent.pluck(&#39;handler&#39;).include(handler)) return false;</span>
        <span class="gd">-</span>
        <span class="gd">-    var responder;</span>
        <span class="gd">-    if (eventName.include(&quot;:&quot;)) {</span>
        <span class="gd">-      responder = function(event) {</span>
        <span class="gd">-        if (Object.isUndefined(event.eventName))</span>
        <span class="gd">-          return false;</span>
        <span class="gd">-</span>
        <span class="gd">-        if (event.eventName !== eventName)</span>
        <span class="gd">-          return false;</span>
        <span class="gd">-</span>
        <span class="gd">-        Event.extend(event, element);</span>
        <span class="gd">-        handler.call(element, event);</span>
        <span class="gd">-      };</span>
        <span class="gd">-    } else {</span>
        <span class="gd">-      if (!MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED &amp;&amp;</span>
        <span class="gd">-       (eventName === &quot;mouseenter&quot; || eventName === &quot;mouseleave&quot;)) {</span>
        <span class="gd">-        if (eventName === &quot;mouseenter&quot; || eventName === &quot;mouseleave&quot;) {</span>
        <span class="gd">-          responder = function(event) {</span>
        <span class="gd">-            Event.extend(event, element);</span>
        <span class="gd">-</span>
        <span class="gd">-            var parent = event.relatedTarget;</span>
        <span class="gd">-            while (parent &amp;&amp; parent !== element) {</span>
        <span class="gd">-              try { parent = parent.parentNode; }</span>
        <span class="gd">-              catch(e) { parent = element; }</span>
        <span class="gd">-            }</span>
        <span class="gd">-</span>
        <span class="gd">-            if (parent === element) return;</span>
        <span class="gd">-</span>
        <span class="gd">-            handler.call(element, event);</span>
        <span class="gd">-          };</span>
        <span class="gd">-        }</span>
        <span class="gd">-      } else {</span>
        <span class="gd">-        responder = function(event) {</span>
        <span class="gd">-          Event.extend(event, element);</span>
        <span class="gd">-          handler.call(element, event);</span>
        <span class="gd">-        };</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    responder.handler = handler;</span>
        <span class="gd">-    respondersForEvent.push(responder);</span>
        <span class="gd">-    return responder;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function _destroyCache() {</span>
        <span class="gd">-    for (var i = 0, length = CACHE.length; i &lt; length; i++) {</span>
        <span class="gd">-      Event.stopObserving(CACHE[i]);</span>
        <span class="gd">-      CACHE[i] = null;</span>
        <span class="gd">-    }</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  var CACHE = [];</span>
        <span class="gd">-</span>
        <span class="gd">-  if (Prototype.Browser.IE)</span>
        <span class="gd">-    window.attachEvent(&#39;onunload&#39;, _destroyCache);</span>
        <span class="gd">-</span>
        <span class="gd">-  if (Prototype.Browser.WebKit)</span>
        <span class="gd">-    window.addEventListener(&#39;unload&#39;, Prototype.emptyFunction, false);</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-  var _getDOMEventName = Prototype.K,</span>
        <span class="gd">-      translations = { mouseenter: &quot;mouseover&quot;, mouseleave: &quot;mouseout&quot; };</span>
        <span class="gd">-</span>
        <span class="gd">-  if (!MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED) {</span>
        <span class="gd">-    _getDOMEventName = function(eventName) {</span>
        <span class="gd">-      return (translations[eventName] || eventName);</span>
        <span class="gd">-    };</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function observe(element, eventName, handler) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-</span>
        <span class="gd">-    var responder = _createResponder(element, eventName, handler);</span>
        <span class="gd">-</span>
        <span class="gd">-    if (!responder) return element;</span>
        <span class="gd">-</span>
        <span class="gd">-    if (eventName.include(&#39;:&#39;)) {</span>
        <span class="gd">-      if (element.addEventListener)</span>
        <span class="gd">-        element.addEventListener(&quot;dataavailable&quot;, responder, false);</span>
        <span class="gd">-      else {</span>
        <span class="gd">-        element.attachEvent(&quot;ondataavailable&quot;, responder);</span>
        <span class="gd">-        element.attachEvent(&quot;onfilterchange&quot;, responder);</span>
        <span class="gd">-      }</span>
        <span class="gd">-    } else {</span>
        <span class="gd">-      var actualEventName = _getDOMEventName(eventName);</span>
        <span class="gd">-</span>
        <span class="gd">-      if (element.addEventListener)</span>
        <span class="gd">-        element.addEventListener(actualEventName, responder, false);</span>
        <span class="gd">-      else</span>
        <span class="gd">-        element.attachEvent(&quot;on&quot; + actualEventName, responder);</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function stopObserving(element, eventName, handler) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-</span>
        <span class="gd">-    var registry = Element.retrieve(element, &#39;prototype_event_registry&#39;);</span>
        <span class="gd">-    if (!registry) return element;</span>
        <span class="gd">-</span>
        <span class="gd">-    if (!eventName) {</span>
        <span class="gd">-      registry.each( function(pair) {</span>
        <span class="gd">-        var eventName = pair.key;</span>
        <span class="gd">-        stopObserving(element, eventName);</span>
        <span class="gd">-      });</span>
        <span class="gd">-      return element;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    var responders = registry.get(eventName);</span>
        <span class="gd">-    if (!responders) return element;</span>
        <span class="gd">-</span>
        <span class="gd">-    if (!handler) {</span>
        <span class="gd">-      responders.each(function(r) {</span>
        <span class="gd">-        stopObserving(element, eventName, r.handler);</span>
        <span class="gd">-      });</span>
        <span class="gd">-      return element;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    var responder = responders.find( function(r) { return r.handler === handler; });</span>
        <span class="gd">-    if (!responder) return element;</span>
        <span class="gd">-</span>
        <span class="gd">-    if (eventName.include(&#39;:&#39;)) {</span>
        <span class="gd">-      if (element.removeEventListener)</span>
        <span class="gd">-        element.removeEventListener(&quot;dataavailable&quot;, responder, false);</span>
        <span class="gd">-      else {</span>
        <span class="gd">-        element.detachEvent(&quot;ondataavailable&quot;, responder);</span>
        <span class="gd">-        element.detachEvent(&quot;onfilterchange&quot;,  responder);</span>
        <span class="gd">-      }</span>
        <span class="gd">-    } else {</span>
        <span class="gd">-      var actualEventName = _getDOMEventName(eventName);</span>
        <span class="gd">-      if (element.removeEventListener)</span>
        <span class="gd">-        element.removeEventListener(actualEventName, responder, false);</span>
        <span class="gd">-      else</span>
        <span class="gd">-        element.detachEvent(&#39;on&#39; + actualEventName, responder);</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    registry.set(eventName, responders.without(responder));</span>
        <span class="gd">-</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function fire(element, eventName, memo, bubble) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-</span>
        <span class="gd">-    if (Object.isUndefined(bubble))</span>
        <span class="gd">-      bubble = true;</span>
        <span class="gd">-</span>
        <span class="gd">-    if (element == document &amp;&amp; document.createEvent &amp;&amp; !element.dispatchEvent)</span>
        <span class="gd">-      element = document.documentElement;</span>
        <span class="gd">-</span>
        <span class="gd">-    var event;</span>
        <span class="gd">-    if (document.createEvent) {</span>
        <span class="gd">-      event = document.createEvent(&#39;HTMLEvents&#39;);</span>
        <span class="gd">-      event.initEvent(&#39;dataavailable&#39;, true, true);</span>
        <span class="gd">-    } else {</span>
        <span class="gd">-      event = document.createEventObject();</span>
        <span class="gd">-      event.eventType = bubble ? &#39;ondataavailable&#39; : &#39;onfilterchange&#39;;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    event.eventName = eventName;</span>
        <span class="gd">-    event.memo = memo || { };</span>
        <span class="gd">-</span>
        <span class="gd">-    if (document.createEvent)</span>
        <span class="gd">-      element.dispatchEvent(event);</span>
        <span class="gd">-    else</span>
        <span class="gd">-      element.fireEvent(event.eventType, event);</span>
        <span class="gd">-</span>
        <span class="gd">-    return Event.extend(event);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  Event.Handler = Class.create({</span>
        <span class="gd">-    initialize: function(element, eventName, selector, callback) {</span>
        <span class="gd">-      this.element   = $(element);</span>
        <span class="gd">-      this.eventName = eventName;</span>
        <span class="gd">-      this.selector  = selector;</span>
        <span class="gd">-      this.callback  = callback;</span>
        <span class="gd">-      this.handler   = this.handleEvent.bind(this);</span>
        <span class="gd">-    },</span>
        <span class="gd">-</span>
        <span class="gd">-    start: function() {</span>
        <span class="gd">-      Event.observe(this.element, this.eventName, this.handler);</span>
        <span class="gd">-      return this;</span>
        <span class="gd">-    },</span>
        <span class="gd">-</span>
        <span class="gd">-    stop: function() {</span>
        <span class="gd">-      Event.stopObserving(this.element, this.eventName, this.handler);</span>
        <span class="gd">-      return this;</span>
        <span class="gd">-    },</span>
        <span class="gd">-</span>
        <span class="gd">-    handleEvent: function(event) {</span>
        <span class="gd">-      var element = event.findElement(this.selector);</span>
        <span class="gd">-      if (element) this.callback.call(this.element, event, element);</span>
        <span class="gd">-    }</span>
        <span class="gd">-  });</span>
        <span class="gd">-</span>
        <span class="gd">-  function on(element, eventName, selector, callback) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    if (Object.isFunction(selector) &amp;&amp; Object.isUndefined(callback)) {</span>
        <span class="gd">-      callback = selector, selector = null;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    return new Event.Handler(element, eventName, selector, callback).start();</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  Object.extend(Event, Event.Methods);</span>
        <span class="gd">-</span>
        <span class="gd">-  Object.extend(Event, {</span>
        <span class="gd">-    fire:          fire,</span>
        <span class="gd">-    observe:       observe,</span>
        <span class="gd">-    stopObserving: stopObserving,</span>
        <span class="gd">-    on:            on</span>
        <span class="gd">-  });</span>
        <span class="gd">-</span>
        <span class="gd">-  Element.addMethods({</span>
        <span class="gd">-    fire:          fire,</span>
        <span class="gd">-</span>
        <span class="gd">-    observe:       observe,</span>
        <span class="gd">-</span>
        <span class="gd">-    stopObserving: stopObserving,</span>
        <span class="gd">-</span>
        <span class="gd">-    on:            on</span>
        <span class="gd">-  });</span>
        <span class="gd">-</span>
        <span class="gd">-  Object.extend(document, {</span>
        <span class="gd">-    fire:          fire.methodize(),</span>
        <span class="gd">-</span>
        <span class="gd">-    observe:       observe.methodize(),</span>
        <span class="gd">-</span>
        <span class="gd">-    stopObserving: stopObserving.methodize(),</span>
        <span class="gd">-</span>
        <span class="gd">-    on:            on.methodize(),</span>
        <span class="gd">-</span>
        <span class="gd">-    loaded:        false</span>
        <span class="gd">-  });</span>
        <span class="gd">-</span>
        <span class="gd">-  if (window.Event) Object.extend(window.Event, Event);</span>
        <span class="gd">-  else window.Event = Event;</span>
        <span class="gd">-})();</span>
        <span class="gd">-</span>
        <span class="gd">-(function() {</span>
        <span class="gd">-  /* Support for the DOMContentLoaded event is based on work by Dan Webb,</span>
        <span class="gd">-     Matthias Miller, Dean Edwards, John Resig, and Diego Perini. */</span>
        <span class="gd">-</span>
        <span class="gd">-  var timer;</span>
        <span class="gd">-</span>
        <span class="gd">-  function fireContentLoadedEvent() {</span>
        <span class="gd">-    if (document.loaded) return;</span>
        <span class="gd">-    if (timer) window.clearTimeout(timer);</span>
        <span class="gd">-    document.loaded = true;</span>
        <span class="gd">-    document.fire(&#39;dom:loaded&#39;);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function checkReadyState() {</span>
        <span class="gd">-    if (document.readyState === &#39;complete&#39;) {</span>
        <span class="gd">-      document.stopObserving(&#39;readystatechange&#39;, checkReadyState);</span>
        <span class="gd">-      fireContentLoadedEvent();</span>
        <span class="gd">-    }</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function pollDoScroll() {</span>
        <span class="gd">-    try { document.documentElement.doScroll(&#39;left&#39;); }</span>
        <span class="gd">-    catch(e) {</span>
        <span class="gd">-      timer = pollDoScroll.defer();</span>
        <span class="gd">-      return;</span>
        <span class="gd">-    }</span>
        <span class="gd">-    fireContentLoadedEvent();</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  if (document.addEventListener) {</span>
        <span class="gd">-    document.addEventListener(&#39;DOMContentLoaded&#39;, fireContentLoadedEvent, false);</span>
        <span class="gd">-  } else {</span>
        <span class="gd">-    document.observe(&#39;readystatechange&#39;, checkReadyState);</span>
        <span class="gd">-    if (window == top)</span>
        <span class="gd">-      timer = pollDoScroll.defer();</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  Event.observe(window, &#39;load&#39;, fireContentLoadedEvent);</span>
        <span class="gd">-})();</span>
        <span class="gd">-</span>
        <span class="gd">-Element.addMethods();</span>
        <span class="gd">-</span>
        <span class="gd">-/*------------------------------- DEPRECATED -------------------------------*/</span>
        <span class="gd">-</span>
        <span class="gd">-Hash.toQueryString = Object.toQueryString;</span>
        <span class="gd">-</span>
        <span class="gd">-var Toggle = { display: Element.toggle };</span>
        <span class="gd">-</span>
        <span class="gd">-Element.Methods.childOf = Element.Methods.descendantOf;</span>
        <span class="gd">-</span>
        <span class="gd">-var Insertion = {</span>
        <span class="gd">-  Before: function(element, content) {</span>
        <span class="gd">-    return Element.insert(element, {before:content});</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  Top: function(element, content) {</span>
        <span class="gd">-    return Element.insert(element, {top:content});</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  Bottom: function(element, content) {</span>
        <span class="gd">-    return Element.insert(element, {bottom:content});</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  After: function(element, content) {</span>
        <span class="gd">-    return Element.insert(element, {after:content});</span>
        <span class="gd">-  }</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-var $continue = new Error(&#39;&quot;throw $continue&quot; is deprecated, use &quot;return&quot; instead&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-var Position = {</span>
        <span class="gd">-  includeScrollOffsets: false,</span>
        <span class="gd">-</span>
        <span class="gd">-  prepare: function() {</span>
        <span class="gd">-    this.deltaX =  window.pageXOffset</span>
        <span class="gd">-                || document.documentElement.scrollLeft</span>
        <span class="gd">-                || document.body.scrollLeft</span>
        <span class="gd">-                || 0;</span>
        <span class="gd">-    this.deltaY =  window.pageYOffset</span>
        <span class="gd">-                || document.documentElement.scrollTop</span>
        <span class="gd">-                || document.body.scrollTop</span>
        <span class="gd">-                || 0;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  within: function(element, x, y) {</span>
        <span class="gd">-    if (this.includeScrollOffsets)</span>
        <span class="gd">-      return this.withinIncludingScrolloffsets(element, x, y);</span>
        <span class="gd">-    this.xcomp = x;</span>
        <span class="gd">-    this.ycomp = y;</span>
        <span class="gd">-    this.offset = Element.cumulativeOffset(element);</span>
        <span class="gd">-</span>
        <span class="gd">-    return (y &gt;= this.offset[1] &amp;&amp;</span>
        <span class="gd">-            y &lt;  this.offset[1] + element.offsetHeight &amp;&amp;</span>
        <span class="gd">-            x &gt;= this.offset[0] &amp;&amp;</span>
        <span class="gd">-            x &lt;  this.offset[0] + element.offsetWidth);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  withinIncludingScrolloffsets: function(element, x, y) {</span>
        <span class="gd">-    var offsetcache = Element.cumulativeScrollOffset(element);</span>
        <span class="gd">-</span>
        <span class="gd">-    this.xcomp = x + offsetcache[0] - this.deltaX;</span>
        <span class="gd">-    this.ycomp = y + offsetcache[1] - this.deltaY;</span>
        <span class="gd">-    this.offset = Element.cumulativeOffset(element);</span>
        <span class="gd">-</span>
        <span class="gd">-    return (this.ycomp &gt;= this.offset[1] &amp;&amp;</span>
        <span class="gd">-            this.ycomp &lt;  this.offset[1] + element.offsetHeight &amp;&amp;</span>
        <span class="gd">-            this.xcomp &gt;= this.offset[0] &amp;&amp;</span>
        <span class="gd">-            this.xcomp &lt;  this.offset[0] + element.offsetWidth);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  overlap: function(mode, element) {</span>
        <span class="gd">-    if (!mode) return 0;</span>
        <span class="gd">-    if (mode == &#39;vertical&#39;)</span>
        <span class="gd">-      return ((this.offset[1] + element.offsetHeight) - this.ycomp) /</span>
        <span class="gd">-        element.offsetHeight;</span>
        <span class="gd">-    if (mode == &#39;horizontal&#39;)</span>
        <span class="gd">-      return ((this.offset[0] + element.offsetWidth) - this.xcomp) /</span>
        <span class="gd">-        element.offsetWidth;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-  cumulativeOffset: Element.Methods.cumulativeOffset,</span>
        <span class="gd">-</span>
        <span class="gd">-  positionedOffset: Element.Methods.positionedOffset,</span>
        <span class="gd">-</span>
        <span class="gd">-  absolutize: function(element) {</span>
        <span class="gd">-    Position.prepare();</span>
        <span class="gd">-    return Element.absolutize(element);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  relativize: function(element) {</span>
        <span class="gd">-    Position.prepare();</span>
        <span class="gd">-    return Element.relativize(element);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  realOffset: Element.Methods.cumulativeScrollOffset,</span>
        <span class="gd">-</span>
        <span class="gd">-  offsetParent: Element.Methods.getOffsetParent,</span>
        <span class="gd">-</span>
        <span class="gd">-  page: Element.Methods.viewportOffset,</span>
        <span class="gd">-</span>
        <span class="gd">-  clone: function(source, target, options) {</span>
        <span class="gd">-    options = options || { };</span>
        <span class="gd">-    return Element.clonePosition(target, source, options);</span>
        <span class="gd">-  }</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-/*--------------------------------------------------------------------------*/</span>
        <span class="gd">-</span>
        <span class="gd">-if (!document.getElementsByClassName) document.getElementsByClassName = function(instanceMethods){</span>
        <span class="gd">-  function iter(name) {</span>
        <span class="gd">-    return name.blank() ? null : &quot;[contains(concat(&#39; &#39;, @class, &#39; &#39;), &#39; &quot; + name + &quot; &#39;)]&quot;;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  instanceMethods.getElementsByClassName = Prototype.BrowserFeatures.XPath ?</span>
        <span class="gd">-  function(element, className) {</span>
        <span class="gd">-    className = className.toString().strip();</span>
        <span class="gd">-    var cond = /\s/.test(className) ? $w(className).map(iter).join(&#39;&#39;) : iter(className);</span>
        <span class="gd">-    return cond ? document._getElementsByXPath(&#39;.//*&#39; + cond, element) : [];</span>
        <span class="gd">-  } : function(element, className) {</span>
        <span class="gd">-    className = className.toString().strip();</span>
        <span class="gd">-    var elements = [], classNames = (/\s/.test(className) ? $w(className) : null);</span>
        <span class="gd">-    if (!classNames &amp;&amp; !className) return elements;</span>
        <span class="gd">-</span>
        <span class="gd">-    var nodes = $(element).getElementsByTagName(&#39;*&#39;);</span>
        <span class="gd">-    className = &#39; &#39; + className + &#39; &#39;;</span>
        <span class="gd">-</span>
        <span class="gd">-    for (var i = 0, child, cn; child = nodes[i]; i++) {</span>
        <span class="gd">-      if (child.className &amp;&amp; (cn = &#39; &#39; + child.className + &#39; &#39;) &amp;&amp; (cn.include(className) ||</span>
        <span class="gd">-          (classNames &amp;&amp; classNames.all(function(name) {</span>
        <span class="gd">-            return !name.toString().blank() &amp;&amp; cn.include(&#39; &#39; + name + &#39; &#39;);</span>
        <span class="gd">-          }))))</span>
        <span class="gd">-        elements.push(Element.extend(child));</span>
        <span class="gd">-    }</span>
        <span class="gd">-    return elements;</span>
        <span class="gd">-  };</span>
        <span class="gd">-</span>
        <span class="gd">-  return function(className, parentElement) {</span>
        <span class="gd">-    return $(parentElement || document.body).getElementsByClassName(className);</span>
        <span class="gd">-  };</span>
        <span class="gd">-}(Element.Methods);</span>
        <span class="gd">-</span>
        <span class="gd">-/*--------------------------------------------------------------------------*/</span>
        <span class="gd">-</span>
        <span class="gd">-Element.ClassNames = Class.create();</span>
        <span class="gd">-Element.ClassNames.prototype = {</span>
        <span class="gd">-  initialize: function(element) {</span>
        <span class="gd">-    this.element = $(element);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  _each: function(iterator) {</span>
        <span class="gd">-    this.element.className.split(/\s+/).select(function(name) {</span>
        <span class="gd">-      return name.length &gt; 0;</span>
        <span class="gd">-    })._each(iterator);</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  set: function(className) {</span>
        <span class="gd">-    this.element.className = className;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  add: function(classNameToAdd) {</span>
        <span class="gd">-    if (this.include(classNameToAdd)) return;</span>
        <span class="gd">-    this.set($A(this).concat(classNameToAdd).join(&#39; &#39;));</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  remove: function(classNameToRemove) {</span>
        <span class="gd">-    if (!this.include(classNameToRemove)) return;</span>
        <span class="gd">-    this.set($A(this).without(classNameToRemove).join(&#39; &#39;));</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  toString: function() {</span>
        <span class="gd">-    return $A(this).join(&#39; &#39;);</span>
        <span class="gd">-  }</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Object.extend(Element.ClassNames.prototype, Enumerable);</span>
        <span class="gd">-</span>
        <span class="gd">-/*--------------------------------------------------------------------------*/</span>
        <span class="gd">-</span>
        <span class="gd">-(function() {</span>
        <span class="gd">-  window.Selector = Class.create({</span>
        <span class="gd">-    initialize: function(expression) {</span>
        <span class="gd">-      this.expression = expression.strip();</span>
        <span class="gd">-    },</span>
        <span class="gd">-</span>
        <span class="gd">-    findElements: function(rootElement) {</span>
        <span class="gd">-      return Prototype.Selector.select(this.expression, rootElement);</span>
        <span class="gd">-    },</span>
        <span class="gd">-</span>
        <span class="gd">-    match: function(element) {</span>
        <span class="gd">-      return Prototype.Selector.match(element, this.expression);</span>
        <span class="gd">-    },</span>
        <span class="gd">-</span>
        <span class="gd">-    toString: function() {</span>
        <span class="gd">-      return this.expression;</span>
        <span class="gd">-    },</span>
        <span class="gd">-</span>
        <span class="gd">-    inspect: function() {</span>
        <span class="gd">-      return &quot;#&lt;Selector: &quot; + this.expression + &quot;&gt;&quot;;</span>
        <span class="gd">-    }</span>
        <span class="gd">-  });</span>
        <span class="gd">-</span>
        <span class="gd">-  Object.extend(Selector, {</span>
        <span class="gd">-    matchElements: function(elements, expression) {</span>
        <span class="gd">-      var match = Prototype.Selector.match,</span>
        <span class="gd">-          results = [];</span>
        <span class="gd">-</span>
        <span class="gd">-      for (var i = 0, length = elements.length; i &lt; length; i++) {</span>
        <span class="gd">-        var element = elements[i];</span>
        <span class="gd">-        if (match(element, expression)) {</span>
        <span class="gd">-          results.push(Element.extend(element));</span>
        <span class="gd">-        }</span>
        <span class="gd">-      }</span>
        <span class="gd">-      return results;</span>
        <span class="gd">-    },</span>
        <span class="gd">-</span>
        <span class="gd">-    findElement: function(elements, expression, index) {</span>
        <span class="gd">-      index = index || 0;</span>
        <span class="gd">-      var matchIndex = 0, element;</span>
        <span class="gd">-      for (var i = 0, length = elements.length; i &lt; length; i++) {</span>
        <span class="gd">-        element = elements[i];</span>
        <span class="gd">-        if (Prototype.Selector.match(element, expression) &amp;&amp; index === matchIndex++) {</span>
        <span class="gd">-          return Element.extend(element);</span>
        <span class="gd">-        }</span>
        <span class="gd">-      }</span>
        <span class="gd">-    },</span>
        <span class="gd">-</span>
        <span class="gd">-    findChildElements: function(element, expressions) {</span>
        <span class="gd">-      var selector = expressions.toArray().join(&#39;, &#39;);</span>
        <span class="gd">-      return Prototype.Selector.select(selector, element || document);</span>
        <span class="gd">-    }</span>
        <span class="gd">-  });</span>
        <span class="gd">-})();</span>
        </pre></div>
        <h2>
          <a href='full/#public-javascripts-rails-js'>public/javascripts/rails.js</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -1,191 +0,0 @@</span>
        <span class="gd">-(function() {</span>
        <span class="gd">-  // Technique from Juriy Zaytsev</span>
        <span class="gd">-  // http://thinkweb2.com/projects/prototype/detecting-event-support-without-browser-sniffing/</span>
        <span class="gd">-  function isEventSupported(eventName) {</span>
        <span class="gd">-    var el = document.createElement(&#39;div&#39;);</span>
        <span class="gd">-    eventName = &#39;on&#39; + eventName;</span>
        <span class="gd">-    var isSupported = (eventName in el);</span>
        <span class="gd">-    if (!isSupported) {</span>
        <span class="gd">-      el.setAttribute(eventName, &#39;return;&#39;);</span>
        <span class="gd">-      isSupported = typeof el[eventName] == &#39;function&#39;;</span>
        <span class="gd">-    }</span>
        <span class="gd">-    el = null;</span>
        <span class="gd">-    return isSupported;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function isForm(element) {</span>
        <span class="gd">-    return Object.isElement(element) &amp;&amp; element.nodeName.toUpperCase() == &#39;FORM&#39;</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function isInput(element) {</span>
        <span class="gd">-    if (Object.isElement(element)) {</span>
        <span class="gd">-      var name = element.nodeName.toUpperCase()</span>
        <span class="gd">-      return name == &#39;INPUT&#39; || name == &#39;SELECT&#39; || name == &#39;TEXTAREA&#39;</span>
        <span class="gd">-    }</span>
        <span class="gd">-    else return false</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  var submitBubbles = isEventSupported(&#39;submit&#39;),</span>
        <span class="gd">-      changeBubbles = isEventSupported(&#39;change&#39;)</span>
        <span class="gd">-</span>
        <span class="gd">-  if (!submitBubbles || !changeBubbles) {</span>
        <span class="gd">-    // augment the Event.Handler class to observe custom events when needed</span>
        <span class="gd">-    Event.Handler.prototype.initialize = Event.Handler.prototype.initialize.wrap(</span>
        <span class="gd">-      function(init, element, eventName, selector, callback) {</span>
        <span class="gd">-        init(element, eventName, selector, callback)</span>
        <span class="gd">-        // is the handler being attached to an element that doesn&#39;t support this event?</span>
        <span class="gd">-        if ( (!submitBubbles &amp;&amp; this.eventName == &#39;submit&#39; &amp;&amp; !isForm(this.element)) ||</span>
        <span class="gd">-             (!changeBubbles &amp;&amp; this.eventName == &#39;change&#39; &amp;&amp; !isInput(this.element)) ) {</span>
        <span class="gd">-          // &quot;submit&quot; =&gt; &quot;emulated:submit&quot;</span>
        <span class="gd">-          this.eventName = &#39;emulated:&#39; + this.eventName</span>
        <span class="gd">-        }</span>
        <span class="gd">-      }</span>
        <span class="gd">-    )</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  if (!submitBubbles) {</span>
        <span class="gd">-    // discover forms on the page by observing focus events which always bubble</span>
        <span class="gd">-    document.on(&#39;focusin&#39;, &#39;form&#39;, function(focusEvent, form) {</span>
        <span class="gd">-      // special handler for the real &quot;submit&quot; event (one-time operation)</span>
        <span class="gd">-      if (!form.retrieve(&#39;emulated:submit&#39;)) {</span>
        <span class="gd">-        form.on(&#39;submit&#39;, function(submitEvent) {</span>
        <span class="gd">-          var emulated = form.fire(&#39;emulated:submit&#39;, submitEvent, true)</span>
        <span class="gd">-          // if custom event received preventDefault, cancel the real one too</span>
        <span class="gd">-          if (emulated.returnValue === false) submitEvent.preventDefault()</span>
        <span class="gd">-        })</span>
        <span class="gd">-        form.store(&#39;emulated:submit&#39;, true)</span>
        <span class="gd">-      }</span>
        <span class="gd">-    })</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  if (!changeBubbles) {</span>
        <span class="gd">-    // discover form inputs on the page</span>
        <span class="gd">-    document.on(&#39;focusin&#39;, &#39;input, select, texarea&#39;, function(focusEvent, input) {</span>
        <span class="gd">-      // special handler for real &quot;change&quot; events</span>
        <span class="gd">-      if (!input.retrieve(&#39;emulated:change&#39;)) {</span>
        <span class="gd">-        input.on(&#39;change&#39;, function(changeEvent) {</span>
        <span class="gd">-          input.fire(&#39;emulated:change&#39;, changeEvent, true)</span>
        <span class="gd">-        })</span>
        <span class="gd">-        input.store(&#39;emulated:change&#39;, true)</span>
        <span class="gd">-      }</span>
        <span class="gd">-    })</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function handleRemote(element) {</span>
        <span class="gd">-    var method, url, params;</span>
        <span class="gd">-</span>
        <span class="gd">-    var event = element.fire(&quot;ajax:before&quot;);</span>
        <span class="gd">-    if (event.stopped) return false;</span>
        <span class="gd">-</span>
        <span class="gd">-    if (element.tagName.toLowerCase() === &#39;form&#39;) {</span>
        <span class="gd">-      method = element.readAttribute(&#39;method&#39;) || &#39;post&#39;;</span>
        <span class="gd">-      url    = element.readAttribute(&#39;action&#39;);</span>
        <span class="gd">-      params = element.serialize();</span>
        <span class="gd">-    } else {</span>
        <span class="gd">-      method = element.readAttribute(&#39;data-method&#39;) || &#39;get&#39;;</span>
        <span class="gd">-      url    = element.readAttribute(&#39;href&#39;);</span>
        <span class="gd">-      params = {};</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    new Ajax.Request(url, {</span>
        <span class="gd">-      method: method,</span>
        <span class="gd">-      parameters: params,</span>
        <span class="gd">-      evalScripts: true,</span>
        <span class="gd">-</span>
        <span class="gd">-      onComplete:    function(request) { element.fire(&quot;ajax:complete&quot;, request); },</span>
        <span class="gd">-      onSuccess:     function(request) { element.fire(&quot;ajax:success&quot;,  request); },</span>
        <span class="gd">-      onFailure:     function(request) { element.fire(&quot;ajax:failure&quot;,  request); }</span>
        <span class="gd">-    });</span>
        <span class="gd">-</span>
        <span class="gd">-    element.fire(&quot;ajax:after&quot;);</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-  function handleMethod(element) {</span>
        <span class="gd">-    var method = element.readAttribute(&#39;data-method&#39;),</span>
        <span class="gd">-        url = element.readAttribute(&#39;href&#39;),</span>
        <span class="gd">-        csrf_param = $$(&#39;meta[name=csrf-param]&#39;)[0],</span>
        <span class="gd">-        csrf_token = $$(&#39;meta[name=csrf-token]&#39;)[0];</span>
        <span class="gd">-</span>
        <span class="gd">-    var form = new Element(&#39;form&#39;, { method: &quot;POST&quot;, action: url, style: &quot;display: none;&quot; });</span>
        <span class="gd">-    element.parentNode.insert(form);</span>
        <span class="gd">-</span>
        <span class="gd">-    if (method !== &#39;post&#39;) {</span>
        <span class="gd">-      var field = new Element(&#39;input&#39;, { type: &#39;hidden&#39;, name: &#39;_method&#39;, value: method });</span>
        <span class="gd">-      form.insert(field);</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    if (csrf_param) {</span>
        <span class="gd">-      var param = csrf_param.readAttribute(&#39;content&#39;),</span>
        <span class="gd">-          token = csrf_token.readAttribute(&#39;content&#39;),</span>
        <span class="gd">-          field = new Element(&#39;input&#39;, { type: &#39;hidden&#39;, name: param, value: token });</span>
        <span class="gd">-      form.insert(field);</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    form.submit();</span>
        <span class="gd">-  }</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-  document.on(&quot;click&quot;, &quot;*[data-confirm]&quot;, function(event, element) {</span>
        <span class="gd">-    var message = element.readAttribute(&#39;data-confirm&#39;);</span>
        <span class="gd">-    if (!confirm(message)) event.stop();</span>
        <span class="gd">-  });</span>
        <span class="gd">-</span>
        <span class="gd">-  document.on(&quot;click&quot;, &quot;a[data-remote]&quot;, function(event, element) {</span>
        <span class="gd">-    if (event.stopped) return;</span>
        <span class="gd">-    handleRemote(element);</span>
        <span class="gd">-    event.stop();</span>
        <span class="gd">-  });</span>
        <span class="gd">-</span>
        <span class="gd">-  document.on(&quot;click&quot;, &quot;a[data-method]&quot;, function(event, element) {</span>
        <span class="gd">-    if (event.stopped) return;</span>
        <span class="gd">-    handleMethod(element);</span>
        <span class="gd">-    event.stop();</span>
        <span class="gd">-  });</span>
        <span class="gd">-</span>
        <span class="gd">-  document.on(&quot;submit&quot;, function(event) {</span>
        <span class="gd">-    var element = event.findElement(),</span>
        <span class="gd">-        message = element.readAttribute(&#39;data-confirm&#39;);</span>
        <span class="gd">-    if (message &amp;&amp; !confirm(message)) {</span>
        <span class="gd">-      event.stop();</span>
        <span class="gd">-      return false;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    var inputs = element.select(&quot;input[type=submit][data-disable-with]&quot;);</span>
        <span class="gd">-    inputs.each(function(input) {</span>
        <span class="gd">-      input.disabled = true;</span>
        <span class="gd">-      input.writeAttribute(&#39;data-original-value&#39;, input.value);</span>
        <span class="gd">-      input.value = input.readAttribute(&#39;data-disable-with&#39;);</span>
        <span class="gd">-    });</span>
        <span class="gd">-</span>
        <span class="gd">-    var element = event.findElement(&quot;form[data-remote]&quot;);</span>
        <span class="gd">-    if (element) {</span>
        <span class="gd">-      handleRemote(element);</span>
        <span class="gd">-      event.stop();</span>
        <span class="gd">-    }</span>
        <span class="gd">-  });</span>
        <span class="gd">-</span>
        <span class="gd">-  document.on(&quot;ajax:after&quot;, &quot;form&quot;, function(event, element) {</span>
        <span class="gd">-    var inputs = element.select(&quot;input[type=submit][disabled=true][data-disable-with]&quot;);</span>
        <span class="gd">-    inputs.each(function(input) {</span>
        <span class="gd">-      input.value = input.readAttribute(&#39;data-original-value&#39;);</span>
        <span class="gd">-      input.removeAttribute(&#39;data-original-value&#39;);</span>
        <span class="gd">-      input.disabled = false;</span>
        <span class="gd">-    });</span>
        <span class="gd">-  });</span>
        <span class="gd">-</span>
        <span class="gd">-  Ajax.Responders.register({</span>
        <span class="gd">-    onCreate: function(request) {</span>
        <span class="gd">-      var csrf_meta_tag = $$(&#39;meta[name=csrf-token]&#39;)[0];</span>
        <span class="gd">-</span>
        <span class="gd">-      if (csrf_meta_tag) {</span>
        <span class="gd">-        var header = &#39;X-CSRF-Token&#39;,</span>
        <span class="gd">-            token = csrf_meta_tag.readAttribute(&#39;content&#39;);</span>
        <span class="gd">-</span>
        <span class="gd">-        if (!request.options.requestHeaders) {</span>
        <span class="gd">-          request.options.requestHeaders = {};</span>
        <span class="gd">-        }</span>
        <span class="gd">-        request.options.requestHeaders[header] = token;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gd">-  });</span>
        <span class="gd">-})();</span>
        </pre></div>
        <h2>
          <a href='full/#public-robots-txt'>public/robots.txt</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -1,5 +1,5 @@</span>
        <span class="gd">-# See http://www.robotstxt.org/wc/norobots.html for documentation on how to use the robots.txt file</span>
        <span class="gi">+# See http://www.robotstxt.org/robotstxt.html for documentation on how to use the robots.txt file</span>
         #
         # To ban all spiders from the entire site uncomment the next two lines:
        <span class="gd">-# User-Agent: *</span>
        <span class="gi">+# User-agent: *</span>
         # Disallow: /
        </pre></div>
        <h2>
          <a href='full/#script-rails'>script/rails</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -1,6 +0,0 @@</span>
        <span class="gd">-#!/usr/bin/env ruby</span>
        <span class="gd">-# This command will automatically be run when you run &quot;rails&quot; with Rails 3 gems installed from the root of your application.</span>
        <span class="gd">-</span>
        <span class="gd">-APP_PATH = File.expand_path(&#39;../../config/application&#39;,  __FILE__)</span>
        <span class="gd">-require File.expand_path(&#39;../../config/boot&#39;,  __FILE__)</span>
        <span class="gd">-require &#39;rails/commands&#39;</span>
        </pre></div>
        <h2>
          <a href='full/#test-performance-browsing_test-rb'>test/performance/browsing_test.rb</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -1,9 +0,0 @@</span>
        <span class="gd">-require &#39;test_helper&#39;</span>
        <span class="gd">-require &#39;rails/performance_test_help&#39;</span>
        <span class="gd">-</span>
        <span class="gd">-# Profiling results for each test method are written to tmp/performance.</span>
        <span class="gd">-class BrowsingTest &lt; ActionDispatch::PerformanceTest</span>
        <span class="gd">-  def test_homepage</span>
        <span class="gd">-    get &#39;/&#39;</span>
        <span class="gd">-  end</span>
        <span class="gd">-end</span>
        </pre></div>
        <h2>
          <a href='full/#test-test_helper-rb'>test/test_helper.rb</a>
        </h2>
        <div class="highlight"><pre><span class="gu">@@ -1,12 +1,9 @@</span>
        <span class="gd">-ENV[&quot;RAILS_ENV&quot;] = &quot;test&quot;</span>
        <span class="gi">+ENV[&#39;RAILS_ENV&#39;] ||= &#39;test&#39;</span>
         require File.expand_path(&#39;../../config/environment&#39;, __FILE__)
         require &#39;rails/test_help&#39;
         
         class ActiveSupport::TestCase
        <span class="gd">-  # Setup all fixtures in test/fixtures/*.(yml|csv) for all tests in alphabetical order.</span>
        <span class="gd">-  #</span>
        <span class="gd">-  # Note: You&#39;ll currently still have to declare fixtures explicitly in integration tests</span>
        <span class="gd">-  # -- they do not yet inherit this setting</span>
        <span class="gi">+  # Setup all fixtures in test/fixtures/*.yml for all tests in alphabetical order.</span>
           fixtures :all
         
           # Add more helper methods to be used by all tests here...
        </pre></div>
      </div>
    </div>
    <a href='https://github.com/jswanner/RailsDiff'>
      <img alt='Fork me on GitHub' src='https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png' style='position: absolute; top: 0; right: 0; border: 0;'>
    </a>
    <script src='/assets/app.js'></script>
    <script>
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-7325596-4']);
      _gaq.push(['_setSiteSpeedSampleRate', 100]);
      _gaq.push(['_trackPageview']);
      
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = 'http://www.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>
